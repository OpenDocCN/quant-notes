# 爽了！这也太全了！Python金融时间序列分析与量化交易实战教程！终于有人讲透了！线性回归、聚类算法、时间序列预测、股票预测 - P39：38.获取因子指标数据 - 人工智能搬砖学长 - BV1Ri421h7Ry

![](img/138882c63b4f263bd65d9002a516902a_0.png)

这里啊咱们现在已经啊，就是把所有工具包全部给它导进来了，接下来呢咱们就用这个工具啊帮我们去完成。

![](img/138882c63b4f263bd65d9002a516902a_2.png)

哎，我们因此分析任务就行了，而这里就是你看这个阿尔法learns当中啊，然后导进几个模块，UTUS是一会帮我们处理数据的，然后PROTE是帮我们去画图的。



![](img/138882c63b4f263bd65d9002a516902a_4.png)

然后下面俩是帮我们一会做分析的啊，这是一会咱要用到的。

![](img/138882c63b4f263bd65d9002a516902a_6.png)

然后呃因子分析咱名字改过来了行了，在这里咱们写吧，那我们来想一想，这个哎跟之前咱的一个回测框架不太一样吧，回测框架当中啊，有一个憨豆bar要是每天都可以去执行一件事，但是呢你看这里。

咱们现在这个模块当中啊，有每天去执行那一说吗，好像没找到吧，那我要干什么，我是不是现在啊得把很多天的数据取出来啊，他没法每一天帮我取，每一天再帮我取吧。



![](img/138882c63b4f263bd65d9002a516902a_8.png)

那咱们得怎么办，我得自己来去写了啊，咱们先写一下。

![](img/138882c63b4f263bd65d9002a516902a_10.png)

第一步我们要选择一个日期数据，选择日期数据，什么叫选择日日期数据呢。

![](img/138882c63b4f263bd65d9002a516902a_12.png)

你接下来啊要取哎，比如说一个，从19年1月1号到20年1月1号的，你得把这部分日期取出来，因为一会儿啊咱们在查询的过程当中，你得把日期传进去，咱才能查询出来相应的一个结果吧，好了。

咱们来写一下第一个函数，叫做我们去获取一下，获取啊，咱们的一个trading data啊，我们的一个所有的交易的哎，不是data是一个date，就是一个日期日记当中啊，有两个参数。

第一个参数就是呃从哪年，比如说从这个2019年吧，然后1月1号，然后呢接下来第二参数到哪一年，到这个2020年，然后它的一个1月1号哎这就完事了，然后我给他指定一个返回值嘶呃trading dates。

这是咱们现在要用到的所有的日期。

![](img/138882c63b4f263bd65d9002a516902a_14.png)

每写完一步啊，咱都来看一看啊，因为也不确定这个东西写的对不对。

![](img/138882c63b4f263bd65d9002a516902a_16.png)

来检查一下啊，没问题是吧，好了，这是咱们现在指定好了。

![](img/138882c63b4f263bd65d9002a516902a_18.png)

我需要的呃一个时间段当中啊，都有哪些个交易日，咱们现在全拿出来了，接下来呢我们是不是说呃，要获取交易数据指标了，好了。



![](img/138882c63b4f263bd65d9002a516902a_20.png)

获取啊，获取哦因子指标吧，因子指标这些指标怎么获取。

![](img/138882c63b4f263bd65d9002a516902a_22.png)

是不是我们要做这样一个查询的操作了，好了，查询操作当中，你先告诉我，你要去查第一个因子，它叫什么名字。



![](img/138882c63b4f263bd65d9002a516902a_24.png)

这个到时候大家你们可以随便玩啊，咱就拿这个p real来当做我们的一个指标得了啊。

![](img/138882c63b4f263bd65d9002a516902a_26.png)

随便选一个，然后接下来那你说我现在啊，是不是说敌在所有的股票当中哎。

![](img/138882c63b4f263bd65d9002a516902a_28.png)

去把这个因子拿出来啊，那好了，咱们得把股票拿了出来，这里啊我们也不做限制了，搜索A股咱就直接的全部拿出来，然后一会儿咱把这些因子哎都给它打印出来，然后咱们来分析分析啊，看看哪些因子啊。

看看这个因子在不同股票当中啊，它的一个指标怎么样，我们先把所有的哎00300给他。

![](img/138882c63b4f263bd65d9002a516902a_30.png)

全部先拿到手啊。

![](img/138882c63b4f263bd65d9002a516902a_32.png)

XSHD行了，这是我们现在怎么样把所有的股票，咱现在都拿到手了。

![](img/138882c63b4f263bd65d9002a516902a_34.png)

然后指定个名字吧，这就是我现在的一个股票池子啊，这是我现在有的一个股票。

![](img/138882c63b4f263bd65d9002a516902a_36.png)

然后呢有了股票之后，我们是不是要做一个查询操作啊，查什么查基于哎fundamentals当中呃。

![](img/138882c63b4f263bd65d9002a516902a_38.png)

去查一下当前我这个指标来说呀。

![](img/138882c63b4f263bd65d9002a516902a_40.png)

它的一个各种各样的一个情况吧，呃这块儿哎呀这块这个太长了。

![](img/138882c63b4f263bd65d9002a516902a_42.png)

我直接的去复制吧，打开一下咱们的一个帮助文档。

![](img/138882c63b4f263bd65d9002a516902a_44.png)

我们去对data获取是吧，点第一个，然后呢这里哎他就是有所有的API在找啊，就是现在我要去这儿呢，我们去查询一些它的数据，然后这一块我也不用看字段了，我就图方便了，咱直接把这个东西复制过来就行了。

这就是我当前的query语句，我直接复制了，然后复制到哪，我看看啊，复制到这里就行，哎，我要的所有的指标行，咱拿过来，我实在记不住啊，这东西实在太长了好了，咱们来指定一下，这个就是我要查询指标。

我说指定一个QQ呢，等一个query。

![](img/138882c63b4f263bd65d9002a516902a_46.png)

我到这里去查呃，去查它当前的一个P指标，然后呢对于这个P指标，咱可以给他做一个filter，就是看一看他是不是啊，在我的一个主要式当中，咱来写一下哦，这些写挺长点儿，filter下filter当中啊。

还是得把当前的哦这个传进来，我把当前的这个东西直接的复制吧。

![](img/138882c63b4f263bd65d9002a516902a_48.png)

太长了，这个名字把它复制过来。

![](img/138882c63b4f263bd65d9002a516902a_50.png)

然后呢看一下当中它的什么，它的一个代码的名字是吧，我看看他这个stop code当中有没有一个杠啊，这呢是吧，这是有一个杠的啊，把它给它复制过来行了，把它的一个code啊，没有杠。

把他的一个code复制过来。

![](img/138882c63b4f263bd65d9002a516902a_52.png)

然后呢去判断一下它的一个股票是否啊，是在我当前的这个池子当中。

![](img/138882c63b4f263bd65d9002a516902a_54.png)

我的池子刚才定义好名字了吧，好了，在这儿给它复制过来传进去。

![](img/138882c63b4f263bd65d9002a516902a_56.png)

这就行了，这里给大家看了一下，就是当前我们的一个查询语句。

![](img/138882c63b4f263bd65d9002a516902a_58.png)

那做完这个查询语句之后，接下来我们是不是说哎，你得执行这样一个找的操作才行啊。

![](img/138882c63b4f263bd65d9002a516902a_60.png)

好了，我们另起一行在这里呃，执行早操作，我直接复制了，这里也直接get一下，get一下咱们当前数据。

![](img/138882c63b4f263bd65d9002a516902a_62.png)

然后我的一个查询，我说这是个Q，我给它传进来就行了，不光你要告诉我传进来一个Q。

![](img/138882c63b4f263bd65d9002a516902a_64.png)

你还要告诉我什么，哎你的一个查询日期吧，日期咱刚才是不是指定了好了。

![](img/138882c63b4f263bd65d9002a516902a_66.png)

指定日期哎呦，但是这个日期它是一个它是一个序列是吧。

![](img/138882c63b4f263bd65d9002a516902a_68.png)

咱得查询某一天，这样吧，咱就查询某查询第零天吧，先试一试结果对不对啊，先把数据拿到手，然后呃指定个返回值，这个就是我们查询的结果。



![](img/138882c63b4f263bd65d9002a516902a_70.png)

每一天的我们去查的一个factor。

![](img/138882c63b4f263bd65d9002a516902a_72.png)

哎他的一个data数据行了，然后这样咱们执行一下哦，哦这诶执行完没问题是吧。

![](img/138882c63b4f263bd65d9002a516902a_74.png)

不要看这个一些警告，警告跟咱没关系，只是平台它的一些问题咱不用去管。

![](img/138882c63b4f263bd65d9002a516902a_76.png)

然后这里咱们拿到这个数据，拿到这个数据之后啊，嗯咱来看一看吧，这个数据当中也指标，我说点ILOC一下。



![](img/138882c63b4f263bd65d9002a516902a_78.png)

LC当中我需要先看一下吧，它的一个shape值啊，这个需要给大家解释一下它的shift值啊，稍微的有一点不一样啊，你看什么，它是个三维的。



![](img/138882c63b4f263bd65d9002a516902a_80.png)

但实际上来说只有最后一个维度，它是有数据的吧，前两个没什么用啊，咱都不用去管这个事好了。

![](img/138882c63b4f263bd65d9002a516902a_82.png)

那我说前两个那默认就是002，然后接下来最后一个维度，我说我看这么五条数据吧。

![](img/138882c63b4f263bd65d9002a516902a_84.png)

来执行一下，现在有什么了，是不是说哎这是一个咱的股票数据。

![](img/138882c63b4f263bd65d9002a516902a_86.png)

然后这个是它的一个就是具体指标。

![](img/138882c63b4f263bd65d9002a516902a_88.png)

它是等于多少，咱们现在是拿到手了吧，大家可能说诶这怎么没有一个日期啊，因为这里边当你传的过程当中。

![](img/138882c63b4f263bd65d9002a516902a_90.png)

是不是你就只写了当前的某一天，第一天哪天。

![](img/138882c63b4f263bd65d9002a516902a_92.png)

2019年的1月2号吧，啊这是当前对于特定的1000，咱把这个指标给拿出来了。

![](img/138882c63b4f263bd65d9002a516902a_94.png)

但是我们来想一想，现在我们要做什么。

![](img/138882c63b4f263bd65d9002a516902a_96.png)

那现在我在这写一下，我们现在完成的，现在完成就是呃获取啊。

![](img/138882c63b4f263bd65d9002a516902a_98.png)

指定日期吧，指定日期的数据啊，咱们已经会了，怎么样去做。

![](img/138882c63b4f263bd65d9002a516902a_100.png)

那现在呢我们要做什么，我要把这一段的时间全部的给它做出来吧。

![](img/138882c63b4f263bd65d9002a516902a_102.png)