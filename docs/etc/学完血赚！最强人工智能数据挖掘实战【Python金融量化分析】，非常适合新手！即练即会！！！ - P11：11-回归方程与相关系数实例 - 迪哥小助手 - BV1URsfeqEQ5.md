# 学完血赚！最强人工智能数据挖掘实战【Python金融量化分析】，非常适合新手！即练即会！！！ - P11：11-回归方程与相关系数实例 - 迪哥小助手 - BV1URsfeqEQ5

啊，这要写一下吧，就是构建回归方程。其实啊构建这个回约方程方法，其实哎呀特别多，好多工具包都能去做的啊，咱随便选就行。这里呢咱也没导其他工具包，咱就拿这个n派来去做吧。

n派当中啊就是呃有一个fit函数啊，这个fit函数帮我们去构建，或者说帮我们去训练一个回约模型，其实它也不是训练了，就是帮我们去计算一个回约系数就行了。哎，怎么变小了。



![](img/9a5316deb870c4feb6fc0471a5d82b9e_1.png)

![](img/9a5316deb870c4feb6fc0471a5d82b9e_2.png)

![](img/9a5316deb870c4feb6fc0471a5d82b9e_3.png)

回复一下。然后呢，这里边需要我们传建几个参数啊，在之前不是有这样一个数据嘛？啊，把这个数据拿过来。你得告诉啊，在这里边哎，你要去看，就是你要去呃计算这个汇位方程的时候，你得去告诉我啊，有几个参数。

第一个你是谁跟谁的关系啊，是不是你把这两个指标给我传进去啊。好了，第一个指标啊，咱再说了一下是这个点APX是吧？然后再把还有第二个指标。计算它俩之间的一个关系。第二个是一个VX。然后呢还有第三个参数。

呃，第三个参数这样，就是咱们现在啊说这个回归方程，那你比如说这个是个Y，然后这个是这个是个X那你说啊正常情况下咱是Y等于KX加B是吧？那其实呢不光哎Y等于K加B什么意思啊？那这块就是有一个X的一次项。

然后这块乘上了一个X的零次项是吧？那其实上来说不光我可以有一个一次项，我还可以有什么X的二次项，X的一个三次项，X的4次项吧，但是大家通常情况下，你见过这么高阶的吗？好像，没有吧。

一般我们都是一个Y等于K加B比较常见吧。那其实这里啊就是呃你可以不光做一个直线，做一个曲线也行，怎么描述呢？😊，指定个递位值，递归值等于一的意思。就是说这里啊只有X的一个一次项和X的一个零次项。

没有X2次项。那你指定成二呢，你指令成二，它是有X2次项，X的一次项，还有一个X的零次项啊，它是这个意思。这里啊咱就你看这个任务当中也不是一什么曲线吧。

所以啊咱递当中也没必要写个二直接指定成一个一就完事了。哦，我看一下问题，这块它报了一个错，我估计是在求一些逆矩阵。因为在做这个线回归当中，要求逆求逆当中啊肯定会出现一点小问题，咱来看一下吧。

看一下我的输入有没有什么毛病，我把这个输入给它得打印一下。咱家输入啊输入当中有一些空值是吧？这样咱把这个数据啊在稍微处理构建回放程之前，我说呃当前我的一个结果你得等于呃干什么，得对它进行一个A是吧？

然后A一下照A当中，然后我直接其实不用做一个返回值了，我直接得原始数据更改吧。😊。

![](img/9a5316deb870c4feb6fc0471a5d82b9e_5.png)

![](img/9a5316deb870c4feb6fc0471a5d82b9e_6.png)

![](img/9a5316deb870c4feb6fc0471a5d82b9e_7.png)

![](img/9a5316deb870c4feb6fc0471a5d82b9e_8.png)

![](img/9a5316deb870c4feb6fc0471a5d82b9e_9.png)

![](img/9a5316deb870c4feb6fc0471a5d82b9e_10.png)

![](img/9a5316deb870c4feb6fc0471a5d82b9e_11.png)

没有注意更更当时更改，你指定一个inplace，然后等于个处值就可以了。行，然后咱们再来做。

![](img/9a5316deb870c4feb6fc0471a5d82b9e_13.png)

啊，这个没问题了。咱现在就得到了我当前这个方程的一个结果吧。方程结果就相当于这个呃，这是一个K，这是一个B啊，相当于我们已经把这个方程给它解出来了吧。行了，那我们现在已经方程能进行求解了。

能进行求解完的一个方程。你说我现在能不能在图当中把这个结果给它画出来啊。那既然有方程了，咱来把这个结果给它画一下。呃，画过程当中，我们来去呃重新画一下吧。在这里。😊。



![](img/9a5316deb870c4feb6fc0471a5d82b9e_15.png)

还是啊对它进行一个pls操作。呃，第一步我得先把这个散点图画出来吧，底下有这个散点，然后再画这条线吧。行，然后在这里先把这个三点图画来，然后这个看值等于一个散点图，散点图当中，然后呃去指定一下吧。

就是三点图当中，你可以指定一个X等于谁？然后还有一个参数，Y是等于谁？X我就等于这个吧。X跟之前一样，千万别变了，然后Y也是跟之前是一样的。然后呢这是我们一个三点图，然后图稍微的大一点。

这个size等于1个16就行。我要看一看对不对啊？啊，行，这是我们现在大致画出来的一个三点图。然后呢，不光我们要画三点图，还要看什么，还要在这个图当中啊，继续去画什么，一个回归方程吧。好了。

然后说把这个图得到，然后在这个图当中，我要继续去画，继续去画就是再pute一下，呃，把我的回方程给它p进去，回归方程当中啊，就是呃其实回方程它也是由一些点构成的一条线是吧？

就是由最少有两个点构成这样一条线嘛。那这里。

![](img/9a5316deb870c4feb6fc0471a5d82b9e_17.png)

![](img/9a5316deb870c4feb6fc0471a5d82b9e_18.png)

![](img/9a5316deb870c4feb6fc0471a5d82b9e_19.png)

![](img/9a5316deb870c4feb6fc0471a5d82b9e_20.png)

啊，你就以指定我的一个点是什么。点来说第一个值呃，X是这个是吧？我把这个指行出来，就是在这个里边，然后它的一个XX我也拿过来名字别指能错了，直接复制。好了，这是我的一个X。

然后呢我要知道这条线当中这条线里边每一个X值我都知道了，我是不是还也知道这条线当中每一个它的一个Y值等于多少啊，Y值Y值怎么算呢？这里边哎咱用这个n派这个包来去做啊，咱没办法直接去算这个Y值。

但是我们是不是有这个系数啊，咱可以用这个系数来反过头来求它的一个Y值是吧？行，这块给它个返回值吧，这块就是一个regression，然后一个回归，有一个返回值。



![](img/9a5316deb870c4feb6fc0471a5d82b9e_22.png)

![](img/9a5316deb870c4feb6fc0471a5d82b9e_23.png)

![](img/9a5316deb870c4feb6fc0471a5d82b9e_24.png)

返回值啊，就是我该求解出来那样个系数啊，然后有这个回位值之后，就相当于现在是Y等于KX加B。你这个X不是我在这写出来了吗？然后咱该求的求出来的就是这个K和这个B吧。然后我现回传过去。

我是不是就能把这个Y求出来了。相当于啊这个画图挺麻烦的，咱时不用这个包了，这地画图挺麻烦的，然后Y这块我得去回传一下，回传一下计算它的一个Y6值，然后回传过程当中，你得把当前。

你求解出来的这个回位方程给我传进去，不光我回归方程，然后它得用还它把Y求出来，那是不是也得把X输进去啊，X我这样里输进去啊，这里我再把它拿过来，把它当做一个X输进去是不是行了，看一下哎，结果出来了。

这个线别是蓝的了，蓝的太难看了，然后给它改个颜色吧，这里改成一个红色的。😊。

![](img/9a5316deb870c4feb6fc0471a5d82b9e_26.png)

![](img/9a5316deb870c4feb6fc0471a5d82b9e_27.png)

![](img/9a5316deb870c4feb6fc0471a5d82b9e_28.png)

哎，这个红色的线索没了，我看一下在这块，然后我去指定了一下哦，不对。

![](img/9a5316deb870c4feb6fc0471a5d82b9e_30.png)

在这个括号后面是吧？在这一块指定一个红色的眼红色的线行了。现在我们是不是把这个回方程咱就给它画出来了啊，这里回方程一画出来之后，是不是结果就一目了然了，非常容易。

我就可以看到当前两个指标之间到底什么样的关系，全部给它画出来了吧。当然就是指标之间啊，你最好还做一个预处理。因为你看现在的数值是多少。我们现在的数值不是针对于原始的它那个究竟是多少吧。而这块算什么。

它的一个增长率吧啊，所以说这块注意点啊，你要做这个回方程，或者说当你要统计结果的时候，你得看一看怎么样把这个预数据做预处理，或者说预处理成咱们什么样的一个数据，相对来说啊会更合适一点。



![](img/9a5316deb870c4feb6fc0471a5d82b9e_32.png)

![](img/9a5316deb870c4feb6fc0471a5d82b9e_33.png)

![](img/9a5316deb870c4feb6fc0471a5d82b9e_34.png)

![](img/9a5316deb870c4feb6fc0471a5d82b9e_35.png)

![](img/9a5316deb870c4feb6fc0471a5d82b9e_36.png)

![](img/9a5316deb870c4feb6fc0471a5d82b9e_37.png)

![](img/9a5316deb870c4feb6fc0471a5d82b9e_38.png)

然后又想又想到一点，就是这个两两数值之间啊还可以干什么？不光我们能用回归方程来去计算，还有什么相关系数吧，来看一下这个相关系数，相关系数啊其实画起来也非常简单啊，但这个大家写一下吧，那都不用写了。

直接这个我看这个数据。😊。

![](img/9a5316deb870c4feb6fc0471a5d82b9e_40.png)

![](img/9a5316deb870c4feb6fc0471a5d82b9e_41.png)

所以到时候是不是就两就是不是就有两个指标，就这两个指标，咱可以直接画啊，就这两个指标直接画得了。在这当中啊直接算相关系数，这个表是不是就算出来了，非常简单，我们给算什么，它们之间的一个相关系数吧。好了。

自己跟自己的是一，然后他们两个之间对角就是非对角线上肯定是一个对策对称的，你跟我的相关系数和我跟你的相关系数怎么样，都是一样的吧。啊，这样咱就把这个结果给它画出来了。然后呢。

如果说大家要想去我想一想还可以统计哪些个指标。😊，那比如这样，现在还有一个问题啊，哎我再给大家描述一下，把这个呃任务做的稍微的难一点。我说现在咱还有这样一件事儿。啊。

现在我不光啊要去统计它的一个相关系数了。然后你看咱这原始数据当中有什么，这个当中我没写这个问题，我把这个问题推给大家列一列。然后呢，我把这个问题啊再列一列，我说先增加一道附加题吧。呃，根据这个年份。😊。



![](img/9a5316deb870c4feb6fc0471a5d82b9e_43.png)

![](img/9a5316deb870c4feb6fc0471a5d82b9e_44.png)

啊，不是根据年份，就是随着年份的变化啊计算。然后呃它们之间的相关系数的变化情况，然后并展示还，可以吧。好了，把这个题做的稍微难一点。那大家可能会问，那这个怎么做呀？第一点随着年份的变化。

我们是不得考虑一个时间了。但是你说你考虑一个时间点合适吗？肯定不合适吧，肯定要做什么一个窗口吧啊，在这里我们要做很多个窗口了，比如这里是这样。



![](img/9a5316deb870c4feb6fc0471a5d82b9e_46.png)

啊，比如说第一个时间点，那么第一个时间当中取200个窗口行吧。然后第二个指标取这么200就是都是一样的，取相同的一个窗口。取完窗口之后，然后去计算啊，和两个指标之间的一个关系啊，这就行了吧。

这点啊就是我们现在要做的一件事儿，随着年份的变化，计算其相关系数的变化。写代码吧，写代码当中啊，大家看的应该会更直接一点。



![](img/9a5316deb870c4feb6fc0471a5d82b9e_48.png)

![](img/9a5316deb870c4feb6fc0471a5d82b9e_49.png)

![](img/9a5316deb870c4feb6fc0471a5d82b9e_50.png)

数据拿过来啊，数据当中我先拿这么第一个指标复制吧，不想写了。呃，直接这个第一个指标拿过来。

![](img/9a5316deb870c4feb6fc0471a5d82b9e_52.png)

啊，咱们这个标分指标呃，这个指标当中，然后我说哎呀要去算，然后它跟另一个指标之间的一个关系，那这怎么算啊？那其实是这样，我们在这个指标当中啊，我是不是说我要看随着年份的变化。

然后它跟另一个指标之间的一个相关系数变得怎么样了，那是不是说我得对当前这个指标，哎，既然随着年份的变化，我得随着年份构建出来很多个窗口吧。好了，在这里我说我构建一个窗口吧。

我先看一下这个窗口构建选个极利数吧，选个250个行吧。呃，我看一下window等于25，然后呃做一个窗口，做一个窗口完之后，然后接下来用我这个窗口去算这个相关系数，算相关系数，你得告诉我它是跟谁算啊。

跟谁算，这里边有好多个窗口，那肯定就是每一个窗口。

![](img/9a5316deb870c4feb6fc0471a5d82b9e_54.png)

都要去跟我另一个指标去算吧。好了，我把另一个指标拿过来。这是我另一个指标啊，这里底下是这样，就是你算这个相关系数。如果你前面传进来的是一个序列，因为这是滑动嘛啊，滑动好多好多个窗口是吧？滑动窗口之后。

那你接下来第二个它只是一个指标值。那其中啊它会每个指每个窗口都跟它计算吧，每个窗口都给它计算，那是不是相当于随着时间的变化，咱把这个相关系数变化给它求出来了。好了，在这块相关系数当中，我去指定第二指标。

第二指标指定出来了，直接点pro应该就可以了吧？这接点proute一下。d pro当中呢呃指定它的一个大小稍微大一点，1个11个6，这就完事了。呃，来看一下这个结果看一看。



![](img/9a5316deb870c4feb6fc0471a5d82b9e_56.png)

这块啊就是你看它一条直线，因为什么？因为这块画写错了，这个指标没写进去啊，之前复制习惯应该是什么VS吧，再直线一下。行了，当前我们这个变化情况，咱是不是就给它算出来了呀。好了。

这是就是随着我时间的一个变化吧。然后这个点APS我的一个标幅指标和我的一个口慌指数，然后之间它的一个变化情况是不是画出来了。咱刚才画了多少，我看一看之前咱算的应该是一个呃这块结果没了。

我看看大概是一个我之前记得是啊这呢是一个负的点。8几是吧，大概是在都是负的，大概是这样的一个位置是吧？但是这个位置是算什么？从整体上来看，但是现在呢。😊。



![](img/9a5316deb870c4feb6fc0471a5d82b9e_58.png)

![](img/9a5316deb870c4feb6fc0471a5d82b9e_59.png)

![](img/9a5316deb870c4feb6fc0471a5d82b9e_60.png)

![](img/9a5316deb870c4feb6fc0471a5d82b9e_61.png)

我是把它怎么样画成了一个窗口吧，随着时间的一个变化，我能算什么？就是随着时间的变化，我这个指标随着时间的变化，跟当前这个值，然后它的一个变化情况咱是不是指现出来了。好了，跟大家看了一下。

就是啊又额外增加一道附加题吧，看了一看我们的这个相关系数啊，该怎么算，以及相关系数啊，咱都能玩出来哪些各花招啊，能做在事儿其实蛮多的。行了，这节课就跟大家基本上说到这里了，跟大家主要说了一下。

咱们当前啊对于一个金融时间训练啊，一些基本的处理方法，以及呢在padas还有n排当中，怎么样基于这个工具包，做一些统计啊，分析啊以及计算，还有展示这个工作，建议大家啊就是。



![](img/9a5316deb870c4feb6fc0471a5d82b9e_63.png)

![](img/9a5316deb870c4feb6fc0471a5d82b9e_64.png)

![](img/9a5316deb870c4feb6fc0471a5d82b9e_65.png)

![](img/9a5316deb870c4feb6fc0471a5d82b9e_66.png)

![](img/9a5316deb870c4feb6fc0471a5d82b9e_67.png)

![](img/9a5316deb870c4feb6fc0471a5d82b9e_68.png)

看完咱们课程之后，哎，把这些东西自己啊照着先做一遍啊，不用把这个答案去掉，能把这个代码理解它做一件什么事，或者说稍微改一改，你这么做，哎，你取了个这你取了10点，我不带我取8天是不是也行啊。

把这个结果稍微练习一遍啊，咱们内容相对来说啊还是比较多的，这个是一个实验序列。哎，咱们基本的处理方法。



![](img/9a5316deb870c4feb6fc0471a5d82b9e_70.png)

![](img/9a5316deb870c4feb6fc0471a5d82b9e_71.png)

![](img/9a5316deb870c4feb6fc0471a5d82b9e_72.png)

![](img/9a5316deb870c4feb6fc0471a5d82b9e_73.png)