# 4.1 策略信号对接券商自动下单 - P1 - SameQuant量化 - BV1b7421f73G

大家好，这期我们讲解如何将我们的策略的交易信号，对接到券商的QMT自动交易，首先呢我们导入我们这个mi k m t的一个，交易的一个功能包，这样一句话就可以了。



![](img/8be2686e012ee8ec0eb90ab8f05f497c_1.png)

那个封装好了，这个功能包呢就是这样的一个啊，这个文件这个文件里面呢，我们所有的功能都给你封装好了。

![](img/8be2686e012ee8ec0eb90ab8f05f497c_3.png)

你直接拿来用即可啊，这个前提是你本机要先登录你的一个券商的。

![](img/8be2686e012ee8ec0eb90ab8f05f497c_5.png)

QMT软件，好，我们现在运行看一下，先查一下资金，我们可以看到这个资金已经查询到了好。

![](img/8be2686e012ee8ec0eb90ab8f05f497c_7.png)

接下来我们再演示下单看一下啊，这个就是买入下单你也运行一下。

![](img/8be2686e012ee8ec0eb90ab8f05f497c_9.png)

但是现在是啊，周末可能下单的话，他这个是无法下单。

![](img/8be2686e012ee8ec0eb90ab8f05f497c_11.png)

下单会失败啊，因为咱们是模拟账号测试环境，我们可以看到这次有下单，它有一个委托编号。

![](img/8be2686e012ee8ec0eb90ab8f05f497c_13.png)

这个有委托编号表明下单成功，但是周末的话，它实际上这个测试环境是没有委托成功了。

![](img/8be2686e012ee8ec0eb90ab8f05f497c_15.png)

这个特别说明一下哈，这个就是说我们表示交易连接成功了，接下来如何将我们的反包，大阴线策略的一个交易信号，一秒钟出信号嘛，我们上一节讲的是一秒钟出信号，那么我们现在要对接到这个磁盘当中。

这目前还还需要其他的一些工作啊，哪些工作呢。

![](img/8be2686e012ee8ec0eb90ab8f05f497c_17.png)

首先第一步你新建一个JI文件叫反包大阴线，也就是你可以根据你这个策略名啊。

![](img/8be2686e012ee8ec0eb90ab8f05f497c_19.png)

命运一个PY文件，将我们这个八大阴线，完整的一个策略的一个代码。

![](img/8be2686e012ee8ec0eb90ab8f05f497c_21.png)

包含策略框架的一个策略代码也复制过来啊，复制到这里面。

![](img/8be2686e012ee8ec0eb90ab8f05f497c_23.png)

也就是你把这个我们这节3。1课程里面的，这个所有代码复制到这里面来。

![](img/8be2686e012ee8ec0eb90ab8f05f497c_25.png)

就是反包大阴线的这种带复制到这里面，我们再创建一个叫九梦的一个。

![](img/8be2686e012ee8ec0eb90ab8f05f497c_27.png)

一个一个PY文件，这个PY文件主要是什么呢，主要就是说我们的一个定时程序。

![](img/8be2686e012ee8ec0eb90ab8f05f497c_29.png)

我们要定时运行的一些程序或功能啊，全部都写到这里面来好，主要包含哪个呢，第一个就说啊，你要包含一个，就说我每个交易日有5。31分，要当天收盘的一个行情数据啊，所有个股的行情补充到历史行情数据当中。

要保证我们这个日K线行情数据的完整性哈。

![](img/8be2686e012ee8ec0eb90ab8f05f497c_31.png)

这是每天的这个近视程序，就是这个意思，用这个schedule这个包哈。

![](img/8be2686e012ee8ec0eb90ab8f05f497c_33.png)

每天补充这行业数据，接着还有一个程序，就说我要每秒钟预期一次的。

![](img/8be2686e012ee8ec0eb90ab8f05f497c_35.png)

这个叫反包大阴线吹灯梦，他首先呢几句话是判断是否是交易日。

![](img/8be2686e012ee8ec0eb90ab8f05f497c_37.png)

是否是交易时段，这个就是一个咱们的一个策略啊。

![](img/8be2686e012ee8ec0eb90ab8f05f497c_39.png)

这个策略就是反包大阴线的一个策略，这个我们一秒钟出，反包大阴线策略的一个信号啊，这一秒钟一秒钟出来，如果有信号哈，首先这个DFCNL有信号的时候，就这个df c cl它就不为空嘛，如果不为空的时候。



![](img/8be2686e012ee8ec0eb90ab8f05f497c_41.png)

我们就去便利这个DFC了这个表，然后我们去获取它的一个股票代码，当然这里要避免重复下单，所以这里还加了一个一个，就是说这两句是避免重复下单的，也就是说首先我们将这个股票代码和日期，当天的团队。

这个团队是当天的日期，我们形成一个历史，我们要判断这个历史，是否在我们的一个半历史上里面啊，如果不在这个办理历史里面，我们就直接把这个代码啊，我们这个股票这个代码去下单，那这个下单的金额。

比如说这个金额金额你自己试啊，以什么价格去买入下单，我们假设这个以卖五价进行一个下单哈，你这里就运营下单好，如果运行下单之后呢，我们将这个我们这一笔买入的这个股票代码，追加到我们办历史上里面去。

那么他下一笔，如果说又出现了相同的股票代码的信号的话，那就不会买入了，所以说这个这个是一个去除避免买入下单。



![](img/8be2686e012ee8ec0eb90ab8f05f497c_43.png)

这个也要特别注意的哈，就是说我们这个方法就是盘中一秒钟运行一次。

![](img/8be2686e012ee8ec0eb90ab8f05f497c_45.png)

只要说他出信号的时候，我们就立即捕捉到，就能立即下单哈，你盘中循环去，所以说就保证了及时的价单，当然你你改成两秒，这都可以的啊。



![](img/8be2686e012ee8ec0eb90ab8f05f497c_47.png)

你如果想快，你就用一秒就可以了啊，这个没有任何问题好，另外呢就还需要一个定时程序。

![](img/8be2686e012ee8ec0eb90ab8f05f497c_49.png)

什么定时程序呢，因为我们的反包战线涉及到一个。

![](img/8be2686e012ee8ec0eb90ab8f05f497c_51.png)

就说我们上几节课里面涉及到，就是说你如果需要需要一秒钟出信号的话，你在每个交易日收盘之后，我们这里就设置点35分之后。



![](img/8be2686e012ee8ec0eb90ab8f05f497c_53.png)

你要是形成一个什么，形成一个预选。

![](img/8be2686e012ee8ec0eb90ab8f05f497c_55.png)

也就是预选这个数据，你爸符合前15日有10万涨停。

![](img/8be2686e012ee8ec0eb90ab8f05f497c_57.png)

就加上当日跌幅超过负5%的，你把这些股票预选出来。

![](img/8be2686e012ee8ec0eb90ab8f05f497c_59.png)

大概可能就十字以内吧，一般都是情况就是十只以你先把预选出来，这个预选这个方法就是这样。

![](img/8be2686e012ee8ec0eb90ab8f05f497c_61.png)

你还是预其实跟盘中交易的那个一样，你只你只要在15。35再运行一次，这个方法，那么他就会把预选的是当日的盘后的预选数据。



![](img/8be2686e012ee8ec0eb90ab8f05f497c_63.png)

反包装一些预选数据给你生成出来，好这样啊，你在实盘的时候。

![](img/8be2686e012ee8ec0eb90ab8f05f497c_65.png)

你把你直接运行这个schedule，定时这个程序就行了。

![](img/8be2686e012ee8ec0eb90ab8f05f497c_67.png)

你把它运行起来好，我们再打一下啊，开始运行运行实盘反包1600。

![](img/8be2686e012ee8ec0eb90ab8f05f497c_69.png)

就这样的啊，你把它运行起来，运行起来之后。

![](img/8be2686e012ee8ec0eb90ab8f05f497c_71.png)

你你其他的什么都不用管了，盘中的时候你什么都不用管了，这个它就可以永久的一直这么运行下去，只要出信号，它就会自动买入啊，啊，所以呢你整个啊。



![](img/8be2686e012ee8ec0eb90ab8f05f497c_73.png)

我们从策略信号到QMT，交易的一个对接就完成了，就通过这个CHEDULE磁盘的时候，你就保持这个运行就可以了，磁盘的对接啊。



![](img/8be2686e012ee8ec0eb90ab8f05f497c_75.png)

本期就分享到这里，那么下一节呢我们还要讲这另外一个，就是说我们有时候需要。

![](img/8be2686e012ee8ec0eb90ab8f05f497c_77.png)

就是说我们的一个交易信号，或者是一个选股的一个信号，有可能我不需要对接实盘交易。

![](img/8be2686e012ee8ec0eb90ab8f05f497c_79.png)

或者是我需要一个提醒功能，那么就有一个钉钉提醒的一个功能，这个丁免费发消息，这个也是免费的。

![](img/8be2686e012ee8ec0eb90ab8f05f497c_81.png)