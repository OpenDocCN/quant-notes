# 学完血赚！最强人工智能数据挖掘实战【Python金融量化分析】，非常适合新手！即练即会！！！ - P37：37-因子数据预处理 - 迪哥小助手 - BV1URsfeqEQ5

![](img/4e50700acabd521218ff743aff4b8093_0.png)

绕后接来呃，指标查询完了之后，那是不是说我们得做这个呃预处理操作了。预处理操作。在这个预处理操作当中啊，咱是不是呃就是之前给大家说了，咱们三步走，哎，第一步要去极职，第二步标准化，第三步周性化啊。好了。

咱来写啊第一步。

![](img/4e50700acabd521218ff743aff4b8093_2.png)

我们要做一个呃去集值，去集值啊方式挺多，咱们简单点就用这个3西igma，哎，这个比较好用。然后呢，第二步第二步啊，我说我要做一个什么，做一个标准化啊，就是一个stander。



![](img/4e50700acabd521218ff743aff4b8093_4.png)

![](img/4e50700acabd521218ff743aff4b8093_5.png)

![](img/4e50700acabd521218ff743aff4b8093_6.png)

呃，做一这样一个standard一个操作。然后呢，第三步第三步啊，咱们说要做一个中性化的一个操作。咱们来写一下完成我们当前的一个中性化的操作。行了，就这三步就可以了。呃，这也这样吧，咱们先把三个函数。

我们写完。然后呢写完三个函数之后啊，咱们再来去在这里直接去调啊，相当于低均值你要自己写函数，然后标准化自己写，然后中性化也得自己写，比较麻烦啊。先写第一个。



![](img/4e50700acabd521218ff743aff4b8093_8.png)

![](img/4e50700acabd521218ff743aff4b8093_9.png)

![](img/4e50700acabd521218ff743aff4b8093_10.png)

![](img/4e50700acabd521218ff743aff4b8093_11.png)

![](img/4e50700acabd521218ff743aff4b8093_12.png)

![](img/4e50700acabd521218ff743aff4b8093_13.png)

第一个啊就是一个聚集值啊，咱来写一下filterfil什么呢？filter一个3啊，西格玛就行了。在这里啊咱来想一想我传入是什么，那是不是传入一个指标啊，然后呢，咱之前说了是不是一个三西格马。

N等于什么？N等于3吧。好了，接下来咱来写第一步在三西格玛当中，哎，你是不是得说啊我得算出来均值和标准差啊，好了，写一下啊，我们的一个均值还有标准差。😊。



![](img/4e50700acabd521218ff743aff4b8093_15.png)

![](img/4e50700acabd521218ff743aff4b8093_16.png)

![](img/4e50700acabd521218ff743aff4b8093_17.png)

![](img/4e50700acabd521218ff743aff4b8093_18.png)

在这里我们的一个均值比较简单啊，跟咱们之前写的一都是一模一样的。在这里就是一个点幂，然后STD就是它的一个点STD就行了。



![](img/4e50700acabd521218ff743aff4b8093_20.png)

![](img/4e50700acabd521218ff743aff4b8093_21.png)

![](img/4e50700acabd521218ff743aff4b8093_22.png)

那接下来就是一个max，还有这样一个一个命啊，咱们都分别指定一下我的一个上限，还有一个下限range，这也是一个range等于什么？就等于哎我当前的一个均值，然后加上或者是减去多少倍的一个哎。

就是加上一个N倍，这里就是三次马，3乘上我当前的一个STD所不就行了。然后这一块下面都是一样的，只不过说它就是一个减号咱就完事了。这样咱就完成了第一个啊，像哎这还没完成，还得为剩一个值。



![](img/4e50700acabd521218ff743aff4b8093_24.png)

![](img/4e50700acabd521218ff743aff4b8093_25.png)

对特在你的安排当中，我得把跌值不是真正的去掉，而是把它做一个规范啊。在这里zeious给它传进去。然后我们两个参数的两个界限再指定好，这就行。第一个界限，然后还有我们的第二个界限。好了。

这是一个我们的来写下吧，这里这步操作。

![](img/4e50700acabd521218ff743aff4b8093_27.png)

![](img/4e50700acabd521218ff743aff4b8093_28.png)

![](img/4e50700acabd521218ff743aff4b8093_29.png)

啊，我们的一个呃去离询点吧，或者是去啊及职吧，去及职操作。好了，接下来我们再来写还有什么？接下来就是我们第二个第二个当中呃要去做这样一个标准化，我们来写标准化操作。



![](img/4e50700acabd521218ff743aff4b8093_31.png)

![](img/4e50700acabd521218ff743aff4b8093_32.png)

好了，写一下，我们重新啊创建一个函数，在这个函数当中啊，咱来写标准化操作啊，其实题这也是挺简单的，需要我们干什么，其实方法都是一样的，都是需要咱们去计算出来哦stand。😊。



![](img/4e50700acabd521218ff743aff4b8093_34.png)

![](img/4e50700acabd521218ff743aff4b8093_35.png)

![](img/4e50700acabd521218ff743aff4b8093_36.png)

T AND。都是需要我们去计算出来一些指标吧。好了，然后咱的一个呃stander。

![](img/4e50700acabd521218ff743aff4b8093_38.png)

就到sder得了，了解这里，我们来直选一下标准化操作当中啊，咱们要做这样一件事儿。首先还是这两个池，这样池这部都可以直接复制过来了。



![](img/4e50700acabd521218ff743aff4b8093_40.png)

![](img/4e50700acabd521218ff743aff4b8093_41.png)

这样直接复制过来，然后我的一个参数也是直接复制过来。然后这块是直接return一个结果。

![](img/4e50700acabd521218ff743aff4b8093_43.png)

return一下咱的一个s，然后减去一个面，然后呃再哎这这哎再比上这样一个标准差型，再比上1个STD就完事了。这是个标准化操作吧。好了，咱们也下一个下一个咱之前是不是没写过，叫中性化操作。



![](img/4e50700acabd521218ff743aff4b8093_45.png)

![](img/4e50700acabd521218ff743aff4b8093_46.png)

呃，中心化是这样，我们在中心化当中啊，咱之前说了，我们要干什么，是不是哎我说要去做一个回归方程啊，在这个回归方程当中，我们要干什么？是不是说第一步，哎，我得把这个回归方程给它怎么样给它求解出来吧。

求解完出来之后呢，把做一个ntl得了，求解完出来，求解出来之后，我说咱们要用一个真实值减预测值解完之后相当于哎我这个因此它自身应该自身的一个价值是等于多少吧。但是咱们来想一想，这里有需要几个参数啊。😊。



![](img/4e50700acabd521218ff743aff4b8093_48.png)

![](img/4e50700acabd521218ff743aff4b8093_49.png)

哎，这里咱们需要几个参数。咱们之前是不是说了，我看一下这个市镜率，哎，跟我市值之间的关系啊，那其实对于我们的一个市净率来说，它是啥？它是我们的一个因子呢，就是我们的一个factoror。然后呢。

我们要叫拿这个factorctor跟谁做对比啊，是不是跟刚才咱们拿出来这个指标啊，我直接复制过来了，直接哎复制过来。😊。



![](img/4e50700acabd521218ff743aff4b8093_51.png)

![](img/4e50700acabd521218ff743aff4b8093_52.png)

![](img/4e50700acabd521218ff743aff4b8093_53.png)

拿后我们的市净率给我们这个市值啊做一些事儿了。好了，把它俩拿过来。在这里呢咱们说一下，就是谁是X，谁是YY是谁啊？其实这里不用写Y啊，咱们直接用这个参数行，但会让大家看着更明显一点啊。

再给大家强调一遍Y是谁啊？试试看我的一个市值，哎，对这个factor影响有多大，那谁是Y。😊。

![](img/4e50700acabd521218ff743aff4b8093_55.png)

![](img/4e50700acabd521218ff743aff4b8093_56.png)

Y就是我的个因，就是咱们这个因子吧。好了，Y是因子X呢？😊，X哎是我当前的一个市值吧，这没问题吧。好了，接下来咱们之前啊是不是导进来一个this this models啊哦，这块咱们来指定一下。

这块我得把它的API再导进来一下呃，inpart一样。

![](img/4e50700acabd521218ff743aff4b8093_58.png)

![](img/4e50700acabd521218ff743aff4b8093_59.png)

![](img/4e50700acabd521218ff743aff4b8093_60.png)

在这个state models当中，然后呃点API，然后1个SMSM吧。这里我们要用最小二乘法来做一个求解。所以说我得把这个t models拿到手，在这个t model当中，在这个mod当中啊。

咱们求点什么线性回归方程吧。说白了啊往简单说，我们要做一个最小二乘法Y在这个OS当中啊，我们要传建两个参数。第一个就是一个Y值，第二个就是一个X值，咱们先写Y。



![](img/4e50700acabd521218ff743aff4b8093_62.png)

![](img/4e50700acabd521218ff743aff4b8093_63.png)

![](img/4e50700acabd521218ff743aff4b8093_64.png)

然后这个要求啊就是底是一个flowor类型啊，最好给它转成一个flowor类型。S tap一下。S type成咱们的一个flow类型，然后这是一个Y，然后接下来是XX也是一样的。



![](img/4e50700acabd521218ff743aff4b8093_66.png)

传进来我们的一个标签，还有我们的一个数据，这就行了。然后呢，他会把这个模型给我返回回来，我写一个result吧，这就是我的模型。在我的模型当中啊，你说其实哎我想要的是谁啊？

我想 returnturn什么，是不是啊我要return我的一个真实值和我的一个预测值之间的一个差异啊。好了，在这个space model当中啊，咱有个简单的方法，你直接给turn什么？

result当中，它有一个方法，呃，叫做我们的一个残差来找一下。😊。

![](img/4e50700acabd521218ff743aff4b8093_68.png)

![](img/4e50700acabd521218ff743aff4b8093_69.png)

![](img/4e50700acabd521218ff743aff4b8093_70.png)

![](img/4e50700acabd521218ff743aff4b8093_71.png)

![](img/4e50700acabd521218ff743aff4b8093_72.png)

![](img/4e50700acabd521218ff743aff4b8093_73.png)

![](img/4e50700acabd521218ff743aff4b8093_74.png)

哦，这个叫做我们的参叉，但是不是这个把DL去掉，这样咱们先返回什么？就是你去除掉了啊，在这个现微方程当中，你把这个WI加B给去掉了，相当于把咱们市值影响啊，它的一个因素去掉了。那这个相当于是较纯的了。

咱现在就完成了一个提纯的操作啊，方法是比较简单啊啊，咱们用这个 models它这个属性啊直接帮我们自动的算一个差异值了。大家感兴趣啊，你可以自己上一件AP当中看一下啊。

这个属性直接自动的帮你做了咱们的一个差异值。

![](img/4e50700acabd521218ff743aff4b8093_76.png)

![](img/4e50700acabd521218ff743aff4b8093_77.png)

![](img/4e50700acabd521218ff743aff4b8093_78.png)

![](img/4e50700acabd521218ff743aff4b8093_79.png)

![](img/4e50700acabd521218ff743aff4b8093_80.png)

![](img/4e50700acabd521218ff743aff4b8093_81.png)