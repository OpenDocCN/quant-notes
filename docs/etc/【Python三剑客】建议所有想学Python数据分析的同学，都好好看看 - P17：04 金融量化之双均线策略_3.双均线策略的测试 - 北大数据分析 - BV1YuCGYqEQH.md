# 【Python三剑客】建议所有想学Python数据分析的同学，都好好看看 - P17：04 金融量化之双均线策略_3.双均线策略的测试 - 北大数据分析 - BV1YuCGYqEQH

看下最后的一个需求，最后一个需求的话，咱们就基于我们双击线找出的金叉跟死叉，需要让这个策略去执行，买股票跟卖股票啊，看下最终的一个收益如何好，具体的需求只是说，如果一个人呢从2010年开始。

初始资金的是10万块对吧，用这10万的初始资金金叉呢尽量买入股票，那么死叉全部把股票卖出，那么到今天为止他的炒股收益如何吧对吧，那首先这块的话，它的初始资金是100000OK吧。

那么什么叫金叉尽量买入呢，为什么不是金叉全部买入呢，各位这块要理解一下，为什么金叉是尽量买入，而不是全部买入，想一下，因为我们说这个股票你买的话只能是一手，一手买的吧，不能是一股一股买，对不对。

那么我们一次性最少只能买一手吧对吧，那就是说我们这10万块钱有可能啊，有可能不会不会都花光，是不是不会都花光吧，比如说我们一只股票是三块对吧，那么一手股票是不是300啊对吧，那么我们10万块钱买多少手。

能够把这10万花完呢，是不是不是除不尽呢，买不完是不是，所以说我们的净差尽量买入，死叉的话，就把买的全部卖出就可以了吧，看一下我们的炒股收益如何，是不是好，那这个我们该怎么去实现呢。

首先我们知道什么时候买。

![](img/500cf6c2a50703e8328673daa2f71215_1.png)

什么时候卖了吧对吧，在这我们初步的做一个做一个分析，分析，首先第一点我们买卖股票的单价使用什么呢，使用我们的开盘价吧对吧，跟我们的第一个案例是一样的，我们先指定一个买卖股票的单价。

使用开盘价去买就可以了，OK吧好，那第二步啊，我们知不知道买卖股票的时机是什么呢，就什么时候买。

![](img/500cf6c2a50703e8328673daa2f71215_3.png)

什么时候卖呢，这我们说了吧，金叉买死叉卖，那么在前一步。

![](img/500cf6c2a50703e8328673daa2f71215_5.png)

咱们是不是已经找出了我们的金叉时间，跟死叉时间啊对吧，那么金叉所对应的时间买入股票。

![](img/500cf6c2a50703e8328673daa2f71215_7.png)

尽可能多的买入死叉的时间，把买的股票全部卖出吧。

![](img/500cf6c2a50703e8328673daa2f71215_9.png)

对吧好，那这个是咱们分析出来的结论，那还有一个特殊的情况，我们需要关注一下，那就是说有没有可能，最终最终手里会有剩余的股票没有卖出去，会有这样的情况吗，我说会有会有对吧。

那么什么时候我们最终这个人的手里边会剩余，股票没有卖出去呢，我们说了买卖股票的实际是说金叉买入，死叉卖出，那你想如果啊，最后一天就是我们现在股票的历史数据，最后一天为什么呢，为进差为进差则啊。

则是买入股票吧，是不是股票就卖不出去啊，所以说如果最后一天如果为净差的时间，那么我们最终是买入股票，那么最后一天是金叉，就是没有死叉的时间了吧，对吧啊，所以说我们的股票就卖不出去了吧对吧。

所以说有可能最后一天为金差，那么意味着手中会有剩余的股票没有卖出去吧，那么我们需要去估量啊，估量剩余股票的价值，然后计算到计算到这个总收益中吧对吧，那么最终股票剩余价值，我们需要给它衡量一个什么呢。

剩余股票的单价吧对吧，剩余股票的单价，就使用上我们的最后一一天的收盘价来衡量，OK吧，假如最后一天为金叉，他买入了N手股票，OK吧，那么剩余的这N手股票它的实际价格啊。

实际的价值就用咱们整个股票历史数据的，最后一天的收盘价，作为该支剩余股票的一个单价吧，对吧好，那么这个是咱们分析的一个结论哈。



![](img/500cf6c2a50703e8328673daa2f71215_11.png)

结论那么结论分析好了之后呢，那么接下来咱们去实现一下吧，实现一下，首先那这块的话我们已经有了这个什么呢，Ba date，还有我们的这个golden，对的是吧，那一个存放的是金叉的时间。

一个存放的是死叉的时间吧对吧，那么这个金叉的时间需要买入死叉的时间卖出，然后的话那这块我们看一下，那金叉跟死叉的时间都是从02年开始的吧，好看下金叉金叉是从01年啊对吧，那么我们现在题目需求要求。

我们是不是从10年开始进行股票的买卖啊，那我们是不是需要把day的death date。

![](img/500cf6c2a50703e8328673daa2f71215_13.png)

和我们的golden death，它的时间节点调整到2010，到这个今天就是昨天为止啊，对不对，需要调整一下，那这块怎么去调呢，好看一下这块我们这么去调，首先我这块的话有一个S1吧，好S1S1是啥呢。

S1的话我用一个serious来表示，可以吧，serious表示，那然后呢这个serious它的数据源，我给它制定成一，然后index给它制定成这个golden date，那这一步什么意思呢。

那就是现在有一个serious，serious里面存储的元素都是一，是不是都是一啊，这个一我们就作为什么呢，作为金叉的标识。



![](img/500cf6c2a50703e8328673daa2f71215_15.png)

OK吧，现在看一下S1，S1走，你看S1。

![](img/500cf6c2a50703e8328673daa2f71215_17.png)

你看它的时间就是我们的索引吧，显示索引吧，你看这个索引对应的值是一，那么但凡日后呢，我们在S1当中看到的值为一啊，count值为一，就是在series stor中，count值为一。

这个一表示的时间就是金叉时间，OK吧，我们把一作为金叉的标识，当然我们也可以把什么呢，零作为死叉的标识吧对吧好series，然后data等于零，OK吧，那么index等于death啊。

Death data，那现在这块我们说零作为死叉的标识，OK吧，零作为查标识，那现在我们就可以把S跟S1是不是给拼起来，对吧，S就等于S1。2啊，end谁呢，S2吧，那现在我来看一下S走。



![](img/500cf6c2a50703e8328673daa2f71215_19.png)

那这里边的话是不是有一也有零啊对吧，那一作为的是谁，是不是近叉的标识。

![](img/500cf6c2a50703e8328673daa2f71215_21.png)

死零作为是死叉的标识啊对吧，那金叉跟死叉应该是交错的吧。

![](img/500cf6c2a50703e8328673daa2f71215_23.png)

你看我们的图是不是先有一个金叉死叉，金叉死叉是不是金叉死叉交错的呀。

![](img/500cf6c2a50703e8328673daa2f71215_25.png)

那这块的话我们就可以让S等于S点，我们可以让它排下序，可以吧，salt杠index根据我们的index做排序走。



![](img/500cf6c2a50703e8328673daa2f71215_27.png)

你这是排完序之后，再看下S不是0101交错了对吧。

![](img/500cf6c2a50703e8328673daa2f71215_29.png)

一个近差，一个死叉，一个金叉，一个死叉吧对吧。

![](img/500cf6c2a50703e8328673daa2f71215_31.png)

那现在我们S里边存储的，就是我们的金叉跟死叉的时间呀，这里边存储的是金叉和死叉对应的时间，是不是啊，那么一表示金差十啊。



![](img/500cf6c2a50703e8328673daa2f71215_33.png)

零表示死差吧，那我们题目要求，咱们的时间应该是从10年开始的吧对吧，那在这的话S就等于我们切一下吧，S中括号从2010是不是切到多少啊。



![](img/500cf6c2a50703e8328673daa2f71215_35.png)

2020啊对吧，SONY好，那这的话再看一下S走。

![](img/500cf6c2a50703e8328673daa2f71215_37.png)

现在S里边所存储的不就是，从2010~2020。

![](img/500cf6c2a50703e8328673daa2f71215_39.png)

对应的什么呢，这组数据吗对吧，所以现在你看这个S里边存储的是，金叉跟死叉的时间，OK吧，那么一表示金叉，零表示死叉这块各位也能听懂吧，OK吧好，那么现在的话，我们的S有了S里边已经存储好金叉X叉了。

那么接下来咱们要买卖股票了吧对吧，那么意味着这个series当中，这个series当中我们就分析判断它的每一个值吧，如果值是一说明对应的时间刚好是它的索引，是不是进差对吧，就买入股票呗。

用10万块钱尽可能都能买入吧，如果判定的值是零，那么意味着需要把之前买入的股票全部卖出吧，对吧，那这怎么去设计呢，首先我先设计一个变量叫做first杠money，这个是谁呢，这个是他的本金是10万块。

就是本金是吧，本金是不可变的吧对吧，因为我们最终要算它的总收益，是不是总收益，就是说你最终所有这个呃卖股票收入的钱是吧，然后减去你的本金才是你的总收益吧，对吧好，然后的话呢这我再设定一个叫做什么呢。

叫做money，money就等于first money，那么这个money啊，这个money是可变的，那就是说是可变的，那就是我们这个买股票花的钱，和卖股票收入的钱，都从该变量中进行什么进行操作吧对吧。

那就是说我首先买股票啊，买股票我是不是需要花钱啊，花钱从money里边捡吧对吧，比如说你买了5万的股票，就需要从money里面减去5万吧，对吧好，我们的本金是不变的，最终让你的money减去你的本金。

不就是你的总收益吗，对不对，好，我们再设定一个变量叫做hold hold啊，hold的话是什么呢，hold我们表示的是你持有股票的股票的什么呢，股数吧，这个是我们的什么呢。

这个是额持有是由股票的数量可以吧，持有股票数量，如果你买了一手，那么意味着你持有股票的数量是不是100股啊，对不对，这数量指的不是几首吧，指的是我们的股数，是不是股数啊啊好。

那就是说在这我们知道100股啊，等于一首，对不对，好那么定义好了，那么这个三个三个变量，那么接下来咱们是不是该买卖股票了对吧，那从哪儿买卖股票呢，是不是从我们的死叉和金叉进行股票的买卖啊，对吧。

那哪是定叉，哪是死叉呢，我们在这是不可以遍历下谁呢，变了一下我们的这个series啊对吧。

![](img/500cf6c2a50703e8328673daa2f71215_41.png)

这个serious里面存储的是不是零和一啊，那么零表示啥呢，零表示哎这个零对应的时间是一个死叉，咱们该卖股票了吧，一对应是金叉，是不是该买股票了，对不对，所以在这啊去判定。

那现在这个I对应的不就是零和一吗对吧，I要么等于零对吧，要么等于一吧，对不对，等于零意味着是什么呢，是死叉，是不是是死叉，那么需要卖股票吧对吧，等于E的话意味着是金叉，不需要买股票啊对吧，那怎么办呢。

判定呗，if如果I等于等于一，什么意思，那么意味着我们碰到的是金叉的时间吧，近差时间咱们是需要买股票啊对吧，买股票，那怎么买呢，尽可能多的去买吧对吧，尽可能多的去买，在这的话是基于，基于10万的本金啊。

尽可能多的去买入，股票OK吧，这怎么尽可能多的去买支股票呢，那10万块钱一共能买多少多少多少只股票啊，是吧好我们来算一下吧，你看一下，那我们一次性啊，一次性的话只能是买一手股票最少对吧。

一手不就是100只吗对吧，100只是不是乘以多少啊，不是乘以单价呀对吧，100乘以单价，那就是说我们需要知道买一手股票花多少钱吧，对吧，然后让我们的10万除以买一手股票的钱数对吧。

那他所返回的不就是说我们买了多少股票吗，对吧好，那么在这的话咱们就来算一下，那这的单价是什么呢，我们说基于谁去买股票啊，是基于我们当前金差这个时间对应的，这个开盘价去买股票啊对吧。

那这首先啊我们先要去获取什么呢，获取股票的单价，对不对，股票单价，股票单价指的是我们的金叉时间，对应的行数据中的开盘价吧，开盘这样对不对，你比如说第一个金叉是不是。



![](img/500cf6c2a50703e8328673daa2f71215_43.png)

2010年1月20号啊对吧，那我们的原始数据是不是DF啊。

![](img/500cf6c2a50703e8328673daa2f71215_45.png)

从DF里边是不是找出二零，假如说这个是2010年对吧，2010年那一天的日期吧，不把这个值是不取出来，作为我们买股票的单价对吧，那这儿的单价怎么取呢，P就是我们的单价可以吧啊P是单价，P的话就是什么呢。

从DF当中对吧，DF当中，首先我们是不是要取出这个金叉所对应的，行数据啊，对吧，点儿lock取出金叉锁定的行数据，那这个行数据呃应该指定我们的行索引吧，行索引是谁，行索引不就是我们这个S当中的什么呢。

这个一所对应的索引吧，对不对，现在我们的I是不是有了对吧，I有了吧对吧，那么这个I啊，在这的话我们可以S中括号I对吧，S中括号I，那么意味着你看现在啊，现在我们如果第一次循环啊。

第一次循环我们是不是可以拿到什么呢，看一下我们判定的I啊，判定的I就说我们的第一个值吧对吧，第一个值，那如果第一个值啊，我们有了之后，那第一一个值的话，我们是不是需要拿到它的一个什么呢。

拿到它的一个索引呢对吧，那么这块怎么去拿到我们series中，第一个值的索引呢，这么难呢，那这块是不是根据我们的索引去取我们的值啊，所以在这我们去换一下换一下，这样的话我不让他in s了，in什么的。

learn s可以吧，印一个learn s，那么意味着这个I它就是什么呢，就是我们的这个S这个series当中元素的什么呢，个数吧是吧，匀速个数啊，比如说这是一个五，那么意味着I的值是从0~4吧。

那么这个I现在表示的是不是，我们的这个servers当中的这个隐式索引的对吧，现在这个I啊，这个I表示的是什么呢，SS这个series中的隐式索引对吧，原始的啊，原始的这个什么呢。

时间作为的是不是series当中的显示索引啊对吧，现在我这for i in learn s，现在的这个I就变成了series当中的隐式索引了吧，对吧，那么有了隐式索引之后。

那现在我这就不能让I等于等于一了，是不是我们要判定S中括号I吧，你看S中括二不就是根据哎，这个series通过隐式索引取值吗，取错值如果是一啊，如果是一，说明我们取出的值是什么呀，是金叉，对不对金叉。

那么再找出一所对应的索引吧对吧，找出一所对应的索引啊，那现在我们来看一下，那现在这块的话我们已经判定啊，判定这个取出的第一个值对吧，S这个series中取出下标为零，第一个值是一是一的话。

我们需要去买股票，那这需要指定一个什么呀，指定我们的一个单价是不是，那这块单价怎么指定呢，各位单价怎么怎么指定的，单价的话就是说在这儿取出我们的S中，括号I对吧。

是取出我们的第series当中第零个元素啊，是把这第零个元素它的什么呢，它的索引拿到啊，那这拿索引我是通过点儿index拿索引，这取的一定是它的一个显示索引吧对吧，那这个是我们的金叉时间啊对吧。



![](img/500cf6c2a50703e8328673daa2f71215_47.png)

我单独拿出来吧，好这个是我们取出的一个什么呢，time吧，叫做金叉时间，那S中括号I后点index，这取出的就是我们的什么呢，金叉的时间就是一所对应serious值，所对应的索引吧对吧。

那我把time的话作为什么呢，作为我们原数据啊，作为我们原数据的行索引。

![](img/500cf6c2a50703e8328673daa2f71215_49.png)

可以作为行索引，不是不可以啊对吧，就取出了行数据，是不是，那行数据，我们最终想要的是行数据当中的开盘价，中括号，这是不是取出open，那是不是取出开盘价，那现在这个P指的不就是我们的单价吗。



![](img/500cf6c2a50703e8328673daa2f71215_51.png)

对吧好在这我打一下，看P能不能出来吧，走。

![](img/500cf6c2a50703e8328673daa2f71215_53.png)

那这啊是I是这的问题吧。

![](img/500cf6c2a50703e8328673daa2f71215_55.png)

说int object is not，不是可迭代的，是不是啊，这的话是不是得写一个range啊，是吧，range啊，应该是从零到哪呢，到LENREN，这放的是不是我们的S啊。



![](img/500cf6c2a50703e8328673daa2f71215_57.png)

对不对，放的是S啊，现在看下这，这的话还有一个操作，就是说我们在取索引的时候。

![](img/500cf6c2a50703e8328673daa2f71215_59.png)

index写错了吧，indexes吧。

![](img/500cf6c2a50703e8328673daa2f71215_61.png)

index有括号吗。

![](img/500cf6c2a50703e8328673daa2f71215_63.png)

我们来看一下啊，series怎么去取我们的这个索引啊，哎比如说我这有一个什么呢，有一个SS吧，等于series好，这里边存的是什么呢，data存的是123对吧好，那这块的话逗号index。

我们这儿存的是A。

![](img/500cf6c2a50703e8328673daa2f71215_65.png)

C是不是好SS有了吧对吧。

![](img/500cf6c2a50703e8328673daa2f71215_67.png)

这我们取一下索引啊，在这我中括号零走中号零取的是不是一呀。

![](img/500cf6c2a50703e8328673daa2f71215_69.png)

就是一对不对，那现在我想取出是不是一这个值。

![](img/500cf6c2a50703e8328673daa2f71215_71.png)

一这个值所对应的一个索引呢对吧，想取出一这个值它的索引，那么这个索引的话是谁呢，索引的话就是在这就可以这样吧，你看SS点index是不是所有的索引啊是吧。



![](img/500cf6c2a50703e8328673daa2f71215_73.png)

取出的是不是第一个数对应的索引。

![](img/500cf6c2a50703e8328673daa2f71215_75.png)

是不是该这么去写啊对吧，该这么去取啊，那这就是我们说应该是在这应该是什么呢。

![](img/500cf6c2a50703e8328673daa2f71215_77.png)

s d r index吧对吧，S点index是不是取出它所有的索引啊，我们取出的是不是第一个值所对应的索引，对不对，第一个值是我们的I呀，I是不是我们的第一个值啊，对不对。



![](img/500cf6c2a50703e8328673daa2f71215_79.png)

走现在这时候取出来对吧，这取出的是我们对应的这个单价吧对吧。

![](img/500cf6c2a50703e8328673daa2f71215_81.png)

这我们需要知道出错之后怎么去改吧对吧，我们第一次写的时候。

![](img/500cf6c2a50703e8328673daa2f71215_83.png)

一定会有各种各样的问题对吧，但是我们整个的思路有了之后，那即使出现一些小的问题，假设我这不知道到底该怎么取了，那我可以在下边举一个小的例子对吧。



![](img/500cf6c2a50703e8328673daa2f71215_85.png)

测试一下该怎么去取对应的值吧，OK吧，所以说在这再说一遍啊，现在我们的P啊，P是我们购买股票的单价吧，股票的单价对吧。



![](img/500cf6c2a50703e8328673daa2f71215_87.png)

单价我们说需要使用当天啊，当天这个开盘价作为我们的股票单价吧对吧，那这个股票单价的话，我们就可以通过什么，通过我们先取出金叉，比如说这是个金叉，如取出金叉所定的行数据。

再把行数据当中的open j列的值取出，是不是就可以了对吧，那所以说首先我在这需要得到金叉的时间吧，不要得到金叉时间，金叉时间怎么得到啊，首先你看S点index是获得所有的。

就是series这个s serious当中所有的索引啊对吧，那I是不是获得我们的第一个第一个索引值，是吧，那I不就是我们的这个隐式下标吗对吧，它也可以表示我们的第一个索引值吧对吧，那现在我们的P就有了。

P是我们的单价是不是好单价有了之后的话，我们需要在这儿呢制定一下hold hold是什么，就说我们需要买多少股吧对吧，买多少股啊，那这块的话股数怎么求呢，我们首先要知道我们要用本金。

尽可能多的去买股票吧对吧，那么在这的话我们的本金是不是10万的对吧，那就是我们的money是10万啊，money是100000money要除以多少呢，首先我的单价啊，单价乘以100，这是什么。

单价乘以100的话，这是不是一手股票对应的一个价钱呢对吧，一手股票就能价钱，那么让money整除它，让MONY整除它，那这返回的就是说我们用这10万块，最多能买多少手股票吧对吧，最多能买多少手股票。

OK吧，那现在我们来看一下啊，来看一下，那现在得到这样的一个数之后啊，得到这样的数之后，这返回的是什么，我们的10万÷1手股票的花的钱数对吧，那所返回的不就是我们的手吗对吧，就是能买多少手股票吧对吧。

能买多少手股票啊，那这个是我们的买股票的手数，这怎么写呢，Hand，杠count ok吧好，那么在这的话，我们就来看一下他可以买多少手吧，对要买多少手啊，这个是说这个呃实用，使用10万。

最多买入多少首股票。

![](img/500cf6c2a50703e8328673daa2f71215_89.png)

是不是好那手有了，那手有了的话，我们最终是不是在hold里边需要统计什么呀，hold里边是统计一下，那你这么多数股票一共有多少只呢，不让它乘以100，就是我们的hold就是股票的什么呀。

是不是股票的支数啊对吧，就买了多少只呗，OK吧好这个是我们的手数啊，而这个hold，就是说我们尽可能多的买了多少只股票吧对吧。



![](img/500cf6c2a50703e8328673daa2f71215_91.png)

那你买股票的支数是不是在这求出来了是吧。

![](img/500cf6c2a50703e8328673daa2f71215_93.png)

求出来了吧，求出来之后的话，那接下来干啥呢，在这你买股票就得花钱，是不是从money里边是不是减等于一个谁不减，等于我们的这个厚的乘以P啊，这个是什么，这个是说我们买股票花了多少钱吧。

这个钱是不是得从本金里边减出，减减减去啊对吧，将买股票花的钱从啊本金中减去吧，不是本区是不是从我们的这个money中减去啊，是不是可变的这个本金中减去啊对吧，从money中，减去，OK吧减去啊。

那现在的话啊，我们这就是不是进行了买股票操作了对吧，那么除了买的话，你需不需要卖啊，需要卖吧对吧。

![](img/500cf6c2a50703e8328673daa2f71215_95.png)

那卖怎么卖，else不就是卖吗对吧，你看如果if判定它的值是一表示为进叉时间吧，else就表示这个值是零呗，零是不是死叉时间，死叉是说需要将买入的股票卖出去啊对吧。



![](img/500cf6c2a50703e8328673daa2f71215_97.png)

将买入的股票卖出去，那这块的话咱们买了多少多少支股票啊，是不是买了厚的只股票啊，不将厚的只股票全部卖出去啊对吧，基于什么卖出去，是不是基于我们的这个死叉的时间，对应的开盘价卖出去对吧，那这样的话。

首先第一步啊，我们还是需要计算出，或者说这个找出卖出，卖出，股票的单价是多少，是不是，那这是不是跟上面的找法是一样的呀，对吧，找法一样吧，那这怎么找呢，那首先啊我们卖股票的单价也应该是什么呢。

首先也应该是我们的这个死叉对应时间，对应好数据所对应的一个开盘价，是不是，那这怎么找呢，还是P啊，PP这块的话，我们就等于什么等于DF吧，DF是不是原数据点lock。

那么这里边是不是放一个死叉的时间对吧，那这我还需要拿到一个什么呢，time叫做time time，是不是死啥时间，这写一个什么，写一个D1，这样吧，这是死叉时间。

死叉时间的话是谁是我们的这个sdr in index对吧，是不是所有的这个series当中的索引，不取出第X索引啊对吧，如果I如果I所对应的value值不是一，那就是零呗对吧。

那这就找到了这个死叉时间了吧，还把它作用到我们原数据的行索引当中，最终我们在这一行里边，想拿出的不就是我们的open开发价吗对吧，那么这个P啊，这个P是不是我们卖股票对应的什么呢，卖股票对应的这个值啊。

单价是不是啊，卖股票对应的单价啊，好卖股票对应的单价有了之后，你会发现这个是P这个是P，这两个变量会冲突吗，不会冲突吧，因为他们的尊与不一样，是不是尊域不一样吧对吧，在这是不会冲突的吧，对不对啊。

那随时在这啊，在这的话我们单价有了，那接下来去卖吧，卖吧是吧，卖卖股票的话，单价有了，那卖多少只啊，hold里边保存的不就是我们股票的这个数量吗，对吧，hold里边保存的是我们的股票数量。

让P乘以股票数量，是不是卖股票到手多少钱啊对吧，到手多少钱啊，那到手多少钱，那这个钱的话是不是得加到我们的money当中啊，对吧，在这让money不加等于它就可以了对吧，加点它就可以了啊，这个P的话。

如果你想跟上面的P分清的话，这也可以写成一个P杠什么呢，DX是吧，这是我们死叉所对应卖股票的单价吧对吧，这是P杠death，OK吧，好我们这写下注释啊，那么这个是什么，这个是卖股票的单价对吧。

然后这块的话将什么呢，将我们卖出的，卖出的股票收入对吧，是不是加入到哪儿啊，是不是money内容啊，马理中对不对，那股票卖完了之后，那你这块的厚的厚的，是不是应该给他复位成零啊对吧，因为股票都卖出去了。

那ho的值一定要给它赋为零对吧，因否则的话，那下一次继续执行，我们循环的话是不是hold会进行一个累加呀，不得加呀对吧，所以在这一旦股票卖出去后的，一定要给他清空为零，这一步很重要，一定要记着。

OK吧啊好，那现在的话啊，我们在这是不是就计算出了这个money的值啊对吧，然后在这的话，我们最终啊打印一下我们的money是多少吧。



![](img/500cf6c2a50703e8328673daa2f71215_99.png)

走看一下。

![](img/500cf6c2a50703e8328673daa2f71215_101.png)

![](img/500cf6c2a50703e8328673daa2f71215_102.png)

这儿哪有个printer呀，我之前在哪打印过一个printer是吧。

![](img/500cf6c2a50703e8328673daa2f71215_104.png)

我这只要money吧是吧，只要money啊。

![](img/500cf6c2a50703e8328673daa2f71215_106.png)

money没有在循环里边。

![](img/500cf6c2a50703e8328673daa2f71215_108.png)

OK啊刚才是这的问题啊，看一下这的问题在这儿我写错了啊，这块一不小心按了一个type，这自动补全补错了吧，这块我们该加入的是我们的这个这个卖出股票，这个单价锁定的时间的对吧，这应该是this time。

而不是days date吧对吧，这state是我们所有的查时间是吧，应该是date this杠time是不是就可以了对吧，那这块的话我们在这将for循环结束之后，在这呢看一下我们的什么呢。



![](img/500cf6c2a50703e8328673daa2f71215_110.png)

money吧，money money如果是什么呢，正数说明他赚了是不是啊，那如果是负数，说明他赔了呗，赚多少呢。



![](img/500cf6c2a50703e8328673daa2f71215_112.png)

是不是需要让money再减去first money，减去本金呢对吧，减去本金啊，但是呢这还有一个可能啊，我们说这还有可能性，就是说我们说最后啊，最后如果啊有股票卖不出去，说明最后啊一天它是一个金叉。

是不是买股票没有卖出去啊对吧，你在这儿啊，在这如何如何判定，判定最后一天为金叉还是死叉呢，因为如果是金叉，说明他手里边还有剩余的股票吧，有剩余的股票，我们需要将剩余的股票算到他的总收益当中。

是不是OK吧，剩余股票的价值算到总数据当中，那在这的话有同学说可以啊，直接把这个什么呢，把这个series当中啊，最后一个元素取出来，看它是零还是一吧，如果是一说明最后一天是定差，如果是零。

最后一天是死叉吧对吧，这样是没问题的啊，没问题，但是的话这还有一个便捷的方式，我们看谁看ho的cold，你想如果哈如果这个最后一次循环else不走的话，意味着最后一天是进差，最后一天else走的话。

说明最后一天是死叉吧，那else如果走的话，hold值就为零了吧，else不走的话，hold值不为零，是不是，所以说最终的这个什么呢，hold啊，hold我们就看它如果是李莹，李莹的话。

就说明最后一天是一个死叉，股票都卖出去了吧，否则是金叉，是不是没有卖出去啊对吧，那怎么办，就让后的乘以多少，是不是乘以最后一天的单价对吧，最后一天的单价，那最后一天是谁，我们找一下吧。

DF是原数据吧是吧，原数据啊，首先取出它的什么呢，我们说用最后一天的什么呀，收盘价吧对吧，在这一是不是就可以了对吧，这个就是我们剩余股票last杠，OK吧。

NAS money这个是我们最终剩余股票的一个什么呢，剩余股票的价值吧，那如果最后一天为什么呢，最后一天如果为这个死叉的话，hold不就是零吗，零乘以这个单价是不是还是零啊对吧。



![](img/500cf6c2a50703e8328673daa2f71215_114.png)

那所以说最终啊最终我们在这算他的什么，算他的总收益吧。

![](img/500cf6c2a50703e8328673daa2f71215_116.png)

总收益怎么算，应该是什么呢，应该是我们的这个这个什么呢，这个money对吧，这个money money是他卖出股票到手的钱吧，加上谁，last mon是不算上他没有卖出股票。

它的一个实际的价值减去什么的，是不是减去我们的本金。

![](img/500cf6c2a50703e8328673daa2f71215_118.png)

本金是谁，本金是不是first mon，对吧。

![](img/500cf6c2a50703e8328673daa2f71215_120.png)

那这个结果值就是它的总数100是多少呢，走看见了吗，这个是它最终的总汇率，是不是赚的对吧，应该是赚钱了吧。



![](img/500cf6c2a50703e8328673daa2f71215_122.png)

OK吧，算下来啊，那在这的话通过这样的一个代码的编写，在这我们就能够算出什么。

![](img/500cf6c2a50703e8328673daa2f71215_124.png)

算出它，如果基于我们的双均线进行股票买卖的话，它最终的一个总收益如何。

![](img/500cf6c2a50703e8328673daa2f71215_126.png)

是不是OK吧，当然这基于的是我们的什么呢，历史交易数据吧对吧。

![](img/500cf6c2a50703e8328673daa2f71215_128.png)

你想那这的金叉跟死叉找的是啊，过去的这段时间所对应的什么呢，金叉和死叉在过去的时间，我根据金叉叉买死叉卖，那我过去时间都过去了，不可能再买卖了呀，对不对，那找静态跟找什么意义吗，也是有的，OK也是有的。

比如说啊，那在这个比如说在去年当中，我找到的金叉和死叉，比如说去年金叉，它的分布主要是分布在比如说6月5号，7月8号，3月14号，那么明年是吧，他的这个什么经济差，也可能是分布在这几个月份吧对吧。

我就基于这样的一个规律。

![](img/500cf6c2a50703e8328673daa2f71215_130.png)

把它作用到未来的时间节点去买卖股票，是不是就可以了。

![](img/500cf6c2a50703e8328673daa2f71215_132.png)

OK吧好，那么在这的话，咱们就把这两个股票所对应的这个数据，分析的操作就已经实现完毕了啊，那么在这的话咱们最后的一个案例。



![](img/500cf6c2a50703e8328673daa2f71215_134.png)

咱们就是基于这个真实的金融量化的双均线。

![](img/500cf6c2a50703e8328673daa2f71215_136.png)

所写的这样的一组分析的程序，OK吧，那在这的话也可以帮助大家感受一下。

![](img/500cf6c2a50703e8328673daa2f71215_138.png)

那我们的金融量化到底要干什么吧，是不是要写股票买卖的策略。

![](img/500cf6c2a50703e8328673daa2f71215_140.png)

股票买卖的策略怎么写啊，就是基于我们的历史数据去分析。

![](img/500cf6c2a50703e8328673daa2f71215_142.png)

去统计去计算，是不是就可以了对吧，如果哈如果各位你还有很浓的兴趣啊，那么老师给大家去推荐一个平台，叫做巨宽啊，叫距宽，那么你在这的话。



![](img/500cf6c2a50703e8328673daa2f71215_144.png)

你百度搜索距宽，百度搜索距宽就可以看到距宽的一个官网，距宽官网当中，他给你封装好了一系列它自己内部的API，通过他自己的API，就可以自己基于他的API去编写相关的金融策略，OK吧。

并且距宽它还给我们提供了什么，提供了to share的相关功能，区块里边它也是有相关的金融产品的数据，你也可以直接基于区块的API去捕获相关的数据。



![](img/500cf6c2a50703e8328673daa2f71215_146.png)