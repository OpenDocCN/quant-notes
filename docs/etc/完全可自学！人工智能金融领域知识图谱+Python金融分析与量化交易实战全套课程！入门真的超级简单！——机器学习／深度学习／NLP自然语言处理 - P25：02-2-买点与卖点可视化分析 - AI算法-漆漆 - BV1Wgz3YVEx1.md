# 完全可自学！人工智能金融领域知识图谱+Python金融分析与量化交易实战全套课程！入门真的超级简单！——机器学习／深度学习／NLP自然语言处理 - P25：02-2-买点与卖点可视化分析 - AI算法-漆漆 - BV1Wgz3YVEx1

![](img/b70ed43e76648982383fdc830225e3f9_0.png)

好了，我们第一步导进来，咱们当前所需要的这些工具包，安排pandas maplot啊。

![](img/b70ed43e76648982383fdc830225e3f9_2.png)

这不用说了，咱们把之前的全复制过来就行了，然后呢读数据啊。

![](img/b70ed43e76648982383fdc830225e3f9_4.png)

还是啊，我们之前的那个data点CSV指定我们的索引，第一列是什么，第一列索引就是咱们当前选的哎那个时间是吧。



![](img/b70ed43e76648982383fdc830225e3f9_6.png)

然后把时间解析一下啊，然后把这个结果拿到手了，拿到手之后啊，一会我会选个股票啊，这里是有几个股票是吧，咱就拿这个苹果这个股票来当例子。



![](img/b70ed43e76648982383fdc830225e3f9_8.png)

给大家做这样一个实验，然后这个info咱也不用去看了。

![](img/b70ed43e76648982383fdc830225e3f9_10.png)

这是咱的一个数据好了，我们完成这样几个事来看一下吧。

![](img/b70ed43e76648982383fdc830225e3f9_12.png)

咱们要做的事啊，首先第一件事儿啊，你说我们要去选择苹果的骨架，并且呢在咱之前在做例的时候，是不是说可能有问题，什么问题，数据当中可能会存在缺失值吧，易存缺失值哎，你做一些实验窗口的时候可能会有些问题吧。

所以说咱们在预处理的第一个阶段先干什么，把缺失值全部的给它去掉吧，啊这个是我们要去做的一件事行了。

![](img/b70ed43e76648982383fdc830225e3f9_14.png)

在这块我们先把这个数据拿到手，我说这个data啊。

![](img/b70ed43e76648982383fdc830225e3f9_16.png)

我把这个data拿到手吧，等于什么呢，等于啊我把我当前的数据给传进来呃。

![](img/b70ed43e76648982383fdc830225e3f9_18.png)

我只需要一列就行了，就是苹果的这一列吧。

![](img/b70ed43e76648982383fdc830225e3f9_20.png)

好了，把苹果这一列名字我给它复制过来，然后呢，接下来啊现在把这个列我有了，然后干什么哦，不要忘记我们要去去掉这个缺失值吧，再做一个DPA嗯。



![](img/b70ed43e76648982383fdc830225e3f9_22.png)

然后我打印一下这个data data。

![](img/b70ed43e76648982383fdc830225e3f9_24.png)

点high的一下行了，我们现在数据有了，这个不就是咱现在我想要的份数据吗，啊只有苹果这个骨架了，第一个这咱做完了，非常简单吧啊先做了一个取缺失值。



![](img/b70ed43e76648982383fdc830225e3f9_26.png)

第二步计算我短期和长期的一个均线，那短期和长期，第一步，你是不是得先告诉我这个短期咱要多少天，这个长期咱要多少天吧，好那我们来写一下一个短期，然后呢再来一个长期，这里这样就是短期和长期啊。

咱给他写的稍微的大一点。

![](img/b70ed43e76648982383fdc830225e3f9_28.png)

因为咱们这个数据啊，你看我这块看不出来这段数据咱一共多少条，有这么2000多条。

![](img/b70ed43e76648982383fdc830225e3f9_30.png)

大概是得有个78年的一个数据了。

![](img/b70ed43e76648982383fdc830225e3f9_32.png)

所以说在78年的数据当中啊，呃如果你这两个值指定太小了，在咱图当中画的那就太不清楚了，所以说我先把这两个指标值啊，画的稍微的大一点啊，再来看，正常就是短期可能五天比较常见，长期是二天比较常见。

但是我也刚说了，咱们任务相对来说数据量比较多，我把这个数值啊稍微的设置那么大一点啊，咱好观察行，第一步，我先把这个短期和长期的一个时间设出来了，那接下来呢接下来我们是要算这个均线了。



![](img/b70ed43e76648982383fdc830225e3f9_34.png)

或者说算这个走势了，这该怎么算啊，在咱们当前的我的这个数据当中，我是不是要对这个数据做什么，做一个各种窗口吧，得把好多窗口全做出来吧，好了，把我当前的一个短期先传进去，这是我窗口的大小吧。

每个窗口算什么哎咱该说的，比如这都是收盘价，算收盘价是什么值，是不是一个均值啊，在这里我再点M1下，把这个均值拿到手是不行了，然后这里我说我计算了一下呃，然后计算完之后。

我把这个结果回传到咱当前的data frame当中，并且给他指定个名字，可以吧好啦，让我们来执行一下啊，执行完之后哦，把下面也执行吧，下面就是第二个，然后这个改成一个二就得了。



![](img/b70ed43e76648982383fdc830225e3f9_36.png)

执行两次呃，我看下这块出现出现个小问题呃，这个KERO原因啊，是因为现在啊，当我把这个数据就是加了一列之后，前列数据当中不有两列吗，有两列数据，然后我再做这个rowing的时候啊，你就得去指定好了。

你对谁来去做这个rolling这样一件事吧，因为现在我们数据当中它就不是有这么一列了。

![](img/b70ed43e76648982383fdc830225e3f9_38.png)

所以我得给它指定出来，就是在数据当中啊，我对呃。

![](img/b70ed43e76648982383fdc830225e3f9_40.png)

我看的名字啊，对我的苹果的股价啊，这要多加一步，其实正常情况下在上面多加一步也行啊。

![](img/b70ed43e76648982383fdc830225e3f9_42.png)

然后再执行一下啊，行没问题了，然后呢看一下我们当前这个数据点head一下嘶啊。

![](img/b70ed43e76648982383fdc830225e3f9_44.png)

这块会出现好多缺失值是吧，那也正常，因为前面几个窗口。

![](img/b70ed43e76648982383fdc830225e3f9_46.png)

你得最少得有42窗口才能有这样一个值吧，好了，点tail一下吧，tail当中我们是不是能把它的一个短期。



![](img/b70ed43e76648982383fdc830225e3f9_48.png)

还有SMA1是短期啊。

![](img/b70ed43e76648982383fdc830225e3f9_50.png)

这个A2它是一个长期是吧，好了，这一步我们完成了，就是分别咱计算了一下这个短期还有长期均线。

![](img/b70ed43e76648982383fdc830225e3f9_52.png)

我们的一个结果，然后如果大家想画图啊。

![](img/b70ed43e76648982383fdc830225e3f9_54.png)

也很简单，你可以画图展示一下，对我们这个data啊，data当中啊，你不是有这些指标吗，对于data我直接的，我去点plot at一下是就行了，图当中你去指定一下这个图它的一个大小啊。

咱指定的稍微这么大一点，看看结果吧。

![](img/b70ed43e76648982383fdc830225e3f9_56.png)

好了，这图是不是有了，你看这个图当中啊，是不是发现了一些事啊。

![](img/b70ed43e76648982383fdc830225e3f9_58.png)

咱可以来分析分析啊，他是不是有几个焦点，你看我们先来看这个红色的，这就是原原始股价，咱就不看了啊，咱就看这个短期和这个长期，然后有这个红色的，还有这个绿色的，然后呢找一找吧，我们当前这个红色的诶。

这里红色的和绿色当中啊，会有一些点吧，那这些个点是不是都是我们需要考虑的，一些对象了，来看第一个点，第一个点绿色的，我的短期均线跟长期均线做交叉了，并且箭头往哪儿的，往下的说明干什么了。

你说此时哎咱们是该买还是该卖啊，这是什么，这是死亡，这是死亡交叉吧，该卖了这个东西，然后再看一看，我看有没有网上的哦，找一找在这里这个位置，这个位置可能不太明显，来看一看这个位置吧，这个位置挺明显的。

这位置怎么样了，交叉完了怎么样，是要涨了吧，啊这块就是我们的一个黄金交叉。

![](img/b70ed43e76648982383fdc830225e3f9_60.png)

我们的一个买点吧，好了给大家看了一下，就是在这张图当中。

![](img/b70ed43e76648982383fdc830225e3f9_62.png)

我们已经能够啊显示出来了当前一些啊，我们的一个结果了。

![](img/b70ed43e76648982383fdc830225e3f9_64.png)

然后这个数据咱再处理处理吧，上面咱之前看的时候怎么样了，是不是有很多个缺失值啊。

![](img/b70ed43e76648982383fdc830225e3f9_66.png)

所以说咱得把缺失值一会再去掉，我看第三问啊，第三问就是做一个标记标记啊。

![](img/b70ed43e76648982383fdc830225e3f9_68.png)

一下这个短期和长期均线的位置关系。

![](img/b70ed43e76648982383fdc830225e3f9_70.png)

其实说白了就是呃你给我指定个标志位，有position表示是你这个短期均线是大于长期均线，还是一个小于那个长期均线，然后做这个之前咱得把缺失值去掉，刚才是不是给大家看了数据当中啊。

我们的缺失值还是挺多的，我不用，就是要不然你写这个东西，然后等号等于个data，要不然在这块写上就是一个呃，in place等于一个true，相当于在原始数据当中执行这样一次修改的。



![](img/b70ed43e76648982383fdc830225e3f9_72.png)

操作好了，去掉一个缺失值，然后呢在data a当中我们的问题啊，不是说你指定一个标志位嘛，然后通过这个标志位表示的是当前啊，我们的一个位置，它是就是短期的是大于长期的。

还是小于长期的安排点VUE一下VR当中啊，你去指定一下，当前在我的这个电脑当中算一下吧。

![](img/b70ed43e76648982383fdc830225e3f9_74.png)

哦我们的一个短期啊，把这个直接复制过来，我们这个短期的和长期的之间的关系，短期的是否是大于这个长期的VR当中啊，有三个参数，第一个参数就是判断，第二参数就是满足条件下返回什么。

第三个参数不满足条件下返回什么。

![](img/b70ed43e76648982383fdc830225e3f9_76.png)

指定一下是不是就可以啦，好了执行完之后，我来去点HIIT一下，看结果点还得下。

![](img/b70ed43e76648982383fdc830225e3f9_78.png)

你看这里咱们多了一个标志位吧，好了，我们短期的长期的标志位是不是都有了，标志位为一的代表什么，是不是，就是我们的一个短期是大于咱的一个长期，你看从数值上也是我们当前的这样一个结果吧。

然后这个图其实也能画出来啊，咱之前说全系列的时候，我记得好像说过这个东西，对我们data你可以去点pat一下DEPLOG当中呢，然后呃咱之前说的时候是不是说你得去画什么，得去画第二个轴吧。

要不然这个结果啊，sector y sector y当中啊，然后你去指定一下这个Y轴呃，我只有两个Y这个Y轴，然后用谁来当做是比较合适的，我把这个复制过来，acquisition好，这就行了。

然后指定图也是稍微大一点，future size等于一个十逗号六。

![](img/b70ed43e76648982383fdc830225e3f9_80.png)

来看一下吧，这个是不是咱们当前的结果，哎咱之前给大家画过了，那好了。

![](img/b70ed43e76648982383fdc830225e3f9_82.png)

那我现在咱们要做一个策略了，做什么策略呢，哎呀你说这个股票啊，如果呃我就什么都不管。

![](img/b70ed43e76648982383fdc830225e3f9_84.png)

就是从我从我这个最差最早的一个点买起来，来了，我就不管了，然后到最后这个18年一八年中旬的时候吧，我说我把它卖掉，我看一下之前的一块钱，相当于相当于现在几块钱啊，这是什么都不管的前提下。

那现在啊你说我们还应该什么都不管吗，好像不应该了吧，为什么，因为我们之前是不是设计一种策略了，我可以怎么样，有的时候我可以卖掉，有的时候我可以再买进是吧，好啦那我们来想一想。

如果在这个时候我们能把这件事做出来，是不是相当于咱能保证什么，始终我是一个盈利的状态啊，比如这时候这样，这个时候都在这个点的时候，比如说现在你有这么100块，就是就假设吧你的总值是100块钱。

然后你去给他，这时候这时候咱应该怎么样，你给卖掉吧，然后呢这块的时候如果他变成80块钱，你再买进来，那什么意思啊，那是不是说这个时候里外里你还是赚了20呀，是不是这样一件事啊，就是这里这个意思啊。

不是说他现在这个往下走了，就是咱是稳赔的，因为咱刚设计策略了嘛，我可以怎么样，我可以在这个这底下就给它卖掉，然后下一个点我再给他买进，是不就完事儿了，咱刚才不是说了吗，能是能计算出来哪个点该买。

哪个点该卖，所以说啊就是呃永远都是什么，按照咱们这个策略来说，相当于开挂似的，你事先能先知啊，按照咱们这策略来说，就是永远都是盈利的，因为正常情况下，你看什么都不管，这100变80应该是亏20吧。

但是呢我们反而怎么样，我们在这点卖了，在这也得买进来，我们反而怎么样，赚了20吧，哦是这个意思。

![](img/b70ed43e76648982383fdc830225e3f9_86.png)

所以说一会儿啊咱们会一直去赚下去啊，咱们来看一看，就是你什么都不管啊的时候，咱的最终的一个报酬率啊，或者说一块钱能等于现在多少钱，以及我按照咱之前设计的，我们的一个就是买点和卖点。

咱都能通过这个双双均线也算出来吧，然后来看一看我自己设计系统，哎咱们能够一块钱最终赚多少钱啊。

![](img/b70ed43e76648982383fdc830225e3f9_88.png)