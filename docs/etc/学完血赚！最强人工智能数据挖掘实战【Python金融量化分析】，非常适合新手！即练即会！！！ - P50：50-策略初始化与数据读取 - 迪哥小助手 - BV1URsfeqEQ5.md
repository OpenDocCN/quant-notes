# 学完血赚！最强人工智能数据挖掘实战【Python金融量化分析】，非常适合新手！即练即会！！！ - P50：50-策略初始化与数据读取 - 迪哥小助手 - BV1URsfeqEQ5

这里啊我已经是打开了一个新的策略文件。在这里呢，我们一起啊来去动手实现一下这个因子打分选股。行了。然后按照我们的顺序，咱们一步步写啊。第一个咱们现在要做一个注抓方法，在这个contex当中啊。

我们要指定哎当前我们的一个大池子，你要到哪当中去选这个股票啊，咱为了使得这个效果能够偏好一点。哎，咱们直接在那个呃沪深300当中去选啊，这样咱们使得收益率看能够更好看一些啊。好了，咱们写沪深300。

这是咱们现在指定好这一个大池子，然后接下来呢哎我说在这个contex当中啊，哎一会儿我做调仓，那调仓里啊，你是不是得告诉我，哎，我到哪儿去选一些好的股票吧，那这块咱们先指定一个标名字啊。

就是我们上一次哎咱们当前的一个排名情况，一会儿呢我们会把这个排名情况给得到哎，咱们contex当中啊先指定好一会儿在这个当中啊去选啊，那么前十或者是前20个。然后接下来呢咱们来指定一个定日器吧。😊。



![](img/5ec54c53ac401434475f5dbe3d207bec_1.png)

![](img/5ec54c53ac401434475f5dbe3d207bec_2.png)

在这个第二期当中啊，我们去指定一下啊，它的一个调仓，我们是run方法啊，咱选按月调仓。按调当中啊，第一个就是一会儿咱们要去自己啊实现的一个函数，我们写个rebalance。然后第二个写个一就行了。

然后既然我们写好这个函数了，来下来吧，下面我们来定义一下，在这个函数当中我直接复制一块。

![](img/5ec54c53ac401434475f5dbe3d207bec_4.png)

![](img/5ec54c53ac401434475f5dbe3d207bec_5.png)

![](img/5ec54c53ac401434475f5dbe3d207bec_6.png)

啊，写什么，写一下咱们的一个rebanddance函数。在这个rebanddance函数当中啊，我们要做的事儿，其实还是蛮多的。其实最核心的一个什么最核心的哎就是咱们怎么样去指定我们的一个评分了。好了。

rebandd当中呃第一步咱们就得现在把呃那前300个，或者说排序好的300个，或者说是那个排名的10个吧，咱得返回出来，在这块我得知道哎呀，当前你排名完之后的一个股票，那这块咱们自己哎去写一个函数吧。

比如说呃它就是get socks。

![](img/5ec54c53ac401434475f5dbe3d207bec_8.png)

![](img/5ec54c53ac401434475f5dbe3d207bec_9.png)

我们自己写个函数，在这个函数当中啊，它要去帮我们去实际的去呃做一个评分操作。我们来写一下呃，还是把这个分下来，然后名字改一下，叫做get stop。这个函数当中我们就去写吧。第一步干什么？

第一步我们是不是说要去获取哎咱们现在需要的一个数据啊。所以说第一步咱们肯定要做一个查询的操作get。

![](img/5ec54c53ac401434475f5dbe3d207bec_11.png)

![](img/5ec54c53ac401434475f5dbe3d207bec_12.png)

呃，查景操作查询操作当中咱们来写吧。第一个就是你的一个queryquery，我们自己写query吧。在这块我先写好这个query。



![](img/5ec54c53ac401434475f5dbe3d207bec_14.png)

因为我们要查的比较多啊，这块我单独列出来了。我们查查的就是刚才在noble当中，我们是不是哎给大家列出来了有那么6个指标吧，哎，或者是啊有几个指标都行，或者大家自己玩的时候，你选多少个多少个。

咱就以那6个为例子给大家来说吧。好了，咱们一个写第一个我直接复制了这个fument。

![](img/5ec54c53ac401434475f5dbe3d207bec_16.png)

哦，啊，这样算了这些吧，fuamentals他应该会给我提示啊，fuamentals当中呃，咱们要选的第一个就是那个每股收益。在那个金融指标当中，哎，我们有一个每股收益，美股收益啊。

看一下它是一个D开头的。

![](img/5ec54c53ac401434475f5dbe3d207bec_18.png)

![](img/5ec54c53ac401434475f5dbe3d207bec_19.png)

![](img/5ec54c53ac401434475f5dbe3d207bec_20.png)

呃，找一找看一看呃，这这儿呢这儿呢对，就是大家第一个每股收益是吧？不者这样，哎，咱们点下来，这是我们第一个要做的美股收益。我给大家写一下它的一个名字，这就是我的一个。



![](img/5ec54c53ac401434475f5dbe3d207bec_22.png)

每股收益美股收益啊EPS指标。然后我们希望它是怎么样，它是越高越好的。哎，这是我们第一个指标。好了，然后在这块我们写上个逗号。这里咱们是第二指标，然后我们再写第二指标。

第二指标像是我们nobo当中给大家说的，哎，我们还有一个呃净资产的一个收益率啊，跟这个都是一样的。我可以把前面一些全部给它复制过来。好，全部复制过来之后，来找一找净在收益率也是一个净融指标哦。

在这个不是也它是一个收益率，是一个return开头的return开头的当 on一个这个指标。好了，我们来注释一下，它呀叫做一个净资产。



![](img/5ec54c53ac401434475f5dbe3d207bec_24.png)

![](img/5ec54c53ac401434475f5dbe3d207bec_25.png)

![](img/5ec54c53ac401434475f5dbe3d207bec_26.png)

净资产收益率，我们也是希望它它是一个越高越好的。然后呢，再来最后一个吧，最后一个还是哎在这个指标当中都一样的。第三个我们来说哎就是有一个投入资本的一个回报率。投入资本回报率啊。

那也是一个return还开头的回报率嘛。return一下。

![](img/5ec54c53ac401434475f5dbe3d207bec_28.png)

呃，return一下，然后净资产的回报率来找它是一个un什么啊，最后一个是吧？看一下，哎，对，这是我们净资产的回报率。然后呢给它指定名字吧，叫做一个。



![](img/5ec54c53ac401434475f5dbe3d207bec_30.png)

净资产回报率，然后我们也是回报。回报。😔，那啊我们也是希望它能够越高越好的。好了，这是我们现在把这三个指标全部列出来了。那有三个指标之后啊，其实还没完，我们要对这个指标怎么样？哎。

是不是说啊得找一下它已在我的股票当中啊，这个操作估计大家应该相对来说啊都是比较熟悉了。在这块我们指定一个哦filter在这个filter当中，我们来去指定一下filter当中啊来去指定一下吧。

当前哎我们的股票啊得是带我的这个值当中。好了，fuaments点。😊。

![](img/5ec54c53ac401434475f5dbe3d207bec_32.png)

![](img/5ec54c53ac401434475f5dbe3d207bec_33.png)

![](img/5ec54c53ac401434475f5dbe3d207bec_34.png)

一下咱们当前的呃当中，然后有一个t stock in呃t code，然后对它然后点in的一个操作呃，对它然后我们来进行判断一下是不是在我们的石头当中，把我们的一个呃或者300这个池子给拿到手。

这就完事了。行到这里啊，咱们写了一下我们这个queryque制完之后啊，大家注意点这没完，它返回是什么，返回的格式哎，最早一次课所给大家说了，我们得把这个格式怎么样给转正一下吧。

到时候方便我们去取哎它的一个索引的好了，然这块，咱们实际写一下吧，ge fundamental当中，我们来写。



![](img/5ec54c53ac401434475f5dbe3d207bec_36.png)

![](img/5ec54c53ac401434475f5dbe3d207bec_37.png)

![](img/5ec54c53ac401434475f5dbe3d207bec_38.png)

![](img/5ec54c53ac401434475f5dbe3d207bec_39.png)

在这个get函当中啊，我们来去把这个query传进去，呃，这样吧，直接给它复制进来吧，直接把这个query传进去。然后这块正好它是一个点，哎，这也完事了。呃，括号也没什么问题。好了。

这是咱完成的第一件事儿。我们现在把一些越高越好的指标给它拿到手了。然后给它指定个名字吧，咱一会里区分啊，这个东西呃，它是一个越高越好了，指定一个fuamental，我们希望当前得到de frame。

它是越高越好的，指定一个up就行了。然后复制一下吧，就是在我们当前这个指标当中啊，我们不光要拿这个越高越好的，还要拿什么，是不是还有一个是越低越好的呀，来，咱写一个当，我把这些名字，呃稍微改一改就行。

然后下面基本这些操作，咱都不用去改的。

![](img/5ec54c53ac401434475f5dbe3d207bec_41.png)

![](img/5ec54c53ac401434475f5dbe3d207bec_42.png)

![](img/5ec54c53ac401434475f5dbe3d207bec_43.png)

![](img/5ec54c53ac401434475f5dbe3d207bec_44.png)

![](img/5ec54c53ac401434475f5dbe3d207bec_45.png)

几个指标呃，把这个改一改，这个它就不是每股的一个收益率了。我说这个它叫做一个资产的负债率。资产负债率。我们希望这个资产负债率啊，它是一个越低越好的那这三个其实它都是一个越低越好的。

我把这三个值啊拿到手啊，它都是一个越低越好的这是一个资产负债率。然后还有一个就是呃PB的一个一比上1个PB吧啊，因为PB我们希望什么PB我们希望越高越好。所以说啊不是就是一比上1个PB。

我们希望越高越好。所以说当前的1个PB值。我们希望它是一个越低越好的啊，这是1个PB值。

![](img/5ec54c53ac401434475f5dbe3d207bec_47.png)

然后第三个第三个我们再拿到一个市值吧，市值反正也是越小越好的啊，虽便拿着简单的得了。改一改吧。第一个我们给给它改成实际的值，叫做一个资产的负债率呃，资产的一个负债率是吧？好了，找一找它有没有当前哎。

没给我出它的一个提示呢？

![](img/5ec54c53ac401434475f5dbe3d207bec_49.png)

点一下呃，资产的一个负债率，就是哎就是第一个是吧？然后第二个叫做一个PB值，我再点一下呃，点一下就是PB。



![](img/5ec54c53ac401434475f5dbe3d207bec_51.png)

![](img/5ec54c53ac401434475f5dbe3d207bec_52.png)

在这里直接点一下，他应该直接会拿到这个PB。呃，找一找哎，这里怎么没有这个PB呢？哦，当前前面这个不对，前面这个稍微改一改啊，改一下就行了。D然后把这个改成1个PB指标。哎，第就是这是1个PB指标。

我们也希望越低越好的。然后第三个就是我们的一个市值好，直接把这个复制过来吧。

![](img/5ec54c53ac401434475f5dbe3d207bec_54.png)

直接把这个负值，然后是值，它就是一个点market当中的找一找。第一个就是了。好了，我们现在啊就是已经哎把我们当前的呃需要查找两个数据全部做好了。一个我们是越低越好的。

第二个我们是一个第一个我们是一个越高越好的。第二个我们是一个越低越好的行了，这两个值咱现在就有了这个点T哎这块不太对，大家来观察一下，这个点T应该是放哪的，哎，是不是我们最后的时候才放这个点T啊。

那不应该是点框里边吧，应该是你get fundamental之后，我得到data frame对data frame做转制吧。所以这块有点毛病，我们得把这个点T给它放到外面啊，这刚才差有点有点小毛病。

转制要到外面最后我们来去转制的然后这一块做完之后这样吧，咱先打印一下结果来看一看，一会儿咱来打印一下。算了一会儿。😊。



![](img/5ec54c53ac401434475f5dbe3d207bec_56.png)

![](img/5ec54c53ac401434475f5dbe3d207bec_57.png)

啊，一会儿咱来打印吧，等运营运行的时候，其实这块先大家说说结果吧。现在我们得到什么，哎，一共300股票，当前这个dta frame，它的一个ship值多少？300多少3吧。

那下面呢也是1个300多号3吧啊，这块有个越高越好的这块有一个越低越好的。我们现在把这两个呃指标数据，或者是我们的一个因子数据啊，全部给它拿到手了。



![](img/5ec54c53ac401434475f5dbe3d207bec_59.png)

![](img/5ec54c53ac401434475f5dbe3d207bec_60.png)