# 【比刷剧还爽！】这太完整了！量化交易和python金融分析实战课程，全程干货无废话 入门到精通一步到位！（数据挖掘分析／大数据／可视化／投资／金融／股票／算法） - P12：13. 13.13.买点与卖点可视化分析(Av1302064773,P13) - AI算法-溜溜 - BV1iC411n7XN

![](img/a787a07321c0c597e362a2d0a5f9647e_0.png)

好了，我们第一步导进来，咱们当前所需要的这些工具包，安排pandas maplot啊。

![](img/a787a07321c0c597e362a2d0a5f9647e_2.png)

就不用说了，咱们把之前的全复制过来就行了，然后呢读数据啊。

![](img/a787a07321c0c597e362a2d0a5f9647e_4.png)

还是我们之前的那个data点CSV指定我们的索引，第一列是什么，第一列索引就是咱们当前选的那个时间是吧。



![](img/a787a07321c0c597e362a2d0a5f9647e_6.png)

然后把时间解析一下，然后把这个结果拿到手了，拿到之后一会我会选择股票啊。

![](img/a787a07321c0c597e362a2d0a5f9647e_8.png)

这里有几个股票是吧，咱就拿这个苹果这个股票来当例子。

![](img/a787a07321c0c597e362a2d0a5f9647e_10.png)

给大家做这样一个实验，然后这个info咱也不用去看了。

![](img/a787a07321c0c597e362a2d0a5f9647e_12.png)

这是咱的一个数据，好了，我们完成这样几个事来看一下吧。

![](img/a787a07321c0c597e362a2d0a5f9647e_14.png)

咱们要做的事啊，首先第一件事儿啊，你说我们要去选择苹果的股价，并且呢在咱之前在做力的时候，是不是说可能有问题，什么问题，数据当中可能会存在缺失值吧，一存确实值诶，你做一些实验窗口的时候可能会有些问题吧。

所以说咱们在预处理的第一个阶段先干什么，把缺失值全部都给它去掉吧，啊这个是我们要去做的一件事行了。

![](img/a787a07321c0c597e362a2d0a5f9647e_16.png)

在这块我们先把这个数据拿到手，我说这个data啊。

![](img/a787a07321c0c597e362a2d0a5f9647e_18.png)

我把这个data拿到手吧，等于什么呢，等于我把我当前的数据给传进来呃。

![](img/a787a07321c0c597e362a2d0a5f9647e_20.png)

我只需要一列就行了，就是苹果的这一列吧。

![](img/a787a07321c0c597e362a2d0a5f9647e_22.png)

好了，把苹果这一列名字我给它复制过来，然后呢，接下来啊，现在把这个列我有了，然后干什么哦，不要忘记我们要去去掉这个缺失值吧。



![](img/a787a07321c0c597e362a2d0a5f9647e_24.png)

再做一个召回A嗯，然后我打印一下这个data data点。

![](img/a787a07321c0c597e362a2d0a5f9647e_26.png)

还得一下行了，我们现在数据有了，这个不就是咱现在我想要这份数据吗，啊只有苹果这个骨架了，第一个这咱做完了，非常简单吧。



![](img/a787a07321c0c597e362a2d0a5f9647e_28.png)

先做了一个取缺失值，第二步计算我短期和长期的一个均线，那短期和长期，第一步，你是不是得先告诉我这个短期咱要多少天，这个长期咱要多少天吧，好了，我来写一下一个短期，然后呢再来一个长期。

这里这样就是短期和长期啊，咱给他写的稍微的大一点。

![](img/a787a07321c0c597e362a2d0a5f9647e_30.png)

因为咱们这个数据啊，你看我这个看不出来这段数据咱一共多少条。

![](img/a787a07321c0c597e362a2d0a5f9647e_32.png)

有这么2000多条，大概是得有个78年的一个数据了。

![](img/a787a07321c0c597e362a2d0a5f9647e_34.png)

所以说在78年的数据当中啊，呃如果你这两个值指令太小了，在咱图当中画的那就太不清楚了，所以说我先把这两个指标值啊，画得稍微的大一点，再来看，正常就是短期可能五天比较常见，长期是二天比较常见。

但是我刚才说了，咱们任务相对来说数据量比较多，我把这个数值稍微的设置那么大一点啊，咱好观察写，第一步，先把这个短期和长期的时间设出来了，那接下来呢接下来我们是要算这个均线了。



![](img/a787a07321c0c597e362a2d0a5f9647e_36.png)

或者说算这个走势了，这该怎么算啊，在咱们当前的我的这个数据当中，我是不是要对这个数据做什么，做一个各种窗口吧，得把好多窗口全做出来吧，好了，把我当前的一个短期先传进去，这是我窗口的大小吧。

每个窗口算什么，哎，咱该说的比如这都是收盘价，算收盘价是什么值，是不是一个均值啊，在这里我再点名一下，把这个均值拿到手是不行了，然后这里我说我计算了一下呃，然后计算完之后。

我把这个结果回传到咱当前的data frame当中，并且给他指定个名字，可以吧，好了，让我们来实现一下哦，执行完之后我把下面也执行吧，下面就是第二个，然后这个改成一个二就得了。



![](img/a787a07321c0c597e362a2d0a5f9647e_38.png)

执行两次呃，我看下这块出现出现的小问题呃，这个KTL原因是，因为现在当我把这个数据就是加了一列之后，其他列数据当中不是有两列吗，有两列数据，然后再做这个rolling的时候，你就得去指定好了。

你对谁来去做这个rolling这样一件事吧，因为现在我们数据当中它就不是有这么一列了。

![](img/a787a07321c0c597e362a2d0a5f9647e_40.png)

所以我得给他指定出来，就是在数据当中啊，我对呃。

![](img/a787a07321c0c597e362a2d0a5f9647e_42.png)

我看名字啊，对我的苹果的股价啊，这位多加一步，其实正常情况下在上面多加一步也行啊。

![](img/a787a07321c0c597e362a2d0a5f9647e_44.png)

然后再执行一下啊，行没问题了，然后呢看一下我们当前这个数据得head下嘶啊。

![](img/a787a07321c0c597e362a2d0a5f9647e_46.png)

这边会出现好多缺失值是吧，那也正常，因为前面几个窗口。

![](img/a787a07321c0c597e362a2d0a5f9647e_48.png)

你得最少得有42窗口才能有这样一个值吧，好了点，tail一下吧。

![](img/a787a07321c0c597e362a2d0a5f9647e_50.png)

tail当中，我们是不是能把它的一个短期，还有SM1短期啊。

![](img/a787a07321c0c597e362a2d0a5f9647e_52.png)

这个A2它是一个长期是吧，好了这一步我们完成了，就是分别计算了一下这个短期还有长期均线。

![](img/a787a07321c0c597e362a2d0a5f9647e_54.png)

我们的一个结果，然后如果大家想画图也很简单。

![](img/a787a07321c0c597e362a2d0a5f9647e_56.png)

你可以画图展示一下，对我这个data data当中啊，你不是有这些指标吗，对于data我直接的我去点plot一下，说不就行了，图当中你去指定一下这个图它的大小啊。



![](img/a787a07321c0c597e362a2d0a5f9647e_58.png)

咱指定的稍微大一点，看结果吧。

![](img/a787a07321c0c597e362a2d0a5f9647e_60.png)

好了，这图是不是有了，你看这个图当中啊，是不是发现了一些事儿啊。

![](img/a787a07321c0c597e362a2d0a5f9647e_62.png)

咱可以来分析分析啊，他是不是有几个交点，你看我们先来看这个红色的，这就是原原始股价，咱就不看了啊，咱就看这个短期和长期，然后有这个红色的，还有这个绿色的，然后呢找一找吧，我们当前这个红色的诶。

这里红色的和绿色当中会有一些点吧，那这些个点是不是，都是我们需要考虑的一些对象了，来看第一个点，第一个点绿色的，我的短期均线和长期均线做交叉了，并且箭头往哪儿的，往下的说明干什么了。

你说此时诶咱们是该买还是该卖啊，这是什么，这是死亡，这是死亡交叉吧，该卖了这个东西，然后再看一看，我看有没有网上的哦，找一找在这里这个位置，这个位置可能不太明显，来看一看这个位置吧，这个位置挺明显的。

这个位置怎么样了，交叉完了怎么样，是要涨了吧，这就是我们的一个黄金交叉的一个买点吧。

![](img/a787a07321c0c597e362a2d0a5f9647e_64.png)

好了给大家看了一下，就是在这张图当中。

![](img/a787a07321c0c597e362a2d0a5f9647e_66.png)

我们已经能够显示出来了，当前一些啊我们的一个结果了。

![](img/a787a07321c0c597e362a2d0a5f9647e_68.png)

然后这个数据咱再处理处理吧，上面咱之前看的时候怎么样了，是不是有很多个缺失值啊。

![](img/a787a07321c0c597e362a2d0a5f9647e_70.png)

所以说咱得把缺失值一会再去掉，我看第三问啊，第三问就是做一个标记。

![](img/a787a07321c0c597e362a2d0a5f9647e_72.png)

标记一下这个短期和长期经验的位置关系。

![](img/a787a07321c0c597e362a2d0a5f9647e_74.png)

其实说白了就是呃你给我指定用标志位，有position，表示的是你这个短期均线是大于长期均线，还是一个小于那个长期均线，然后做这个之前咱得把缺失值去掉，刚才是给大家看了数据当中啊。

我们的缺失值还是挺多的，我不用就是要不然你写这个东西，然后等号等一个data，要不然你在这边写上就是一个1place等一个true，相当于在原始数据当中执行这样一次修改的。



![](img/a787a07321c0c597e362a2d0a5f9647e_76.png)

操作，好了，去掉一个缺失值，然后呢在大家当中，我们的问题不是说你指定一个标志位嘛，然后通过这个标志位表示的是当前啊，我们的一个位置，它是就是短期的是大于长期的，还是小鱼长期的安排。

点V1下威尔当初去指定一下，当前在我的这个电影当中算一下吧。

![](img/a787a07321c0c597e362a2d0a5f9647e_78.png)

我们的一个短期把这个直接复制过来，我们这个短期的和长期的之间的关系，短期的是否是大于这个长期的位置当中啊，有三个参数，第一个参数就是判断，第二个参数就是满足条件下返回什么。

第三个参数不满足条件下返回什么。

![](img/a787a07321c0c597e362a2d0a5f9647e_80.png)

指定一下就可以了好了，执行完之后来去点hit一下。

![](img/a787a07321c0c597e362a2d0a5f9647e_82.png)

看结果，这还得要你在这里咱们多了一个标志位吧，好了，我们短期的长期的标志位是不是都有了，标志位为一的代表什么，这不就是我们的一个短期是大于咱这个长期，你看从数值上也是我们当前的这样一个结果吧。

然后这个图其实也能画出来啊，咱之前说全系列的时候，我记得好像说过这个东西，对不对，你可以去点一下DEFLOOR当中呢，然后呃咱之前说的时候，是不是说你得去画什么，得去画第二个轴吧，要不然这个结果啊。

SEYSEY当中啊，然后你去指定一下这个Y轴呃，这两个Y这个Y轴，然后用谁来当做是比较合适的，我把这个复制过来好，这就行了，然后指定图也是稍微大一点，size等于一个十根号六来看一下吧。



![](img/a787a07321c0c597e362a2d0a5f9647e_84.png)

这个是咱们当前的结果，咱之前给大家画过了。

![](img/a787a07321c0c597e362a2d0a5f9647e_86.png)

那好了，那我现在咱们要做一个策略了，做什么策略呢，哎呀你说这个股票如果呃我就什么都不管。

![](img/a787a07321c0c597e362a2d0a5f9647e_88.png)

就是从我从我这个最菜最早的一个点买进来了，我就不管了，然后到最后这个18年一八年中旬的时候吧，我说我把它卖掉，我看一下之前的一块钱，相当于现在几块钱啊，这是什么都不管的前提下。

那现在啊你说我们还应该什么都不管吗，好像不应该了吧，为什么，因为我们之前是不是一种策略了，我可以怎么样，有的时候我可以卖掉，有的时候我可以再买进是吧好了，那我们来想一想。

如果在这个时候我们能把这件事做出来，是不是相当于咱能保证什么，始终我是一个盈利的状态啊，比如这时候这样，这个时候在这个点的时候，比如说现在你有这么100块，就是假设吧，你的总值是100块钱。

然后你去给他，这时候这时候咱们应该怎么样给它卖掉吧，然后呢这块的时候如果它变成80块钱，你再买进来，那什么意思啊，那是不是说这个时候里外里你还是赚了20呀，是不是这样一件事啊，就是这里这个意思啊。

不是说他现在这个往下走了，就是咱是稳赔的，因为咱刚才设计策略了吗，我可以怎么样，我可以在这个这里就给它卖掉，然后下一个点我再给他买进，不就完事儿了，咱刚才不是说了吗，能是能计算出来哪个点该买。

哪个点该卖，所以说啊就是呃永远都是什么，按照咱们这个策略来说，相当于开挂似的，你事先能先知啊，按照咱的策略来说，就是永远都是盈利的，因为正常情况下，你看什么都不管，这100变80应该是亏20吧。

但是呢我们反而怎么样，我们在这点卖了，在这点就买进来，我们反而怎么样，赚了20吧，哦是这个意思。

![](img/a787a07321c0c597e362a2d0a5f9647e_90.png)

所以说一会儿啊咱们会一直转下去啊，咱们来看一看，就是你什么都不管啊的时候，咱这最终的一个报酬率啊，或者说一块钱能等于现在多少钱，以及我按照咱之前设计的，我们的一个就是买点和卖点。

咱都能通过这个双双均线也算出来吧，然后来看一看我自己设计系统诶。

![](img/a787a07321c0c597e362a2d0a5f9647e_92.png)

咱们能够一块钱最终赚多少钱啊。