# python数据科学工具-026-pandas-向量化字符串操作例子 - P1 - Vivianzjzjwwy - BV1PhD5Y2EHG

那么在处理真实世界的数据的时候呢，这种向量化的字符串操作呢就非常有用，因为这些数据通常是比较乱，我们这里给出的一个例子呢，是用了一个开放的食谱数据库，它的来源也是从web上收集而来的。

它是从各个不同的源啊，不同的渠道收集而来的，我们的目标呢是几把这些食谱数据库啊，把这部这些食谱数据解析解析出里面的食材啊，每一份食谱所用的食材，那么我们以后呢如果有了手上有了食材以后呢。

我就可以用这个食材去找哪些食谱，用了这些食材，这样呢我就可以去按师傅做菜了啊，那么这个数据呢书上也给了个地址，但是这个书上这个地址呢已经下载不了了，那么你可以去找这个地址去下载啊。

或者你就直接到谷歌上去搜索这个文件，那你必定是这个文件找到的，好如果你在呃苹果也好，在LINUX上也好，你可以用GNZP把它解开，在windows上呢，你就用一般的其他的解解压缩工具，把它解开就行了。

那这个数据呢是一个JSON格式的数据文件，JSON格式其实它是一个很简单的一个格式啊，你可以到网上随便搜一下，总而言之它就是是有结构的一个文本数据，那么呃我们的pandas呢它是提供了一个方法。

pd点提供了一个函数PD点V的JSON，他把这个格式读上来就OK了，但是呢这里所以从web上来的数据，其实有很多问题，那么我们看看会碰到哪些问题，这是激励，Nm i n p。

那本来的话那我就努力的节省啊，有的节省以后呢，我把这个文件名啊，这里我已经解开了，把这个文件名读上来就OK了。



![](img/a92c8221304153a13cb2a8f09b6d7c19_1.png)

但事实上这个地方是不成功的。

![](img/a92c8221304153a13cb2a8f09b6d7c19_3.png)

他说数据有问题的，那么原因是什么呢。

![](img/a92c8221304153a13cb2a8f09b6d7c19_5.png)

如果你打开这个文件啊，或者你在。

![](img/a92c8221304153a13cb2a8f09b6d7c19_7.png)

![](img/a92c8221304153a13cb2a8f09b6d7c19_8.png)

LINUX下或者在苹果下，你都得用这命令，或者你在windows下，你打开这个文件。

![](img/a92c8221304153a13cb2a8f09b6d7c19_10.png)

你可以看一下它这个节省格式呢，它其实整个文件不是节省格式的，它每一条道都是节省格式的，所以我们现在要想办法呢，就把杰森他可以是个数据库，而数是一个数组，那么我想把所有的内容呢包到一个节省的数据。

一个一个列表里面啊，节省了一个数组里面，这样呢我再去解析呢就不会出错了，也就是说我把所有的一行一行全部读上来，读上来以后，然后哎我把它并成一个节省的数组，阶乘的数数呢也很简单，假设这是一个嗯。

一个节省的，这是一个节省对象，那你只要把他这样包含起来啊，把所有的这些这些行，现在我们已经知道，这一行就本身已经是一个合格的，一个合法的一个节省成一个格式了，那么我们现在只需要把它包起来。

然后外面加上一个中间呢用字符串，用逗号隔开外面的包，一个左中括号，右中括号呢，这个是如果拼起来的话呢，那我们的pandas点一的节省这个函数呢，哎就能够把它正常解析了。



![](img/a92c8221304153a13cb2a8f09b6d7c19_12.png)

那所以呢我们现在就是把这个文件读上来。

![](img/a92c8221304153a13cb2a8f09b6d7c19_14.png)

这个文件呢是这样读的，With open，这个呢是一个标准的读法，也就是说我们把这个文件打开，打开呢可以变成一个F，然后我们可以从F里面读东西，那为什么用这个格式呢，因为不管成功也好不成功也好。

这种格式呢就稳定，会被自动会关闭，当然我们只需要读啊，不需要写就行了，这就是R的意思啊，现在我们能把每一行都读上来，读到一个我们的数组里面啊，Python数组里面，那我们可以用啊。

或者Python的tap里面都行，那么我们可以用TAPLE的包含，还有呢就像有些行他会有回车啊，什么这些东西后面的一些空白白空支付呢，我们也不要了，把它STP掉。

那么for line这个就是每一行这样的，我这个tap包含了，我们就得到了一个tap，这个tap里面每一个成员就是一个字符串，这个字符串呢是一个节省的字符串，然后呢我们把它放贝塔里面。

现在贝塔里面就有一行一个成员，一行一个成员这样一个tap，然后呢我把这些TP呢连起来，对我把这些TAO连起来，也就是把每一行连起来，中间用，逗号隔开，哎就像这里，我把每一行连起来，然后用逗号隔开。



![](img/a92c8221304153a13cb2a8f09b6d7c19_16.png)

这个我外面加一个中括号就行了，最后我得一谈节省，我就最后也是个字符串啊，我就在这里面放中括，这零就表示花括号零在一个字符串里面，这时候点FORMULT。

就是指我FORMATTER后面的第零个参数替代过来啊。

![](img/a92c8221304153a13cb2a8f09b6d7c19_18.png)

They are jessic。

![](img/a92c8221304153a13cb2a8f09b6d7c19_20.png)

![](img/a92c8221304153a13cb2a8f09b6d7c19_21.png)

好现在我们得到JSON里面是这样的格式。

![](img/a92c8221304153a13cb2a8f09b6d7c19_23.png)

这个整个一个格式，那这个格式呢是节省格式的，因为它是一个节省数组，现在我就可以用，PV一点read JSON来一趟，节省哎。



![](img/a92c8221304153a13cb2a8f09b6d7c19_25.png)

我就可以得到一个recipes，它里面的包含了所有的，食谱，那么这个地方当然也有点问题了，他有个提示要我们用string IO，那我们就用string i in port IO，我们呢用个性IO。



![](img/a92c8221304153a13cb2a8f09b6d7c19_27.png)

好现在我们看看它有多少条。

![](img/a92c8221304153a13cb2a8f09b6d7c19_29.png)

一共有17万条事故相当大啊，那么它而且有17列。

![](img/a92c8221304153a13cb2a8f09b6d7c19_31.png)

那每一列是什么东西呢，我们大致可以看一下LISX点head。

![](img/a92c8221304153a13cb2a8f09b6d7c19_33.png)

![](img/a92c8221304153a13cb2a8f09b6d7c19_34.png)

是它有id，有name这个食谱的名字，ingredients就是它的食材，也就是它的配方啊，怎么样怎么样的食材组成这一道食食品好。



![](img/a92c8221304153a13cb2a8f09b6d7c19_36.png)

后面还有一些我们也不是在这里，反正我们也不是太关心，那么你可以看看具体的某一条。

![](img/a92c8221304153a13cb2a8f09b6d7c19_38.png)

这个第零条我们来看一下，因为我们要用的是缺损的索引。

![](img/a92c8221304153a13cb2a8f09b6d7c19_40.png)

所以我们用的是i location。

![](img/a92c8221304153a13cb2a8f09b6d7c19_42.png)

第零条，这里其实这数据还是比较乱，就特别是你看这个食谱，我们是比较关心这个食谱的，那里石头。

![](img/a92c8221304153a13cb2a8f09b6d7c19_44.png)

这个食谱的话你看对吧，是比较乱的。

![](img/a92c8221304153a13cb2a8f09b6d7c19_46.png)

那实际上很多从web上来的数据就这样子啊，这个地方的一个师傅，他也不是也没有结构的，它就是一个字符串嗯，所以呢我们需要从里面抽取出我们需要的信息，那我们也看一看这个食谱，关于食谱这一项。

它的大致状况是怎么样的，等于没SI，Yeah，关于ingredients in一点子它的长度，那由于我们要的是所有的所有这个食谱里面嗯，每一每一道食谱的它的，石材的长度，他的状况我们看一下。

所以我们要用STR点。

![](img/a92c8221304153a13cb2a8f09b6d7c19_48.png)

Blame you，It's scribed，Yeah，那我们也可以看看它平均长度难，这个食材的平均长度呢也就是个配方啊，配料表达的是平均长度是250个左右，字，最长呢有我用了很多很多食材。

看起来有接近9000个，9000多，最短的没有，它甚至没有提供十食材的配方，那么这是一个情况啊，那我们看看最长的那个是什么呢，我们也可以了解一下，最长那个就是说，NP点AGONEX。

阿d max就是说我这里最长的它的长度里面，因为这个这样的话。

![](img/a92c8221304153a13cb2a8f09b6d7c19_50.png)

我是一个整数的一个哎series对象对吧，也就是说这是这里面的每一项，就是第几个食谱的，他的食材的长度，那如果我取他的阿格斯，就是最长的那一个食材的，所以就是就是第几个市场，如果第十第一条是最长的。

那他就返回一了，第1万条哎，第1万条是最长，他就返回1万啊，就是它的索引，那么你就可以用这个索引看看他的名字是什么，他的名字name看是有name。



![](img/a92c8221304153a13cb2a8f09b6d7c19_52.png)

有name这一道食谱的这个名字是什么啊。

![](img/a92c8221304153a13cb2a8f09b6d7c19_54.png)

哦这个名字也很长，你看看，那不光是能做这些，我还能做其他的事情，譬如说我们看一下哪些食谱呢，可以是可以用在早餐啊。



![](img/a92c8221304153a13cb2a8f09b6d7c19_56.png)

早餐上的，那这个早餐呢一般是在这个描述里面，description里面对吧，你看这里有什么afternoon对吧。



![](img/a92c8221304153a13cb2a8f09b6d7c19_58.png)

那么这个时候我们就可以用the sides，这个描述里面，description它是不是包含breakfast啊，Breakfast，breakfast也可能拼错啊，他有可能不是说拼错。

有可能是大写的B，也可能是小写的B，但这content呢我们是能包含一个正则表达式的，所以我们给它一个字符类P大V或者小V，这两个里面任何一个都能匹配，Make first。

这里面包含早餐的一共有多少个，看一看好有3524条，或者我们去看看哎，包含桂皮的食材里面，包含桂皮的配方里面这个食材里面ingredients，点STR，点contains，譬如说包含桂皮的有多少个。

他有可能C大写，有可能小写对吧，有1万多个包含桂皮的，那甚至在web上的数据呢，甚至他有可能拼出来，比如说少写一个N啊。



![](img/a92c8221304153a13cb2a8f09b6d7c19_60.png)

这个时候哎他果真有啊，有11条，那这种数这种类型的数据呢，或者对这种类型基本上数据里面包含什么内容，我们去看这些数据，了解一下数据的状况呢，那用pandas string的工具呢就很方便了对吧，那么。

接下去我们做一个简单的一个食谱推荐系统啊，理想的状况是我给出呃几几个师傅，然后呢我就几个呃素食材，那我就能找到一个师傅啊，用了这些食材，当然这说起来很简单，但是你看这里面的数据是很糟糕的，很乱的。

所以实际上做起来也不那么简单，那么我们这就更简单一点啊，我们呢就确定几个食谱，几个常用的一个几个食谱啊，食材特别是那些就是说嗯配料啊对吧，盐啊，胡椒粉啊，或者还有香香用的香草啊等等香料。

那么我们就用这些东西，我们现在就给他一个，就看看这几样哎，这反正随便来的啊，只不过举个例子而已，那我们想要的目的是呢，我们想想构造出这么一个东西来。



![](img/a92c8221304153a13cb2a8f09b6d7c19_62.png)

我们构造出一个data frame，这个data flame呢行呢，就是索引就索引就好了啊，就是缺省的索引就好了，你不用专门关心这个，其实每一个索引就对应的食谱上的索引，对也就是说这个都对应第几个食谱。

第零个食谱，第一个是谱所有的食谱，但是列上呢我们是把刚才那些这些东西。

![](img/a92c8221304153a13cb2a8f09b6d7c19_64.png)

![](img/a92c8221304153a13cb2a8f09b6d7c19_65.png)

作为他的劣，就相当于是，相当于是如果盐第一份食谱用了盐，那我们用了我们就是TRU，没用就是false，举个例子，那tap也一样啊，他用了他就是true，没用就fast，举个例子。

所有的食谱对这些食材的使用情况，有就是true，没有就force，那有了这么一个data，假设我们有了这么一个data frame以后呢，那就事情就简单了对吧，这个我们就可以根据这个系谱。

有没有直接去寻找我这个哪些食谱，用了这些食材，那我们怎么建这个DFM呢，我们的方法是建立一个dictionary，经过一个字典，关键字是取说salt，然后salt后面跟了一个一个系列。

这系列思呢就是求无法式，求法式，也就是说如果在这一行上，在这个第几个识谱上，它一用了，我就是TRU，没有人就force，这个是个S，那pepper也一样，这个字典如果构造出来的话。

那你直接用pandas的data frame，就可以把它创建出这样的一个data frame来，也就是我们要这样一个CELI对着这个key，这个key对这个系列等等等等等等等。

等到这里全部这个这样一个字典建好。

![](img/a92c8221304153a13cb2a8f09b6d7c19_67.png)

那建这个字典也是很困难，也是很简单的，首先呢我们是一个，dictionary包含，也就是说对每一种食材，假设我有一种确定的一种食材，譬如说这个是SPC，等于假设我确定了一种，确定这种情况下。

我怎么找到它对应的这个cs呢，就是每一种食谱里面用还是不用呢，那就很简单了，Resi yeah，The ingredients，他有没有包含吗，有没有包含我们PES，当然这个地方有个问题啊。

因为salt我们是写小写的，他有可能大小写，他混在那里写的对吧，如果你管有了大小写，如果不去管它的话呢，他是缺省情况下呢，他是大小写敏感的，也就是大小写，大写和小写是不一样的。

我们这里呢想要大写和小写呢一样，你怎么写，反正只要包含SALT这四个字母，不管它是大写和小写，我们都要找到，那这种情况下，书上这个这个答案是错的，因为content。

他不能直接后直接后面跟一个参数是没用的啊，我们要要么就是用叫做case，它这么一个参数K等于确认情况下K是true的，也就是说大小写是不一样的，我们要呢大小写一样，就大小写都能找到。

那这样我们就能够得到一个，得到一个SERI就是salt，它对应在每一个食谱里面成分，它的食材有没有包括SHT，包括它就是一个TRU，没包括它就是一个false。



![](img/a92c8221304153a13cb2a8f09b6d7c19_69.png)

这就是我们需要的东西，对啊，那你这看清楚以后，那你就简单了，我们要的是，一个key对啊，这里是一个key，就是食材嘛，然后呢是这个对应的key，他的一个series，那么这样呢是一个TP对吧。

但是diction那里是可以有个包含的，也就是说杰克逊里如果你给他一系列的TP，Number four，Spice inspire，就是我们所有的食材，这样的话呢，他就能创建出我们刚才所说的那个碟形雷。

也就是一个key，一个value，一个key，一个value对吧，这个key这个就是它的value，那这样就能够得到一个支点，啊你看这个字典是不是salt，对应的就是一个CV啊。

pepper对应的又是个C位，所以你就可以用是八的，最后我们得到的这个F就是PD点贝塔frame，用这个字典来去创建出一个data frame。



![](img/a92c8221304153a13cb2a8f09b6d7c19_71.png)

那么你看看这个大概什么样子，是不是跟我们讲的一样对的。

![](img/a92c8221304153a13cb2a8f09b6d7c19_73.png)

这就是我们需要的这个索引呢，就是对应的食谱里面第几条哎，第几个食谱，譬如说这一条食谱，它就包含了pepper，其他的没有，如果是第一个食谱，你看它包含了三样，第三样东西，那有了这个铁塔分类以后。

我们可以做很多事情了啊，其实我们想要做的都已经能做到了，那现在假设我们有三种食材，我们要去查这个三种食材在哪些食谱里面有，那么你可以这样，selection等于by思DF桌上用的快理。

我们这里其实不需要用快的，我们用我们之前学过的内容就可以了，假设我是这个需要，安慰语，嗯比如说这个也需要，以前呢我们有三种食材，啊这也是，这样你看看有多少准，十十二寸你可以看一下来。



![](img/a92c8221304153a13cb2a8f09b6d7c19_75.png)

对吧，是不是这个为真得到了这个为真，还有这个都为正这12种，那么这个时候这个selection里面的index，就是前面的这些index对。



![](img/a92c8221304153a13cb2a8f09b6d7c19_77.png)

就这个最前面的那个index，那我们用这index就可以找到食谱的名字了，那么你就可以用这个index这SX，点main selection，点index。



![](img/a92c8221304153a13cb2a8f09b6d7c19_79.png)

这样就找到这用了，同时用了这三种食材的。

![](img/a92c8221304153a13cb2a8f09b6d7c19_81.png)

所有食谱的名字都在这里，那么这个例子看下来呢，希望你对pandas字符串方法呢，如何去进行有效的数据清理呢，有一些稍微有点了解，当然了，如果你真的要写一个非常强壮的一个，食谱对接系统的话。

你还要做很多工作啊，这里面呢从食谱，每个食谱里面提取出完整的食材列表呢，是任务的一个非常重要的组成部分对吧，但这很不幸的是，这些数据啊都是从web上来的，那么它的格式是多种多样的。

所以这个工作就会相对来说会比较耗时，但是在事实上呢在数据科学里面嗯，清理啊，或者说整理现实世界的数据呢，通常占了大部分的工作量，大部分的时间都花在这上面，那么pandas呢提供了这些工具。

它可以呢帮助你比较高效的去完成这些工作。

![](img/a92c8221304153a13cb2a8f09b6d7c19_83.png)