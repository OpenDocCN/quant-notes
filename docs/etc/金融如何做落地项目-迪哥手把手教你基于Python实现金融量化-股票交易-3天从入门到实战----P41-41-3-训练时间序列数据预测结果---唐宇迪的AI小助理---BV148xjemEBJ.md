# 【Python金融分析与量化交易实战】AI结合金融如何做落地项目？迪哥手把手教你基于Python实现金融量化+股票交易，3天从入门到实战！ - P41：41.3-训练时间序列数据预测结果 - 唐宇迪的AI小助理 - BV148xjemEBJ

![](img/7a42618780ae1b04c1f9bc3afb706fe1_0.png)

接下来啊咱们实际的执行这个函数啊，得到我们想要得到的这个序列就可以了。

![](img/7a42618780ae1b04c1f9bc3afb706fe1_2.png)

第一步还是先把咱们数据啊做一个基本操作，咱先把所有数据做一个标准化，标准化其实方法非常简单，就是一个X然后减去它的一个均值，再比上一个标准差减均值的目的啊，就是让数据哎以零为中心点做一个对称。

剪完均值之后，大概数据这样就是原始数据，拿红色画吧，它可能浮动范围都挺大的，一堆点的数据，然后呢减完均值之后，各维度减完均值啊，拿绿拿黄色吧，各维度减哎呀，黄色看不出来，拿蓝色吧，各个维度减完均值之后。

它肯定是以原点为中心进行对称的吧，然后呢再比上标准差，让各个维度啊取值范围尽可能是一致的，都在一个比较小，可能负的一点多到正的一点多的一个范围，区间上，这一步啊是一个标准化操作，然后做这个标准化的时候。

大家注意点啊，就是我们不能用验证集或者训练集，数据参与到做标准化的计算当中，其实说白了就是让你训练过程当中啊，无论哪一步都不能用到，之后验证集或者是测试集当中信息，所以说咱们全部的操作。

都是基于训练集来去做的，你看这里我们是不是说在这一块，我说我把训练集哎，把这个实际把这30万是吧，把实际选集数据取出来算均值，实际的选集数据取出来算一个标准差，然后接下来再去执行这样一个标准化操作吧。

没有涉及到任何跟验证集。

![](img/7a42618780ae1b04c1f9bc3afb706fe1_4.png)

还有测试集啊相关的一些操作的好了，然后我们指定下参数吧，第一个参数，第一个参数就是呃我当前来去指定一下呃，我的一个窗口大小，刚刚也说了，窗口大小，你希望连续多少天，不是连续多少个样本的数据。

这里20连续20个数据，然后这个ta值为零。

![](img/7a42618780ae1b04c1f9bc3afb706fe1_6.png)

什么意思啊，再来看一下吧，这一块有这样的操作，就是实际的一个label值等于多少，11个target的值，如果它也值为零，哎不是如果target的值啊为零，什么意思啊，相当于它是取虚拟的一个序列。

完了之后的下一个吧，默认就是下一个tan是唯一，那就是下两个哎。

![](img/7a42618780ae1b04c1f9bc3afb706fe1_8.png)

这个意思这个是我们啊去指定了一下参数，折完参数之后啊，然后对我们的一个训练集，还有一个验证集，分别去执行一下咱这个操作，这就可以了，这里啊就是哎就是咱们该不是指定一个参数吧。

30万表示的是嗯整从整个数据当中取多少，当训练集取多少，当验证集，这可两个函数执行完之后啊，咱们就有了我们当前所需的一个训练数据，还有验证数据，然后到时候大家你可以执行完之后。



![](img/7a42618780ae1b04c1f9bc3afb706fe1_10.png)

打印一下它的设备值来观察一下，我先打印一下，就是咱训练数据的一个shape值等于多少啊，等于呃29万九千九百九百八，原始数据多少，30万个，那为什么这里少了20呢，因为这里啊是这样啊。

就是呃它默认情况下，你说咱能取到最后一个吗，不是就是能从最后一个开始吗，不能吧，因为我们要保证每个序列都是20的，所以说啊前面怎么取的，我不管了，最后一个序列一定是多少，一定是后20个。

那你说这后20个取完之后，相当于怎么样就得到了2200哎，就是这个少了20个哎，这个意思啊，后面我们只会少取20个，因为在后面的时候，它的血液长度已经不足20了，没办法再去取了，这是第一个维度。

咱一共得到了多少个序列，然后第二维度呢，第二维度，它是不是说表示每个序列它的一个长度啊，好了，一个序列当中有20个就是20个时间不长，然后呢第三个维度每个实验过程当中啊。



![](img/7a42618780ae1b04c1f9bc3afb706fe1_12.png)

咱用到了几个特征啊，这里我刚才不是给大家说了吗，咱们这一块哦，先做一个简单的方法。

![](img/7a42618780ae1b04c1f9bc3afb706fe1_14.png)

只选单特征，所以单特征啊这块体现出来了，就是一个一诶只用一个特征来去做这样一件事。

![](img/7a42618780ae1b04c1f9bc3afb706fe1_16.png)

然后呢对应的Y值我们来这不值。

![](img/7a42618780ae1b04c1f9bc3afb706fe1_18.png)

也可以发现Y值诶，跌维度跟X跌维度必然是一样的，相当于Y它只是接下来要预测的一个值而已。

![](img/7a42618780ae1b04c1f9bc3afb706fe1_20.png)

噢这个意思，然后大家还可以实际打印出来某指标。

![](img/7a42618780ae1b04c1f9bc3afb706fe1_22.png)

比如说打印出来第一个样本，第二本数据当中，这一块有20个数据。

![](img/7a42618780ae1b04c1f9bc3afb706fe1_24.png)

然后这个是它实际对应下一个点，实际的一个Y值。

![](img/7a42618780ae1b04c1f9bc3afb706fe1_26.png)

这里一块咱已经把数据啊全部准备好了，接下来咱们就要马上来进行一个训练操作。

![](img/7a42618780ae1b04c1f9bc3afb706fe1_28.png)

然后呢训练之前啊，这块还是有这样一个展示展示啊。

![](img/7a42618780ae1b04c1f9bc3afb706fe1_30.png)

比较简单啊，画图的这个这块不给大家去说了，就是把它这个呃这不有啊，这不这不有几十个点吗，把这几个点数据拿出来，然后呢再把它的一个标签纸拿出来，只不过说用不同的线条来描述一下。

你看这里就是我们要去测的当前的一个结果，比如这块画叉的，这是我的一个标签值，咱要预测一下，比如说给我输入的是这样一个序列，我看它能不能给我预测出来，最终的结果是跟这个差是有多大的一个差异啊。



![](img/7a42618780ae1b04c1f9bc3afb706fe1_32.png)

这个就是我们要预测的一个结果。

![](img/7a42618780ae1b04c1f9bc3afb706fe1_34.png)

然后这块呢先给大家做了一个baseline，baseline的意思，就是说呃用一些统计方法看能不能去做呢，这一块做的比较直接啊，比如说现在我拿到了20天数据，那统计方法第21天的怎么办。

我说我把这20天数据做一个平均吧。

![](img/7a42618780ae1b04c1f9bc3afb706fe1_36.png)

平均结果当做第21天的感觉，好像不太靠谱是吧。

![](img/7a42618780ae1b04c1f9bc3afb706fe1_38.png)

好了，这句话就是有一个平均值啊，你看这里一会儿我们会诶拿跟这个平均值啊。

![](img/7a42618780ae1b04c1f9bc3afb706fe1_40.png)

来做一些对比的，然后呢先给大家来说这个模型，说完模型咱再来看这个结果吧。

![](img/7a42618780ae1b04c1f9bc3afb706fe1_42.png)

做这个模型啊其实很简单，第一步指定一个batch size，因为咱这个数据啊说实在的比较小，你可以把这个batch设置的偏大一些，这也没关系，第一步还是去做这个数据，数据当中啊，咱之前是已经做好了。

做好了就是都是咱们拿到矩阵数据，X矩阵数据Y是吧，好了，直接填表data，把咱们数据转换一下，说不完事了，转完之后咱们点batch，然后去构建我们的训练集数就可以了，非常简单的方法吧。

TENSORFLOW点DA当中构建一个DATASET，X和Y分别传进去，这是我训练没问题吧，好了，在训练当中洗一下牌，洗完牌之后做一个batch是不就完事了，跟咱之前给大家解释的方法是不是都一模一样。

非常容易啊，咱就把X或者说把训练集我们构建出来了，那验证集啊，咱构建方法啊可以说是一模一样的。

![](img/7a42618780ae1b04c1f9bc3afb706fe1_44.png)

一般情况下就是验证集，咱就不需要再做SHER操作了，反正到时候DN确全部跑一遍。

![](img/7a42618780ae1b04c1f9bc3afb706fe1_46.png)

做一次验证，是不是就得啦，这是啊，咱们现在已经是为R尔摩想做好准备了。

![](img/7a42618780ae1b04c1f9bc3afb706fe1_48.png)

数据已经都有了，然后呢下面我去打印了一下当前结果值，看值不值，没有什么问题，21没问题吧，第N段值表示拜仁size多少无所谓啊，然后下面flow64，这个没问题吧，以及当前我的一个哎。



![](img/7a42618780ae1b04c1f9bc3afb706fe1_50.png)

再往下看吧，这个就是打一下维度，看看有没有一些信息跟他刚才描述的不一样的。

![](img/7a42618780ae1b04c1f9bc3afb706fe1_52.png)

看起来都是相同的，然后呢去构建这个LTL模型啊，这个也比较简单啊，到时候大家自己指定隐藏神经元吧，大点小点无所谓，反正咱这个任务也不难，数据量也不大，然后呢。

这块就是第一个加上一个LTMLTMLTM当中啊，你返回的这回应该返回什么，应该是最后一个结果值吧，最后一个基础值比如说它是八维的一个向量吧，或者是一个64位或122，128位，随便啊，执行向量。

那最终啊咱有几个结果啊，最终我只要一个结果吧，那这一块还需要再连什么，再连上一个全连接层吧，好了这里啊咱准备了一下哎，再准备一个圈接层数，完事了，那接下来我说我构建一个呃。



![](img/7a42618780ae1b04c1f9bc3afb706fe1_54.png)

构建个损失函数，然后去训练，那是不就得了，方法是不是非常简单啊。

![](img/7a42618780ae1b04c1f9bc3afb706fe1_56.png)

只是简单的构建一个LTL模型，咱就完事了，然后接下来就是呃这块是打印出来预测的结果。

![](img/7a42618780ae1b04c1f9bc3afb706fe1_58.png)

预测的结果就是预测结果的一个维度，预测结果维度啊，它是256杠一，咱之前说那个batch是多少啊，我们是不是指定batch就是256啊，一次迭代得到256个样本，就是256个序列。



![](img/7a42618780ae1b04c1f9bc3afb706fe1_60.png)

它所对应的结果哎这是256杠一，然后呢，接下来训练训练过程当中啊，这一块就是呃在实际这就这里有参数啊，这个参数就是steps per epoch，它的意思就是说呃呃你这里要迭代多少次。

在一一会一会在一个EEP当中，我要迭代多少次，这个值啊，我设置的可能偏小啊，因为到时大家可以算一下，就是咱当前这个200，然后呢再乘上一个这个256，可能没有达到什么。

咱们当前整体的一个数据量的一个要求啊，因为就是在这块反正速度比较快，咱写的稍微小点，这个任务也没关系，大家都是可以改一改实际的一个参数。



![](img/7a42618780ae1b04c1f9bc3afb706fe1_62.png)

如果说你觉着训练速度比较慢的情况下，然后下面就是他训练结果。

![](img/7a42618780ae1b04c1f9bc3afb706fe1_64.png)

训练结果也比较简单啊，损失值一直在下降，最终下降的偏低，你看vodation loss。

![](img/7a42618780ae1b04c1f9bc3afb706fe1_66.png)

也是一个在收敛的一个状态当中，然后呢接下来给大家看一下吧。

![](img/7a42618780ae1b04c1f9bc3afb706fe1_68.png)

就是哦咱训练完的结果，因为这个模型都比较简单啊，所以这块咱不给大家细说了。

![](img/7a42618780ae1b04c1f9bc3afb706fe1_70.png)

直接看结果就行了，看结果吧，结果当中我这边画了几个不同的线条啊。

![](img/7a42618780ae1b04c1f9bc3afb706fe1_72.png)

然后这个红色的是我的一个true label，然后呢，这个绿色的是我的一个预测值的一个结果，然后这个蓝色的是之前那个序列，它的一个走势看起来就是给我们感觉啊，只用一个特征，你看效果好吗。

好像不是特别好吧，预测值和真实值之间啊，还有那么一丁点的一个差异。

![](img/7a42618780ae1b04c1f9bc3afb706fe1_74.png)

然后这个你看差异可能就更大一些了。

![](img/7a42618780ae1b04c1f9bc3afb706fe1_76.png)

然后最后一个哎在这里就是我取了随机取了，不是随机啊，就是只取了其中三个样本，你看这里点tag一下，取了三个样本，这三个样本分别展示了一下它的一个预测结果，把这三个样本分别传入到咱当前的网络当中。



![](img/7a42618780ae1b04c1f9bc3afb706fe1_78.png)

哎得到它的一个结果，然后把这个结果值画出来了，这里给大家看了，就是呃只用一个特征的时候。

![](img/7a42618780ae1b04c1f9bc3afb706fe1_80.png)

哎咱得到结果嗯，反正看起来还凑合吧。

![](img/7a42618780ae1b04c1f9bc3afb706fe1_82.png)

可能稍微有点差，一会儿呢咱把这个任务稍微的再改一改。

![](img/7a42618780ae1b04c1f9bc3afb706fe1_84.png)