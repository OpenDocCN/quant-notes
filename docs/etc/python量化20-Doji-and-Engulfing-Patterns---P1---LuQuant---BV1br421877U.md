# python量化20：Doji and Engulfing Patterns - P1 - LuQuant - BV1br421877U

您好，今天我们将比较十字星和吞没蜡烛这两种蜡烛形态。为此，我们将使用与布林带相结合的简单策略，并且我们将回测去年一小时历史数据的形态。在这个框架中，我们将展示如何将价。



![](img/0ff43535dc1073d6f5d296b28b5ff14f_1.png)

![](img/0ff43535dc1073d6f5d296b28b5ff14f_2.png)

行为模式与其他指标相结合，成为纯技术交易的一个好工具。pyython代码可以从该视频描述中的链接下载。如果您喜欢该内容，请通过点赞和关注来支持。如果您有任何想要探索的想法。



![](img/0ff43535dc1073d6f5d296b28b5ff14f_4.png)

![](img/0ff43535dc1073d6f5d296b28b5ff14f_5.png)

![](img/0ff43535dc1073d6f5d296b28b5ff14f_6.png)

可以在评论部分进行讨论，我们将只关注两组形态。十字星前面是看跌蜡烛，然后是上升趋势，蜡烛或看涨蜡烛，表明未来的上升趋势吞没模式，其中一根蜡烛的开盘。和收盘价小于或大于前一根蜡烛。换句话说。

当前蜡烛完全吞噬了前一根蜡烛，无论这个方向是什么，这都将是未来价格的预测趋势。这些。这两种形态的看长设置的视例，我们还可以考虑更好的设置。其中，addogy后面跟着一根看爹蜡烛，而在吞没形态的情况下。

吞没蜡烛具有看跌方向。在这种情况下，这些形态将表明未来因此我们使用这。

![](img/0ff43535dc1073d6f5d296b28b5ff14f_8.png)

模式的方式首先是等待价格蜡烛收盘于布林带线上方或下方。如果我们在布林带下线下方形成看涨模式，那么我们设置买入信号。如果我们有看跌信号，蜡烛建立在布林带。线之上，我们设置了空投或卖出信号。因此。

如果我们在布林带下方出现看涨模式，我们预计价格会回升。如果在布林贷上方出现看跌模式，我们预计价格会回升，我们预计价格会回落。这就是我们将在pyython中探索的内容。将用python编写所有这些内容。

将其全部放入交易策略中，并在应用一些修改之前执行回溯测试部分以及我们策略的优化。这是我用来回测这些指标的jupiter笔记本。所以。



![](img/0ff43535dc1073d6f5d296b28b5ff14f_10.png)

首先，使用wifi模块和pandas。我们在2021年4月1日到3月19日之间下载欧元美元。2023年，我使用的是每小时时间范围。如果您愿意，您可能希望在未来的实验中更改此时间范围。但对于。

视频我们将使用每小时时间范围，然后我将使用pas技术指标技术分析模块来计算布林带我使用长度30和标准差1。5这也。您将来可能想要试验的两个参数，然后我们可以定义我们的函数布林线十字星信号。

它采用开放的数据真收盘高价和低价以及布灵带数据。我们将检查第一个条件。因此，对于看涨信号，我。将寻找当前蜡烛的收盘价，该收盘价低于布林带下限。如果它是在这种情况下，同时我们的当前收盘价大于开盘价。

因此我们有一根绿色蜡烛或一根上升趋势蜡烛，前面有一根十字星蜡烛。其中，收盘价等于开盘价，前面也有相反的蜡烛趋势蜡烛及收盘价低于开盘价的看跌蜡烛。因此左侧就是这种情况，我们试图在代码中表示，我们有当前。



![](img/0ff43535dc1073d6f5d296b28b5ff14f_12.png)

绿色蜡烛或前面带有十字星的上升趋势，蜡烛，开盘价相等收盘价。之前有一根看跌蜡烛，所以这是我们的反转模式，我们将其视为反转模式。如果它发生在布林带下线下方，那么我。



![](img/0ff43535dc1073d6f5d296b28b5ff14f_14.png)

设置买入信号或看涨信号，这就是为什么我们回到看跌信号，这是完全相反的。所以我们的收盘价高于布林线的上轨。然后我们有一个看跌的当前蜡烛，所以收盘。😡，低于开盘价之后是十字星收盘等于开盘价。

前面是上升趋势或绿色蜡烛，其中收盘价高于开盘价。在这种情况下，我们将返回具有更好信号的信号，或者在我们没有的任何其他情况下返回卖出信。任何信号，因此该函数将返回零，然后我正在使用该函数。

并且正在计算数据帧中的信号。我们将这些信号添加到名为不灵十字星信号的星列中，该列等于该函数将要执行的任何层。对于每根蜡烛，我们现在可以在图表上可视化这些信号。为此，我在数据框中创建一个名为点位置的星列。

这就是我们将使用此在蜡烛上方或下方添加信号的位置函数。位置以X作为参数，因此这只是为了创建点的新位置。如果信号是看跌信号，我们将在稍后将其绘制在图表上。这意味着，如果它是卖出信号，我们将在上面放置一个。

如果是看长蜡烛。我们将把信号发生的蜡烛下方的点放在现在，我们可以在同一张图表上绘制布灵线和蜡烛的信号。我们可以在这里看到。



![](img/0ff43535dc1073d6f5d296b28b5ff14f_16.png)

放大这部分是一个信号，我们有一个十字星，后面是看爹蜡烛，前面是看长蜡烛。我们可以看到我们的代码正在按预期工作，紫色点是它放置在蜡烛上方的信号。因为这。😡，一个更好的信号。现在在这种情况下。

我们没有价格下跌，所以这是一个完整的信号。我们将在未来测试这种策略的准确性，以回溯测试我们可以创建的指标的效率和准确。



![](img/0ff43535dc1073d6f5d296b28b5ff14f_18.png)

回测实例或回测包中的类，我使用的初始手术为50股本，并且我使用的是我们刚刚计算并添加到数据框中的信号。因此，如果信号是看涨的，并且我。当前没有任何未平仓交易，我们允许一次进行一笔未平仓交易。

我们设置止损和止盈值。然后我们使用这两个止损和止盈值执行买入头寸。在十字星模式的情况下，止盈止损比率设置为1。5。当我们有看跌信号时，我们正在执行单元隔信号，并使用手数大小50。

止盈止损比率以及止损和止盈止损被视为前一个蜡烛。较低值的最小值或最大值或较高值的最大值，考虑到当前蜡烛和前一个蜡烛。因此，在布落信号的情况下，例如我们我们要建立多头头寸，我们要买入头寸。因此我们。

止损设置在当前蜡烛的最低点或前一个蜡烛的最低点下方，以这两个值之间的最小值为准，出现看跌信号时，当我们做空时，我们会检。当前蜡烛与前一根蜡烛之间的最高价，并根据此止损距离设置止盈。

因此它等于止损距离的1。5倍，所以我们的保证金是10分之1，所以这是1到10限。1000美元的杠杆，然后我们进行回溯测试。到目前为止，我们得到的回报率为-1。7%，看起来一点都不好的东西。

这可以通过股权的外观得到证实，这是我们的股权一开始会有所上。

![](img/0ff43535dc1073d6f5d296b28b5ff14f_20.png)

但随后会下降，所以我们会下降。如果我们增加佣金等，它就不会到目前为止是一个很好的指标。现在我们可以使用吞没信号，而不是十字星信号来尝试相同的回溯测试。因此我们正在寻。



![](img/0ff43535dc1073d6f5d296b28b5ff14f_22.png)

低于布灵带下线的看涨信号的收盘价。我们正在检查当前收盘价是否高于当前蜡烛的开盘价。因此，我们有一根看涨蜡烛，前一根蜡烛应该是红色的，因此收盘价应该低于开盘。这是一根看爹蜡烛。

同时我们有当前蜡烛的开盘价低于前一只蜡烛的收盘价，当前蜡烛的收盘价高于前一只蜡烛的开盘价，这就是当前蜡烛。完全吞没前一只蜡烛的主体的方式。在这种情况下，我们返回二，所以这是一个看涨信号。

我们正在检查收盘价是否高于布林线上限，以获取看跌信号。在这种情况下，我们有看跌吞没模。我们返回一，在任何其他情况下，我们返回零，因为我们没有任何特定的信号，我们将计算这些信号。

并将它们添加到我们的数据框中，到一个名为布灵吞噬信号的星列。就像我们对十字星信号所做的那。😊。

![](img/0ff43535dc1073d6f5d296b28b5ff14f_24.png)

我们将把它们绘制成图表，我们可以看到这里的紫色点，所以我们可以看到收盘价高于布林线上线，同时这看起来像一根吞噬蜡烛看它。所以。是一根看爹吞没蜡烛，完全吞没了前一根蜡烛。

这就是为什么我们在当前蜡烛上方有一个紫色点，这意味着这是一个卖出或做空信号。现在我们可以使用新。

![](img/0ff43535dc1073d6f5d296b28b5ff14f_26.png)

计算信号进行回溯测试，并考虑到我们使用的相同参数十字星，所以权益的50作为手术大小止盈止损比率1。5倍止损和止盈方法。因此这是当。低点和前一个蜡烛低点之间的最小值，在看涨信号的情况下。

以及在一个更好的信号。我们检查当前蜡烛和前一个蜡烛之间的最大或最高价格，作为我们的止损价格。然。根据我们的止损距离，使用止盈止损比率设置止盈，在这种情况下采用相同的保证金。

我们的十字星保证金大约是1000分之1美元现金。所以这些。参数。所以我们对吞噬蜡烛使用相同的参数，并且在在这种情况下，我们也有一些负面的东西，我们有负1。38%，让我们检查一下净值，此时看起来也。



![](img/0ff43535dc1073d6f5d296b28b5ff14f_28.png)

太好，这两个指标此时可能没有显示出良好迹象的原因，是因为我们正在采取极端情况。所以只有如果我们收盘价高于或低于不灵线，这些情况可能有点极端。只有当我们具。

高波动性和高上升趋势方向或严重下降趋势方向时才会发生。我们可以尝试另一种方法，而不是寻找高于或低于收盘价。在布林带线下方，我们将简。形态是否发生在布灵带内，但在弯曲的上半部分或带的下半部分。

含义在中价格线和上限以及中价格和下线之间，因此回到十字星，而不是才。

![](img/0ff43535dc1073d6f5d296b28b5ff14f_30.png)

收盘价低于布林线下轨的极端情况，我们将只应用收盘价高于布林线下轨的条件。因此它不在布林线之外，但同时时间它应该低。布林带的中线，所以这里没有绘制中线，但我们仍然可以使用它。因为它在我们的数据框中。

所以这两个条件是我们现在应用的更改，所以收盘价再次高于下轨线，并且也低。布灵带线的中线，那么其余部分完全相同，因此我们有一个十字星，它被一根看爹蜡烛包围，然后是一根看涨蜡烛。在这种情况下，我们返回两个。

我将针对看爹信号应用相同的条。稍作修改，我将评论前一部分。现在对于看跌信号，我们需要一个看跌十字星模式，该模式将发生在布林带中线的中间价格之上。但是仍。布林带内。因此，在布林带的上限以下。

我们将执行此操作，并尝试使用完全相同的参数来回测所有内容。这些参数没有太大变化，我们只是改变了我们在其中应用信号的是。😡。



![](img/0ff43535dc1073d6f5d296b28b5ff14f_32.png)

布林贷，而不是布林贷之外，让我们检查一下，现在我们的正回报率为17。9%。如果我们看一下股票，在这种情况下看起来要好得多。我们可以看到他开始在努力争。



![](img/0ff43535dc1073d6f5d296b28b5ff14f_34.png)

![](img/0ff43535dc1073d6f5d296b28b5ff14f_35.png)

牵引力一开始，但后来我们开始增加权益，不断增加。实际上我们在这里占据很大一部分的原因。然后我们注意到算法工作的更好，是因为我们人。在这个渠道上，我们仍然在对待一切，作为静态市场不是静态的。

我们不能在超过一年的时间内应用相同的止损和止盈距离，并期望相同的结果。市场不一样，市场正在变化，并且非常动。



![](img/0ff43535dc1073d6f5d296b28b5ff14f_37.png)

因此我们应该算法，但这是未来视频的主题。现在让我们尝试对吞噬信号应用相同的修改。我将评论这部分。所以现在我们执行细胞可受。



![](img/0ff43535dc1073d6f5d296b28b5ff14f_39.png)

我们可以直接进行回溯测试和结果，也显示出26%的回报。所以它比十字星蜡烛效果更好。我们可以看看股票，它会挣扎一段时间。



![](img/0ff43535dc1073d6f5d296b28b5ff14f_41.png)

它也会直接增加到更高的盈利能力。所以这又不是我们的完整策略，我们只是在一个简单的策略中测试一些指标。所以如果您想在现实生活中使用它，您可以使。



![](img/0ff43535dc1073d6f5d296b28b5ff14f_43.png)

道场指标和吞没指标与布林带相结合的指标，就像我们在本视频中所做的那样，已经回测过。

![](img/0ff43535dc1073d6f5d296b28b5ff14f_45.png)

我们证明这些都是很好的指标。但是如果您不。

![](img/0ff43535dc1073d6f5d296b28b5ff14f_47.png)

在此处出现回撤期，并考虑佣金等。那么您的手动交易中应该改进哪些地方？这将导致您的损失必须应用更动态和更好的退出信号。因此，您设置止损和止盈的方式应该是动态的，并且遵循市场必须有不同的方。



![](img/0ff43535dc1073d6f5d296b28b5ff14f_49.png)

和更好的方法来改进这一点，同时考虑到平均真实的ATR市场范围等等，或者可能设置我们在本视频中没有测试的追踪止损。这里的重点主要是比较十字星模式和吞没模式这两个指。



![](img/0ff43535dc1073d6f5d296b28b5ff14f_51.png)

似乎吞没模式模式在某些情况下效果稍好，但我们绝对可以将这两个信号结合起来，以获得更多的盈利能力。因此，如果我们想组合这两个信号或这两个模式，以协调使用它们。



![](img/0ff43535dc1073d6f5d296b28b5ff14f_53.png)

![](img/0ff43535dc1073d6f5d296b28b5ff14f_54.png)

可以从之前的十字星中获取第一个信号。就在这里，我们可以修改我们在第二种情况下使用的信号函数，以便组合这两个信号。我只是在这里更改这部分。所以如果不灵线吞。



![](img/0ff43535dc1073d6f5d296b28b5ff14f_56.png)

信号等于2，并且字点不灵线，十字线信号实际上等于二可以是其中之一，所以它将被替换为或者所。我们有这两个信号之一，我们将寻求买入信号，所以这应该是一个结束。我们一次只允许一笔交易物。

我将把这部分复制到这里。只需将信号从两个修改为一。因为我们正在寻找更好的信号或短信号，现在我们可以运行组合信号回测，我们可以检查结果，以便我们回报率为41%。因此我们增加了交易数量。



![](img/0ff43535dc1073d6f5d296b28b5ff14f_58.png)

![](img/0ff43535dc1073d6f5d296b28b5ff14f_59.png)

信号数量达到335个。我认为之前我们得到的信号数量约为100个，我将检查这一点，并与十字星情况进行比较。因此我们得到219笔交易，并且为了添加吞噬信号，实际上。



![](img/0ff43535dc1073d6f5d296b28b5ff14f_61.png)

![](img/0ff43535dc1073d6f5d296b28b5ff14f_62.png)

交易数量添加为正回报，因此，我将在此处绘制更新后的股票的权益，看看它的表现如何。这就是我们得到的。所以我们仍然拥有相同的形状。所以一开始这些算法不。很好的工作，这个策略不能很好的工作。

比如说一年然后在一整年里，他工作的很好，所以我不鼓励你使用它作为算法交易模式。这是一个简单的程序，只是为了测试一些模式的效率和准确。😊。



![](img/0ff43535dc1073d6f5d296b28b5ff14f_64.png)

在这种情况下，我们可以在手动交易中使用这些模式。但是如果您打算这样做，最好的方法是并行使用不同的策略，不同的算法策略。当一个策略不是这样时运作良好，无论如何，另一个可以弥补损失。

这就是我要告诉你的这一个，我希望你们喜欢它并行。😡。

![](img/0ff43535dc1073d6f5d296b28b5ff14f_66.png)

这个视频请通过喜欢和订阅来支持，直道我们的下一个交易安全，下次再。

![](img/0ff43535dc1073d6f5d296b28b5ff14f_68.png)

![](img/0ff43535dc1073d6f5d296b28b5ff14f_69.png)