# 第28节课 交易信号及委托6 - P1 - 古辰诗提 - BV1n1xEeLEtV

欢迎大家来到从零开始量化系列课程，MC课程的第28节课，这一节课开始，咱们讲最后一大块，就是咱们经常会用到的一大块，就是投资组合，投资组合是什么意思呢，就是咱们平时在看的时候是单一的图表。

就算你加入其他的这个图表序列的话，它也只能在你的主图表上去进行交易和买卖，对吧，如果说想同时回测多个这个合约的话，你需要用到就是这个投资组合这样的一个模块，咱们可以先看一下投资组合模块是哪个模块啊。



![](img/e12331d72448523a772f2df5c7fd14d6_1.png)

就是这个投资组合交易pt t，咱们可以打开它看一眼。

![](img/e12331d72448523a772f2df5c7fd14d6_3.png)

好这个是它的整个的界面，左边这个边栏呢是你去添加策略的商品和信号，你可以复制它呃，就是复制策略，它会给你再生成一个这个名字，你还可以进行改，比如说重命名，重命名策略，比如说我第一个我要放螺纹。

螺纹杠一啊，然后第二个比如说我要重命名策略，比如说我要换成焦炭，焦炭钢一，你可以放多个策略，当然一个策略里边呢你也可以添加多个商品，比如我从这插入商品，啧就是我这放2B2301啊，SHF1。2B啊。

2301，然后设置一下，设置成10分钟吧，好这个我给添加进去，同时呢你还可以添加多个商品啊，我再添加一个，SHB点2B，比如说2205啊，都可以，你也可以给它添加参考商品，这可以插入参考商品呃。

比如说我这个2B2301，我想用到这个嗯，hot合约SHFD点2b hot是吧，主力连续，我要给他就是添一个主力连续，这样合约当然你也可以从这儿啊，右边栏这你会发现数据都在这呢是吧。

你可以把它复制CTRLCCTRLV，这样的话就不用再就是进行添加了啊，你也可以直接从这改，比如我把这个改一下，改成一个20回车呃，回车他得确认一下啊，他得确认一下，然后你点击确定就可以。

你也可以把这俩呢CTRLC或CTRLV，他就直接添加到商品呃，这个这个你第二个策略这来了啊，这个下面呢是添加信号的，添加信号和咱们这个图表上是类似的，你只要只需要把信号往里添加就可以了啊。

一个完整的策略，首先商品是肯定得有的，也必须得有信号，不然的话如果说你里边缺一个的话，他在一整体运算的时候，会给你把这个策略给忽略掉，这边是调时间的，一般不会用，上面就是说500格的K线啊。

就是一般你限定时间，比如说2020年开始，然后我就是进行回测啊，这个是他的一个简单的设置，右边这呢投资组合设置呢，其实你一般都不需要动啊，一般不需要动，然后初始资本这呢你可以给他改一下。

就是说呃往多里改也好，或者说是怎么样，但是一般都不需要动，你要是这样去回测的话，那它一般情况下，哪怕你只有10万块钱，你回测多个品种，它也不会有不会受到影响，因为他并没有设置这个保证金占用啊。

并没有设置这个保证金占用，所以说它没有问题，如果说你想尝试，比如说我有10万块钱，我想试一下，我跑几个品种啊什么的，你这保证金占用，这需要调一下，比如说我给他调成十，这个呢就是合约价值。

如果说你仓位开不出来的话，他就不会再开仓了，能理解我的意思吗，就是仓位如果开不出来，就是他就不会再开仓了，这儿也会给你进行限制的好，咱们可以演示一下好吧，然后我把这个全删掉，先。

比如说我这儿商品插入一个，稍微慢一点啊，SHIB1。2B呃，000吧，然后用10分钟的。

![](img/e12331d72448523a772f2df5c7fd14d6_5.png)

好点击一下确定，然后我这个信号里边呢，我新建一个，我把这个给粘过来，我直接就用我们这个策略啊，然后我这仓位这呢by ten entious，就是我买十首啊，Sell，是吧，然后进行一下编译。

好这个编译是没有问题的。

![](img/e12331d72448523a772f2df5c7fd14d6_7.png)

然后我从这儿，呃添加信号，然后代码28，好信号添加进来了吧，啊也没有什么参数是吧，好然后我下我下面这个先不管，然后呢，我把它这个呢调成1万块钱的这个初始资本，然后保证金占用是10%。

那就意味着我开一手螺纹，比如说它的价格是5000块钱的话，他的额一个点的价值是十块，那这手的价值是5万5万，如果说我需要呃10%保证金，那意味着就是说他得交纳呃5000块钱保证金。

我所以说1万块钱差不多也就开个一呃，一首两首是吧，好这个时候我进行下回测，我时间别太长了啊，2021年吧，回回测一年的，稍微等一下啊，回测好了，咱可以看一下，咱们看一下这个交易列表。



![](img/e12331d72448523a772f2df5c7fd14d6_9.png)

你会发现合约都是一手的是吧。

![](img/e12331d72448523a772f2df5c7fd14d6_11.png)

合约都是一手的呃，当然这个跟咱们有没有设置这个什么有关系啊，比如说呃他同时的开仓手手术什么的，其实这个他是没有影响的对吧，因为我不涉及到就是说加仓啊是吧，如果说我把它变成10万的话，咱们看看一下啊。

这就变成十首了吧，对不对，但是如果说我1万块钱的话，他会受到影响啊，我再进行一下回测，它会受到影响的吧，这个就是保证金的作用，然后下面这个最大潜在损失比率啊，这个你不要去动它啊，不要去捅它。

也会有一定的影响的，它也会有一定影响的，你点这就是不算这个最大潜在损失比率啊，但是如果说你点这儿的话，你给它修改的话也是会有影响的，就是他有一个计算方式，其实最大潜在损失比率是什么意思啊。

我预计它最大亏损是这个合约价值的，5%啊，最大亏损是这个合约价值的百分额5%，这样的话它也会限制你的手数的，比如说我先把它点到这个固定保证额，固定保证金这儿啊，然后最大合约价值。

比如说我给它设成10%还是一，还是1万块钱，看一下啊，你看两首两首，一首两首，他也会有影响的，它也会有影响的，所以说呃这块你就给他写个五就行了，然后如果说你要计，你要计算保证金的话，你就点这个。

当然这个上面固定保证金金额，咱们之前应该是讲过，就是在咱们这个，啊这个里边的这个报价管理器里边，他有个那个保证金的设置。



![](img/e12331d72448523a772f2df5c7fd14d6_13.png)

你可以在那设，但是我不建议大家就是大家这么设啊，这个是保证金吗，啊我不建议大家从这来设，你轻易不要动这个里边的就是他预设好的数。



![](img/e12331d72448523a772f2df5c7fd14d6_15.png)

这个这个数值，然后你最你你你要想计算保证金，你就从这算基本上占10%，就是十十倍杠杆嘛，一般保证金给的低的是8%对吧，你从这儿设就可以了，呃你记住这会对你的这个开仓手术是有影响的，包括这个初始资本。

如果说你钱亏没了，他就也就不好再再开仓了，这儿呢有个资金管理信号，咱们后边会讲到，这儿也可以添加策略的，但是这儿的这个策略呢不建议大家来添加啊，不建议大家来添加，因为有一些咱们后边会学到的一些关键字。

会控制整个策略的进出场的一个情况嗯，你可以把这个资金管理，比如说我百分之我亏损了20%的时候，我就我就怎么样是吧，我就不开仓了啊，然后如果说挣了40%，我也就不开仓了，我就停了或者怎么样的。

你可以从这来进行控制，但是一般不建议大家从这来添加这个信号，你完全可以再另一个，就是说我再复制一个策略，然后，嗯比如说我复制策略啊，我完全可以复制一个策略，我单独用一个策策略。

在这里边来进行这种资金的管控呃，从这儿因为从这从这进行管理的话，他会有一些问题呃，就是有一些函数在这个信号里边，它不会对全局产生作用呃，当然有一些函数是能够产生作用的，所以说你还需要去分别这些东西。

但是如果都放在这的话，都会产生作用的，好吧，这个是一个界面的一个介绍，然后带大家认识一下，就是它可以添加多个商品呃，可能有些老板会说可不可以添加多个信号，也可以啊，你也可以从这添加多个信号。

这个没有问题，但是建议大家信号只添加一个，然后商品你可以多添加几个额，然后你想添加多个信号，你就把它分开来，因为这个可以不可以不断的往下拉啊，strange就是刚开始复制。

咱们看到这个strange其实就是策略的意思嘛，好吧这个就是一个界面的一个介绍。

![](img/e12331d72448523a772f2df5c7fd14d6_17.png)

跟咱们这个投资组合相关的一些，就是这个关键字呢给大家简单说一下啊，额第一个就是投资组合的策略属性。

![](img/e12331d72448523a772f2df5c7fd14d6_19.png)

第一个给大家介绍的呢，这个用的不多啊，他这个优先权你设的越高，就是他在开仓的时候会优先嗯开仓，但是是优先开仓，并不是说后边不开仓了，如果说你不设的话。



![](img/e12331d72448523a772f2df5c7fd14d6_21.png)

你不设的话，他优先权是从上到下的进行这个开仓，如果说你只有10万块钱，然后呢你最多开十首螺纹，然后你这儿挂了15个策略，那我优先看哪个呢，它就是从上往下，当然你也可以给他设优先权。

比如说我最后一个策略是吧，我把他优先权设一下，设成1万，然后倒数第二个设成9000，那在资源有限的情况下，他会先把1万的那个就是先进行操作。



![](img/e12331d72448523a772f2df5c7fd14d6_23.png)

就是这么个意思啊，他的这个使用方法就是，什么呀，就是后边就等于是等于一个值，就是他的这个优先权等于一个值，一般的跟投资组合相关的这个关键字，前面都有这个东西啊，port这个怎么读啊。

PORTFOLIA啊，就这个啊，就是这个就是一般就是跟策略组合相关的，第一个优先权基本上不怎么用，就是给一个值，赋一个值越大，它的优先权越高，你想将低股价设置为较高的优先级，就是用收盘价嘛。

如果说你价格更呃，价格越低的话，他负负负的就越小嘛，如果说你价格越高的话，他负的就越大嘛，就这个意思啊，这个就就不演示了，这个也没法进行演示啊，然后get margin margarine。

咱们之前讲过吧，就是保证金，就是取得使用者在这个设置的保证金设置啊，咱们这个咱们演这演示一下啊啊这。

![](img/e12331d72448523a772f2df5c7fd14d6_25.png)

print一下，进行一下编译。

![](img/e12331d72448523a772f2df5c7fd14d6_27.png)

好编编译是没有问题的是吧。

![](img/e12331d72448523a772f2df5c7fd14d6_29.png)

然后我进行下回回测，然后咱们看一看。

![](img/e12331d72448523a772f2df5c7fd14d6_31.png)

这个输出输出保证金是设置的是零，因为咱们没有设这个保。

![](img/e12331d72448523a772f2df5c7fd14d6_33.png)

设这个保证金嘛，如果说保证金设10%的话，进行下回测好。

![](img/e12331d72448523a772f2df5c7fd14d6_35.png)

咱们再来看一下是吧，就变成了十了，他这个是负开头的啊，负数就是负号开头的，它会变成十啊，从这儿咱们也写一下，就month。



![](img/e12331d72448523a772f2df5c7fd14d6_37.png)

好这个是保证金。

![](img/e12331d72448523a772f2df5c7fd14d6_39.png)

就是以负数开头的嗯，这保证性返回的是负数啊，它返回的值乘以N啊，返回的值定值N乘以一，这个是投资组合设置页面设定的潜在损失。



![](img/e12331d72448523a772f2df5c7fd14d6_41.png)

就是咱们设就设置了这个东西吧，潜在损失也咱们把这个先变成这个这个。

![](img/e12331d72448523a772f2df5c7fd14d6_43.png)

然后咱们可以把它转过来看一下啊。

![](img/e12331d72448523a772f2df5c7fd14d6_45.png)

潜在损失他也是负数，好进行下编译。

![](img/e12331d72448523a772f2df5c7fd14d6_47.png)

然后执行一下，回测一下，五是吧，他就是乘以一个一。

![](img/e12331d72448523a772f2df5c7fd14d6_49.png)

一了嘛，它就变成了五啊，下面一个取得使用者在这个投资组合设置页面，设定的单个部位的最大，这个是不还是报，我查的是念报啊，报险率，单个部位的最大保险率就这么设置的。



![](img/e12331d72448523a772f2df5c7fd14d6_51.png)

总部总部位保险率百分之百，单个部位最大保险率是百分之百，这个你可以百度一下啊，其实就是说我总部的报险率是百分之百，是什么意思呢，就是我可以把所有的本金都全亏掉，单个部位，比如说我有几个策略。

你按说一个策略，就比如说有10万块钱，那一个策略就是2万5对吧，但他这儿呢，单个部位最大保险率也是百分之百啊，就是我可以把我单个部位的签约全部给亏完。



![](img/e12331d72448523a772f2df5c7fd14d6_53.png)

其实就是这么个意思啊，也没什么太深的，它只是一个计算方式，但是呢这就这些计算方式呢，嗯也没有一个特别详细的解释，咱们只能去搜啊搜。



![](img/e12331d72448523a772f2df5c7fd14d6_55.png)

然后这个我就不给大家演示了，唉也演示一下吧。

![](img/e12331d72448523a772f2df5c7fd14d6_57.png)

好看过了。

![](img/e12331d72448523a772f2df5c7fd14d6_59.png)

这个一般也用的不多啊。

![](img/e12331d72448523a772f2df5c7fd14d6_61.png)

百分之百嗯。

![](img/e12331d72448523a772f2df5c7fd14d6_63.png)

这个没有加这个负号好，还有一个就是取得使用者在投资组合设置页面，总部保险率，这个就不演示了啊，出来肯定是百分之百是吧，咱们看这个第二块就是投资组合策略部位，投资者投资组合策略部位函数。

使用方式类似单一商品的策略部位指令，就是可以利用这个相关的关键字啊，回测时取得整个投资组合的进出部位，比数和数量，就是咱们以前在弄用图表的时候，是获取这个整个图表上面数据的，比如说经常的名称啊是吧。

然后交易的数量啊，呃就是以及一些其他的属性的内容，但是在咱们这个投资组合这个里边呢，也可以去获得，比如说你像这个current entrance，就是返回投资组合目前未平仓的交易笔数啊。



![](img/e12331d72448523a772f2df5c7fd14d6_65.png)

啊从这我进行一下回测一下，看看他有没有没平仓的，都平仓了啊，那我就不演示了好吧。

![](img/e12331d72448523a772f2df5c7fd14d6_67.png)

就是还没有平仓的，一直拿到现在还没有平仓的，就是这个CONTENTRANCE，第二个就是open position profit，就是返回目前投资组合未平仓部位的经历额。

总金额就是到现在还没有平仓的这一部分，他就是说他的利润是多少，当然这个利润也可能是负的，负的就是亏损嘛是吧，那你想返回是-50，就是到现到目前为为止还没有平仓的部分啊。

第三个是max open position，这个是什么，就是返回投资组合中计算并返回，目前商品未平仓部位最大额可能的亏损金额，这个这个也不演示了啊，就是就是曾出现过的最大亏损金额为100啊。

他就返回100，就是返回一个极值嘛，属于是，然后这个是max loss for entrance计算啊，并返回使用者，在一定数量的手术和某个价位的进场部位，最大潜在亏损。

嗯他这个演示啊就是啊已返回最大潜在亏损，如果使用者在，收盘价买进100手多头，就是返回最大的潜在的亏损，这个也没什么好说的啊，有兴趣可以自己去演示一下，这个用的也不多，重新设定商品的潜在亏损。

最大潜在损失金额，这个有兴趣自己去去演示一下吧好吧，然后咱们看第三块就是投资组合绩效策略，绩效策略其实就是你的也也毛损呐，毛利啊什么之类的是吧，然后包括净利，这个是cross profit。

就是获利总金额嘛，就是它就是毛利，毛利就是没有计算额华点手续费啊，然后毛损也是啊，就是gross lose，就是net，就是把这个华点手续费啊全部给这个计算了，就是net profit啊。

然后这个是total trans，如果没有前面这个咱们在图表里边，他就是来计算，就是说总共的就是交易次数的啊，然后如果说你有这个了，他就是在这个投资组合里边，这种方式只能用于投资组合是吧。



![](img/e12331d72448523a772f2df5c7fd14d6_69.png)

这个给大家演示演示一下啊，还是有可能用到的这个。

![](img/e12331d72448523a772f2df5c7fd14d6_71.png)

啊进行一下回测，你想他的总的交易次数是其实是72次。

![](img/e12331d72448523a772f2df5c7fd14d6_73.png)

72笔交易嘛是吧，然后咱们的这个输出出来的也是72B啊，也是72B，这就是这个total trans，然后如果说没有前面的这个，就是只有后边这一块，只能用在这个图表里边啊，或者说当然你也可以用在这个。

比如说我这样，好然后进行下编译。

![](img/e12331d72448523a772f2df5c7fd14d6_75.png)

编译也是没有问题的，编译也是没有问题的，但是它计算的就是你单个策略的总的，交易的这个比数嗯啊五十九十三。



![](img/e12331d72448523a772f2df5c7fd14d6_77.png)

五十九十三，五十九十三，就不太准确了嗯。

![](img/e12331d72448523a772f2df5c7fd14d6_79.png)

你把它放到这个交易组合里边来，它就不太准确了。

![](img/e12331d72448523a772f2df5c7fd14d6_81.png)

六十九十三，这个是两个数加起来是72是吧。

![](img/e12331d72448523a772f2df5c7fd14d6_83.png)

两个数加起来是72呃，但是他是五十九十三，应该是这个是59比，然后这个是13比，因为二它里边没有东西嘛，啊这个就不太准确了，但他加起来是72是吧，好这个是total trans。



![](img/e12331d72448523a772f2df5c7fd14d6_85.png)

咱们再往下看看这个获利交易总比数啊，就是你挣钱的总比数嘛，然后亏损交易的总比数啊，这个就我就不演示了啊，然后啊percent是百分比的意思吗，perfect就是就是额获利的，占这个整个的百分比是多少啊。

strange joe down就是返回投资总额，从最近权益资金高点的亏损金额，就是从最高最高点往回路，就是呃落落了多少钱，这个给大家演示一下吧。



![](img/e12331d72448523a772f2df5c7fd14d6_87.png)

进行下。

![](img/e12331d72448523a772f2df5c7fd14d6_89.png)

编译，然后进行下回测。

![](img/e12331d72448523a772f2df5c7fd14d6_91.png)

![](img/e12331d72448523a772f2df5c7fd14d6_92.png)

回回来了9570啊，回来了，9570。

![](img/e12331d72448523a772f2df5c7fd14d6_94.png)

就是从权益高点到，就是目前已经亏损了9570了，是吧好，这个是max i d中档，就是返回投资组合在交易期间内出现的最大，权益资金亏损金额。



![](img/e12331d72448523a772f2df5c7fd14d6_96.png)

进行一下编译。

![](img/e12331d72448523a772f2df5c7fd14d6_98.png)

然后进行一下回测，回测出来呢，就是说这儿咱们他也有这个分析嘛。

![](img/e12331d72448523a772f2df5c7fd14d6_100.png)

就是绩效概要，投资总额最大回撤就是9610对吧。

![](img/e12331d72448523a772f2df5c7fd14d6_102.png)

9610，然后咱们看看这个他也是9610，所以一般情况下啊，就是你想要的东西，都会在这个回回测报告里边都会有的。



![](img/e12331d72448523a772f2df5c7fd14d6_104.png)

包括你的这个周期分析呃，日按日的每天是个什么情况呃，月分析每个月是个什么情况，包括年度呃，你每一年是个什么情况，都会有特别的详细好吧，而且它还可以保存下来，就是保存到你就是说固定的地方。

然后给你保存为一个excel的格式，然后你再去打开它进行分析，然后甚至打印出来都可以，咱们可以看一下啊，你看这个里边所有的你点击确认啊，它会有一个就是导出报告的一个过程，然后报告一导出这来之后。

它里边会有很多的表格，你可以进行详细的分析，然后或者说你拿给别人看看，我这个策略怎么怎么样，是吧啊，都是可以的，我觉得这一点做得非常的好啊，另外一个虽然呢咱们之前讲过。



![](img/e12331d72448523a772f2df5c7fd14d6_106.png)

他这个print往外输出的时候输出不了了，但是他的这个数据啊其实是可以导出来的啊，其实是可以导出来的。



![](img/e12331d72448523a772f2df5c7fd14d6_108.png)

咱们可以看一下，在这个报价管理器这。

![](img/e12331d72448523a772f2df5c7fd14d6_110.png)

好就是咱们可以从哪导出数据呢，就是这个这个这个，导出数据，然后导出成阿斯克码啊，然后比如说我就用这个成交价的tick啊，分钟日用这个分钟吧，然后点击确定，直接保存到桌面吧，啊它就会进行导出。

百英码2012啊，已经完成导出了是吧，打开文件夹这个啊，当然我这里边是2012是没有东西的啊，看看下面这个有东西吗，他也没有东西，所以说他就呃导出来就啥也没有啊，如果说我导一个螺纹，我导出来之后。

它里边是可以有东西的啊，比如说这个，然后ASHFE，然后我导这个螺纹2B，2B比如说这个000好，然后这个是导出数据吧，文件导出数据ask码，分钟我就导出分分中线吧，就这个是吧，你看这些是他的分中线嘛。

然后我就点击确认，是20万条数据，打开文件夹，然后lower，转圈呢因为比较多啊，这个date time open high low clothes to al wallow就都有了啊。



![](img/e12331d72448523a772f2df5c7fd14d6_112.png)

这都有了，当然如果说你要用数据什么的，你可以导出来之后再拿别的这个编程语言。

![](img/e12331d72448523a772f2df5c7fd14d6_114.png)

就是用这个Python再把它读读出来啊。

![](img/e12331d72448523a772f2df5c7fd14d6_116.png)

也是可以的，也是可以好吧，但是不建议大家这么去做啊，就是投资组合呢，其实前面的呢用的都不是特别多啊，用的都不是特别多，比较重要的一块呢是这个PMM这个关键字。



![](img/e12331d72448523a772f2df5c7fd14d6_118.png)