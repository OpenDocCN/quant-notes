# 学完血赚！最强人工智能数据挖掘实战【Python金融量化分析】，非常适合新手！即练即会！！！ - P39：39-策略效果评估分析 - 迪哥小助手 - BV1URsfeqEQ5

行了，那我们现在是不是已经删除掉了，咱们现在啊不在我当前持有当中这些股票。那好了，那现在我要去做一个判断了，咱们来做第一个判断。😊。



![](img/6782095d3740028bf23e34b75fd2fcbc_1.png)

如果说如果说呀现在啊你确实删掉了一些，再就是你筛这个当中啊，它的一个数量是大于零的啊，就是你确实要执行这样一个条槽的操作。因为现在有一些不满足咱们要求了，那就是一个不等于0。那我现在要干什么。

我就可以打印一下。呃，不打也行，就是现在我们就要完成一个调仓任务，打印一下吧。一会儿咱们观察一下，就是方便看一下你这计时器啊起不起作用。然后现在我要做一个调仓。现在呢咱们来执行这样一个跳仓操作。好了。

那做吧，咱们来执醒一下。那也就是说啊现在呃对我呃要删这个东西好了，呃，for我的每一只股票是吧？好了， useK talk in咱们现在要删的这些个当中，那我要干什么呢？😊，输出首先第一步，哎。

我先把它给给它就是不持有它了。那这款有一个函数吧，叫做order。

![](img/6782095d3740028bf23e34b75fd2fcbc_3.png)

ORDER找一找order percent不是order哎这个函数是吧？在这个函数当中我们要写什么？好了，你现在对谁操作呀，对我股票操作，你想让你的持有量变成多少呢？变成零不就完事了吗？不在我手里了。

这就是全抛去了吧。好了，这是第一步STOCK多打了一个。

![](img/6782095d3740028bf23e34b75fd2fcbc_5.png)

多打了一个好了，这样咱们已经抛完了。抛完之后啊，现在那我们进来要干什么？那你调开湾仓了，整出一些，你说外率往里整点啊，那好了，再写循环吧。说我的一个股票在哪儿啊，在咱们现在要就是在我们现在池子吧。

哪个是池子，来算一下哎，这个这个我看是不是这个这个是我们的一个哎这个是我们的池子吧。刚才咱们说了，这里是我做了一个筛选，筛选完之后，我得到了股票池子。那好了，对我所有股票池当中的每一个。😊。

还是要执行这样一个操作吧，还是执行这样一个操作。但是呢此时那你就是呃不是拿零了，拿谁呀，拿一吧。好了，拿一去比上。哎呀，那一个买多少呢？咱也不用去管这个买多那个买少了，反正平均来吧，平均来去买好了。

一比上就行了。咱把这个股票，在这里给它全一笔比上一个浪值数于完事了。这样相当于我又做些什么操作，哎，把咱们当前股票给它就是买出来了吧，相当于哎这就是完成了咱们的一次调仓操作，行了，这里咱们就写完了。

就是。😊。

![](img/6782095d3740028bf23e34b75fd2fcbc_7.png)

每个月咱们都要干什么，是不是哎都得去查一查这个池子有没有什么问题，然后好及时执行我们当前的一个操作呀。好了，这里是我们现在写了一下我们当前的一个呃所需要用到的吧，所有的一个函数。

这样咱们先来现在写还是写完了，试试看吧，我先把这个东西。

![](img/6782095d3740028bf23e34b75fd2fcbc_9.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_10.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_11.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_12.png)

这个东西都没有用了，这个东西都pas掉吧。咱现哎呀这最这函都版没用上的，咱直接都写到一起了。我不改了，直接这点咱们就在这个reps函数当中直接写了，其他的我就不改了。然后看一看这个东西都pass掉了。

行了，先试试吧，估计可能会先报错，咱看一看有没有什么问题。😊。

![](img/6782095d3740028bf23e34b75fd2fcbc_14.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_15.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_16.png)

运行一下，看一看这个程序先能不能跑起来啊，要是能跑起来再看结果，直接看这个输入日志，我估计太对，你看他可能会有报错。



![](img/6782095d3740028bf23e34b75fd2fcbc_18.png)

好，报我错了，看一下在这里啊有些有一些小问题呃，他说了一下哪一块它缺了一个参数。

![](img/6782095d3740028bf23e34b75fd2fcbc_20.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_21.png)

哦，在做咱们的一个中心化的时候，缺了个参数来看一下中心化的时候呃，在这里找。

![](img/6782095d3740028bf23e34b75fd2fcbc_23.png)

这里是预除以操作哦，中心化说缺要了一个参数是吧？好了，把这个参数给它复制过来，这个参数就是。

![](img/6782095d3740028bf23e34b75fd2fcbc_25.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_26.png)

我看下这咱咱用没用上啊中性化中性化操作啊，在这里这里咱少写了个参数，我们得把这个指标啊再给它传进去。这个指标啊就在这里，咱们得写一下。第一个是咱们该指定好的那第二个就是返回的data frame当中。

我得把它的名字给它写进去。名字找一找啊没在这儿呢，给它写进去就行了。把它的名字给写进去。行，然后我们再运行一下，看一看。



![](img/6782095d3740028bf23e34b75fd2fcbc_28.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_29.png)

看会报错啊，会报错，反正呢咱们就改啊，反正第一次写完了，写完之后对不对，现在不好说啊，又报错了，再看一看。😊。



![](img/6782095d3740028bf23e34b75fd2fcbc_31.png)

呃，又说一下，我有个这个又是中心化当中看一下中心化当中啊，他说这个属性名字估计是不是我拼错了，哪去了中性化咱们这个属性当中呃，RESIDRESID没问题啊。

是有这个属性result等于SMM点O然后一个Y值，这是一个X哦，这块少了一个东西。哎呦咱们现在只是定义好了这个定义好了一下我们的一个会就是要做什么，做最最二人法，但少了个东西少了什么，少了一个fet。

少了一个训练操作吧啊，还没有去做训练。所以说就是训练完之后，咱才能对这个结果，算它的差异吧啊，直接少了一个训练操作。好了，再执行一下。



![](img/6782095d3740028bf23e34b75fd2fcbc_33.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_34.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_35.png)

把之前都关掉，看这回还没有什么问题。

![](img/6782095d3740028bf23e34b75fd2fcbc_37.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_38.png)

呃，哎，这个这个应该这个应该可以了，编译哎呀，又编译又出问题了。看一下zes当中没有哦，这个这这个应该应该咱们单词又拼错了。



![](img/6782095d3740028bf23e34b75fd2fcbc_40.png)

找一下这个是在哪来着啊？是不是说我们在选股的时候，我说要选择哎咱们的一个百分之多少啊，QNTQU哎呀，这评错了，QANT是吧？好了，这块稍微改一改QNT然后LG这没问题了，运行一下。



![](img/6782095d3740028bf23e34b75fd2fcbc_42.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_43.png)

运行一下，看这回啊，咱们的小错误也挺多的，因为直接写这个东西啊，难免啊难免多多少少多多少少会出现点小错误啊。😊。



![](img/6782095d3740028bf23e34b75fd2fcbc_45.png)

啊，警告不看了。😊，哦，又出现这个 erroror呃，stock list哎呦又是一样小问题，这又少又少了个list，找一下吧，在哪一行。



![](img/6782095d3740028bf23e34b75fd2fcbc_47.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_48.png)

dlay当中是吧？好了，dlay当中又少了一个。在我们去删的过程当中，stock list好了，再来执行一下。



![](img/6782095d3740028bf23e34b75fd2fcbc_50.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_51.png)

呃，我太之前，我要我再顺便检查一下吧，估计这个拼写当中可能有点小毛病，list都是list吧。

![](img/6782095d3740028bf23e34b75fd2fcbc_53.png)

好了，看一看这回是不叔志。取得哎，这个这个好像可以了，哎，半天没报错。那行了，说明现在执行已经通过变译了。下面咱们就看一下逻辑上没有什么问题。在这块我不是做了一个打印嘛？

就是呃你看这块就是每次调仓的时候，它都会做打印。咱来看一看它是不是有啊，2月份先有。😊。

![](img/6782095d3740028bf23e34b75fd2fcbc_55.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_56.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_57.png)

是吧2月1号执行了，接下来可能是3月初啊，3月几号看会不会执行这一块有它的一个3月1号也执行了。这块有个进度条啊。你看现在呃速度还挺慢的，因为毕竟咱们这个时间选的是一年。

然后我们的一个本金这一块都是默认的，这个东西都没改。然后这里就是默认情况下，它是每日都一期做计算。但是我做了一个定时器，我是不是做了一个定时器啊。

咱们是按照每月去执行什么去执行这样一个这个balance的操作吧。😊。

![](img/6782095d3740028bf23e34b75fd2fcbc_59.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_60.png)

好了，然后5月3号然后咱们接下来稍微等一等吧。接下来就是大概就是大概再过个几十秒钟吧，咱就能把这个任务给做完了。做完之后，哎，这块做的时候，咱们来看收益。😊。



![](img/6782095d3740028bf23e34b75fd2fcbc_62.png)

看这个收益吧，是不是感觉还还可以，是不是咱们选的随便选一年啊，我也不知道今年怎么样。当时然后现在呢你看就是基准收益赔的挺多的。然后呢，咱们的收益你让你现在少赔一点，一会儿看能不能稍微挣点，哎。

现在是不怎么样，是不是稍微正一点了。你看基准年化是负的，咱们现在也负的，再等一等。😊。

![](img/6782095d3740028bf23e34b75fd2fcbc_64.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_65.png)

注日志现在已经打印到7月份了。现在已经打到7月份了，然后哎现在怎么样，你看你的一个基准的啊，基准的怎么样都是负的。但是咱们现在呢我们的一个策略是不是开始起一点作用了，它好歹是个正的吧。

就是一般情况下不赔，有时候不赔都是一个比较好的啊，现在咱们是不是也是正的。你看右边这两个相对来说啊比它的一个基准效果要好那么一些吧。😊。



![](img/6782095d3740028bf23e34b75fd2fcbc_67.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_68.png)

然后呢，哎这个这个这个这个夏普率相相对来说有点太低了啊。

![](img/6782095d3740028bf23e34b75fd2fcbc_70.png)

然后再等一等，马上它就执行完了，80%多了，速度还是有点慢啊。可能一到晚上我大概我试了一下，就是白天的时候啊速度稍微快快一点。晚上时候可能这个平台用人可能比较多啊，都晚上闲的没事，突发奇想。

怎么玩一玩什么东西啊。其实大部分人啊就是用这些平台都是什么都是干什么，都是来去玩一玩，大部分都是做回测嘛，哎，拿这些数据看一看我的想法怎么样，不一定真要干什么，咱只是哎去模拟哎玩一玩这个东西。

当然咱们这个东西啊，你不能拿到实际的一个市面上当中啊，因为啊这个东西什么样，那都说不准啊，都不好说的，咱只是来做一个回测好了，来看一下吧，在这个回测当中啊最大的回撤区间还行，百之有点多不算大。

在这里呢这两个指标怎么样？也不算太高，是不是？但是哎比一些基准的效果要强一些吧。这个是我们在选择股票的时候怎么样了。基于啊我们的一些指标像是基于一些因。😊。



![](img/6782095d3740028bf23e34b75fd2fcbc_72.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_73.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_74.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_75.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_76.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_77.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_78.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_79.png)

来去选哪些我想要哪些我不想要吧。并且呢是我把咱们刚才说的，我们有三步走。哎，咱们可以把预除理操作也加进去吧。啊，在大尔当中啊，主要就给大家说了一下我们的一个整理流程啊，咱们的一个走法啊是长什么样子。

一步一步啊，咱们该怎么样去做？😊。

![](img/6782095d3740028bf23e34b75fd2fcbc_81.png)

第一步啊，你在这个购货函数当中啊，你写好当前我们的定制器是按月呢，还是按周呢，还是按天呢啊，自己去来设计。然后呢，这一块我说我先去归掉一些，咱们不想要的。然后呢。

归完之后我说我先去现在手里是不是剩一些股票了。好了，剩些股票我就看一下吧。在这些股票当中啊，查询出来。😊。



![](img/6782095d3740028bf23e34b75fd2fcbc_83.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_84.png)

一些指标啊，咱这个任务做的比较简单，只是做了两个就是咱们课程当中提的一个市值，还有一个净率这个东西啊。然后接下来我说做一些处理操作，咱是不是还是自己写了，然后因此我们是不是可以做一些筛选操作啊啊。

咱们说了，我们希望呃当前这个指标值，那应该是越低越好的，所以说做了一个小于等于的判断。那现在拿到手里的股票了。那接下来我说判断一下吧，有些股票啊，现在手里有的，你现在持有这个东西，它不在不在什么。

不在你这个池当中，咱就给它就是怎么样，就是让你的占有率占有量等于多少零吧。那接下来呢我说我再去买买多少呢？那就咱平均一分是不就完事了。然后最后下面就是呃咱们该写到一些基本判断操作。

这里啊就是咱们整体的结果来看看吧。😊。

![](img/6782095d3740028bf23e34b75fd2fcbc_86.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_87.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_88.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_89.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_90.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_91.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_92.png)

呃，交易啊交易交易详情，每天交易详情就不看了，就看咱们的一个最终的结果吧。😊。

![](img/6782095d3740028bf23e34b75fd2fcbc_94.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_95.png)

账户信息吧，你看咱们现在就是从这个1月4号开始，一直到。

![](img/6782095d3740028bf23e34b75fd2fcbc_97.png)

一直到我的一个哎呦这块它只能打印出来一半的年份是吧？你可以看一看，就是你的一个市值啊。现在它的一个变化情况，基本上大家看了一下，往前面点的时候怎么样了，基本上都是赔的吧。可能后面的时候稍微挣了一点啊。

这个是咱们大概啊得到的一个结果吧啊，这些基这些这些就是一些强应信息啊，大家感兴趣啊，我们就自己来看吧。在这里我就不给大家一个就说了啊一些交易的信息，反正都是一些历史数据。行了。

这个就是咱们今天啊完成了一个因子全国的策略，并且呢把一些数据预处理的方法全部啊收入进去了。😊。

![](img/6782095d3740028bf23e34b75fd2fcbc_99.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_100.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_101.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_102.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_103.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_104.png)

![](img/6782095d3740028bf23e34b75fd2fcbc_105.png)