# Kaggle竞赛lightgbm收益残差预测pipline - P1 - 高频交易dragon - BV1Cm42137hw

![](img/14981df56063d8f318560218db5d86c9_0.png)

OK那么把他给的做完了整个比赛的东西啊。

![](img/14981df56063d8f318560218db5d86c9_2.png)

数据都知道之后呢，我们来看看这个这个的话。

![](img/14981df56063d8f318560218db5d86c9_4.png)

那么其实这就是它的很多人会用到的一个，打比赛用的一个叫ride bg gbm，这样一个people line这样的模型，因为x g boost的这些模型的话。



![](img/14981df56063d8f318560218db5d86c9_6.png)

其实就是都是基于数模型，然后呢呃整个的他给了一个就是说最主要呃。

![](img/14981df56063d8f318560218db5d86c9_8.png)

这个里面呢还有一个就是小小的东西。

![](img/14981df56063d8f318560218db5d86c9_10.png)

就是你们可以看一下，这个我是觉得就是不要去呃strict呃，这样的一个模型，其实就是说你的数据不能去泄露。



![](img/14981df56063d8f318560218db5d86c9_12.png)

未来的数据而已，就是这样的一个东西，就是怎么样去读数据。

![](img/14981df56063d8f318560218db5d86c9_14.png)

它是非常这个这个不要去泄露半点，这个这个这个这个包括它的这个呃递交啊。

![](img/14981df56063d8f318560218db5d86c9_16.png)

包括这一块都有一些东西，所以说他这个low的它的数据的时候，它一定是这个这个什么作为小于什么样的一个。



![](img/14981df56063d8f318560218db5d86c9_18.png)

时间的啊，这个这个里面你可以去看一下啊。

![](img/14981df56063d8f318560218db5d86c9_20.png)

它整个people run是怎么样去做的啊，也就是说包括你的训练集。

![](img/14981df56063d8f318560218db5d86c9_22.png)

测试集嗯，甚至如果你做了交叉验证的话。

![](img/14981df56063d8f318560218db5d86c9_24.png)

包括预测嗯，包括递交到比赛的模型里面，都不能去去把未来的东西啊去去。

![](img/14981df56063d8f318560218db5d86c9_26.png)

人家有的递交了模型对吧，你一直去这个去修，或者把泄露的模型去拿回去，可能比赛就不太公平了，他肯定就是有一个递交的东西。



![](img/14981df56063d8f318560218db5d86c9_28.png)

OK我们往下看看这个这个p lines是怎么来。

![](img/14981df56063d8f318560218db5d86c9_30.png)

怎么去做的啊，这个里面呢。

![](img/14981df56063d8f318560218db5d86c9_32.png)

这个里面的它其实呢就是把整个的。

![](img/14981df56063d8f318560218db5d86c9_34.png)

因为这个模型的话，现在整个的目前的cargo的，默认的是好像是4。3啊。

![](img/14981df56063d8f318560218db5d86c9_36.png)

好像现在改版还蛮大的，我我当时打印了一下。

![](img/14981df56063d8f318560218db5d86c9_38.png)

看了一下，现在最最大的模型已经是这个最新的模型。

![](img/14981df56063d8f318560218db5d86c9_40.png)

我看一下啊，已经是四啊。

![](img/14981df56063d8f318560218db5d86c9_42.png)

这个里面是3。3。1啊，就是这个light的BGM来的GB，然后呢现在的呃官网呢已经变成4。4了啊，落后了一个年代啊。



![](img/14981df56063d8f318560218db5d86c9_44.png)

那么整个下来就不好用了，我就觉得参数也不太好用诶，其实呢这个里面的cargo给到的内存，好像给到了32G啊。



![](img/14981df56063d8f318560218db5d86c9_46.png)

好像是这个里面呢可以看到，就是有32G给到的CPU是好像是物理的四核。

![](img/14981df56063d8f318560218db5d86c9_48.png)

但有四个线程给到的硬盘可以看到是19。5。

![](img/14981df56063d8f318560218db5d86c9_50.png)

其实是20GB，大概是目前这样的一个情况，如果没有好的这种jupiter notebook不防呃。

![](img/14981df56063d8f318560218db5d86c9_52.png)

就在这个这个里面去多玩一玩。

![](img/14981df56063d8f318560218db5d86c9_54.png)

这个里面呢还能还能upload呃，new new data类似这样的东西啊，所以说这这个还是蛮有意思的。



![](img/14981df56063d8f318560218db5d86c9_56.png)

所以说这个模型的话我们来看看啊，就是其实也是整个的呃套路都差不太多的哦，也就是说怎么样去拿到一些诶。

![](img/14981df56063d8f318560218db5d86c9_58.png)

数据进行预处理之后，然后怎么样分呃，训练集，测试集，然后呢去做了一些predict，然后再去递交整个的也就这样的一个一个东西，然后我们来看看，首先他载入数据对吧，载入数据之后，然后我们去看看。

他还给到了一个什么这个seed啊，2021，也就是说这个产生了很多的这种随机的一个，一个东西，好我们来看看啊。



![](img/14981df56063d8f318560218db5d86c9_60.png)

这个里面的数据先是长这个样子的，然后呢keep only value before the liary the test set，哦就是跟你讲的，就是呃我们来看看啊，这个整个里面呢他把这个数据的暴露啊。

它是限定的标识是121年这个6月13号啊，这个是圈定一定是这样的一个东西，因为后面的可能呢呃按照比赛的规则啊，到什么时候开始去去做。



![](img/14981df56063d8f318560218db5d86c9_62.png)

什么时候去去那个，所以说你可以看看他的要求对吧，所以说你的训练的数据是6月13号之前的，这个样的数据。



![](img/14981df56063d8f318560218db5d86c9_64.png)

然后呢这个就是它的权重，这个training，就是也就是说这个里面呢给到了一个，就是训练一个资产的这个呃流程，然后呢给到了一个特征工程这一块，就是我们看到的这个shadow的这个东西啊。

那么它就是high减close open open对吧，high减之中它的最大值close open是否有上影线，还有是否有下影线，因为它是一分钟的K线啊，那么这个里面呢就是生成了。



![](img/14981df56063d8f318560218db5d86c9_66.png)

就是多一点的这个东西，然后呢把这个up shado和low shado被拿进来，拼接在一起啊，然后呢这个里面呢就是来进行这个挑选，我们所训练的这个资产，ASSD等于id是等于要匹配起来。

然后呢这个里面呢再把它的这个get future，也就调用了这个函数啊，调用了这个函数，这个函数就多了两个特征而已，那么把1234567+2个就九个是特征，那么把它给拿了起来，拿了起来之后呢。

那么这个里面呢它的目标值就是负值，Y值就是df target的，那然后得到后来把这个拿掉了之后呢，就是跟你讲的，他把这个jp n nail how的email，把这个这个很多的这个呃没有空值的。

就可以丢掉了，丢掉了之后X你看见没有，那么整个预测集里面不能去，包括这个target的的东西啊，也就把Y的这个东西给JOP掉了啊，那么Y单独的成了一列啊，就是用这个这个从X预测到Y的这种映射。

其实做做这个呃线性回归就做这样的东西，X如何到Y的，然后呢它的系数是什么对吧，其实就知道这样的一个东西，那么我们用这个model是你可以看到它的，就是这个回归的模型，然后呢迭代的次数随便写一个东西啊。

那么啊就fit fit之后把XY和model都给返回出来，然后呢loop oo assets就是呃递归循环一下。



![](img/14981df56063d8f318560218db5d86c9_68.png)

然后呢把所有的资产都做一遍啊，其实就是这意思啊，也就xy model，然后呢for这个SSD x lin zip，那么其实就是把所有的这个，这个东西取出来一遍。

然后呢把它的model都给都给XY值和model，都给训练了一遍，然后呢，把它重新把他这个append到某一个这个字段里面，来对吧，X x a i，你看你它是有两个字典，三个字典啊。

那么就把它给给给充充分赋值出来啊。

![](img/14981df56063d8f318560218db5d86c9_70.png)

那么出来之后你可以看到他一直从0~13，训练完了，训练完了之后，他其实就把这个各个特征值和，和那个都训练完了，训练完了之后，它进行一个predict对吧。

然后这x get a future defection这个啊，然后呢去看到第一列的会是什么样一个数据，然后呢其利用model0对吧，这是这个，也就是说跟你讲的它其实是对应起来的，就predict这个X。



![](img/14981df56063d8f318560218db5d86c9_72.png)

然后呢这个Y的predict的值，它就是一个值非常小的值，也就是说其实这个值他要操作，收益也是非常小的对吧，然后呢，最后的话他按照比赛的要求，进行这个predict的a submit。



![](img/14981df56063d8f318560218db5d86c9_74.png)

然后呢进行预测，然后呢再把这个测试集他好像是拿拿出来了啊。

![](img/14981df56063d8f318560218db5d86c9_76.png)

拿出来了之后做完了之后，拿好了predict之后呃，你看见没有，然后呢他好像还做了一个overlap ooverlap。



![](img/14981df56063d8f318560218db5d86c9_78.png)

它其实就是跟你讲的就是有交叉的，它就是有堆叠啊，然后我看看它把是不是把所有的，df test给放到一起了，放到一起了之后，把他的数据的时间一换啊，df chain的这种时间一换哎。



![](img/14981df56063d8f318560218db5d86c9_80.png)

他就是可以看到他的整个的时间最大的是什么，可以看到他是有6月12号啊，那么那么那个那个2021年6月12号，然后呢，这个最小的一个一个一个一个一个什么值，它就是说它的意思就是。



![](img/14981df56063d8f318560218db5d86c9_82.png)

train跟text是严格的分开的，它其实最后的一个一个一个东西，看看它有没有交叉对吧，这样的话就是您的模型不会去泄露。



![](img/14981df56063d8f318560218db5d86c9_84.png)

你看见没有，这里6月12号的23分59分，23：59分啊，那么这个已经是66月13号0点零零，刚好就是差一分钟。



![](img/14981df56063d8f318560218db5d86c9_86.png)

它没有就泄露到这边里面进行数据泄露，也就是说你的没有作弊啊。

![](img/14981df56063d8f318560218db5d86c9_88.png)

他其实就是这个意思，在把的这个整个的right gbm做了一个简单的介绍。

![](img/14981df56063d8f318560218db5d86c9_90.png)

![](img/14981df56063d8f318560218db5d86c9_91.png)