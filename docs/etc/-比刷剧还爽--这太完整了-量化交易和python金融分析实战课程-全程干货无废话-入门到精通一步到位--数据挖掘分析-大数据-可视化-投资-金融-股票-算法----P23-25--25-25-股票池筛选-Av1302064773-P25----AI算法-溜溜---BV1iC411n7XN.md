# 【比刷剧还爽！】这太完整了！量化交易和python金融分析实战课程，全程干货无废话 入门到精通一步到位！（数据挖掘分析／大数据／可视化／投资／金融／股票／算法） - P23：25. 25.25.股票池筛选(Av1302064773,P25) - AI算法-溜溜 - BV1iC411n7XN

然后这里啊就是诶这个日期在后续都调在这块，刚开始咱们就不调了，就是你的一个起始资金，然后一个啊咱就按这个每日每分钟咱就不说了，这些后续都能调就不管了，咱们先来写这个代码好，首先第一步在什么。

在我们的一个构造函数当中啊，我们要写什么呢，我说我现在啊不是这个S1了，想要什么沪深300，是不是沪深300啊，只用名字来写行，你用代码写也行啊，把这个沪深300给他写进来。

诶这个是我们当前要的一个池子吧，好了，然后打印信息我不需要了，那在这个池子当中，那接下来我们来写这个预处理，写这个预处理啊，就是咱们说了要获取他每天的一些财务的数据，那这些东西怎么去做啊，来看这里啊。

这有个帮助文档啊，大家用的时候把这个帮助文档啊全打开，所有咱们哦不是这个所有啊。

![](img/f51c87a2811e98c52b03f76911f71f99_1.png)

咱们的一些指标啊都在哪啊，都是在这些帮助文档当中啊。

![](img/f51c87a2811e98c52b03f76911f71f99_3.png)

咱来去看的啊，其实说白了所有你要获取的一些结果。

![](img/f51c87a2811e98c52b03f76911f71f99_5.png)

不是我列的，也不是谁说的啊，都是在这个文档当中。

![](img/f51c87a2811e98c52b03f76911f71f99_7.png)

人家会给你详记得去写诶，咱们怎么样去查询呢，怎么样得到结果啊，来看吧，我们就刚才说什么，哎刚才是不是说咱们要去查询一些指标啊，那比如好比说你要查询一些什么，你看这里有好多啊，查询什么财务数据啊。

各种各样的指标都有吧，所以我说这像什么，咱最开始就说了，量化交易这个东西说白了就是一个数据挖掘吧，里边涉及到的数据啊太多了，各个指标都有，是不是，所以说能做些事还蛮多的。

咱们今天啊这个小例子就给大家举一个例子。

![](img/f51c87a2811e98c52b03f76911f71f99_9.png)

咱们不用太多指标，咱直接看这个就是查询一下它的一个财务数据，然后大家用的时候一定要这样，就是你先读一读人家这个东西啊，它是呃怎么样去写的，你看这一块他说了哎，当前也用这个函数当中啊。

你得第一个参数给我创建一个query，就是一个查询查询，什么意思呢，就在这块儿他说了诶，他说这个快手当中啊，你可以去填写你要查询的指标，并且呢可以用这个filter去过滤一些条件，诶。

那跟咱们的需求来说是不是挺像的呀，所以这样我直接把这个函数直接复制过来。

![](img/f51c87a2811e98c52b03f76911f71f99_11.png)

复制到咱们这个策略当中，我在这里啊，首先第一步哎，我说我要去做一个查询，然后呢后面这个东西咱先把这个东西都去掉，先写这个query，query等于什么，现在你要查询哪些个东西了吧，好了。

开始当中我说写一下吧，在我们大学快乐当中，那我去查了查什么呢，我刚才说了查我的一个唯物的，它的一个收它的一个收入情况吧，那比如说我现在想看这个财务收入情况，那怎么看呢。



![](img/f51c87a2811e98c52b03f76911f71f99_13.png)

在这里我们来点一看，点开看一下，这里还有他的一些具体啊财务的文档。

![](img/f51c87a2811e98c52b03f76911f71f99_15.png)

就是点开之后他会告诉你哎咱们的数据当中啊，你都有哪些个字段可选。

![](img/f51c87a2811e98c52b03f76911f71f99_17.png)

这个就给大家一个去看了，到时候大家想看哎各种各样的字段。

![](img/f51c87a2811e98c52b03f76911f71f99_19.png)

然后比如基础财务数据当中，我们可能要的就是呃他的一个营业的总收入。

![](img/f51c87a2811e98c52b03f76911f71f99_21.png)

哎咱们用这个指标，其他指标咱们就暂时不看了，这里咱们直接写一下好了，在我们的查询当中，首先第一个要查他的底下啊，查他的一个呃基础的一个营收的一个指标，然后找一下就是在这里它的一个营收的指标。

哎好这里营收指标，那我们来想一想，就是对于它的营收指标，那现在好比说我查到手了，那查完之后干什么啊，查完之后还没完，咱刚才说什么哎，是不是说我要去过滤一下，过滤什么，首先你现在去查的东西啊。

好像有点多是吧，要你要查的东西，你告诉我了，查谁的呀，你是不是还没指定啊，好了，咱们这块指定一下，你在哪些个股票当中执行这样一个查的操作，所以说这里我要写一个filter，filter当中。

相当于呃你自己啊要去做一些判断了好了，首先我们来判断一下，就是当前我们查的这个东西，把它给它复制过来，当前我们要查的这个结果他怎么样，是不是在我们的一个股票当中吧，好了，对他做一个判断。

那也就是说啊现在我们找到了，然后以及再找到它的一个代码，我看到这个啊应该是一个客户代码，看一下他的QQ代码是否是在应该是一个in，我看看应该是一个in就可以了，然后哦对就这个in in就可以了。

然后呢看一下它的一个呃股票代码，是不是啊，在我们的一个股票池当中，古装池啊，咱刚才是不是已经设定好了，就是一个沪深300是吧，好了就给它复制过来，这就行了，然后呢现在我们做了一个判断。

判断完之后我们要干什么，哎呦现在只是做了一个判断，那我说接下来我们还要干什么做一个排序吧，可能判断完之后，我们现在拿到多少个，300个，300个不是想要的，我要做一个order哦。

我看一下o r d r order下排个序排哦，不是order，我看这个名字好像变了，应该是一个order by order by一下order by什么呢，你是不是得告诉我哎，现在你是按照一个升序。

还是按照一个降序来玩这个东西啊，好了，我说现在按照这个东西按照谁呢，按照呃这个吧，就是他的一个营收，然后按照营收的一个降序吧，咱是选什么选最好的嘛，所以说此时我说给他指定一个降序，是不可以啊。

那现在order by做完了，那还差什么，我说这里啊降学完之后可能还有这么多，那你不一定全用吧，后来我说咱们来限制一下limit一下，我们选多少个，那你选十个是不可以啊，相当于在这里我说只选十个。

我最想要的一个股票，是不是就完事儿了呀，这个给大家看了一下，就是我们第一步啊，先写了一下，在before trading之前，我们先做了一个呃基本的一个筛选吧，并且给它排序好了，拿到了十个我想要的。

我这里咱们给它起个名字，就叫做他的一个data frame吧，因为它返回时也是给我一个data frame，然后把这个东西加入到contest当中，一会儿咱还要再去用的行了，就这样吧。

我先给大家打印一下，看一看它能不能啊，把当前我们这个结果给它做出来啊。

![](img/f51c87a2811e98c52b03f76911f71f99_23.png)

print一下，然后其他的其他的咱们暂时先不用不用的，我暂时给它先pass掉。

![](img/f51c87a2811e98c52b03f76911f71f99_25.png)

然后运行一下吧，先看一看能不能把这个结果给我打印出来。

![](img/f51c87a2811e98c52b03f76911f71f99_27.png)

这个打印出来的结果就是每一天他都去打印。

![](img/f51c87a2811e98c52b03f76911f71f99_29.png)

因为你看这个before trading这个东西，它是每一天都要执行这样一个操作吧，所以说哎呀这块有点小问题，他怎么没给我打印出来呢，来看一看打印日志当中哦，它都是打印个空的，我再往下拉一拉。



![](img/f51c87a2811e98c52b03f76911f71f99_31.png)

看是不是都是空的，都是空的，没有打印出来行，咱们检查一下这个函数当中没有什么问题啊，首先第一步我们把函数写出来了，然后写了一个query quer当中，然后我说去查哪个指标。

就查他的一个财务的营收的指标，没问题啊，然后指定个filter对手当中，我说我去判断一下，当前这个股票是否是在我的一个沪深300当中，然后如果说是啊，然后就是把沪深300当中所有股票都拿出来。

然后接下来我说做了一个排序啊，检查也没有什么小问题，打印为空的说明，在这个沪深300当中应该没找到这块，咱们刚才怎么想的，怎么怎么样了，这块是不是写一会儿咱也不行啊，你是不是在指数当中去找啊。



![](img/f51c87a2811e98c52b03f76911f71f99_33.png)

所以这块我们之前少写一个index当中，我看一看他的名字。

![](img/f51c87a2811e98c52b03f76911f71f99_35.png)

如果大家把他的一个名字忘了，没关系啊，你都可以在APY的当当中给他找到。

![](img/f51c87a2811e98c52b03f76911f71f99_37.png)

你看这是股票债券，然后找咱们找这个指数，这能把这个指数这个拿到手。

![](img/f51c87a2811e98c52b03f76911f71f99_39.png)

然后给它复制过来好了，这是在指数当中，然后写一下我的名字就叫沪深300就行了，然后重新呢咱们再来运行回测看看这回的结果，这回也没什么问题了，刚才我们的一个股票池子没指出来啊。



![](img/f51c87a2811e98c52b03f76911f71f99_41.png)

这回咱们重新来看一下，看一下他的输入输出日志吧。

![](img/f51c87a2811e98c52b03f76911f71f99_43.png)

你看这日子当中是不是有了第一天的，然后这个二零从201年1月4号，咱没改时间啊，这是默认时间，然后有哪个你看第一次有这个呃，后几次哎呀，这个看起来其实不是特别好看吧，这个他给出来这个结果是这种情况。

就是横着是一个股票的一个名字，然后下面它是一个就是每个股票。

![](img/f51c87a2811e98c52b03f76911f71f99_45.png)