# CAPM时间序列回归的python代码实现-资本资产定价模型-量化金融与机器学习2024 - P1 - 背包2004 - BV1zK421a7H8

这一段我们我们呃来实现所谓的CA。

![](img/8a54bdc9e800f3b07c099b8a79836e65_1.png)

CAPM的一个呃计算，当CPM的核心。

![](img/8a54bdc9e800f3b07c099b8a79836e65_3.png)

刚才讲了，他主要是要计算什么呢，计算这个东西阿尔法和贝塔啊，旗下阿尔法和贝塔就是做线性的回归嘛。

![](img/8a54bdc9e800f3b07c099b8a79836e65_5.png)

线性回归我们来来来直接做一做啊。

![](img/8a54bdc9e800f3b07c099b8a79836e65_7.png)

来直接做一做，首先呢这个什么要获取呃，这个和这个的在这个之间的一个数据啊，为什么要获取两个呢，因为这个是我们要搞的那个股票，我为什么用这个呢，这个就把它当成大盘的指数了。

所以用的是中证流通指数作为大盘指数，也就作为什么呢，作为我们的RM，作为我们的RM。

![](img/8a54bdc9e800f3b07c099b8a79836e65_9.png)

啊这个这个代码大家都懂的，就是取对应的指数或者股票。

![](img/8a54bdc9e800f3b07c099b8a79836e65_11.png)

它对应的对应的东西啊，我们先要向那个导入一下我们的包。

![](img/8a54bdc9e800f3b07c099b8a79836e65_13.png)

![](img/8a54bdc9e800f3b07c099b8a79836e65_14.png)

假如说我们看一下。

![](img/8a54bdc9e800f3b07c099b8a79836e65_16.png)

那这是这是新安的这个日期和它对应的收盘价。

![](img/8a54bdc9e800f3b07c099b8a79836e65_18.png)

然后这是我们指数，指数是这个这个就这两个东西，它的形式都是这样，形式都是这样，但是呢为了让他们两个对齐要对齐啊，为什么要对齐呢，因为虽然说他们两个大部分情况下都有值，但是有可能心安，有可能那个有可能呃。

停盘带能理解吗，这个时候他有可能在某些地方是有，某些部分是有空值的啊。

![](img/8a54bdc9e800f3b07c099b8a79836e65_20.png)

某些部分是有空值的，所以说我们需要用什么呢。

![](img/8a54bdc9e800f3b07c099b8a79836e65_22.png)

用这个方式把它滚对齐掉，这个怎么弄呢，把他们两个合到一起，Mac是一种连接啊，它可以让两个啊，on就是他这里讲的是基于什么，基于日期进行连接及日期进行连接。



![](img/8a54bdc9e800f3b07c099b8a79836e65_24.png)

这什么我们看一下结果。

![](img/8a54bdc9e800f3b07c099b8a79836e65_26.png)

你看，他这样就把什么呢。

![](img/8a54bdc9e800f3b07c099b8a79836e65_28.png)

把这个和这个今日期连在一起能对齐，但是有可能这里面存在空值啊。

![](img/8a54bdc9e800f3b07c099b8a79836e65_30.png)

所以说呢最好是什么呢，首先最好是干嘛呢，最好是定义它要怎么连接。

![](img/8a54bdc9e800f3b07c099b8a79836e65_32.png)

为什么要定义这个呢，你看这里多了一个。

![](img/8a54bdc9e800f3b07c099b8a79836e65_34.png)

他肯定是有一天没那个，嗯如果，如果不搞这个的话，他应该是取得这里面索引的交集，但是这个交集会导致什么呢，就如果新安股份有一天没有数据停盘了，但那一天就会从这里面给去掉，能理解吧，能去掉。

但实际上它停盘的啊，停盘的我们如果不希望他去掉，就它呢让它的索引，依照1~1到这个中证流通指数的索引。



![](img/8a54bdc9e800f3b07c099b8a79836e65_36.png)

来来对齐。

![](img/8a54bdc9e800f3b07c099b8a79836e65_38.png)

那么这个时候他如果你看这个时候，这个时候的话，它会保留滞空的部分，就是如果他那一天没有。

![](img/8a54bdc9e800f3b07c099b8a79836e65_40.png)

他会保留这个制空的部分，你看如果有有他的话，是245去掉的话。

![](img/8a54bdc9e800f3b07c099b8a79836e65_42.png)

你看是不变的，二百二百四十四应该是有一天的滞空的。

![](img/8a54bdc9e800f3b07c099b8a79836e65_44.png)

我们把它保留下来，保留下来之后呢，然后把这个制空壳啊。

![](img/8a54bdc9e800f3b07c099b8a79836e65_46.png)

啊把这个制空词呃填补一下。

![](img/8a54bdc9e800f3b07c099b8a79836e65_48.png)

用它前面的词填补一下啊。

![](img/8a54bdc9e800f3b07c099b8a79836e65_50.png)

这个字写错了啊。

![](img/8a54bdc9e800f3b07c099b8a79836e65_52.png)

好用前面的词填补一下就行了，填补一下就行了。

![](img/8a54bdc9e800f3b07c099b8a79836e65_54.png)

这个我们给到，给到一个什么呢，给到一个，给他他吧。

![](img/8a54bdc9e800f3b07c099b8a79836e65_56.png)

但是这个东西它的那个索引呢。

![](img/8a54bdc9e800f3b07c099b8a79836e65_58.png)

索引最好是换一换，其实换一换可以啊，我们不换其实也没问题，前面就是新安，然后你这个应该注意一下，这个应该是第一个兴安，这个应该是我们的中正，而这个对应的是我们的兴安。



![](img/8a54bdc9e800f3b07c099b8a79836e65_60.png)

是不是啊。

![](img/8a54bdc9e800f3b07c099b8a79836e65_62.png)

有了这个东西的话，我们要干嘛呢，我们要算收益啊。

![](img/8a54bdc9e800f3b07c099b8a79836e65_64.png)

我们要算收益，这只是价格啊，这价格我们要算什么呢。

![](img/8a54bdc9e800f3b07c099b8a79836e65_66.png)

首先我们要算我们的RRI，当然我们这里其实也可以写，大家可以无所谓啊。

![](img/8a54bdc9e800f3b07c099b8a79836e65_68.png)

像我们的兴安的一个收益，新安的收益是哪个呢，是这个东西。

![](img/8a54bdc9e800f3b07c099b8a79836e65_70.png)

它的。

![](img/8a54bdc9e800f3b07c099b8a79836e65_72.png)

收盘的Y。

![](img/8a54bdc9e800f3b07c099b8a79836e65_74.png)

是吧，这应该是新安的，他除以什么呢，除以它的shift，这个大家还记得吧，这算收益率的，然后减1-1之后呢，我们可以看一下它是有第一个词汇之空，我们最好是把它去掉，所以说呢，好这就得了啊，这就可以了。

类似的我们可以干嘛呢，可以上我们的呃，中证流通指数也是我们这里的RM，X。

![](img/8a54bdc9e800f3b07c099b8a79836e65_76.png)

好这两个收益都算好了。

![](img/8a54bdc9e800f3b07c099b8a79836e65_78.png)

收益都算好了，然后干嘛呢，我们看一下题目啊。

![](img/8a54bdc9e800f3b07c099b8a79836e65_80.png)

假设我们的无风险利率是年化三3。6%。

![](img/8a54bdc9e800f3b07c099b8a79836e65_82.png)

年化3。6%，但是呢我们这里的收益是一天一天的。

![](img/8a54bdc9e800f3b07c099b8a79836e65_84.png)

所以说我们要算一算每天的平均收益，年化是0。036是吧，年化是0。036，所以说它的呃，如果我们用算术网，我们用算数吧，用算术平均值，那应该是他加一，然后干嘛呢，然后开放大家能理解吗。

注意三百三百六十天，因为这个是不存在交易日的，每天都会有的啊。

![](img/8a54bdc9e800f3b07c099b8a79836e65_86.png)

然后呢再减一，大家还记得吗啊，就是算术平均值，因为我们知道一年嘛，一年是0。036，然后算他的360天每天的平均收益啊，用这个方式来算，把这个给到我们的RF。



![](img/8a54bdc9e800f3b07c099b8a79836e65_88.png)

F等于它啊。

![](img/8a54bdc9e800f3b07c099b8a79836e65_90.png)

这个都算好了，然后呢我们他是要干嘛，是要求散点图。

![](img/8a54bdc9e800f3b07c099b8a79836e65_92.png)

是不是求散点图。

![](img/8a54bdc9e800f3b07c099b8a79836e65_94.png)

我们试试RIRI，是吧。

![](img/8a54bdc9e800f3b07c099b8a79836e65_96.png)

那这是呃这个横轴是大盘的。

![](img/8a54bdc9e800f3b07c099b8a79836e65_98.png)

纵轴是我们的那个新安股份啊。

![](img/8a54bdc9e800f3b07c099b8a79836e65_100.png)

是这个了。

![](img/8a54bdc9e800f3b07c099b8a79836e65_102.png)

他他要减减吗，我看他他说要减，要减也行啊。

![](img/8a54bdc9e800f3b07c099b8a79836e65_104.png)

差不多啊。

![](img/8a54bdc9e800f3b07c099b8a79836e65_106.png)

就是移动类项目啊，没什么，这是做散点图。

![](img/8a54bdc9e800f3b07c099b8a79836e65_108.png)

而我们的CPM这个模型呢，是要对这个散点图进行回归的啊，进行做一个线性回归。

![](img/8a54bdc9e800f3b07c099b8a79836e65_110.png)

而且注意同学同学们注意点。

![](img/8a54bdc9e800f3b07c099b8a79836e65_112.png)

这里是什么呢，这里是一个时间序列回归啊，不是一个横截面回归，为什么呢，他用的是啊一个股票的历史啊，历史的一个呃平均收益率，不是取得某一天所有股票的。



![](img/8a54bdc9e800f3b07c099b8a79836e65_114.png)

这里我们用的是时间序列回归。

![](img/8a54bdc9e800f3b07c099b8a79836e65_116.png)

时间序列回归。

![](img/8a54bdc9e800f3b07c099b8a79836e65_118.png)

怎么做呢，啊就用用用我们下面的这个东西。

![](img/8a54bdc9e800f3b07c099b8a79836e65_120.png)

这个。

![](img/8a54bdc9e800f3b07c099b8a79836e65_122.png)

![](img/8a54bdc9e800f3b07c099b8a79836e65_123.png)

![](img/8a54bdc9e800f3b07c099b8a79836e65_124.png)

看一下，这个。

![](img/8a54bdc9e800f3b07c099b8a79836e65_126.png)

然后呢嗯然后和我们的这个东西。

![](img/8a54bdc9e800f3b07c099b8a79836e65_128.png)

但是这个东西需要干嘛呢。

![](img/8a54bdc9e800f3b07c099b8a79836e65_130.png)

需要加一个常数啊，这是这个回归的一个需求。

![](img/8a54bdc9e800f3b07c099b8a79836e65_132.png)

需要这样需要这样一下。

![](img/8a54bdc9e800f3b07c099b8a79836e65_134.png)

![](img/8a54bdc9e800f3b07c099b8a79836e65_135.png)

啊这个函数是专门做线性回归的，就是你只要给到你的Y和X这里呢，我们给这是我们的Y值啊，这是我们的X值，但是X呢我们加了一个常数项，为什么要加常数项呢。



![](img/8a54bdc9e800f3b07c099b8a79836e65_137.png)

就是因为我们这里是假设会有这个阿尔法的。

![](img/8a54bdc9e800f3b07c099b8a79836e65_139.png)

我们要去算阿尔法，所以加了一个常数项。

![](img/8a54bdc9e800f3b07c099b8a79836e65_141.png)

加了一个常数项，然后。

![](img/8a54bdc9e800f3b07c099b8a79836e65_143.png)

就可以了啊，等一下。

![](img/8a54bdc9e800f3b07c099b8a79836e65_145.png)

啊看一下。

![](img/8a54bdc9e800f3b07c099b8a79836e65_147.png)

![](img/8a54bdc9e800f3b07c099b8a79836e65_148.png)

你看啊无非就是把这个是遵循，差不多就是把你的我们的训练数据给到进去，然后模型进行拟合，然后就能得到交通这个模型的一个呃，啊这对啊，这个是搞错了啊，是M啊，刚刚搞错了，怎么可能是一这这太太得了啊是吧。

这样的话就得到了呃，这样这个东西的一个线性拟合啊，这个东西线性拟合有了这个的话，同学们我们print一下吧，这样会看的好看一点。



![](img/8a54bdc9e800f3b07c099b8a79836e65_150.png)

大家要了解了解这个东西的意义啊，了解这个东西的意义。

![](img/8a54bdc9e800f3b07c099b8a79836e65_152.png)

首先呢这个牛不帅，为什么这个这么这个东西是啥。

![](img/8a54bdc9e800f3b07c099b8a79836e65_154.png)

首先是这样的啊，这里是系数，大家能看懂吗，会飞啊，是系数啊，说明什么呢，这个东西拟合出来，它的阿尔法只是这个，然后呢他的贝塔值是这个东西，看到没有，这是它的系数啊，它的系数这个是最重要的。

然后呢还有一个是这里的决定啊。

![](img/8a54bdc9e800f3b07c099b8a79836e65_156.png)

这叫什么，我看下面下面有说明的。

![](img/8a54bdc9e800f3b07c099b8a79836e65_158.png)

叫这个叫什么决定系数啊，它描述了回归曲线对真实数据点的拟合程度，的一个值，应该取在0~1之间越接近越好，而且从这里能看出啊。



![](img/8a54bdc9e800f3b07c099b8a79836e65_160.png)

从这里我们能看出我们这很一般啊。

![](img/8a54bdc9e800f3b07c099b8a79836e65_162.png)

你看我这个在0。24，就是并不是完全并不太好不太好。

![](img/8a54bdc9e800f3b07c099b8a79836e65_164.png)

我们看一下其他的量。

![](img/8a54bdc9e800f3b07c099b8a79836e65_166.png)

啊还有这个量是P值，显示了统计量和响应变量之间，是否具有显著的线性相关性啊。

![](img/8a54bdc9e800f3b07c099b8a79836e65_168.png)

我们看一下我们的批次。

![](img/8a54bdc9e800f3b07c099b8a79836e65_170.png)

批次在哪里看呢，要在这里在这里看啊。

![](img/8a54bdc9e800f3b07c099b8a79836e65_172.png)

P值我看一下P值要写个小于号。

![](img/8a54bdc9e800f3b07c099b8a79836e65_174.png)

那这个系数要小要小比较好看没有。

![](img/8a54bdc9e800f3b07c099b8a79836e65_176.png)

那我们这个系数是很小啊，看到没有。

![](img/8a54bdc9e800f3b07c099b8a79836e65_178.png)

这个这个这个就是啊就是这个东西跟系统啊，跟大盘的变化是很一致的啊，很相关的，但是其实这个常数项的这个这个P值并不小啊。



![](img/8a54bdc9e800f3b07c099b8a79836e65_180.png)

常数项的这个P值并不小好吧，不管怎样。

![](img/8a54bdc9e800f3b07c099b8a79836e65_182.png)

我们把它做出来了啊，把它做出来了，然后我们可以把它可视化一下啊。

![](img/8a54bdc9e800f3b07c099b8a79836e65_184.png)

这应该就是可视化的，你看老师把这个方程写出来了，这个方程是基于基于这个系数的。

![](img/8a54bdc9e800f3b07c099b8a79836e65_186.png)

看到没有这两个系数。

![](img/8a54bdc9e800f3b07c099b8a79836e65_188.png)

然后把方程写出来，然后把它做做一条直线啊。

![](img/8a54bdc9e800f3b07c099b8a79836e65_190.png)

做一条直线，然后在这个应该是要减什么呢，要减2F。

![](img/8a54bdc9e800f3b07c099b8a79836e65_192.png)

![](img/8a54bdc9e800f3b07c099b8a79836e65_193.png)

![](img/8a54bdc9e800f3b07c099b8a79836e65_194.png)

![](img/8a54bdc9e800f3b07c099b8a79836e65_195.png)

啊就这样子，你看这就是我们礼盒的一个情况啊。

![](img/8a54bdc9e800f3b07c099b8a79836e65_197.png)

礼盒的情况，这个礼盒呢得到了这个呃，他的阿尔法只是这个，然后呢他的贝塔值是这个贝塔值，其实还好，他基本上就是跟大大盘一致，就它的啊变化的程度，首先它的方向它是一个正数。

所以说它的方向和大盘的变化是一致的啊，并且大小也差不多啊，就比一稍微小一点啊，但是呢他这个阿尔法只是比较小的，也就是说它超出大盘，它其实是弱于大盘的，就它的收益啊，它的收益是弱于大盘，弱于大盘好吧。

同学们把这个这个东西做一做好不好。

![](img/8a54bdc9e800f3b07c099b8a79836e65_199.png)