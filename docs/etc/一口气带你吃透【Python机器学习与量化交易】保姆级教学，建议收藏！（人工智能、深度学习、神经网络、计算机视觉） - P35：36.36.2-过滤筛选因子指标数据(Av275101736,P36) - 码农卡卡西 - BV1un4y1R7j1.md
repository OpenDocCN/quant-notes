# 一口气带你吃透【Python机器学习与量化交易】保姆级教学，建议收藏！（人工智能、深度学习、神经网络、计算机视觉） - P35：36.36.2-过滤筛选因子指标数据(Av275101736,P36) - 码农卡卡西 - BV1un4y1R7j1

![](img/bb9a774f54a00269b8be1c62e7099cf8_0.png)

三角函数有什么呢，咱们来想一想吧，比如说现在一些停牌的一些停牌的。

![](img/bb9a774f54a00269b8be1c62e7099cf8_2.png)

咱还能用了吗，肯定不用吧，或者是一些你你这个现在拿着股票，那什么都有，那如果还有一些s st股呢，是不是我也不要了，还有一些新上市的股，那刚上市两三天的，刚上市几天的，我们是不可能也不要啊。

在这里哎我们说得写几个函数，帮助咱们去过滤一些股票了，我说我自己写一下呃，一个filter啊，filter什么，咱们先来一个判断吧，先判断那些停牌的停牌的咱就不要了。



![](img/bb9a774f54a00269b8be1c62e7099cf8_4.png)

哎在这里呃，我一会儿我会传进来一个stock list。

![](img/bb9a774f54a00269b8be1c62e7099cf8_6.png)

在这里就是传进来啊，我们当前股票的一个池子，然后对这个当中啊做一些筛选。

![](img/bb9a774f54a00269b8be1c62e7099cf8_8.png)

怎么筛选呢，我说你遍历一下啊，对我其中啊每一个股票。

![](img/bb9a774f54a00269b8be1c62e7099cf8_10.png)

每个股票因我的当前哎我的一个大池子当中，在我当前大池当中，我要判算一下它什么，它是不是一个停牌的吧，那怎么判断是不是停牌啊。



![](img/bb9a774f54a00269b8be1c62e7099cf8_12.png)

如果说它不是不是什么一个停牌的吧。

![](img/bb9a774f54a00269b8be1c62e7099cf8_14.png)

找一找，我看这个应该是这个API点进来看一下啊，你看这里你点的时候。

![](img/bb9a774f54a00269b8be1c62e7099cf8_16.png)

他是不是说了判断某只股票哎是否全年停牌，那我来判断一下吧。

![](img/bb9a774f54a00269b8be1c62e7099cf8_18.png)

如果这个股票全年停牌了，我是不是就不用它了呀，好了，然后这里我把这个股票传进去，股票实实当中，每个股票我都需要做这样一个判断好了，那现在我编辑完之后，我要保存什么，那就是剩下的吧。



![](img/bb9a774f54a00269b8be1c62e7099cf8_20.png)

如果说他没在这个停牌当中，我把它拿出来行吗，就是不是就行了好了。

![](img/bb9a774f54a00269b8be1c62e7099cf8_22.png)

我把这个stock给拿到手啊就行了，然后给它返回一个list。

![](img/bb9a774f54a00269b8be1c62e7099cf8_24.png)

这就完事了，这样咱就哎这块我再写一个return吧，我把这个直接往右边了。

![](img/bb9a774f54a00269b8be1c62e7099cf8_26.png)

右边咱们先不用，咱先写代码好了，我说这块我直接给它return回去。

![](img/bb9a774f54a00269b8be1c62e7099cf8_28.png)

相当于啊此时啊我去判断了一下当前啊，咱这个股票它是不是一个停牌的。

![](img/bb9a774f54a00269b8be1c62e7099cf8_30.png)

咱完成第一件事，然后呢哎咱们就就着这个事啊，把所有东西都写了吧。

![](img/bb9a774f54a00269b8be1c62e7099cf8_32.png)

接下来我还得再判断判断什么呃，判断这个股啊，它是不是一个s st股。

![](img/bb9a774f54a00269b8be1c62e7099cf8_34.png)

s st股，咱肯定不要吧，好了，这个list给它拿过来。

![](img/bb9a774f54a00269b8be1c62e7099cf8_36.png)

然后在这里咱们接着写，还是我把这个东西复制过来就行了，其实逻辑都是一模一样的。

![](img/bb9a774f54a00269b8be1c62e7099cf8_38.png)

在这里哎之前我们判断什么，判断它是不是一个啊。

![](img/bb9a774f54a00269b8be1c62e7099cf8_40.png)

就是是不是那个停牌，那接下来再判断ace is什么呢，你看这里哎直接出来了。

![](img/bb9a774f54a00269b8be1c62e7099cf8_42.png)

是不是一个s st股是吧，好了，把这个传进去，还是我的stock哎。

![](img/bb9a774f54a00269b8be1c62e7099cf8_44.png)

做一个便利，再把它的结果返回回来，是不就行了，这一回我又判断了一下他是不是一个s st股。

![](img/bb9a774f54a00269b8be1c62e7099cf8_46.png)

然后接下来再判断一个，再判断一个它是不是一个新的股票吧。

![](img/bb9a774f54a00269b8be1c62e7099cf8_48.png)

啊就是刚上市的，在这里呢啊所有的操作咱都不用去改啊。

![](img/bb9a774f54a00269b8be1c62e7099cf8_50.png)

只是这块我们要去重新的判断一下，判断什么呢。

![](img/bb9a774f54a00269b8be1c62e7099cf8_52.png)

当前啊，我们的一个股票它是不是一个新上市的呃。

![](img/bb9a774f54a00269b8be1c62e7099cf8_54.png)

这里边然后把我的一个股票给他传进去，然后呢。

![](img/bb9a774f54a00269b8be1c62e7099cf8_56.png)

对我咱们当前啊，呃这些所有的股票要判断什么呢，它是不是一个新账式的。

![](img/bb9a774f54a00269b8be1c62e7099cf8_58.png)

就是它哎你这里没法判断是不是新上市的，但是你可以把他的一些。

![](img/bb9a774f54a00269b8be1c62e7099cf8_60.png)

这里咱是拿到所有股票了吧，然后呢拿到股票当中，你可以去判断一下。

![](img/bb9a774f54a00269b8be1c62e7099cf8_62.png)

就是当前股票呃，对于当前这个股票来说，它的信息里边儿呃。

![](img/bb9a774f54a00269b8be1c62e7099cf8_64.png)

是不是啊小于某些天，比如这里咱来写，我说他这个D哦，他这个API没有直接整出来，那我直接写吧。

![](img/bb9a774f54a00269b8be1c62e7099cf8_66.png)

就是death from咱们的一个list当中，还有这样一个，我看一看它有没有提示啊。

![](img/bb9a774f54a00269b8be1c62e7099cf8_68.png)

是我写错了啊，对是这个，然后哎对这个他已经提示我了，然后这里呢我们要做一个判断，判断什么，你自己想啊，它要大于多少天，比如说呃最少我说当前这个果你大于半年吧，啊大于一个180天。



![](img/bb9a774f54a00269b8be1c62e7099cf8_70.png)

这个也可以帮我们去做一个筛选，那相当于啊这里哎我们先写了，我们有这样三个就是筛选函数。

![](img/bb9a774f54a00269b8be1c62e7099cf8_72.png)

这里的我都写一下啊，这块判断是否啊停牌。

![](img/bb9a774f54a00269b8be1c62e7099cf8_74.png)

然后呢这块我说判断判断是否st啊。

![](img/bb9a774f54a00269b8be1c62e7099cf8_76.png)

s st股。

![](img/bb9a774f54a00269b8be1c62e7099cf8_78.png)

然后呢这个这个他是去判断啊，判断是否是新股啊。

![](img/bb9a774f54a00269b8be1c62e7099cf8_80.png)

这是我们做了一个判断，在这里呢既然我们做完判断之后啊，那你说我们现在干什么。

![](img/bb9a774f54a00269b8be1c62e7099cf8_82.png)

首先啊这块写一下，首先啊过滤掉啊，不想要的股票。

![](img/bb9a774f54a00269b8be1c62e7099cf8_84.png)

这里我们来过滤好了，刚才我们是不是先有函数了，用这个函数干什么。

![](img/bb9a774f54a00269b8be1c62e7099cf8_86.png)

传进去一下，把刚才哎但凡这点咱得到所有的股票。

![](img/bb9a774f54a00269b8be1c62e7099cf8_88.png)

我都得到他的一个id了吧，都有它个编号了行了，传进来我们先判断它。

![](img/bb9a774f54a00269b8be1c62e7099cf8_90.png)

先判断它一下是否它是一个停牌的，然后呢如果说啊这块地有返回值。

![](img/bb9a774f54a00269b8be1c62e7099cf8_92.png)

你看这块它返回的是就是我们的股票是吧，所以说给它指定名字吧。

![](img/bb9a774f54a00269b8be1c62e7099cf8_94.png)

那就是哦do啊，等于我的过滤完结果。

![](img/bb9a774f54a00269b8be1c62e7099cf8_96.png)

那这个只是我们现在做了第一次过滤吧，那我们肯定还有第二次过滤，第二次过滤啊得用什么。

![](img/bb9a774f54a00269b8be1c62e7099cf8_98.png)

那现在判断了是否停牌，那接下来判断它是否是一个s st股。

![](img/bb9a774f54a00269b8be1c62e7099cf8_100.png)

是不就行了，然后接下来还有最后一个，判断它是否是一个新股。

![](img/bb9a774f54a00269b8be1c62e7099cf8_102.png)

我再执行一下，往下移一下是否是新股。

![](img/bb9a774f54a00269b8be1c62e7099cf8_104.png)

好了，把函数拿过来，这样我咱们就完成了当前的一个操作呃，过滤掉了我不希望要的。

![](img/bb9a774f54a00269b8be1c62e7099cf8_106.png)

然后接下来要干什么，那好了，那现在股票有了，我们要的是什么呀。

![](img/bb9a774f54a00269b8be1c62e7099cf8_108.png)

哎咱们今天做什么策略来着，是不是一个因子策略啊，在这个因子策略当中啊。

![](img/bb9a774f54a00269b8be1c62e7099cf8_110.png)

我需要拿到哎我想要的一些指标了吧，好啦，那现在咱们来写吧，在这当中我说获得啊，获呃就是查询吧。

![](img/bb9a774f54a00269b8be1c62e7099cf8_112.png)

查询啊，想要的指标好了，查询是什么函数啊。

![](img/bb9a774f54a00269b8be1c62e7099cf8_114.png)

这里也不给大家看一篇文档了，它还会提示我get呃，Fundamentals。

![](img/bb9a774f54a00269b8be1c62e7099cf8_116.png)

在这里好了，get fundamental当中，我们要需要传递一下，第一个就是一个query吧，因为你看这里啊，你点进来之后，它会告诉你第一个参数就是个query啊。



![](img/bb9a774f54a00269b8be1c62e7099cf8_118.png)

你得需要写个query语句，咱来写吧，在这里我说我要去查啊。

![](img/bb9a774f54a00269b8be1c62e7099cf8_120.png)

去查查什么呢，咱们来想一想，在这里啊，我们是不是咱之前说了哎一个什么一个视净值，还有什么按市净率，还有什么，还有我们的一个价市场价值，是不是，所以说啊咱们把这个就试驾，那咱们来看一下吧。

在这里呃我们把这两个要查询的目标咱来写下。

![](img/bb9a774f54a00269b8be1c62e7099cf8_122.png)

第一个呃。

![](img/bb9a774f54a00269b8be1c62e7099cf8_124.png)

fundamentals当中，我要去查查他的什么来着呃。

![](img/bb9a774f54a00269b8be1c62e7099cf8_126.png)

查的1PDRACHEL是吧，来找pd呃。

![](img/bb9a774f54a00269b8be1c62e7099cf8_128.png)

不是看看这个哎，对PB为首，这个值我们把它要查出来吧，我们的设定率。

![](img/bb9a774f54a00269b8be1c62e7099cf8_130.png)

然后接下来呢我们还要再查一个指标，这块你得写个逗号，还有个指标。

![](img/bb9a774f54a00269b8be1c62e7099cf8_132.png)

还有指标呢跟它是一样的，就是最后不太一样，我复制过来复制过来，然后把最后一个去掉。

![](img/bb9a774f54a00269b8be1c62e7099cf8_134.png)

看一下它是个market什么东西，咱找一找呃，market什么东西。

![](img/bb9a774f54a00269b8be1c62e7099cf8_136.png)

market哎这儿呢market cp是吧，还给他找到手了，这个就是咱们课程当中给大家说的。

![](img/bb9a774f54a00269b8be1c62e7099cf8_138.png)

我们的市盈率和一个市值来说，要查询这两个指标吧。

![](img/bb9a774f54a00269b8be1c62e7099cf8_140.png)

好了，那现在我们把这样指标拿到手了，拿到手之后哎，那你说现在找了这么多指标。

![](img/bb9a774f54a00269b8be1c62e7099cf8_142.png)

我们要什么呀，是不是得符合我当前手有些股票的呀。

![](img/bb9a774f54a00269b8be1c62e7099cf8_144.png)

你要查谁啊，查我手里这批股票的呀，所以说这块你写个filter filter当中啊。

![](img/bb9a774f54a00269b8be1c62e7099cf8_146.png)

你要写上啊查谁，那也就是我们手里现在的这些股票好了。

![](img/bb9a774f54a00269b8be1c62e7099cf8_148.png)

把它拿过来点一下吧，点一下呃，在这个当中我们来想一下它是什么。

![](img/bb9a774f54a00269b8be1c62e7099cf8_150.png)

它是一个呃股票这个编码，找一找股票编码啊。

![](img/bb9a774f54a00269b8be1c62e7099cf8_152.png)

Code，然后呢它是一个音in操作，因咱们的一个呃。

![](img/bb9a774f54a00269b8be1c62e7099cf8_154.png)

因咱们的一个stars当中，我把这个stars给他传进去就可以了。

![](img/bb9a774f54a00269b8be1c62e7099cf8_156.png)

好了，这里我们又做了一个筛选，现在就是拿到这两个信息了。

![](img/bb9a774f54a00269b8be1c62e7099cf8_158.png)

然后之前啊咱们是不是给大家说过一下，哎，现在咱们得到的这个信息其实长什么样子。

![](img/bb9a774f54a00269b8be1c62e7099cf8_160.png)

这里我先不运行了，这个它会比较卡，停留时间比较长，它会得到什么。

![](img/bb9a774f54a00269b8be1c62e7099cf8_162.png)

上面第一行是股票的名字吧，第一个股，第二股，第三股，第四个股。

![](img/bb9a774f54a00269b8be1c62e7099cf8_164.png)

第五个股，第六股，然后这是指标指标指标是吧，这样一个格式跟我们想要的一样吗。

![](img/bb9a774f54a00269b8be1c62e7099cf8_166.png)

不一样吧，我们想要的是竖着的，哎我说这是第一个果，这是第二个，这第三个值1234。

![](img/bb9a774f54a00269b8be1c62e7099cf8_168.png)

咱是不是这样，之前说过了吧，所以这里我们怎么办，是不是得做一个转置啊。

![](img/bb9a774f54a00269b8be1c62e7099cf8_170.png)

然后这个其中啊可能你会取到一些空值呃，呃空值咱也不想什么招了。

![](img/bb9a774f54a00269b8be1c62e7099cf8_172.png)

我就全不要了，直接召回A就得了行了，这里咱们现在完成了这一步啊。

![](img/bb9a774f54a00269b8be1c62e7099cf8_174.png)