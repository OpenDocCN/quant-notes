# 跟着大佬11个小时啃透【机器学习与量化交易】项目实战，保姆级教程！！！（Python／可视化／金融／股票／算法／聚类／人工智能） - P15：15-均线调参实例 - 迪哥AI知识课堂 - BV1xM4m127hV

![](img/61cfc64f420d6202eeb037b93a37b7ec_0.png)

行了说完这个双电源测试之后，然后接下来我们看第二个第二个问题是什么呢，就是现在有个问题啊。

![](img/61cfc64f420d6202eeb037b93a37b7ec_2.png)

哎呀你这个结果你说跟哪些因素有关系，大家可能会告诉我，那跟很多因素都会有关系的，那这里咱们该怎么办，咱们也这样，你说现在啊我能不能去找一些参数，比如说我们的一个短线和一个长线，那也不是短线。



![](img/61cfc64f420d6202eeb037b93a37b7ec_4.png)

长期短期和长期，我能不能设置一些不同的值来去看一看，短期究竟是五天合适呢，还是十天合适呢，长期是20天合适呢，还是四天合适呢，我可以算一算这样的组合吧，在tan当中啊。

我们可以很轻松的做这样一个迭代好了，把迭代工具先导进来，我们先把这个迭代工具啊给它拿到手，from咱们DI工具当中，import ti啊，import product这个东西它就是能帮啊。



![](img/61cfc64f420d6202eeb037b93a37b7ec_6.png)

就给大家解释一下他是做什么的，其实很简单啊。

![](img/61cfc64f420d6202eeb037b93a37b7ec_8.png)

就是它需要让我们啊啊写反了，Sm1，还有一个SMA2，它需要让我们啊分别去指定好两个参数空间，参数空间啊，你可以自己随便指定，比如说从20，然后到这个61，只要取不到61，最多取到60。

然后这么四个一加是吧，到这里你也可以指定一个range，range当中，从多少长线，咱稍微大1。180，然后到这个280吧，然后取不到280，取到281，然后十个一加行吧，然后这样。

然后我再指指定一下当前我这个结果呃，这个参数空间的意思就是它这个组合的意思啊，是这样，就是呃得能去帮我们去计算出来，所有的一个组合，比如这里你看这个20跟180行吧。

20就是有这样一些组合一块儿做完之后，二十一百八，这是一种组合是吧，然后20，然后这个一一呃，二十一百九，然后二十三二十二百，然后二十二百一是吧，点点点点。



![](img/61cfc64f420d6202eeb037b93a37b7ec_10.png)

然后20万多少，二十四一百八，然后呢二十四一百九啊。

![](img/61cfc64f420d6202eeb037b93a37b7ec_12.png)

这个遍地操作，能帮助我们把所有的一个结果全部给它。

![](img/61cfc64f420d6202eeb037b93a37b7ec_14.png)

遍地掉啊，是这个意思，然后呢呃一会儿吧，咱在这里就是for循环当中去写吧，在这一块就是我们可以写一下，复员当中我要做便利了，呃，便利当中我要拿到咱当前的两个参数，就是一个长线和一个短线。

in什么in这个product当中，然后我把这个结果给，把当前两个参数空间传进去，这是第一个参数空间，然后这是第二个参数空间。



![](img/61cfc64f420d6202eeb037b93a37b7ec_16.png)

能把所有结果全拿到手，然后在这里做遍历，然后遍历过程当中呢，我会把当前我们的每一个数据全部给它。

![](img/61cfc64f420d6202eeb037b93a37b7ec_18.png)

指定出来吧，啊就是一个data data，我看一看啊，之前哎呀这个data a当中我得重新算了。

![](img/61cfc64f420d6202eeb037b93a37b7ec_20.png)

在这一块这样吧，把咱数据重导一下吧。

![](img/61cfc64f420d6202eeb037b93a37b7ec_22.png)

然后之前那份数据可能让我做乱了，我我为了保险还是重导一下。

![](img/61cfc64f420d6202eeb037b93a37b7ec_24.png)

在这里好，这咱把这个数据在这里重导一下。

![](img/61cfc64f420d6202eeb037b93a37b7ec_26.png)

呃，这里重导吧，导一下咱这个数据data，就是等于我们刚才啊传建的数据当中的。

![](img/61cfc64f420d6202eeb037b93a37b7ec_28.png)

只需要我们的一个平衡骨架啊，咱们再把它复制过来，苹果的骨架啊。

![](img/61cfc64f420d6202eeb037b93a37b7ec_30.png)

把名字指定出来就可以了，然后现在就是我们拿到数据了。

![](img/61cfc64f420d6202eeb037b93a37b7ec_32.png)

拿到数据之后，不要忘记对数据，还要做这样一个去缺失值的操作。

![](img/61cfc64f420d6202eeb037b93a37b7ec_34.png)

我就全复制了，因为都是相同操作，在这里为大家去写了，这里还是第一步去缺失值确认确认之后呢。

![](img/61cfc64f420d6202eeb037b93a37b7ec_36.png)

然后下一步下一步就是我们要去算吧。

![](img/61cfc64f420d6202eeb037b93a37b7ec_38.png)

要去算三个值，一个是returns，一个是SMA1，还有SMA2是吧。

![](img/61cfc64f420d6202eeb037b93a37b7ec_40.png)

我把这三个结果也都复制过来啊，这是一个returns，方法都是一样的，这是把returns给它复制过来。



![](img/61cfc64f420d6202eeb037b93a37b7ec_42.png)

然后呢接下来SMA1还有SMA2。

![](img/61cfc64f420d6202eeb037b93a37b7ec_44.png)

我也复制一下，再往上啊，这块把它拿过来好了。

![](img/61cfc64f420d6202eeb037b93a37b7ec_46.png)

这是一个SMA1，然后我把这个改一改，这是一个SMA2，然后这块分别用一个二就可以了，然后看一下对当前的数据哦，这块也加上一下，刚才咱们就忘了，这里我需要加上就是当前是对谁做这个操作的，然后对我的骨架。

这个也是对我的股价来执行这样一个操作，直接搜完之后啊。

![](img/61cfc64f420d6202eeb037b93a37b7ec_48.png)

然后肯定哎呦这块我估计又会有缺失值，再把这个缺缺失值的东西加一遍，那接下来就是我们再去把上面的呃，判断给复制过来。



![](img/61cfc64f420d6202eeb037b93a37b7ec_50.png)

就是一个position的一个东西啊，找一下，相当于啊把我们之前所有结果。

![](img/61cfc64f420d6202eeb037b93a37b7ec_52.png)

咱要做一个汇总了，正常写代码，其实也就是把上面的结果都写在一个函数当中。

![](img/61cfc64f420d6202eeb037b93a37b7ec_54.png)

只不过说在给大家讲解过程当中啊，可能为了方便我就给大家一行一行去写的。

![](img/61cfc64f420d6202eeb037b93a37b7ec_56.png)

方便咱去展示每一行它的一个结果吗，其实实际上它就是一个函数而已。

![](img/61cfc64f420d6202eeb037b93a37b7ec_58.png)

然后这块我看一看哦，这块再看一下我们的一个策略好啦，然后一个我看到一个position，咱有了return，也有了我们的一个策略。



![](img/61cfc64f420d6202eeb037b93a37b7ec_60.png)

也有了这步整完之后再去掉一个缺失值，每一步都会有缺失值啊，切换缺失值之后，然后最终我会有一个结果，我把这个结果也拿过来啊。



![](img/61cfc64f420d6202eeb037b93a37b7ec_62.png)

结果就是复制这个把这个结果给拿过来，这是当前结果吧。

![](img/61cfc64f420d6202eeb037b93a37b7ec_64.png)

好了有结果之后，我说我对这个结果做一个展示吧，展示就是一个results，这个results咱也写好看一点，给它写成一个呃表格的一个形式吧。



![](img/61cfc64f420d6202eeb037b93a37b7ec_66.png)

就是resource，这样一开始的时候我先创建一个表格吧，results等于我的一个pandas调呃，创建data frame先是空的吧，然后一会儿再往里去传，在这个result当中。

result等于我这个resource里边，然后呢我判断一下，把它当前啊，但凡我需要的东西全加进来呃，还是加一个data frame，把它做成一个表格的形式。



![](img/61cfc64f420d6202eeb037b93a37b7ec_68.png)

在这个data frame当中啊，我用一个key value的形式，把我的一个列名和它实际的值给传进去呃，第一个名字就是一个SMA1是吧好了，S m a1，然后它的值额就是这个SMA1。

然后第二个我直接复制了，第二个就是我的SMA2，把他都复制过来，然后逗号也复制一下，有好几个，这是SMA2，这也是SMA2，然后第三个第三个就是呃我的一个returns，好。

这个returns把这个returns复过复制过来，这也是个returns，然后下一个下一个就是咱们的一个策略，我的这个策略啊，策略拿过来，策略诶，好像复制错了，在这里，这是我，我找一找，这是名字。

这是value名字value名字value啊，该复制这个了，这是我的一个策略，然后再复制一个就行了，最后一个最后一个咱们写一个吧，就是我的一个输出结果，输出结果相当于就是呃我当前的一个预测值。

然后比你的一个结果值，就是咱用这个策略的结果和，不用这个策略能好多少，哎呦我不是把它放到当前这个里当中了吧，那行了，这一块我稍微改一改，等于我的一个策略值，我把这个策略值拿到手。

这个是我的一个策略值是吧，用我当前策略值，然后我要去减法啊。

![](img/61cfc64f420d6202eeb037b93a37b7ec_70.png)

减去一下当前我什么都不做的时候，它的一个结果，这个returns要这里咱还得改一改啊。

![](img/61cfc64f420d6202eeb037b93a37b7ec_72.png)

这块我直接谁RERETURN不行，我这块不是把这个returns都放到这里了吗，得给它列一下哦，我看一下这是呃return，然后returns它的一个结果呃。



![](img/61cfc64f420d6202eeb037b93a37b7ec_74.png)

这块稍微改一改，这块我看一看是不是写乱了，Sm a2。

![](img/61cfc64f420d6202eeb037b93a37b7ec_76.png)

然后这returns得把它改一下，在这个当中它是取returns这个结果吧，然后策略策略当中也是一样的，我把这个也复制过来，也复制过来之后，然后他取我策略的一个结果指数就行了。



![](img/61cfc64f420d6202eeb037b93a37b7ec_78.png)

呃先来试看一下吧，看看结果能不能出来，有点心需要写这么多，看一下。

![](img/61cfc64f420d6202eeb037b93a37b7ec_80.png)

他说呀在我算这个returns过程当中啊，然后就没有了这个key啊。

![](img/61cfc64f420d6202eeb037b93a37b7ec_82.png)

这怎么改啊，先来看一下吧，看一下啊，就是最简单的一个找错误方法。

![](img/61cfc64f420d6202eeb037b93a37b7ec_84.png)

就是他到哪儿遇到问题，然后在前面咱给它打印一下行吧，我说我看一下当前这个结果，他到底咋地了，这个data行不行好了。



![](img/61cfc64f420d6202eeb037b93a37b7ec_86.png)

重新执行一下，我们来看一看呃，我看看打印出来的结果会是什么。

![](img/61cfc64f420d6202eeb037b93a37b7ec_88.png)

打印出来这个数据数据当中啊，只有个date啊，只有我的一个索引，但是呢你看它像是把这个数据当中啊，像是没有这个列了是吧，这源于什么，我们当前取完之后，当前我们得到的是一列数据，一页数据当中啊。

没有给我带这个名字。

![](img/61cfc64f420d6202eeb037b93a37b7ec_90.png)

所以此时我们得稍微改一改，我得把这个东西啊再加上点东西，你得让它接着成为一个data frame才行吧，所以这块咱这样咱把它呀给它加上一个data frame。



![](img/61cfc64f420d6202eeb037b93a37b7ec_92.png)

data frame给它包起来就行了，应该再来执行一下好了。

![](img/61cfc64f420d6202eeb037b93a37b7ec_94.png)

果然不出所料，又报错了，看一下哦，这块我得再再重新执行一下。

![](img/61cfc64f420d6202eeb037b93a37b7ec_96.png)

因为刚才改了东西之后，都得从头来执行来看看啊。

![](img/61cfc64f420d6202eeb037b93a37b7ec_98.png)

这回又报错了，但是报错不太一样，看一下是哪里，最后一行我做这个result table的时候。

![](img/61cfc64f420d6202eeb037b93a37b7ec_100.png)

构建我的一个数据啊，数据表的时候，然后他说了数据表当中啊啊哦。

![](img/61cfc64f420d6202eeb037b93a37b7ec_102.png)

你必须指定一个索引，那我不需要索引啊。

![](img/61cfc64f420d6202eeb037b93a37b7ec_104.png)

嘶不需要索引也没招啊，就是人家说了里边是必须去指定索引的，怎么办呢。

![](img/61cfc64f420d6202eeb037b93a37b7ec_106.png)

那人家说指定索引，那自己指定呗，index随便指定成一个值得了。

![](img/61cfc64f420d6202eeb037b93a37b7ec_108.png)

然后我来执行一下吧，好了执行完了来看一看。

![](img/61cfc64f420d6202eeb037b93a37b7ec_110.png)

先看一看这个结果怎么样，我该随便指定索引哦，看一看，你看我随便指定个零的。

![](img/61cfc64f420d6202eeb037b93a37b7ec_112.png)

所以但是感觉有点奇怪，这么滴吧，咱别随便指定零了，我先给它指定出来的索引，然后呢，我说我再给它一个闹一下，用原始的索引，就是按那个数值012345678再标吧，这个索引我给它忽略掉吧。



![](img/61cfc64f420d6202eeb037b93a37b7ec_114.png)

然后再执行一下哦，来执行执行执行，在咱们传建这个索引，传这个索引的时候，那应该是给这个data frame传索引是吧，然后呢ignore的时候应该是对于这个append来说，我不需要再给加索引了。

是不是应该这样一件事吧，所以说啊咱得把这个括号给对应上，咱想想怎么改啊，在这里这个index应该是对于data frame当中，我要加上括号，看对没对应上当前哦，怎么加中文逗号，加上一个逗号。

你看现在对应了这个data frame吧，你看这个data frame这亮了，所以说现在一个N我对应了，而不是这现在指定1DEX，对应data frame当中有索引了，然后再看最后一个。

我这个以IGNORINDEX，他说是对我这个判断来说，我不需要再加索引了，来看一看当前我这个括号，这括号好像多了一个。



![](img/61cfc64f420d6202eeb037b93a37b7ec_116.png)

再去掉一个哎，对应上了吧，对应是个判的行了，咱再来执行一下。

![](img/61cfc64f420d6202eeb037b93a37b7ec_118.png)

这回没问题了吧，展示下结果，这回我们的索引当中，你看01234咱就全有了吧，SM1还SV2，就是对于不同的结果我展示十个吧。



![](img/61cfc64f420d6202eeb037b93a37b7ec_120.png)

对于不同的一个就是那个什么不同的一个，参数选择吧，咱得到结果，Returns，还有我们策略得到结果，那你看对于不同的结果来说，第一个跌挺有意思啊，就是看咱们这个out out，相当于就是我们这个策略。

比那个啥也不做的时候能强多少，那第一个你看如果说你选的这个窗口不太合适，那反而还不如只啥也不管了，是不是，但是大部分条件下还是比之前要强一些吧。



![](img/61cfc64f420d6202eeb037b93a37b7ec_122.png)

然后甚至有的还是一个处于持平的一个状态。

![](img/61cfc64f420d6202eeb037b93a37b7ec_124.png)

行了，这给大家看了一下，就是呃咱们又给大家对比了一下，就是怎么样去基于我们不同的参数去选择一下。

![](img/61cfc64f420d6202eeb037b93a37b7ec_126.png)

什么样的一个结果才是一个合适的。

![](img/61cfc64f420d6202eeb037b93a37b7ec_128.png)

这给大家梳理一下在Python当中啊，怎么样借助这些工具包，来完成我们的一个双金线策略。

![](img/61cfc64f420d6202eeb037b93a37b7ec_130.png)

来给大家做了一个分析。