# （五）Python 多因子量化选股与机器学习 综合打分／因子选股／策略构建／性能评估 - P1 - 代码解析与论文精读 - BV1Vw4m1y7cn

哈喽各位小伙伴们大家好，经过前面几期的铺垫呢，我们讲解了数据的预处理，我们讲解了单调性检验，我们讲解了因子的IC值，R值，因子收益率，我们讲解了因子筛选，那么今天这一节呢。

我们开始讲解最重要的最核心的选股操作，那么就是综合打分法，因此选股策略构建以及性能评估。

![](img/636be9f7f320c9270ebbd1308e9bbcab_1.png)

今天我们一口气讲完这四部分，首先呢我们还是导入我们之前的因子。

![](img/636be9f7f320c9270ebbd1308e9bbcab_3.png)

处理后的结果就是换手率，波动率，市净率，市现率，市盈率等因子直。

![](img/636be9f7f320c9270ebbd1308e9bbcab_5.png)

那接下来呢我们来看一下，我们因子选股是怎么样进行操作的，首先呢我们嗯还回顾一下上个视频讲解的内容，就是对每个因子进行过去一，过去11个月的因子呃，计算IC值，选择IC值大于0。03的因子。

并且呢根据相关系数去除贡献性，经过这个操作呢，我们就得到了，当前时期应该选择哪个因子进行股票，就是哪个因子作为股票选择的依据，那我们假如选嗯，我们带大家回顾一下吧。



![](img/636be9f7f320c9270ebbd1308e9bbcab_7.png)

嗯也就是说2012年1月要选择波动率，收益率，涨跌幅，成交量振振动指标来作为最终选股的因子。

![](img/636be9f7f320c9270ebbd1308e9bbcab_9.png)

看到没有，那呃我们要对每一个因子进行划分。

![](img/636be9f7f320c9270ebbd1308e9bbcab_11.png)

比如说那既然要选择这几个因子，作为我们最终投资的一个参考依依据，嗯我们对每一个因子呢干嘛呢。

![](img/636be9f7f320c9270ebbd1308e9bbcab_13.png)

划分成五组，如果这个股票对应的因子值比较，就比如说如果如果这个IC值是正的，这里是有这个逻辑是什么呢，IC值是正的，大于零，IC值大于零，看到没有，IC的值大于零，代表着IC值大于零，代表着因子值越大。

股票未来的收益率就越高，那么我们就给当前股票因子值比较大的股票，给予较高的分数，看到没有，如果因子值大于零，并且我们对这个因子进行划分成五组，对于因子值较小的股票，我们给一分，对于因子值较高的股票。

我们给予五分，那到底有多少个因子进行打分呢，我们进行一个便利。

![](img/636be9f7f320c9270ebbd1308e9bbcab_15.png)

相当于在这里我们相当于是换手率波动率，对所有的股票进行打分，净资产收益率也进行打分，涨跌幅也进行打分。



![](img/636be9f7f320c9270ebbd1308e9bbcab_17.png)

成交量也进行打分，我们来看一下它的打分后的一个结果。

![](img/636be9f7f320c9270ebbd1308e9bbcab_19.png)

![](img/636be9f7f320c9270ebbd1308e9bbcab_20.png)

好这里这里是警告，不是报错。

![](img/636be9f7f320c9270ebbd1308e9bbcab_22.png)

没有关系的，它还在运行好，运行完了，我们来看一下哈。

![](img/636be9f7f320c9270ebbd1308e9bbcab_24.png)

我们来看一下股票的这个soccer到底是什么。

![](img/636be9f7f320c9270ebbd1308e9bbcab_26.png)

给大家一个看到没有，就相当于是这个股票它的分数是四分。

![](img/636be9f7f320c9270ebbd1308e9bbcab_28.png)

而这个股票呢分数是19分，就根据这个因子打分。

![](img/636be9f7f320c9270ebbd1308e9bbcab_30.png)

19分就是总和是19分，四分呢就是呃分数较低嗯。

![](img/636be9f7f320c9270ebbd1308e9bbcab_32.png)

而19分的代表分数较高，我们就选择分数较高的，排名前5%，前10%，前20%的股票，由于我们是季度选股对吧，我们就是选择未来三个就是我们选择三个月，持有期为三个月的收益率，作为我们投资组合的收益率。

那肯定不选择前5%的股票，我们要除以一个N，就相当于是等权重投资，假如选择20只股票，那么对二只，对这20只股票进行等权重分配，那么最终的收益率呢，就是呃就是这20只股票收益率的一个平均数。



![](img/636be9f7f320c9270ebbd1308e9bbcab_34.png)

就是这个rate，count加三呢就是季度选股。

![](img/636be9f7f320c9270ebbd1308e9bbcab_36.png)

每个季度进行选择好。

![](img/636be9f7f320c9270ebbd1308e9bbcab_38.png)

那接下来我们要我们就计算这个rate。

![](img/636be9f7f320c9270ebbd1308e9bbcab_40.png)

我们来看一下这个rate r，这个R呢就是一组收益率值。

![](img/636be9f7f320c9270ebbd1308e9bbcab_42.png)

Orrate。

![](img/636be9f7f320c9270ebbd1308e9bbcab_44.png)

我们打印这个ORRATE，这个这个就是500%分之十。

![](img/636be9f7f320c9270ebbd1308e9bbcab_46.png)

20%的收益率值，就是在这个投资期限上的收益。

![](img/636be9f7f320c9270ebbd1308e9bbcab_48.png)

我们打印这个ORRORIA，看到没有，就相当于是嗯。

![](img/636be9f7f320c9270ebbd1308e9bbcab_50.png)

嗯相当于是2012年1月的收益率，2012年4月投资的收益率。

![](img/636be9f7f320c9270ebbd1308e9bbcab_52.png)

17月10月一月的投资收益率。

![](img/636be9f7f320c9270ebbd1308e9bbcab_54.png)

然后呢，我们然后呢我们开始因为我们要画收益率图嘛。

![](img/636be9f7f320c9270ebbd1308e9bbcab_56.png)

就是要画这种收益率图，我们要导入这个沪深300作为我们基准。

![](img/636be9f7f320c9270ebbd1308e9bbcab_58.png)

作为我们的基准。

![](img/636be9f7f320c9270ebbd1308e9bbcab_60.png)

然后呢我们来会绘制一下500%分之十。

![](img/636be9f7f320c9270ebbd1308e9bbcab_62.png)

20%的一个收益率曲线。

![](img/636be9f7f320c9270ebbd1308e9bbcab_64.png)

这个是持有5%，这个是持有10%，这个是持有20%的股票的收益率走势，大家可以看到，选择前5%票的股的，股票的收益率是最高的。



![](img/636be9f7f320c9270ebbd1308e9bbcab_66.png)

这个也是符合我们的常识，就是你根据你这个打分。

![](img/636be9f7f320c9270ebbd1308e9bbcab_68.png)

你根据这个打分分数越高，证明他未来的上涨的可能性就越高。

![](img/636be9f7f320c9270ebbd1308e9bbcab_70.png)

这个就叫做综合打分法。

![](img/636be9f7f320c9270ebbd1308e9bbcab_72.png)

因此打分法。

![](img/636be9f7f320c9270ebbd1308e9bbcab_74.png)

然后我们嗯绘制一下这个收益率图，大概是这样的一个结果，这个是沪深300，这个基准收益率是沪深300，上面是500%分之十。



![](img/636be9f7f320c9270ebbd1308e9bbcab_76.png)

20%的一个收益率图，而从2012年到2022年上涨了接近六倍。

![](img/636be9f7f320c9270ebbd1308e9bbcab_78.png)

六倍667倍哈，就翻了六七倍。

![](img/636be9f7f320c9270ebbd1308e9bbcab_80.png)

这是我们综合打分法的一个结果，那超额收益率怎么算呢。

![](img/636be9f7f320c9270ebbd1308e9bbcab_82.png)

超额收益率就是投资组合收益率。

![](img/636be9f7f320c9270ebbd1308e9bbcab_84.png)

减去基准收益率获得的那个值呢，就是超额收益率。

![](img/636be9f7f320c9270ebbd1308e9bbcab_86.png)

看到没有，就是前5%收益率减去基准收益率，我们这个阴影部分的面积就是阴影部分在上面，它的超额收益率就是正的，阴影部分在下面超额收益率就是负的，那很显然我们的超额收益都是正的。

因为5%的收益率要远远超于基准收益率，所以这阴影部分的面积始终在零以上。

![](img/636be9f7f320c9270ebbd1308e9bbcab_88.png)

这个就是我们的一个阴影部分的面积。

![](img/636be9f7f320c9270ebbd1308e9bbcab_90.png)

那呃那我们也可以，大家可以把这个5%改成10%。

![](img/636be9f7f320c9270ebbd1308e9bbcab_92.png)

和20%，画一下他这个超额收益率的一个一个一个分布。

![](img/636be9f7f320c9270ebbd1308e9bbcab_94.png)

那接下来我们要计算几个指标。

![](img/636be9f7f320c9270ebbd1308e9bbcab_96.png)

最大回撤，累计收益率，年化收益率，夏普比率所提的比率和阿尔法贝塔信息比率。

![](img/636be9f7f320c9270ebbd1308e9bbcab_98.png)

我们最终得到了一个这样的一个图。

![](img/636be9f7f320c9270ebbd1308e9bbcab_100.png)

就是累计收益率，年化收益率，夏普比率所定的比率，最大回撤，阿尔法贝塔信息比率。

![](img/636be9f7f320c9270ebbd1308e9bbcab_102.png)

呃这个所有代码均在视频正下方会呈现。

![](img/636be9f7f320c9270ebbd1308e9bbcab_104.png)

大家感兴趣的可以去下载，如果大家不感兴趣，也可以仿照我这个视频嗯。

![](img/636be9f7f320c9270ebbd1308e9bbcab_106.png)

就不感兴趣的就别管了，就可以仿照这个视频了解一下就可以了。

![](img/636be9f7f320c9270ebbd1308e9bbcab_108.png)

好那这个内容呢就是讲的呃。

![](img/636be9f7f320c9270ebbd1308e9bbcab_110.png)

这个内容主要是做了一个呃核心的。

![](img/636be9f7f320c9270ebbd1308e9bbcab_112.png)

中的核心就是这个地方就是这个综合打分法，打完分之后才能计算收益率。

![](img/636be9f7f320c9270ebbd1308e9bbcab_114.png)

计算收益率完之后才能进行绘图，那么我们这个收益率这个图是怎么算的呢。

![](img/636be9f7f320c9270ebbd1308e9bbcab_116.png)

我们使用的是使用的是这个呃。

![](img/636be9f7f320c9270ebbd1308e9bbcab_118.png)

呃com com com pro的函数就是累积相乘，累积相乘就是一加R11加二乘。

![](img/636be9f7f320c9270ebbd1308e9bbcab_120.png)

一加R3计算的一个累计收益率。

![](img/636be9f7f320c9270ebbd1308e9bbcab_122.png)

然后下面就是年化波动率的算法。

![](img/636be9f7f320c9270ebbd1308e9bbcab_124.png)

年化我们嗯还有这个下铺，年化收益率的一个算法。

![](img/636be9f7f320c9270ebbd1308e9bbcab_126.png)

最终我们发现那个呃，这个这个基准收益率呢是呃一呃11个点，而四个呃不是这个是一个点，四个点，六个点。

![](img/636be9f7f320c9270ebbd1308e9bbcab_128.png)

九个点，就是14699个点。

![](img/636be9f7f320c9270ebbd1308e9bbcab_130.png)

而这个5%的这个夏普比例是最高的。

![](img/636be9f7f320c9270ebbd1308e9bbcab_132.png)

他的这个最大回撤呢是基准收益率，最大回撤最小20%的最大回撤，最高代表它的风险越高。

![](img/636be9f7f320c9270ebbd1308e9bbcab_134.png)

就是风险越高，好今天我们就讲到这里，大家感兴趣的话。

![](img/636be9f7f320c9270ebbd1308e9bbcab_136.png)

可以去反复的去来看一下我这个视频，然后如果想要代码的话。

![](img/636be9f7f320c9270ebbd1308e9bbcab_138.png)

可以在视频正下方进行领取，好今天我们讲到这里，祝大家生活愉快，成果多多，工作顺利好。

![](img/636be9f7f320c9270ebbd1308e9bbcab_140.png)