# AI在金融界的热门应用【Python金融分析量化交易】从基础原理到案例实战，同济大佬手把手教学_亚马逊股价预测＼股票池筛选 - P39：5-策略效果评估分析 - 迪哥AI课堂 - BV1zK421v7e1

行了，那我们现在是不是已经删除掉了，咱们现在啊不在我当前持仓当中这些股票。

![](img/8e04c4f214779880bb2041c4190e5243_1.png)

那好了，那现在我要去做一些判断了，咱们来做第一个判断，如果说如果说啊现在啊你确实删掉了一些，再就是你删这个当中啊，它的一个数量是大于零的啊，就是你确实要执行这样一个调仓的操作。

因为现在有一些不满足咱们要求了，那就是一个不等于零，那我现在要干什么，我就可以打印一下啊，不打也行，就是现在我们就要完成一个调仓任务，打印一下吧，一会儿咱们观察一下，就是方便看一下你的计时器啊。

起不起作用，然后现在我要做一个调仓，现在呢咱们来执行这样一个跳仓操作好了，那做吧，咱们来执行一下，那也就是说现在对我哦要删这个东西好了呃，for我的每一只股票是吧，好了，Uk talk in。

咱们现在要删的这些个当中，那我要干什么呢，输出首先第一步哎，我先把它给给它，就是不持有它了，那这块有一个函数吧，叫做order o r d e r。



![](img/8e04c4f214779880bb2041c4190e5243_3.png)

找一找order percent，不是order这个函数是吧。

![](img/8e04c4f214779880bb2041c4190e5243_5.png)

在这个函数当中我们要写什么好了，你现在对谁操作呀，都有股票操作，你想让你的持有量变多少呢，变成零不就完事了吗，不在我手里了，这就是全抛出去了吧，好了，这是第一步，STOCK多打了一个，多打了一个好了。

这样咱们已经泡完了，泡完之后，现在我们接下来要干什么，那你调调完仓了，整出一些，你说完了往里整点啊，那好了，再写循环吧，for我的一个股票在哪啊，在咱们现在要就是在我们现在池子吧，哪个是池子来算一下诶。

这个这个我看是不是这个啊，这个是我们的一个啊，这个是我们的池子吧，刚才咱们说了，这里是我做了一个筛选，筛选完之后，我得到了股票池子，那好了，对我所有股票池子当中的每一个，还是要执行这样一个操作吧。

还是执行这个操作，但是呢此时那你就是哦不是拿零了，拿谁啊，拿一吧好了，拿一去，比上哎呀，那一个买多少呢，咱也不用去管这个买多，那个买少了，反正平均来吧，平台去买好了，一比上就行了。

咱们把这个股票啊在这里给他全一笔，比上一个浪值数就完事了，这样相当于我要做些什么操作，唉把咱们当前股票给他就是买出来了吧，相当于唉这就是完成了咱们的一次调仓操作。



![](img/8e04c4f214779880bb2041c4190e5243_7.png)

行了，这里咱们就写完了，就是每个月咱们都要干什么，是不是唉都得去查一查，这个池子有没有什么问题，找好及时执行我们当前的一个操作呀。



![](img/8e04c4f214779880bb2041c4190e5243_9.png)

好了，这里是我们现在写了一下。

![](img/8e04c4f214779880bb2041c4190e5243_11.png)

我们当前的一个呃所需要用到的吧，所有的一个函数，这样咱们先来。

![](img/8e04c4f214779880bb2041c4190e5243_13.png)

现在写，还是写完了试试看吧，我先把这个东西。

![](img/8e04c4f214779880bb2041c4190e5243_15.png)

这东西都没有用了，这东西都pass掉吧，咱先哎呀，这这这个憨豆版本用上头。

![](img/8e04c4f214779880bb2041c4190e5243_17.png)

咱直接都写到一起了，我不改了，直接在这里，咱们就在这个REBS函数当中直接写了。

![](img/8e04c4f214779880bb2041c4190e5243_19.png)

其他的我就不改了，然后看一看这个东西都pass掉了行了，先试试吧。

![](img/8e04c4f214779880bb2041c4190e5243_21.png)

估计可能会先报错啊，咱看一看没有什么问题，运行一下，看一看这个程序先能不能跑起来啊，要是能跑起来再看结果，直接看这输入日志。



![](img/8e04c4f214779880bb2041c4190e5243_23.png)

我估计太对，你看他可能会有报错，好吧，我错了。

![](img/8e04c4f214779880bb2041c4190e5243_25.png)

看一下在这里啊，有些有一些小问题啊，他说了一下哪一块缺了一个参数哦。

![](img/8e04c4f214779880bb2041c4190e5243_27.png)

在做咱们的一个中心化的时候，缺了个参数。

![](img/8e04c4f214779880bb2041c4190e5243_29.png)

来看一下中心化的时候啊，在这里找这里是预处理操作哦。

![](img/8e04c4f214779880bb2041c4190e5243_31.png)

中心化说缺了一个参数是吧，好了，把这个参数给它复制过来，这个参数就是我看下这咱咱用不用上中性化。

![](img/8e04c4f214779880bb2041c4190e5243_33.png)

中性化操作啊，在这里这里咱少写了个参数，我们得把这个指标啊，再给它传进去，这个指标啊就在这里，咱们得写一下，第一个是咱们该指定好的，那第二个就是返回的data frame当中，我得把他的名字给他写进去。

名字找一找啊，明摆着呢给他写进去就行了。

![](img/8e04c4f214779880bb2041c4190e5243_35.png)

把他的名字给写进去行，让我们再运行一下，看一看看看会不会报错。

![](img/8e04c4f214779880bb2041c4190e5243_37.png)

会报错，反正咱们就改啊，反正第一次写完了，写完之后对不对。

![](img/8e04c4f214779880bb2041c4190e5243_39.png)

现在不好说啊，又报错了，再看一看嘶呃又说了一下。

![](img/8e04c4f214779880bb2041c4190e5243_41.png)

我有个这个又是中心化当中，看一下中性化当中，他说这个属性名字估计是不是我拼错了。

![](img/8e04c4f214779880bb2041c4190e5243_43.png)

哪去了，中性化咱们这个属性当中呃，RESIDRESID没问题啊，是有这个属性，result等于SMISMOS，然后一个Y值，这是一个哦，这块少了一个东西，哎呦咱们现在只是定义好了，这个定好了一下。

我们第一个回复就是要做什么，做最最养生法，但少了东西，少了什么，少了一个feat，少了一个训练操作吧啊还没有去做训练，所以说就是训练完之后，咱才能对这个结果算它的差异吧。



![](img/8e04c4f214779880bb2041c4190e5243_45.png)

之前少了一个训练，操作好了再执行一下，把之前的都关掉。

![](img/8e04c4f214779880bb2041c4190e5243_47.png)

看这回还没有什么问题。

![](img/8e04c4f214779880bb2041c4190e5243_49.png)

哦这个这个这个应该可以了，编译哎呀，又编译又出问题了，看一下series当中没有哦。

![](img/8e04c4f214779880bb2041c4190e5243_51.png)

这个单词拼错了，找一下这个是在哪来着。

![](img/8e04c4f214779880bb2041c4190e5243_53.png)

是不是说我们在选股的时候，我说要选择哎咱们的一个百分之多少啊，QTQU哎呀错了，QANT是吧，改一改QNTLE。



![](img/8e04c4f214779880bb2041c4190e5243_55.png)

运行一下看看，这回咱们的小错误也挺多的。

![](img/8e04c4f214779880bb2041c4190e5243_57.png)

因为直接写这个东西难免啊，难免多多多多少少会出现点小错误啊。

![](img/8e04c4f214779880bb2041c4190e5243_59.png)

警告不看了哦，又出现error stock list。

![](img/8e04c4f214779880bb2041c4190e5243_61.png)

哎哟又是一点小问题，又少了一个list，找一下吧，在哪一行。

![](img/8e04c4f214779880bb2041c4190e5243_63.png)

![](img/8e04c4f214779880bb2041c4190e5243_64.png)

![](img/8e04c4f214779880bb2041c4190e5243_65.png)

呃他之前我还顺便检查一下吧，估计这个拼写当中可能有点小毛病。

![](img/8e04c4f214779880bb2041c4190e5243_67.png)

list都是list吧，好来看一看这回输出日志，去掉这个这个好像可以了，半天也没报错，那行了，说明现在执行已经通过编译了。



![](img/8e04c4f214779880bb2041c4190e5243_69.png)

下面咱们就看一下逻辑上没有问题，在这块我不是做了一个打印吗。

![](img/8e04c4f214779880bb2041c4190e5243_71.png)

就是哦你看这块就是每次调仓的时候，他都会做打印，再来看一看他是不是有啊，2月份先有，是2月1号执行了，接下来可能是3月初，3月几号看会不会执行这块有它的，3月1号也执行了，这块有个进度条啊。



![](img/8e04c4f214779880bb2041c4190e5243_73.png)

你看现在呃速度还挺慢的，因为毕竟咱们这个时间选的是一年，然后我们的一个本金这块都是默认的，这东西都没改，然后这里就是默认情况下。



![](img/8e04c4f214779880bb2041c4190e5243_75.png)

它是每日都会去做计算，但是我做了个定时器，我是不是做了一个定时器啊，咱们是按照每月去执行什么，去执行这样一个REBALANCE的操作吧，好了，然后5月3号，那咱们接下来稍微等一等吧。

接下来就是大概就是大概再过个几十秒钟吧，咱就能把这个任务给做完了。

![](img/8e04c4f214779880bb2041c4190e5243_77.png)

做完之后哎这块做的时候，咱们来看收益，看这个收益吧，是不是感觉还还可以，是不是咱们选的随便选一年啊，我也不知道今年怎么样，当时然后现在呢，你看就是基准收益赔的挺多的啊，然后呢咱们的收益能让你少赔一点。



![](img/8e04c4f214779880bb2041c4190e5243_79.png)

一会看能不能稍微挣点，现在是怎么样，是不是稍微正一点了，你看基准年化是负的。

![](img/8e04c4f214779880bb2041c4190e5243_81.png)

咱们现在也是负的，再等一等，朱日志，现已经打算到7月份了，现在已经打到7月份了，然后现在怎么样。

![](img/8e04c4f214779880bb2041c4190e5243_83.png)

你看你的一个基准的啊，基准怎么样都是负的，但是咱们现在呢。

![](img/8e04c4f214779880bb2041c4190e5243_85.png)

我们的一个策略是不是开始起一点作用了，它好歹是个正的吧，就是一般情况下不赔，有时候不赔都是一个比较好的啊，现在咱们是不是也是正的，你看右边这两个相对来说比它的一个基准，效果要好那么一些吧，然后呢。

这个这个这个这个夏普率相对来说有点太低了。

![](img/8e04c4f214779880bb2041c4190e5243_87.png)

然后再等一等，马上他就执行完了，80%多了，速度还是有点慢，可能一到晚上我大概我试了一下，就是白天的时候速度稍微快一快一点。



![](img/8e04c4f214779880bb2041c4190e5243_89.png)

晚上时候可能这个平台用人可能比较多啊。

![](img/8e04c4f214779880bb2041c4190e5243_91.png)

都晚上闲着没事，突发奇想怎么玩一玩什么东西啊，其实大部分人啊就是用这些平台都是什么。

![](img/8e04c4f214779880bb2041c4190e5243_93.png)

都是干什么，都是来去玩一玩，大部分都是做回测嘛。

![](img/8e04c4f214779880bb2041c4190e5243_95.png)

哎难点的数据看一看我的想法怎么样，不一定真要干什么，咱只是哎去模拟来玩一玩这个东西。

![](img/8e04c4f214779880bb2041c4190e5243_97.png)

当然咱们这个东西啊，你不能拿到实际的一个市面上当中啊。

![](img/8e04c4f214779880bb2041c4190e5243_99.png)

因为哦这个东西什么样，那都说不准啊，都不好说的，咱只是来做一个回测好了。

![](img/8e04c4f214779880bb2041c4190e5243_101.png)

来看一下吧，在这个回合当中，最大的回撤区间还行。

![](img/8e04c4f214779880bb2041c4190e5243_103.png)

反正有点多，不算大，在这里呢这两个指标怎么样也不算太高。

![](img/8e04c4f214779880bb2041c4190e5243_105.png)

是不是，但是还比一些基准的效果要强一些吧，这个是我们在选择股票的时候怎么样了，基于我们的一些指标，将是基于一些因子来去选，哪些我想要哪些我不想要吧，并且呢是把咱们刚才说的，我们有三步走。

唉咱们可以把预处理操作也加进去吧。

![](img/8e04c4f214779880bb2041c4190e5243_107.png)

啊在大脑当中啊，主要就给大家说了一下我们的一个专业流程啊，咱们的一个走法啊是长什么样子，一步一步啊，咱们该怎么去做第一步啊，你在这个官号函数当中啊，你写好当前我们的定时器是按月呢还是按周呢。



![](img/8e04c4f214779880bb2041c4190e5243_109.png)

还是按天呢啊，自己去设计，然后呢，这一块我说我先去归去掉一些咱们不想要的。

![](img/8e04c4f214779880bb2041c4190e5243_111.png)

然后呢归完之后我说我先去，现在手里是不是剩一些股票了，好了，剩下股票我就看一下吧，在这些股票当中啊，查询出来一些指标啊，咱这个任务做的比较简单，只是做了两个，就是咱们课程中提的一个市值。



![](img/8e04c4f214779880bb2041c4190e5243_113.png)

还有一个经历这个东西啊，然后接下来我说做一些处理操作，咱是不是函数自己写了，然后因此我们是不是可以做一些筛选操作啊。



![](img/8e04c4f214779880bb2041c4190e5243_115.png)

咱们说了，我们希望当前这个指标值那应该是越低越好的。

![](img/8e04c4f214779880bb2041c4190e5243_117.png)

所以说做了一个小于等于判断，那现在拿到手里的股票了，那接下来我说我判断一下吧，有些股票啊现在手里有的，你现在持有这个东西。



![](img/8e04c4f214779880bb2041c4190e5243_119.png)

它不在不在什么不在这个池子当中，咱就给他就是怎么样。

![](img/8e04c4f214779880bb2041c4190e5243_121.png)

就是让你的占有率占有量等于多少零吧，那接下来呢我说我再去买买多少呢。

![](img/8e04c4f214779880bb2041c4190e5243_123.png)

那就咱平均一分数不就完事了，然后最后下面就是啊，咱们刚才写的一些基本判断操作。

![](img/8e04c4f214779880bb2041c4190e5243_125.png)

这里啊就是咱们整体的结果来看看吧，交易交易交易详情。

![](img/8e04c4f214779880bb2041c4190e5243_127.png)

每天交易详情不看了，就看咱们的一个最终的结果吧。

![](img/8e04c4f214779880bb2041c4190e5243_129.png)

账户信息吧，你看咱们现在就是从这个1月4号开始。

![](img/8e04c4f214779880bb2041c4190e5243_131.png)

一直到一直到我的一个哎呦。

![](img/8e04c4f214779880bb2041c4190e5243_133.png)

这块它只能打印出来一半的年份是吧，你可以看一看，就是你的一个市值啊。

![](img/8e04c4f214779880bb2041c4190e5243_135.png)

现在它的一个变化情况，基本上大概看了一下，往前面点的时候怎么样了。

![](img/8e04c4f214779880bb2041c4190e5243_137.png)

基本上都是赔的吧，可能后面的时候稍微正了一点啊，这个是咱们大概啊得到的一个结果吧。

![](img/8e04c4f214779880bb2041c4190e5243_139.png)

啊这些其实这些这些就是一些详细信息啊。

![](img/8e04c4f214779880bb2041c4190e5243_141.png)

大家感兴趣啊，我们就自己来看吧，在这里我就不给大家一个就说了啊。

![](img/8e04c4f214779880bb2041c4190e5243_143.png)

一些交易的信息，反正都是一些历史数据行了，这个就是咱们今天完成了一个因子选股策略，并且能把一些数据预处理的方法。



![](img/8e04c4f214779880bb2041c4190e5243_145.png)