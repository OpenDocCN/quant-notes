# 吹爆！Python金融分析与量化交易实战课程全详解，迪哥手把手教你基于Python实现金融量化+股票交易，究极通俗易懂！ - P66：4-股票预测案例 - 迪哥带你学CV - BV1KT421Y73G

![](img/3c3a77bb89965d2f18cd99796b011b7e_0.png)

这节课呀就给大家来演示一下，怎么样用我们那个ARRIM模型啊，来帮助我们进行一个时间序列的预测工作。

![](img/3c3a77bb89965d2f18cd99796b011b7e_2.png)

嗯首先啊还是先来说一下咱们的数据吧。

![](img/3c3a77bb89965d2f18cd99796b011b7e_4.png)

这回我们拿到的数据啊是一个股票的数据啊，也就是说首先呢我是先读取了一个CSV文件。

![](img/3c3a77bb89965d2f18cd99796b011b7e_6.png)

然后呢在咱们读这个CSV文件的同时啊。

![](img/3c3a77bb89965d2f18cd99796b011b7e_8.png)

我们需要指定两个东西嗯，就是说一会儿我们要用那个就是我我热量模型。

![](img/3c3a77bb89965d2f18cd99796b011b7e_10.png)

所以说首先啊你需要指定好咱们的一个index值，电影呢，就是啊默认让我的death是我们的一个date，就是我们拿时间啊当成一个索引。



![](img/3c3a77bb89965d2f18cd99796b011b7e_12.png)

这个是有必要的，因为一会儿啊在我们去计算ACF或者是PCF啊。

![](img/3c3a77bb89965d2f18cd99796b011b7e_14.png)

或者是你用那个sit models进行建模的时候啊，它必须要求是以时间为咱们的一个索引的，所以说这块需要指定啊，咱们的第一个索引就是第一个位置啊，是以时间为咱们的索引的。

然后呢可能啊就是你的CSV数据读进来之后。

![](img/3c3a77bb89965d2f18cd99796b011b7e_16.png)

日期的格式啊，可能不是符合咱们的要求，所以说呢首先啊也是说啊，要对我的一个日期的一个格式啊，进行一个就是处理。



![](img/3c3a77bb89965d2f18cd99796b011b7e_18.png)

处理成这样一种标准的格式，标准格式啊，做完之后我再看一下数据的样子。

![](img/3c3a77bb89965d2f18cd99796b011b7e_20.png)

然后呢这里我看的是最后十条数据啊，就是我们也看前十条，我们再来看一下这块。

![](img/3c3a77bb89965d2f18cd99796b011b7e_22.png)

我重新运行一遍，看前十条的时候。

![](img/3c3a77bb89965d2f18cd99796b011b7e_24.png)

我们就打一下，咱们先来看一下到哪天吧，一直到这个2016年的7月29号啊。

![](img/3c3a77bb89965d2f18cd99796b011b7e_26.png)

这是最后的时候，然后呢，然后啊我给它打成一个head的值。

![](img/3c3a77bb89965d2f18cd99796b011b7e_28.png)

这回啊就是说我们的起始日期是从二零啊。

![](img/3c3a77bb89965d2f18cd99796b011b7e_30.png)

2000年的1月3号，一直到呢我们最终啊2016年的一个7月份。

![](img/3c3a77bb89965d2f18cd99796b011b7e_32.png)

这就是我们的一个时间的周期，然后啊第一步就是我现在把数据拿来之后啊。

![](img/3c3a77bb89965d2f18cd99796b011b7e_34.png)

咱们通常都是可以对数据做一个重采样吧，比如说啊，现在我需要找的是数据当中的某一列嗯。

![](img/3c3a77bb89965d2f18cd99796b011b7e_36.png)

一个整体数据啊，你去进行分析很难。

![](img/3c3a77bb89965d2f18cd99796b011b7e_38.png)

所以说首先啊就是你先得找出来，你按照哪个序列去分析，这里啊，就是关于股票数据有开盘价，最高价，最低价，然后这样一个B盘价呃，我们选择的是这个close，就是要预测一下每一天的一个最终啊。



![](img/3c3a77bb89965d2f18cd99796b011b7e_40.png)

它的一个收盘价是等于多少的，所以说呢我在这里啊，就是首先我指定的是当前的data frame当中啊，这个close项，然后呢对它进行一个RESIMPLE，相当于是一个重采样，以我们的一个周为单位。

然后这个W啊，W杠MONDAY的意思就是说嗯当你以周为单位的时候，你可以啊以每周几为这样的一个起始，就是做这样一个嗯，不光是说他是以七天为单位，还说啊他是以七天当中的哪一天啊。

为咱们的一个重采样的单位值，这个重采样啊，咱们之前是不是给大家一个表格啊，在那个表格当中啊，都是有一个详细的说明的，然后呢我们用兵，我们用它的一个均值啊，来当成我的一个计算标准。



![](img/3c3a77bb89965d2f18cd99796b011b7e_42.png)

那这回啊，我就要来选择一下我的一个训练数据了，训练数据啊，我选的是2000年到15年啊，一共这么15年的数据。



![](img/3c3a77bb89965d2f18cd99796b011b7e_44.png)

首先呢还是先把我的一个股票数据啊，给他画出来，看一下它是什么样子的。

![](img/3c3a77bb89965d2f18cd99796b011b7e_46.png)

这个画出来的是我们股票价格的一个收盘价呃，横坐标是我的一个2000年到14年，纵坐标呢就是啊它的一些值嗯。



![](img/3c3a77bb89965d2f18cd99796b011b7e_48.png)

在这些值上我们就可以看出来当前这个值啊，它浮动的一个就是这一列。

![](img/3c3a77bb89965d2f18cd99796b011b7e_50.png)

它浮动的范围还是蛮大的吧，嗯对于这么大的一个浮动范围，我们说啊它是不是平稳性较差呀，那我们要做的第一件事，是不是看一下做个几阶的，一个就是做个几阶啊，能把他那个就是降下来吧。



![](img/3c3a77bb89965d2f18cd99796b011b7e_52.png)

所以说我们要对数据线虚拟项，先做这样一个接分的一个操作，就是嗯要做一个一阶差分。

![](img/3c3a77bb89965d2f18cd99796b011b7e_54.png)

或者是一个二阶差分的一个东西，那咱们就先来看一下吧。

![](img/3c3a77bb89965d2f18cd99796b011b7e_56.png)

作为一个一阶差分完了之后的效果再看一下，就是一阶差分满不满足咱们一个需求，如果说不满足咱们的需求呢，你也可以再去做这样一个二阶差分这个东西吧，咱们怎么做差分来着，之前说过吧。

就是把我的一个训练数据拿过来。

![](img/3c3a77bb89965d2f18cd99796b011b7e_58.png)

然后点differ一下，differ完之后啊，我就可以得到它的一个一阶差分的结果了。

![](img/3c3a77bb89965d2f18cd99796b011b7e_60.png)

这个就是我们一阶差分的一个结果，我们大致观察了一下，就是一阶差分啊，其实效果还可以，基本上满足了咱们的一个平稳性的要求，可能来说啊有个别的位置啊。



![](img/3c3a77bb89965d2f18cd99796b011b7e_62.png)

浮动差异较大，但是呢跟之前相比啊，就是已经好多了吧。

![](img/3c3a77bb89965d2f18cd99796b011b7e_64.png)

所以说我暂时认为啊就是我的一个一阶差分，基本上也就是够了。

![](img/3c3a77bb89965d2f18cd99796b011b7e_66.png)

其实在我们的实际数据当中啊，基本上也就是做个一阶差分啊，就差不多了。

![](img/3c3a77bb89965d2f18cd99796b011b7e_68.png)

然后呢咱们要接下来看两个指标吧，ACF和PCF的值在这里啊。

![](img/3c3a77bb89965d2f18cd99796b011b7e_70.png)

分别用我的一个ploat a cf，还有PLOITPCF把我的一个指标画出来了。

![](img/3c3a77bb89965d2f18cd99796b011b7e_72.png)

那通过我的指标也看出来了，就是我的一个ACF决定的是我的一个Q值吧，我的Q值选什么比较合适啊，这是一阶一阶之后都落到我的执行区间上了吧。



![](img/3c3a77bb89965d2f18cd99796b011b7e_74.png)

所以说呢我的一个Q值选一就可以了，然后呢PACF啊也是一样的吧，你们看一阶之后落到时间曲线上，所以说我的一个P值啊也是选一就可以了吧。



![](img/3c3a77bb89965d2f18cd99796b011b7e_76.png)

在这里呢我们就可以通过这两个图啊，简单的观察一下什么样的一个P啊。

![](img/3c3a77bb89965d2f18cd99796b011b7e_78.png)

和Q的值是比较合适的，这回咱们做的比较简单啊，如果说你做的比较规范的话。

![](img/3c3a77bb89965d2f18cd99796b011b7e_80.png)

你还可以看一下AC嗯，那个AIC啊，还有BC的指标吧，咱们之前说过了嗯。

![](img/3c3a77bb89965d2f18cd99796b011b7e_82.png)

感兴趣的话也可以画一个热度图啊，就是按照咱们之前课程一样啊。

![](img/3c3a77bb89965d2f18cd99796b011b7e_84.png)

在这个热度图当中去算一下它的一个ACE，还有BS的值，然后通过值啊。

![](img/3c3a77bb89965d2f18cd99796b011b7e_86.png)

你再选择一组合适的值也是可以的，这回呢咱们比较简单啊，就是我们训练一个model，就是荣耀模型当中把我这个训练数据传过来，然后指定一个order，指定order的意思啊。

就是我们的一个pd q的值分别是多少，刚才说一阶差分，然后PQ值分别等于一就可以了，然后呢可以传递一个frequency。



![](img/3c3a77bb89965d2f18cd99796b011b7e_88.png)

就是以什么为单位，咱们刚才啊是不是RESIMPLE的时候，进行了一个单位啊。

![](img/3c3a77bb89965d2f18cd99796b011b7e_90.png)

以周为单位，所以说这块呢我也是啊，用它进行一个以周为单位的。

![](img/3c3a77bb89965d2f18cd99796b011b7e_92.png)

进行一个simple的，有simple的过程，然后啊接下来我就可以fit一下模型了吧。

![](img/3c3a77bb89965d2f18cd99796b011b7e_94.png)

相当于是训练一下我当前的一个模型，如果说大家想对我这个OLA模型，进行更深层次的了解，我们也可以关注他的一个东西啊。



![](img/3c3a77bb89965d2f18cd99796b011b7e_96.png)

叫做summary，summary当中啊，会帮我们统计出来它的很多指标，有一些指标咱们课上还没涉及到啊，感兴趣的话也可以去看一下他其他的一些指标，都是关于他那个模型评估。



![](img/3c3a77bb89965d2f18cd99796b011b7e_98.png)

还有测量方面的一些东西的，地图完之后啊。

![](img/3c3a77bb89965d2f18cd99796b011b7e_100.png)

我想进行一个product，这就是我进行一个预测吧，我们看啊，就是说整体流程啊都是比较简单的啊。

![](img/3c3a77bb89965d2f18cd99796b011b7e_102.png)

跟我们用sk learn是差不多的，先进行一个模型的训练，然后呢再进行一个模型的预测，嗯在进行模型预测的时候啊，需要指定一个你起始的时间和终止的时间，这两个时间的意思啊，就是说嗯它有一个说法。

就是你的一个起始时间啊，必须它的一个key值相当于是一个index值，必须是在你原始的一个数据当中的，比如说你的一个训练数据当中啊，必须要包含我的一个起始时间，它是就是说你的一个预测值。

必须是一个从已知的时间开始，你要传进去一个未知时间啊，它会给你报错，就是说嗯这个INTET值是没在我的区间上，所以说嗯你的一个起始时间啊，必须是在咱们的一个训练数据当中的，终止时间是没有限制的。



![](img/3c3a77bb89965d2f18cd99796b011b7e_104.png)

终止时间什么都可以的，然后我们就可以进行这样一个预测了，预测完之后啊。

![](img/3c3a77bb89965d2f18cd99796b011b7e_106.png)

我可以打印出来这样的一个结果值，有结果值呢我可以啊画这样一个图。

![](img/3c3a77bb89965d2f18cd99796b011b7e_108.png)

就是嗯在有图当中，我画了一个预测值和一个咱们的一个真实值。

![](img/3c3a77bb89965d2f18cd99796b011b7e_110.png)

来看一下差异啊，就是我画的是14年到这个17年。

![](img/3c3a77bb89965d2f18cd99796b011b7e_112.png)

然后呢，这个呃就是这个图上蓝色的是一个真实值，红色的是我的一个预测值，嗯可以看出来就是真实值啊，走势是偏下的。



![](img/3c3a77bb89965d2f18cd99796b011b7e_114.png)

然后我的预测值啊，走势也是偏下的，当然啊就是说现在的这个股票的一个预测啊。

![](img/3c3a77bb89965d2f18cd99796b011b7e_116.png)

很难做到一个嗯比较精准的，其实上大部分都是做这样一个趋势啊，看出来这是一个下降趋势，红色呢就是咱们实际预测出来的结果，蓝色是它的一个真实值的结果，这样啊，咱们就完成了一个时间序列的预测的工作。



![](img/3c3a77bb89965d2f18cd99796b011b7e_118.png)

嗯看起来整体流程还是蛮简单的吧。

![](img/3c3a77bb89965d2f18cd99796b011b7e_120.png)

就是说我们用这个ram模型啊，可以很方便的帮咱们进行一个嗯，时间序列的一个预测。

![](img/3c3a77bb89965d2f18cd99796b011b7e_122.png)

首先呢再来回顾一下流程吧，咱们流程当中啊，首先在我的整个学员学习当中选某一列吧。

![](img/3c3a77bb89965d2f18cd99796b011b7e_124.png)

我们是基于某一列做这样一个回归的任务。

![](img/3c3a77bb89965d2f18cd99796b011b7e_126.png)

然后呢做差分做ACFPACF啊，确定好我的一个参数，确定好参数之后啊。

![](img/3c3a77bb89965d2f18cd99796b011b7e_128.png)

咱们指定好这个模型，然后实际的点feat一下，点product一下就可以完成啊。

![](img/3c3a77bb89965d2f18cd99796b011b7e_130.png)

咱们这样一个时间序列的预测的工作了，嗯然后再说亮点吧。

![](img/3c3a77bb89965d2f18cd99796b011b7e_132.png)

就是这个股票数据啊，股票数据的话我们也可以用另外一种方式。

![](img/3c3a77bb89965d2f18cd99796b011b7e_134.png)

就是pandas啊，有一个东西叫做一个data reader，然后我们实际上是可以通过那个雅虎财经啊。



![](img/3c3a77bb89965d2f18cd99796b011b7e_136.png)

实际的就是把这个CSV文件get到，然后我们可以自己选择一些股票的代码，就是比如说你可以指定一个股票代码，然后你指定中国的一个股，然后是沪市还是什么市，把这些代码指定好之后啊，我们可以通过那雅虎财经。

把实时的数据啊都给它下载到，然后再指定一个时间间隔。

![](img/3c3a77bb89965d2f18cd99796b011b7e_138.png)

但是啊就是今天啊，从从昨天到今天，我不知道以后是什么什么会什么局势啊。

![](img/3c3a77bb89965d2f18cd99796b011b7e_140.png)

那个雅虎财经它那个接口现在是关闭了，我不知道他会不会重新开啊。

![](img/3c3a77bb89965d2f18cd99796b011b7e_142.png)

因为在我昨天我在写这个代码的时候，我其实是不想拿这样一个本地数据。

![](img/3c3a77bb89965d2f18cd99796b011b7e_144.png)

我想给大家演示的就是一个从这样一个雅虎的，一个嗯财经的那个股票接口啊。

![](img/3c3a77bb89965d2f18cd99796b011b7e_146.png)

它有API，然后直接调它的一个实时数据出来，但是昨天是关闭了一天，他那个接口，然后今天不太清楚能不能去开啊。



![](img/3c3a77bb89965d2f18cd99796b011b7e_148.png)

今天到现在反正都没开，所以啊我就是下载好了一个本地的数据。

![](img/3c3a77bb89965d2f18cd99796b011b7e_150.png)

拿这个本地数据啊给大家进行演示了，大家可以关注一个东西叫做pandas datator。

![](img/3c3a77bb89965d2f18cd99796b011b7e_152.png)

我们用这个东西啊，可以很方便地获取出来很多的数据集啊。

![](img/3c3a77bb89965d2f18cd99796b011b7e_154.png)