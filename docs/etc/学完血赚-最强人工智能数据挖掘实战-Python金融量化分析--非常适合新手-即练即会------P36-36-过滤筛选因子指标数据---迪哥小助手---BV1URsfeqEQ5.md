# 学完血赚！最强人工智能数据挖掘实战【Python金融量化分析】，非常适合新手！即练即会！！！ - P36：36-过滤筛选因子指标数据 - 迪哥小助手 - BV1URsfeqEQ5

![](img/f73f53e00847e60a3c882adece8850d5_0.png)

这个函数有什么呢？咱来想一想吧，比如说现在一些停牌的，一些停牌的咱能用了吗？肯定不用吧。或者是一些你你这个现在拿着股票，那什么都有。那如果还有一些ST股呢，是不是我也不要了，还有一些新上市的股。

那刚上市两三天呢，刚上市几天呢，我们是不是可能也不要啊，在这里哎我们说第一写几个函数，帮助咱们啊去过滤一些股票了，我说我自己写一下。😊。



![](img/f73f53e00847e60a3c882adece8850d5_2.png)

![](img/f73f53e00847e60a3c882adece8850d5_3.png)

呃，一个filter啊，filter什么，咱们先来一个判断吧，先判断那些停牌的停牌的咱就不要了。哎，在这里呃，我一会儿我会传进来一个stocklist，在这里就是传进来啊，我们当前股票的一个池子。

然后对这个当中啊做一些筛选，怎么筛选呢？

![](img/f73f53e00847e60a3c882adece8850d5_5.png)

![](img/f73f53e00847e60a3c882adece8850d5_6.png)

![](img/f73f53e00847e60a3c882adece8850d5_7.png)

我说我你遍利一下啊，对我其中啊每一个股票，每个股票因我的当前哎我这个大池子当中，在我当前大池子当中啊，我要判算一下它什么，它是不是一个停牌的吧。那怎么判断是不是停牌啊？如果说它不是不是什么一个停牌的吧。

找一找，我看这个应该是这个API点进来看一下。

![](img/f73f53e00847e60a3c882adece8850d5_9.png)

![](img/f73f53e00847e60a3c882adece8850d5_10.png)

![](img/f73f53e00847e60a3c882adece8850d5_11.png)

啊，你看这里你点的时候，它是不是说了判断某只股票哎是否全年停牌。那我来判断一下吧。如果这个股票全年停牌了，我是不是就不用它了呀。好了，然后这里我把这个股票传进去，股票实实当中啊。

每个股票我都需要做这样一个判断。好了，那现在我辩利完之后，我要保存什么？那就是剩下的吧。如果说它没在这个停牌当中，我把它拿出来行了，就是不是就行了。好了，我把这个。😊。



![](img/f73f53e00847e60a3c882adece8850d5_13.png)

![](img/f73f53e00847e60a3c882adece8850d5_14.png)

![](img/f73f53e00847e60a3c882adece8850d5_15.png)

![](img/f73f53e00847e60a3c882adece8850d5_16.png)

stop给拿到手啊就行了，然后给它返回一个list，这就完事儿了。这样咱就唉这块我再写一个return吧。我把这个直接往右边了，右边咱们先不用，咱先写代码。好了，说这块我直接给它return回去。

相当于啊此时啊我去判断了一下当前啊咱这个股票它是不是一个停牌的，咱完成第一件事儿。然后呢哎咱们就就着这个事啊，把所有都有写了吧。接下来我还给再判断。😊。



![](img/f73f53e00847e60a3c882adece8850d5_18.png)

![](img/f73f53e00847e60a3c882adece8850d5_19.png)

![](img/f73f53e00847e60a3c882adece8850d5_20.png)

![](img/f73f53e00847e60a3c882adece8850d5_21.png)

![](img/f73f53e00847e60a3c882adece8850d5_22.png)

判断什么呃，判断这个股啊，它是不是1个ST股，把ST股咱肯定不要吧。好了，这个list给它拿过来。然后在这里咱们接着写，还是我把这个东西复制过来就行了。其实逻辑都是一模一样的。

在这里哎之前我们判断什么判断它是不是一个呃就是是不是那个停牌，那接下来再判断。😊。

![](img/f73f53e00847e60a3c882adece8850d5_24.png)

![](img/f73f53e00847e60a3c882adece8850d5_25.png)

![](img/f73f53e00847e60a3c882adece8850d5_26.png)

A什么呢？你看这里哎直接出现了，是不是1个ST股是吧？好了，把这个传进去，还是what的 stock哎，做一个便利，再把它的结果返回回来说就行了。这一回我又判断了一下它是不是1个ST股。

然后接下来再判断一个。😊。

![](img/f73f53e00847e60a3c882adece8850d5_28.png)

![](img/f73f53e00847e60a3c882adece8850d5_29.png)

![](img/f73f53e00847e60a3c882adece8850d5_30.png)

再判断一个它是不是一个新的股票吧啊，就是刚上市的那这里呢呃所有操作咱都不用去改啊，只是这块我们要去重新的判断一下，判断什么呢？当前啊我们的一个股票它是不是一个新上市的呃，这里边。

然后把我的一个股票给它传进去。

![](img/f73f53e00847e60a3c882adece8850d5_32.png)

![](img/f73f53e00847e60a3c882adece8850d5_33.png)

![](img/f73f53e00847e60a3c882adece8850d5_34.png)

然后呢，对于我咱们当前啊呃这些所有的股票要判断什么呢？它是不是一个新上市的，就是它啊你这里没法判断是不是新上市的，但是你可以把它的一些这里咱是拿到所有股票的吧。然后呢，拿到股票当中，你可以去判断一下。

就是当前股票呃，对于当前这个股票来说，它的信息里边呃，是不是呃小于某些天，比如这里咱们写我说它这个d。



![](img/f73f53e00847e60a3c882adece8850d5_36.png)

![](img/f73f53e00847e60a3c882adece8850d5_37.png)

![](img/f73f53e00847e60a3c882adece8850d5_38.png)

![](img/f73f53e00847e60a3c882adece8850d5_39.png)

![](img/f73f53e00847e60a3c882adece8850d5_40.png)

哦，他这个API没有直接整出来，那我直接写吧，就是d from咱们的一个。

![](img/f73f53e00847e60a3c882adece8850d5_42.png)

第色当中哎有这样一个，我看一看，它没有提示啊，是我写错了。

![](img/f73f53e00847e60a3c882adece8850d5_44.png)

啊，对，是这个。然后哎对，这个他已经提示我了。然后这里呢我们要做一个判断，判断什么，你自己想啊，它要大于多少天。比如说呃最少我说当前这个火你大于半年吧啊，大于1个180天，这个也可以帮我们去做一个筛选。

那相当于啊这里哎我们先写了，我们有这样三个就是筛选函数，这里的我都写一下。😊。

![](img/f73f53e00847e60a3c882adece8850d5_46.png)

![](img/f73f53e00847e60a3c882adece8850d5_47.png)

![](img/f73f53e00847e60a3c882adece8850d5_48.png)

啊，这块判断是否呃停牌。

![](img/f73f53e00847e60a3c882adece8850d5_50.png)

然后呢，这一块我说判断。

![](img/f73f53e00847e60a3c882adece8850d5_52.png)

判断是否ST啊ST股。

![](img/f73f53e00847e60a3c882adece8850d5_54.png)

然后呢，这个这个它是去判断啊判断是否是新股啊，这是我们做了一个判断。在这里呢，既然我们做完判断之后啊，那你说我们现在要干什么？首先啊这要写一下，首先啊过滤掉啊，不想要的股票，这里我们来过滤。好了。

刚才我们是不是需要函数了，用这个函数干什么，传进去一下，把刚才哎但凡这里咱得到所有的股票，我都得到它的一个ID了吧，都有它一个编号了。行了，传进来，我们先判断它先判断它一下是否它是一个停牌的。然后呢。

如果说啊这块给我返回值，你看这块它返回的是就是我们的股票是吧？所以说给它指定名字吧。那就是。😊。

![](img/f73f53e00847e60a3c882adece8850d5_56.png)

![](img/f73f53e00847e60a3c882adece8850d5_57.png)

![](img/f73f53e00847e60a3c882adece8850d5_58.png)

![](img/f73f53e00847e60a3c882adece8850d5_59.png)

![](img/f73f53e00847e60a3c882adece8850d5_60.png)

![](img/f73f53e00847e60a3c882adece8850d5_61.png)

![](img/f73f53e00847e60a3c882adece8850d5_62.png)

嗯，do啊等于我得过滤完结果。那这个只是我们现在做了第一次过滤吧，那我们肯定要还有第二次过滤，第二次过滤啊底用什么？那现在判断了是否停牌，那接下来判断它是否是1个ST股是不是行了。

然后接下来还有最后一个判断它是否是一个新股，我再执行一下，往下移一下。

![](img/f73f53e00847e60a3c882adece8850d5_64.png)

![](img/f73f53e00847e60a3c882adece8850d5_65.png)

![](img/f73f53e00847e60a3c882adece8850d5_66.png)

是否是辛苦好了，把函数拿过来，这样我咱们就完成了当前的一个操作。呃，过滤掉了，我不希望要的。然后接下来干什么？那好了，那现在股票有了，我们要的是什么呀？哎，咱们今天做什么策略来着是不是一个因子策略啊？

在这个因子策略当中啊，我需要拿到哎，我想要的一些指标了吧？好了，那现在咱们来写吧。😊。

![](img/f73f53e00847e60a3c882adece8850d5_68.png)

![](img/f73f53e00847e60a3c882adece8850d5_69.png)

![](img/f73f53e00847e60a3c882adece8850d5_70.png)

在这当中哦说获得。啊，或啊就是查询嘛，查询啊想要的指标。好了，查询什么函数啊，这里不给大家看一篇文档了，它也会提示我get呃 fundamentals在这里好了。

get fundamentals当中我们要需要传进一下。第一个就是一个query吧。因为你看这里啊你点进来之后，它会告诉你第一个参数就是一个query啊，你得需要写一个query语句，赶来写吧。



![](img/f73f53e00847e60a3c882adece8850d5_72.png)

![](img/f73f53e00847e60a3c882adece8850d5_73.png)

![](img/f73f53e00847e60a3c882adece8850d5_74.png)

![](img/f73f53e00847e60a3c882adece8850d5_75.png)

![](img/f73f53e00847e60a3c882adece8850d5_76.png)

在这里啊我说我要去查啊去查查什么呢？咱们来想一想，在这里啊，我们是不是咱之前说了哎一个什么一个市净值，还有什么唉市净率，还有什么，还有我们的一个价市场价值，是不是？所以说啊咱把这个就市价。

那咱们来看一下吧，在这里呃我们把这两个要查询的目标咱来写一下。

![](img/f73f53e00847e60a3c882adece8850d5_78.png)

![](img/f73f53e00847e60a3c882adece8850d5_79.png)

第一个呃，fuamental词当中我要去查。

![](img/f73f53e00847e60a3c882adece8850d5_81.png)

查它的什么来着？呃，查的1个PD ratio是吧？来找PD呃，不是看看这个哎，对，PD ratio这个值我们把它要查出来吧，我们的税净率。然后接下来呢，我还要再查一个指标这块你得写个逗号。



![](img/f73f53e00847e60a3c882adece8850d5_83.png)

![](img/f73f53e00847e60a3c882adece8850d5_84.png)

还有个指标还有个指标呢跟它是一样的，就是最后不太一样，我复制过来复制过来，然后把最后的去掉，看一下它是个market什么东西，咱找一找呃，market什么东西market哎这呢marketCAP是吧？

还给他找到手了。这个就是咱们课程当中给大家说的，我们的市盈率和一个市值来说，要查询这两个指标吧。好了，那现在我们把这两个指标拿到手了。😊。



![](img/f73f53e00847e60a3c882adece8850d5_86.png)

![](img/f73f53e00847e60a3c882adece8850d5_87.png)

![](img/f73f53e00847e60a3c882adece8850d5_88.png)

![](img/f73f53e00847e60a3c882adece8850d5_89.png)

拿手之后，哎，那你说现在找了这么多指标，我们要什么呀？是不是得符合我当前手有这些股票的呀？你要查谁呀，查我手有这批股票的呀，所以说这块你写个filterfilter当中啊你要写上啊，查谁。

那也就是我们手里现在的这些股票。好了，把它拿过来点一下吧，点一下。

![](img/f73f53e00847e60a3c882adece8850d5_91.png)

![](img/f73f53e00847e60a3c882adece8850d5_92.png)

![](img/f73f53e00847e60a3c882adece8850d5_93.png)

呃，在这个当中我们来想一下它是什么，它是一个呃股票的一个编码，找一找股票编码啊，code，然后呢它是一个因。



![](img/f73f53e00847e60a3c882adece8850d5_95.png)

![](img/f73f53e00847e60a3c882adece8850d5_96.png)

硬操作因咱们的一个呃因咱们的一个ts当中，我把这个ts给它传进去就可以了。好了，这里我们就做了一个筛选，现在就是拿到这样个信息了。然后之前啊咱们是不是给大家说过一下，哎。

现在咱们得到的这个信息其实长什么样子，这里我先不运行了，所以个它会比较卡，停长时间比较长，它还会得到什么？😊。



![](img/f73f53e00847e60a3c882adece8850d5_98.png)

![](img/f73f53e00847e60a3c882adece8850d5_99.png)

![](img/f73f53e00847e60a3c882adece8850d5_100.png)

![](img/f73f53e00847e60a3c882adece8850d5_101.png)

上面第一行是股票的名字吧，第一个股、第二股、第三个股、第四个股、第五个股、第六股，然后这是指标指标指标是吧？这样一个格式跟我们想要的一样吗？不一样吧，我们想要的竖着的。哎，我说这是第一个股。

这是第二个这第三个只1234，咱说要这样直接说过了吧，就这里我们怎么办？是不是得做一个转制啊，然后这个其中啊可能你会取到一些空值呃，空值咱也不想什么招了，我就全不要了，直接召回A就得了。行了。

这里咱们现在完成了这一步啊，就是呃要去查询一下，我想要的这些指标。

![](img/f73f53e00847e60a3c882adece8850d5_103.png)

![](img/f73f53e00847e60a3c882adece8850d5_104.png)

![](img/f73f53e00847e60a3c882adece8850d5_105.png)

![](img/f73f53e00847e60a3c882adece8850d5_106.png)