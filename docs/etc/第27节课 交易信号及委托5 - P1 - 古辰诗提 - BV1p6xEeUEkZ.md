# 第27节课 交易信号及委托5 - P1 - 古辰诗提 - BV1p6xEeUEkZ

欢迎大家来到从零开始量化系列课程，MC课程的第27节课，上一节课咱们说到了这个内建出场函数，内建主场函数最大的特色特点啊，我个人认为就是代码会特别简洁，然后它是依据tick来进行操作的。

不管你这个代码里边有没有把那个int bar，order generation给打开，它都是按照提克来进行操作的，上一节课呢呃给大家演示没有演示结束，然后咱们把这个粘一下，好把它给粘过来，进行一下编译。



![](img/be882af3f0d99b5062add423f9732e83_1.png)

插入信号27好。

![](img/be882af3f0d99b5062add423f9732e83_3.png)

这是没有问题的对吧，那这个时候呢咱们从这来进行一下添加，就是sit，他都是sat开头的嘛，exit it就是出场on close这个函数啊，它是不需要从前面加那个set。

这个就是那个孔contract和这个set，这个呃position的set stop position和set stop contract，或者这个希尔的啊。



![](img/be882af3f0d99b5062add423f9732e83_5.png)

直接这么单独用就可以了，这个时候呢我进行一下编译，咱们可以看一下啊，你看这它名字标注就不一样了，end of day他就从这出平仓了是吧，然后从这啊end of day是吧。



![](img/be882af3f0d99b5062add423f9732e83_7.png)

它就平仓了，然后从这个策略绩效报告里边呢。

![](img/be882af3f0d99b5062add423f9732e83_9.png)

咱们看到这个他的这个类型啊，啊不是类型就是这个信号啊，你会发现end of day exit，它是单独进行这个标注的是吧，然后这儿呢你可以就是查找最大回撤交易啊，包括最大亏损交易啊。

最后一笔交易啊什么的，这都可以，其实这个MC的，它整个的这个绩效报告还是很全的，有兴趣的可以仔细去研究一下，包括这个周期月度日度啊，日周期年周期都是有的好吧，你这个是第一个啊。

然后咱们讲如果说你想用这个set，比如说stop loss，就是呃最大回撤就是多少钱，我就平仓，比如说我100块钱我就平仓，就十个点吧，这很容易去碰到的，如果说啊如果说，你不给他写前面那个编译的话。

就是写前面那个就是咱们之前说的set stop position，那个你如果不给他写的话。

![](img/be882af3f0d99b5062add423f9732e83_11.png)

它编译呢也是没有问题的啊，也是没有问题的。

![](img/be882af3f0d99b5062add423f9732e83_13.png)

这儿呢也会写上这个stop loss是吧，然后stop loss这边也会有啊。

![](img/be882af3f0d99b5062add423f9732e83_15.png)

也会有，然后咱们看一下啊。

![](img/be882af3f0d99b5062add423f9732e83_17.png)

shut这边没有十，没有十个点吗，3789，按说这也有十，也有十个点了是吧。

![](img/be882af3f0d99b5062add423f9732e83_19.png)

The stop loss，他呢也是单独进行标注的啊。

![](img/be882af3f0d99b5062add423f9732e83_21.png)

单独进行标注的是吧。

![](img/be882af3f0d99b5062add423f9732e83_23.png)

stop loss都是有的，但是啊呃我还是建议大家把这个写上啊。

![](img/be882af3f0d99b5062add423f9732e83_25.png)

把这个写上，咱们看一下他有什么区别啊，策略绩效报告。

![](img/be882af3f0d99b5062add423f9732e83_27.png)

然后，85108510。

![](img/be882af3f0d99b5062add423f9732e83_29.png)

我这里边没设什么花店啊，什么的都没设，然后sit stop呃，position吧，就是所有的仓位。

![](img/be882af3f0d99b5062add423f9732e83_31.png)

Set it stop position，试图8510。

![](img/be882af3f0d99b5062add423f9732e83_33.png)

它没有什么区别呃，但是建议啊大家还是写上这个啊。

![](img/be882af3f0d99b5062add423f9732e83_35.png)

写上这个好吧，这个就是这个set stop loss，就是最大亏损达到多少钱的时候，他就平仓，然后还有什么呀，set it profit就是止盈啊，止盈，比如说1000块钱，1000块钱我就平仓是吧。



![](img/be882af3f0d99b5062add423f9732e83_37.png)

啊这个还还没有1000块钱吗。

![](img/be882af3f0d99b5062add423f9732e83_39.png)

我看看啊，交易列表啊。

![](img/be882af3f0d99b5062add423f9732e83_41.png)

这是有的是吧，呃perfect target，perfect duck啊，target你看这个就是挣1000嘛，挣1000块钱啊。



![](img/be882af3f0d99b5062add423f9732e83_43.png)

最多他就是挣1000块钱是吧，因为如果说你挣得高了，他就直接从1000，那就给平仓了啊，就给平仓了。

![](img/be882af3f0d99b5062add423f9732e83_45.png)

所以这一点嗯是咱们需要注意的，一个是其实就算是一个强止盈，一个是强止损，当然它还有其他的，比如SER呃，就是break even，这这是就是这这个是叫什么，就是损益两平的时候，就是当你的这个最大获利。

比如说到这个100块钱50块钱的时候，然后你再拉回来，就是你不挣钱了，比如说我这还是设成100啊。

![](img/be882af3f0d99b5062add423f9732e83_47.png)

然后我进行一下编译。

![](img/be882af3f0d99b5062add423f9732e83_49.png)

是吧，Break in even stop，平进平出嘛，平进平出是吧啊。

![](img/be882af3f0d99b5062add423f9732e83_51.png)

然后这是一个参数的，后边还有两个参数的sit呃，Profit target，然后还有这个呃present，就是这个按比例来，他这个是就是从指定的最大获利，拉回特定的百分比后，比如说我指定获利500。

然后拉回多少呢，比如说拉回25%啊，然后点一下编译。

![](img/be882af3f0d99b5062add423f9732e83_53.png)

嗯啊这是有的是吧。

![](img/be882af3f0d99b5062add423f9732e83_55.png)

然后咱们可以看一下策略技巧概要啊。

![](img/be882af3f0d99b5062add423f9732e83_57.png)

然后他这个是百分比，你会发现拿500乘以75%，是等于多少啊，500乘以75%就是乘以四呃，3/4嘛，500×4分之三，差不多是这个额盈利0。75%，差不多是380吧，这个就是两个参数啊。

拉回百分比他他是挣了380块钱嗯，其实应该是什么呀，就是你25%，你25的话，55×25是多少，125应该是375是吧，但是罗文他是十，他是十块钱一个点嘛，你你没法拆五块钱一个点啊。

所以说他就是380啊，后边那个我就不再演示了好吧，这个就是内建这个set函数的这个用法啊，SA类函数的用法很方便很方便，但是你在用的时候，第一个是注意它是按照tick来进行更新的啊。

第二个你要注意的是呃，不要跟你的这个就是条件委托啊，就你里边有的这个条件委托呃，相冲突了啊，相冲突了，尤其是什么，比如一大根K线，一大根K线就是比如说比较极端的K线啊。



![](img/be882af3f0d99b5062add423f9732e83_59.png)

就是就是长得好好的。

![](img/be882af3f0d99b5062add423f9732e83_61.png)

突然来了一大根，突然来了一大嗝儿，你只有你既有跟踪的这个呃，直营也有这个条件出场啊，这个时候你就要注意了，呃其实很容易就造成两次委托发送是吧，从你的这个这个SATELE里边已经平掉了。

但是你条件出厂这一根完成了之后。

![](img/be882af3f0d99b5062add423f9732e83_63.png)

所以说你最好在写这个条件的时候，你要加上这个market position啊，你要加上market position，这样有什么好处，就是你这个完成这个平仓之后。

这个market position它在获取的时候，它会变成零是吧，会加以控制啊，这是一个注意点，再看一下代码啊，MPMP它是有这个正负号的对吧，所以说你要在它是就是持这个空仓的时候，你要给它加上绝对值。

绝对值那个还记得吗，就是这个abs value啊，A abs value，然后咱们给这个mp加上绝对值啊，A abs value。



![](img/be882af3f0d99b5062add423f9732e83_65.png)

然后进行编译，那这个一个细点的错误他就会出问题。

![](img/be882af3f0d99b5062add423f9732e83_67.png)

这个时候就是三笔了是吧，这个时候就是三笔了好那咱们测一下。

![](img/be882af3f0d99b5062add423f9732e83_69.png)

就是if last，But on chat then begin，and好啊，这个print就是这个entry嘶INTRNAME，这学呃，INTRNAMEINTRNAME的话，先放这儿。

咱们可以给他取上名字是吧，就是取上名字吗，这个名字怎么取呢，咱们从这额name，名字怎么取啊，咱们就第一笔额，就是说这样来取，就比如说多层的话，就是by，比如说杠一，然后杠一啊，by杠一杠二。

然后by杠一杠三啊，这么来取，然后后边就是by啊，就是杠二啊，这么来取，那你要完成这个目标，你应该怎么去写呀，呃咱们应该是name是吧，name然后你这边还得有一个这个try account吧。

就是我来我得记个数，然后第几次成交，当然啦就是说第几次成交，我可以直接用这个啊，用用这个MP是吧，当他MP小于它的时候，就是我直接用mp的这个值，然后给它转换成就是说这个字符串类型的，然后进行相加是吧。

所以说我这个名字就应该是，比如说我then begin这个写上，然后tab键，然后我先把end先放进去，然后这个name等于应该是什么呀，应该是我的这个TRACCOUNT，就是因为这个是买吗。

买的话我就用这个sell呃，By，然后加上，然后一个这个然后再加上，然后他是第几次买，我就用这个mp，然后用这个number two string，然后把这个MP给它放进去，同时呢我给它加一个一。

为什么加一个一呢，因为MP有可能是零啊对吧，是零的时候我就加一就就变成了开第一首啊，然后mp是一的时候，然后我就我就变成二，他可以开第二首了是吧，然后后边嘶这个number two string。

这个应该是放在后边是吧，我前面我还得加上一个，加上一个就是这个TRACCOUNT，就是第几次，因为我限定了是三次嘛，然后还是number two string，然后后边写上这个TRACCOUNT。

啊这个TRACCOUNTTRACCOUNT呃，这个应该是没有问题，然后by然后这个把name放在里边啊，by把name放在里边，然后这个呢给它放到下面，Then shir short。

then begin是吧，End，然后从这把这个name control v，然后一定记住这这个mp，这就是加上括号a b s value，然后这里边是NP是吧，好我运行一下啊，on except哦。

这边少了一个分号，上面也少了个分号是吧，好看运行一下哎，啊这个number two string啊，后边还得加一个参数啊，别忘了啊，这个它是两个参数呢，后边就是要保留几位小树是吧，我不保留小数好二零。

然后这边后边sell short给它连起来写吧，然后这边加上一个括号，把name给它放进去好，这个时候看看还有还有没有问题，没有问题了，然后看一下呃是吧。



![](img/be882af3f0d99b5062add423f9732e83_71.png)

by01by02嘶百亿百杠一。

![](img/be882af3f0d99b5062add423f9732e83_73.png)

他没有按照a by2E是不是少了一个。

![](img/be882af3f0d99b5062add423f9732e83_75.png)

这边少了一个杠是吧，加上，好啊。

![](img/be882af3f0d99b5062add423f9732e83_77.png)

再来看一下啊是吧，by啊这个by01。

![](img/be882af3f0d99b5062add423f9732e83_79.png)

然后by02，按说应该是跟这个似的是吧，by杠一杠一，by杠一杠三，这个他没有这个杠，看一下啊啊他是这个。



![](img/be882af3f0d99b5062add423f9732e83_81.png)

这咱们把TRACCOUNT再加一啊，因为它起始是零嘛，这个还需要加一，所以说啊比较麻烦一点。

![](img/be882af3f0d99b5062add423f9732e83_83.png)

那好这个时候跟咱想的是一样了。

![](img/be882af3f0d99b5062add423f9732e83_85.png)

by1杠一啊，八一杠281杠三，包括咱们的策略绩效，他也是百一杠112321对吧，然后by31。

![](img/be882af3f0d99b5062add423f9732e83_87.png)

这个时候咱们就可以获取他的这个INTRNAME，Intrname intro name，然后括号里边你如果放零，这个括号里边你如果放零，咱们看一下，你会发现它输出的是什么呀。

哎print entry name，就是他没有输出东西是吧，就是啊我再进行一下编译啊，就是他这个后边没有东西，为什么呀，因为已经没有持仓了，我可以获取到一是吧，我可以获取到一，如果获取到一的话。

他的名字就是by-3杠一是吧。

![](img/be882af3f0d99b5062add423f9732e83_89.png)

他是这个你最后一笔的这个第一笔。

![](img/be882af3f0d99b5062add423f9732e83_91.png)

第一笔，当然这个只有一笔啊，咱们再可以测一下二啊，这边加俩空格啊，编一下是吧，by2杠一，他获取的还是他的进场的第一笔对吧，同样的，你这个后边是这个呃，这个price也好啊，包括date啊。

包括date time也好，都是这个意思啊，后边的呢我就不演示了，然后再给大家演示一下这个check啊，就enterprise check。

比如说我用这个enterprise check这个entry name check的有吗，啊这个是没有的啊，Enterprise check，比如说我放一个四编译，听见声音了吗，他就是报错了啊。



![](img/be882af3f0d99b5062add423f9732e83_93.png)

报错了，然后我截个屏。

![](img/be882af3f0d99b5062add423f9732e83_95.png)

然后把画图打开，是吧，就是持仓索引四溢出啊，持仓索引四溢出，就是你如果用check的话，它会报错，但是如果说你不用check的话，他是不会报错的，它只不过是呃没有输出而已啊。



![](img/be882af3f0d99b5062add423f9732e83_97.png)

编译一下啊，这个是因为刚才出错。

![](img/be882af3f0d99b5062add423f9732e83_99.png)

这的信号关了状态开启一下是吧，他会这个000啊，这个就是check与没有check它的区别，看看还有什么需要这个演示的，这个average enterprise，他是返回目前未平仓部位的平均成本啊。

这个我就不给大家演示了，因为咱们没有未平仓额，未平仓啊，这个是出厂的这个信号啊，就是跟进场的其实是一个意思好吧，Market position at broke，but since intro哈。

这个咱们演示一下好吧，把since entro，啊然后啊S2NCEC4，哎是是人平吗，不是这么拼吗，啊bus啊，cinch bus两个S是吧，pass是进去它同样的后边也可以放，就是说跟之前一样的。

就是参数，比如说我放一个二，额括号，好进行下编译，你会发现已经过了1万2000多根是吧，如果说我放一个一的话，他可能会比他少几根。



![](img/be882af3f0d99b5062add423f9732e83_101.png)

是吧，比他少了40多根，他其实就找到了最前面的这个持仓部位啊。

![](img/be882af3f0d99b5062add423f9732e83_103.png)

这个就是咱们的这个策略部位需要给大家讲的，大家可以自己去作为，就是做这个测试啊，就是所有的都是可以自己来测出来的，而并不是说呃因为这个关就是关键字太多了，另外呢咱们的这个你像你看这个里边。

它自带的还有很多的这个策略啊，包括函数啊，有很多不可能每一个都教到你，而且也不可能去死记硬背这些东西，最关键的是你得知道他有这个东西对吧，有这个东西呃。

最后再给大家演示一下这个max contracts吧，就是返回指定部位的最大持仓，其实是一样的意思啊，print一个，Max，比如说我返回一的话，他应该返回值是多少啊，他应该返回值是一吧啊是一。

但是如果我返回二的话，他是不是应该就是三了，是吧是吧，是三吧啊。

![](img/be882af3f0d99b5062add423f9732e83_105.png)