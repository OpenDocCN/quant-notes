# 强推！这可能是B站最全的【Python金融量化+业务数据分析】系列课程了，保姆级教程，手把手教你学 - P22：1.pandas高级操作之映射~1 - python数字游侠 - BV1FFDDYCE2g

看这个pandas as。

![](img/342b72a0859967b78d5c411462edf4b3_1.png)

那么这一小节咱们主要讲解的是pandas as当中，的一些个高级操作。

![](img/342b72a0859967b78d5c411462edf4b3_3.png)

OK吧，那首先我们来看一下这个pandas当中的一个，替换操作。

![](img/342b72a0859967b78d5c411462edf4b3_5.png)

OK吧啊那首先在pandas当中呢，我们是可以将指定元素给它进行，任意形式的一个替换，OK吧，那么如果想替换的话。



![](img/342b72a0859967b78d5c411462edf4b3_7.png)

怎么替换呢，那这块我们可以调用一个叫做replace，的一个函数啊，叫做replace函数，那通过这个replace函数，我们就可以对其进行一个指定元素的一个替换，OK吧。

那么这个replace函数既可以作用在data frame当中，又可以作用在series当中都是可以的，OK吧，那首先咱们在这，重点是把它作用到我们的data frame当中吧。



![](img/342b72a0859967b78d5c411462edf4b3_9.png)

OK吧，那首先我们把这对应的模块先给它导入一下。

![](img/342b72a0859967b78d5c411462edf4b3_11.png)

导完之后呢，在这我们先去创建一个data frame，可以吧，好data frame，data等于nap点random点random int好，让他从0~100size的话是一个五行六列吧，五行六列。

然后这个行列，所以呢咱们就不给他设定了走。

![](img/342b72a0859967b78d5c411462edf4b3_13.png)

你看一下，现在，那么这块的话已经有这样的一组的数据了吧，下边我要对它进行一个指定形式的替换，替换什么呢，你比如说在这啊，DF第二第一下replace，OK吧。



![](img/342b72a0859967b78d5c411462edf4b3_15.png)

replace是对指定元素进行替换，那么怎么替换呢，看一下它的一个函数原型。

![](img/342b72a0859967b78d5c411462edf4b3_17.png)

有两个参数需要我们去用，第一个叫做to replace，第二个叫value吧，那毫无疑问，to replace指的是我们要替换的元素是谁吧是吧，value就是说把替换的元素替换成什么，OK吧。

in place它就是替代的意思，跟我们之前所用到的in place的参数含义是一样的，默认是false，OK吧，那在这咱们试一下to replace，OK吧，那在这比如说啊。

我想把二全部给它替换成什么呢，替换成这个to可以吧。

![](img/342b72a0859967b78d5c411462edf4b3_19.png)

那能不能行呢，走你看一下原始数据当中的二替换成to了吗。

![](img/342b72a0859967b78d5c411462edf4b3_21.png)

没有，为什么呢，那在这我们来分析一下。

![](img/342b72a0859967b78d5c411462edf4b3_23.png)

我原始的数据是不是都是整形啊，不都整形啊，我这是不是将一个字符串形式的二替换成to啊，那原始数据当中有字符串形式的to吗。



![](img/342b72a0859967b78d5c411462edf4b3_25.png)

没有吧，没有的话就没法替换呗，那这没法替换，它也没报错，是不是，那在这把二呢换成整形走，你有没有把二替换成to呢。



![](img/342b72a0859967b78d5c411462edf4b3_27.png)

替换了吧对吧，就是对我们指定元素进行一个替换，OK吧，那除了能这么替换，还可以怎么玩呢，DF点re怕bass好，我们在这可以单独的去使用一下什么呢，呃to replace，在这我们可以这么去写。

比如说我想把什么呢。

![](img/342b72a0859967b78d5c411462edf4b3_29.png)

想把一给它替换成什么呢，one行不行呢，SONY看一下有没有把我们一替换成Y。

![](img/342b72a0859967b78d5c411462edf4b3_31.png)

那这块的话我们是不是使用字典的形式做替换，对不对，这个里边可以有一个键值对，也可以有多个静止对吧，OK吧。



![](img/342b72a0859967b78d5c411462edf4b3_33.png)

那还有一种特殊情况，你比如说现在这个是我原始数据吧对吧。

![](img/342b72a0859967b78d5c411462edf4b3_35.png)

我看一下在原始数据当中的话，是不是有两个五啊，听见了吗，你比如说我只想把第四列的五给它替换成five5，然后第二列的不替换，那怎么做呢，Replace，你比如说在这to replace是五好。

value是一个five的话，这一定是把所有的物是不是都替换成five啊。

![](img/342b72a0859967b78d5c411462edf4b3_37.png)

那我只想只替换指定列的物怎么办，这块就可以这么去玩啊，先写这块，是说将我们的第四列的五给他替换成什么呢，five看结果到底，那只有把第四列的五替换成five了，第二列的五替换了吗，没有吧。

那所以说你看这种格式就是说将什么呢，指定列，的元素进行替换吧，OK吧，那这个键值指的是第四列的当中的五吧，对吧好，那这块的话我们的to杠replace指的是谁呢，这是不是我们的列索引列所也和谁呢。

和这个替换的值吧对吧，就是被替换的值。

![](img/342b72a0859967b78d5c411462edf4b3_39.png)

OK吧，那这个replace to这个replace，就是我们的一个替换的操作。

![](img/342b72a0859967b78d5c411462edf4b3_41.png)

那在这我们只是把它作用在了，我们的data frame当中吧，你把它作用在series当中也是可以的。



![](img/342b72a0859967b78d5c411462edf4b3_43.png)

OK吧，那通过replace，就可以很便捷地将我们一组原始数据当中，指定的一个或多个值进行替换。

![](img/342b72a0859967b78d5c411462edf4b3_45.png)

是不是，OK吧，好这个是替换。

![](img/342b72a0859967b78d5c411462edf4b3_47.png)

接下来我们来看一个关键的操作，叫做映射啊，映射那所谓的映射是什么呢，映射就是说我们可以将一组原数据当中，指定的值给它映射成另一种表现形式啊，这个叫做映射，那么什么叫把一个值映射成另一种。

不同的表现形式的啊，我们可以这么解释，比如说在这的话，我们可以把这个值啊，和一个特定的标签或字符串进行一个绑定啊，如果把原始数据当中的值，和特定的一个字符串绑定到一起的话，那么意味着这个特殊的字符串。

就可以表示我们的指定的值吧对吧，那就是说我们需要给一个元素，提供另一个不同形式的表现形式，什么意思呢，在这我们看一个需求，比如说啊创建一个什么呢，data frame吧，它有两列。

一列是name ok吧，然后一列是salary，好那这块的话一共是有这么几个人名，比如说第一个是什么呢，张三，第四，93OK吧，好他们的薪资分别是1万5，2万1万5，说两个张三是吧。

这俩张三指的是同一个人，OK吧，DF就等于data frame，Data，数据源等于DC好看一下，我们DF走，你嗯这有一个啊。



![](img/342b72a0859967b78d5c411462edf4b3_49.png)

不写逗号是吧，现在这一组原数据有了，那么接下来我们的一个需求，就是说我们想要给谁呢，想要给这个中文的名字呀，起一个英文的名字，那这个就可以用到咱们的射映射，指的是说给我们指定的元素。

提供另一种表现形式吧对吧，那我们能不能把张三映射成这个tom呢，那时候使用tom来表示张三，可以吧，说给张三呃指定了一个字符串，叫做tom tom，是不是给张三绑定到一起啊对吧，这个叫做预测。

那就是说你的大名跟你的乳名，表示的都是你自己呗对吧，那大名和乳名是对你的两种不同形式的表示吧，OK吧，那这也是一样的，那么这种形式就叫做映射。



![](img/342b72a0859967b78d5c411462edf4b3_51.png)

那怎么做映射呢，好映射的话，首先第一步啊，我们需要有一个什么叫做映射关系表对吧，那就是我们需要将张三和李四，跟另两个英文名进行一个绑定吧，那绑定的话你得有一个绑定关系啊。

绑定关系指的是一个字典形式的映射关系表，对吧，好在这，我在这的话，我们就把这个什么呢，张三啊给他映射成什么呢，我们叫tom，可以吧，好这的话李四就映射成一个，OK吧，这个是我们字典形式的映射关系表。

那么这个映射关系表，里边指明了我们的一个映射关系吧对吧，那怎么映射呢，好DF，我们想给谁做映射啊，是给整个data frame所有的数据自设吗，并不是说只想给我们的中文名字作用设呀。

中文名字指的是name这一列，OK吧，然后点一个谁呢，map map就是我们做映射所对应的一个方法。

![](img/342b72a0859967b78d5c411462edf4b3_53.png)

那么一定要记着这个map它是属于series的一个函数。

![](img/342b72a0859967b78d5c411462edf4b3_55.png)

并不是data frame的，只能通过series去调，那这块通过name取值取出的不就是serious吗，对吧，那map里边放的是一个映射关系表走。



![](img/342b72a0859967b78d5c411462edf4b3_57.png)

你那现在看一下，是不是说把我们name接力当中的张三李四，张三映射成了tom jack tom吧对吧，那我们可以将映射结果啊给它啊，复制到原数据当中啊，作用到原数据里边。

比如这是一个一个EENGLISH杠name，是不是就等于它。

![](img/342b72a0859967b78d5c411462edf4b3_59.png)

然后再看DF整理，现在我们是多了一列叫english name啊，分别是tom j和tom吧，那在这是不是通过我们的map，给我们指定的一列对应的这个series，将这三个值映射成了三种不同形式的表现。

结果啊对吧，那么在这就把tom唯一的绑定给了张三，把这块值唯一的绑定给了李四吧，对不对，那甭管啊你的原始数据当中有多少个人名，只要你对应的映射关系制定好了，那么意味着最终就可以使用咱们的映射关系表。

给每一个固定的值生成一个映射的结果吧。

![](img/342b72a0859967b78d5c411462edf4b3_61.png)

OK吧这个就是我们的一个映射，那映射在咱们的数据分析里边，有怎样的一个作用呢，OK吧这个在我们讲完pandas的高级操作之后，我们还有一个这个数据分析的一个项目啊。

在那个项目当中我们会用到映射所对应的操作。

![](img/342b72a0859967b78d5c411462edf4b3_63.png)

在这我们先把映射的这个基本的使用。

![](img/342b72a0859967b78d5c411462edf4b3_65.png)

掌握了就可以了，OK吧好，那在这的话我们需要提示一下啊，提示一下，那这块的什么呢，map啊，map是series的方法，那么意味着是不是只能只能被series调用，不能用data frame。



![](img/342b72a0859967b78d5c411462edf4b3_67.png)

不能被我们的data frame调用吧，对不对好，那么这个map啊除了可以做映射之外。

![](img/342b72a0859967b78d5c411462edf4b3_69.png)

它还可以充当我们的运算工具，什么叫运算工具呢，好在这儿我们来看一下需求，那就是说我们想要计算张三跟李四的税后薪资，那么在这我们说超过3000部分的钱，需要缴纳50%的税。

然后计算这两个人的税后薪资分别是多少吧，对吧，那在这我们一定是需要运算的，是不是对谁运算，是不是对salary进行列做运算对吧，那这我们就可以DF啊，先把我们的salary取出好点一个map。

那么map就是用来充当我们的运算工具，运算工具指就是说我们要用map这个运算工具，对series当中的这三个值做运算，到底做什么运算呢，运算的法则需要我们自定义对吧，但是我们要知道，运算的法则。

一定需要作用在运算工具当中才可以。

![](img/342b72a0859967b78d5c411462edf4b3_71.png)

OK吧啊，那在这的话我们的运算法则可以是一个什么呢，可以是一个拉姆达逆变函数，也可以是我们自己所封装的一个函数，可以吧，比如说在这我自己封装一个函数吧对吧，叫做after杠salary，OK吧。

这我需要传入一个参数SS就是我们的薪资，比如说那么这个函数是用来计算什么的，S对应的对应的税后薪资，OK吧，薪资啊，那税后薪资咋求啊，return一下我们的税后薪资就可以了对吧。

我们说S是咱们的原始薪资吧，税前薪资是S不是减3000，超过3000部分的钱需要缴纳50%的税，是不是乘以0。5啊对吧，这是缴的税吧，然后S减去它缴的税，不就是咱们的税后薪资吗。

那这个就是我们通过一个函数，制定好的一个运算法则吧，对吧好，该函数是我们制定的一个运算法则，那这个运算法则一定要作用在咱们的什么呀。



![](img/342b72a0859967b78d5c411462edf4b3_73.png)

运算工具当中吧，好那在这的话就是officer salary就可以了。

![](img/342b72a0859967b78d5c411462edf4b3_75.png)

OK吧，那么这块所表示的含义，就是说我们可以加上我们的，将我们的这个DF啊，杠SIERARY这个series啊，将这个series中每一个元素元素指的，是不是我们的薪资啊是吧薪资。

然后作为参数传递给谁呢，是不是传递给我们的S啊对吧，那么意味着这个series当中一共有三个元素吧，那么这三个元素依次传递给我们的，Offafter gsalary。

那么这个函数一次性只能接受一个参数吧，那么就意味着这个函数需要被第三次，才能够接收这cs当中的三个元素吧，对不对。



![](img/342b72a0859967b78d5c411462edf4b3_77.png)

那现在我们来试一下，现在执行之后走，你返回的这三个值不就是我们的税后薪资吗。

![](img/342b72a0859967b78d5c411462edf4b3_79.png)

对吧，税后一次是不是可以直接汇总到原数据里啊，对吧，在原数据当中我们新建一列可以吧，叫做all fter gsy。



![](img/342b72a0859967b78d5c411462edf4b3_81.png)

对吧好，再看一下我们DF走，你现在我们的数据当中啊，是不是多了一列叫做alter salary，它所表示的是我们的一个税后薪资，所以说在这啊我们的map可以充当运算工具，运算工具可以做任意形式的运算。

到底做哪种具体形式的运算呢，是由我们的运算法则指定的吧，那么运算法则可以使用我们的函数或者lambda，匿名函数来表示，OK吧，那么这个就是我们的map啊，这个就是我们的map map两个作用。

第一个可以做映射，第二可以充当运算工具，甭管是自用设还是充当运算工具，series只啊。

![](img/342b72a0859967b78d5c411462edf4b3_83.png)

这个map只能被我们的series去调用吧，OK吧好那么这个我们就过了啊。

![](img/342b72a0859967b78d5c411462edf4b3_85.png)

然后的话，那么接下来来看一下下一个部分叫什么呢。

![](img/342b72a0859967b78d5c411462edf4b3_87.png)

叫做这个啊抽样取样啊，不是随机抽样啊，随机抽样，那么随机抽样不用解释了吧，就是从一组原始数据当中，随机的抽取出一部分的值，是不是OK吧，这怎么做随机抽样呢，我们在这先去新建一个data frame。

比如说在这啊，theta等于NIKE点，好这是由三列100行，可以吧，三列100行组成的，那这块我们给他指定一个列索引吧，所以对吧。



![](img/342b72a0859967b78d5c411462edf4b3_89.png)

这个是我们的DF啊，这个是我们的DF，这哪错了啊。

![](img/342b72a0859967b78d5c411462edf4b3_91.png)

啊这是吧。

![](img/342b72a0859967b78d5c411462edf4b3_93.png)

这是少括号吗，size3行啊。

![](img/342b72a0859967b78d5c411462edf4b3_95.png)

这错了是吧，应该是100行三列吧，对不对好，那现在这块的话，我们的data frame就创建好了，创建好了之后，那么接下来我们在这呢想进行一个随机抽样，那你要知道随机抽样之前。

是先将我们的原始数据打乱呢对吧。

![](img/342b72a0859967b78d5c411462edf4b3_97.png)

那在这我们可以打乱一下我们的原始数据，将原始数据打乱。

![](img/342b72a0859967b78d5c411462edf4b3_99.png)

是不是怎么打乱呢，是把它的行列索引打乱啊。

![](img/342b72a0859967b78d5c411462edf4b3_101.png)

比如说在这我们先把列索引打乱，可以吧是吧，内索引原来是ABC，能不能打断成baa c或CAB啊对吧，那怎么打乱呢，在这DF我们就调一个什么呢，take啊，take take里边的话需要传两个参数啊。

参数一是谁呢，参数一指的是我们的index，index指的是我们打乱的一个结果啊，比如说在这我们将原始数据打乱成什么呢，打乱成我们的C，AB可以吧，好后边还有一个什么xx x这块啊，是一样的。

一表示列零表示行，可以吧，我们是不是想打上列列数不一啊，整体看下，这儿报了个错啊。

![](img/342b72a0859967b78d5c411462edf4b3_103.png)

我报了个错，这个错是啥呢，这个错就指明我们在这的话，不能使用我们的显示索引啊，这块只能使用我们的隐式索引，那咱换成隐式索引试一下吧，对吧，又换成什么呢，201K吧。



![](img/342b72a0859967b78d5c411462edf4b3_105.png)

走打乱了吗，就剩CAB了，打乱了，是不是，这为啥不能用我们的显示索引呢，是因为我们的影视索引对应的是数值，数值是可以帮我们自动生成的，而显示，所以是没法帮我们自动生成的。

你比如说我这块的列如果有300列的话啊，SAB列对应的都是我们的显示作用，可以吧，那如果你想把这SAB列打乱的话，你是不是得在这写一个，基于显示索引的一个乱序序列啊，是不是得自己手写啊，能自己生成吗。

不行吧对吧，但是如果这块如果是隐式索引的话，那么300列它所对应的索引，不就是0~299吗，0~299，咱们能不能生成一个0~299的乱序序列啊，可以对吧，所以说在这我们只能用隐式索引。

不能用我们的显示索引吧对吧，那这怎么生成乱序的随机序列呢，啊在这啊给它生成乱序的随机序列，使用什么呢，使用我们的这个什么呀，NP点random，第二叫做permutation。



![](img/342b72a0859967b78d5c411462edf4b3_107.png)

这里边我们逐步传一个三走，收成是不是0~3所对应的乱序序列啊对吧。

![](img/342b72a0859967b78d5c411462edf4b3_109.png)

如果是十呢，走是不是0~9所对应的乱序序列啊。

![](img/342b72a0859967b78d5c411462edf4b3_111.png)

就是零到N减一之间的一个值，是不是OK吧，那这咱们是不是就可以给他换一下子，这啊这的话咱们就可以给它换成什么呢，换成，NP点random点permutation，对不对，这就放一个三，是不是就可以了。

AACB是不是好，是不是CAB换了吧，那这是不是只是打乱我们的列了，行打乱了吗，没有啊。

![](img/342b72a0859967b78d5c411462edf4b3_113.png)

那接下来咱们是不是还可以把行打乱对吧，怎么打乱行呢，打乱行的话就是说在此基础之上，它所返回的不就是一个data frame吗，再点一个什么呢，take这个好参数。

一是NP点random点PROMPTATION，我们的行索引不就是从0~99吗，那这给他传一个100，是不是给我返回一个0~99的乱序序列啊。



![](img/342b72a0859967b78d5c411462edf4b3_115.png)

是不行走，你现在是不是行列都打乱，都打乱了，明白吧对吧，那我想随机取样怎么办，就在这直接切呀，比如我在这切前50行可以吧。



![](img/342b72a0859967b78d5c411462edf4b3_117.png)

那在这是不切除50行，作为我们的随机抽样的结果啊。

![](img/342b72a0859967b78d5c411462edf4b3_119.png)

对不对，那这块的话我们就结合着我们take和PULATION，就可以实现我们的随机抽样对吧。

![](img/342b72a0859967b78d5c411462edf4b3_121.png)

这是一个小众的一个点啊，这块的话你知道有它的存在就可以了。

![](img/342b72a0859967b78d5c411462edf4b3_123.png)

OK吧好，那接下来的话就是我们的一个分类处理。

![](img/342b72a0859967b78d5c411462edf4b3_125.png)

好这个分类处理的话。

![](img/342b72a0859967b78d5c411462edf4b3_127.png)