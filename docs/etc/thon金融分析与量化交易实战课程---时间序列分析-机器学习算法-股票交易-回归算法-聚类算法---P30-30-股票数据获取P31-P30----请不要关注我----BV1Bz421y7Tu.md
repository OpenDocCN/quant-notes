# 人生苦短，我学量化！比刷剧还爽的python金融分析与量化交易实战课程！——时间序列分析／机器学习算法／股票交易／回归算法／聚类算法 - P30：30.股票数据获取P31(P30) - 请不要关注我- - BV1Bz421y7Tu

![](img/e4189b75871f8132dcbdefa44e404e49_0.png)

接下来我们就来看一下，刚才咱们说的一个因子选股的策略，来先把我们的一个因子拿过来做一些预处理，我要去极值唉，我还要去做标准化，还有中性化操作，做完这些基本操作之后啊，咱们来看一看基于因子啊。

我设计个策略诶，比如说像他们说的因子当中选择某些指标，然后我们来衡量一下哪些股票好，这样能在股票市当中啊，咱把这批数据诶，咱把这批股票拿过来，我去买，然后呢我们的因子会随着时间的变化。

每天都会发生变化吧，那其实啊相信这样一件事，哎我过一段时间我要做一个调仓，就是说果实当中啊，可能就是我买这么十只或者买20只，但是呢一定得是符合我的一个因子，选股策略的吧，咱们就要来完成这样一个任务。



![](img/e4189b75871f8132dcbdefa44e404e49_2.png)

好了，来咱们来看一下怎么去写啊，第一步哎，在这里我是新建了一个我们的文件。

![](img/e4189b75871f8132dcbdefa44e404e49_4.png)

叫做二杠因子策略，在这里呢呃一开始他有些注释信息我都删掉了，没什么用啊，咱们把我们一会儿会用到的一些工具包。



![](img/e4189b75871f8132dcbdefa44e404e49_6.png)

先导进来，在这里啊，就是呃它也是支持，就是你的一些额外的工具包，像是咱们常用的这个南派啊，pandas啊，这些东西都是只能导进来的，然后呢第二个就是一个pandas，然后一个pd。

然后接下来还有一个还有一个就是哦，一会儿我们肯定要做一个回归方程吧，因为当我们在做这个中性化的时候，你要求解一个回归方程，所以说啊咱们得把回归方程哎，这个东西导进来呃，有两个可选的工具包。

一个叫sk learn啊，非常经典的一个Python机器学习工具包，还有一个呢就是统计分析当中也会比较常用的，叫save models呃，对比一下。

就是还是觉得state models用起来更简单一点啊，基本上咱们两行代码就能把这件事做出来，所以这里啊咱们把mos给它导进来，在啊咱们当前的模式当中，我们导入一下呃。

其实只需要导入它的一个回归模块就可以了。

![](img/e4189b75871f8132dcbdefa44e404e49_8.png)

其他的咱们暂时还用不上，这个是我们要用的几个工具包，一会儿看看吧，一会看看咱们还能不能用上，其他的用什么。



![](img/e4189b75871f8132dcbdefa44e404e49_10.png)

咱们现导也行，然后咱们就按照这个顺序一步来去写吧，首先第一步咱们的一个初始化模块，在这个初始模块当中啊，我们要设计设计什么。



![](img/e4189b75871f8132dcbdefa44e404e49_12.png)

一会儿呢我们要肯定要做的一件事，大家想一想，你看啊，我一会儿我会选择一个时间。

![](img/e4189b75871f8132dcbdefa44e404e49_14.png)

比如说这个时间要改一改啊，从2016年的1月1号，到这么2017年的一个1月1号吧。

![](img/e4189b75871f8132dcbdefa44e404e49_16.png)

咱们就这么一年时间，一会儿啊。

![](img/e4189b75871f8132dcbdefa44e404e49_18.png)

咱们是这样，我说现在啊我去选了一个策略，然后在这个策略当中我选了一个股票啊，咱们有大池子，在这个池子当中，可能呃我每个月都要做一个调仓啊，每个月我都要选一选，看哪些诶不符合我策略了，给他卖掉哪些呢。



![](img/e4189b75871f8132dcbdefa44e404e49_20.png)

符合我策略可以买进来，是不是这样一件事啊，那这个就是当我们设一说啊，咱们也消耗。

![](img/e4189b75871f8132dcbdefa44e404e49_22.png)

你是按月来执行呢，还是按天来执行啊，按天你说是有点太频繁了，没必要吧，一般情况下咱们还是按月来执行。

![](img/e4189b75871f8132dcbdefa44e404e49_24.png)

所以说这里在我们这个区域当中啊，咱们得写一下啊，因为我们的定时器，需要写到我们的一个构造函数当中啊，咱写一下咱们之前是不是说过有一个模叫什么。



![](img/e4189b75871f8132dcbdefa44e404e49_26.png)

叫做一个哎，就这个我们这个定时器吧，指定好咱们的定时器，定时器当中啊。

![](img/e4189b75871f8132dcbdefa44e404e49_28.png)

你可以去指定，你看我这块点run，它输出了，你是按天呢还是按月呢，还是按这个周呢，咱们按月数就行了好了，我们指定一个按月指定按月的时候啊，然后你需要去指定交易就不管了，然后你需要去指定一个值。

就是呃按月啊，你在做的过程当中，咱们该怎么样去调吧，好了，那我们写一下吧，咱们写一个rebel。

![](img/e4189b75871f8132dcbdefa44e404e49_30.png)

一会儿呢我们要定义这样一个函数，相当于在这个函数当中啊，我们就去执行一下。

![](img/e4189b75871f8132dcbdefa44e404e49_32.png)

实际咱们的一个哦池子该怎么去选啊，这样一件事好了，然后把这个复制一下，名字稍微改一下就行，在这里名字我复制过来。



![](img/e4189b75871f8132dcbdefa44e404e49_34.png)

Rebalance，这里啊，咱们来想一想，我们都需要做什么，是不是说一开始的时候啊。

![](img/e4189b75871f8132dcbdefa44e404e49_36.png)

哎呀我得去看一下啊，不是一开始的时候我得去先找一批股票出来，然后在这股票当中我去选哪个是我要的，哪个是我不要的吧，我们有这样一件事吧，那这个啊咱们该怎么去做啊，是不是说第一步。

我先得把咱们的所有的股票数据，哎，我说我都得给它读进来，然后呢，接下来咱们在这池子当中一个去选吧，先把我们的数据给它读进来，数据读啊，其实有很多种方法，这点咱们就暂时先选所有的股票数据了。



![](img/e4189b75871f8132dcbdefa44e404e49_38.png)

它是API，咱们点进去啊，点进去的时候不用点进去，就是你鼠标放到这儿的时候。

![](img/e4189b75871f8132dcbdefa44e404e49_40.png)

他就会给你解释啊，当前诶你用的函数它是什么意思，他说这样啊，往上一点啊，他说了，现在呢我们要去哦，这个这个再往下点吧。



![](img/e4189b75871f8132dcbdefa44e404e49_42.png)

让我看不清了，他说现在你要获得某个国家市场，然后一些所有信息了，在这里我们就玩股票就行了，所以说一会儿我们会创建一个tap值等于cs啊。



![](img/e4189b75871f8132dcbdefa44e404e49_44.png)

咱们找到这批股票，找到所有的股票啊，咱们先写一下，在这里呢咱们该说了，看到有一个参数type叫什么，叫做一个cs吧，好了，我把这个cs传进去，这样他会把我的一个股票给拿到手，拿到股票之后。

然后我们还得对股票构做什么，其实一会儿啊咱还得对股票做一个操。

![](img/e4189b75871f8132dcbdefa44e404e49_46.png)

就是做过滤的事吧，因为这些显示所有的。

![](img/e4189b75871f8132dcbdefa44e404e49_48.png)

咱一会儿呢可能不会用到这么多个股票啊，一会儿我们可能只会用其中一部分，所以这里我们把这些股票的id怎么样，把这些股票id啊，我要做一个筛选了，看看有些怎么样，它是不符合的，那我们在前面还得写。



![](img/e4189b75871f8132dcbdefa44e404e49_50.png)