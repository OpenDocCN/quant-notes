# 强推！这可能是B站最全的【Python金融量化+业务数据分析】系列课程了，保姆级教程，手把手教你学 - P23：2.pandas高级操作之分组聚合~1 - python数字游侠 - BV1FFDDYCE2g

![](img/799b0091907d100eef1fa07462305359_0.png)

Ok，那么接下来咱们来看一下这个pandas当中的，数据分类的处理啊，那么这块数据分类的处理，其实指的就是我们所谓的一个分组啊，那么这块的分组呢，其实跟我们在MYSQL数据库库表当中的分组呢。

其实是一样的，OK吧，只不过我们就来看一下在pandas当中，如何基于我们的分组操作，对我们的data frame进行一个分组操作，是不是OK吧。



![](img/799b0091907d100eef1fa07462305359_2.png)

那比如说你在这啊，首先我们先用一组数据啊，这组数据的话一共有四列，分别是item放的是水果的种类。

![](img/799b0091907d100eef1fa07462305359_4.png)

price是每一种水果的价钱，color是每一种水果的颜色，weight是每一种水果的重量，是不是一共有四列。



![](img/799b0091907d100eef1fa07462305359_6.png)

那么接下来在这儿啊，咱们就可以指定啊相关的条件对其进行分组吧，比如说在这我们想要干什么呢，想要对，水果的种类进行分组。



![](img/799b0091907d100eef1fa07462305359_8.png)

那么意味着分组条件是我们的item，是不是就可以了对吧，那这块的话一共是有三种水果啊对吧，那就将我们的原始数据分成三组，是不是就可以了，一组表示是一种水果吧，怎么分组呢，DF点group by。

那么分组的话一定需要有一个分组条件吧，分组条件是不是item item是我们学过种类呀，对不对好，然后的话我们继续来看啊。



![](img/799b0091907d100eef1fa07462305359_10.png)

more是零零就列呗对吧。

![](img/799b0091907d100eef1fa07462305359_12.png)

那现在我们在这去执行走，你现在这给我返回了一个叫做data frame，group by的对象对吧，那这个对象里边所存储的就是我们分组的结果，这是分组的结果，就说我们分成的这三个小组。

都存在了这个对象当中，OK吧，但如果你想看详细的分组情况怎么办，查看详细的分组，分组情况啊，怎么办呢，这块我们需要干什么呢，需要在返回的这个对象当中调一个属性，叫做groups。



![](img/799b0091907d100eef1fa07462305359_14.png)

SONY看一下，那这块groups给我们返回的是不是apple1组，banana1组，orange1组啊，apple对应的是原始数据当中的零五行，是不是好，banana对应的是一三行。

orange对应的是24行，是不是是不是分成了三组啊对吧。

![](img/799b0091907d100eef1fa07462305359_16.png)

在这我们就实现了分组，分组就使用GRY就可以跟我们进行分组吧对吧。

![](img/799b0091907d100eef1fa07462305359_18.png)

但是你要知道，那么通常情况下咱们为什么需要做分组呢。

![](img/799b0091907d100eef1fa07462305359_20.png)

为啥需要分组啊，是因为我们需要做什么呢。

![](img/799b0091907d100eef1fa07462305359_22.png)

需要做分组聚合，是不是分完组之后一定要做聚合。

![](img/799b0091907d100eef1fa07462305359_24.png)

不然的话是没意义的吧，什么叫分组聚合，这我们举一个需求，比如说我们想要去干什么呢，计算出每一种水果的平均价格。



![](img/799b0091907d100eef1fa07462305359_26.png)

那平均价格是不是需要我们做聚合操作呢，对不对，你这怎么求出每一种水果的平均价格呢，DF不是先对我们的每种水果分组啊对吧，by等于什么呢，item是不是先对水果分组，分完组之后。

我们直接在这点一个min一下，不是求均值啊，对谁求最值，我们原始的需求是对我们的水果的价钱，求均值吧对吧。



![](img/799b0091907d100eef1fa07462305359_28.png)

在这我并没有指定价钱吧，而是直接点min走，你看下干什么，是不是对我们的价钱和重量都求了均值啊对吧。

![](img/799b0091907d100eef1fa07462305359_30.png)

那原始数据是除了价钱重量，还有color和item吧，为什么collar没有做均值计算呢。

![](img/799b0091907d100eef1fa07462305359_32.png)

因为corner不是数值型的数据吧是吧，那就是这块的聚合mean操作啊，只能对数值形式的数据进行聚合操作吧对吧，那在这我们就可以得到平均价钱跟平均重量吧，我们要的是平均价钱，并不要平均量怎么办。

我们可以这么去玩啊，就是说在main之前，我们可以先把什么的price取出。

![](img/799b0091907d100eef1fa07462305359_34.png)

OK吗，看现在，那么这块返回的就是苹果的，平均价值是三块是吧，orange是3。5啊，那这样的话就求出了平均价格吧，所以在这我们可以先分组，分组之后我们可以做聚合，聚合的话。

我们可以先取出指定的元素聚合吧，比如说我只想对价格定额，这是不是在这就把价格取出来，再点B1下，是不是就可以了，OK吧好接下来再看啊。



![](img/799b0091907d100eef1fa07462305359_36.png)

我们想要干什么呢，计算每一种颜色啊，每种颜色对应水果的水果的平均重量，OK吧这个怎么求的分组吧是吧，df dr grow by先对谁分组呢，先对颜色分组啊是吧，这块就是我们的by吧。

by就等于颜色是不是color这列是吧，分完组之后，我们想要求平均重量吧，是不是可以先把重量求出来取出来吧，是不是weight呀对吧，然后的话我们要点V是不是求平均重量。



![](img/799b0091907d100eef1fa07462305359_38.png)

OK吧，那这块平均重量是不是就求出来了，OK吧，那平均重量我们如果能取出来之后，下一步干什么呢，我想干什么呢，将计算出的平均重量汇总到原数据中。



![](img/799b0091907d100eef1fa07462305359_40.png)

我们看一下这语言数据是DF吧，DF里边有没有每一种水果的平均重量啊。

![](img/799b0091907d100eef1fa07462305359_42.png)

没有吧，只有每一种水果的重量，并没有每一种水果的平均重量吧，那我想把这个series汇总到原始的数据里边，怎么汇总呢，能不能直接在这DF还给它新增添一点，叫做命杠，wait等于什么呢。

等于我这返回sales行不行，这样行不行，不一定是不可以啊，为啥呢，你看这个series是不是只有三个数据啊，我原始的数据是不是一共有六列啊，这三个数能付给六个六六个位置吗，不可以吧对吧。



![](img/799b0091907d100eef1fa07462305359_44.png)

你直接这么赋值就会有问题，OK吧，有问题走体有没有问题。

![](img/799b0091907d100eef1fa07462305359_46.png)

是不是都是无关，有问题，是不是不能这么玩，那怎么玩呢。

![](img/799b0091907d100eef1fa07462305359_48.png)

13可不可以这样啊，你看我原始数据是不是有两个苹果啊，我需要把这两个苹果把这两行对吧。

![](img/799b0091907d100eef1fa07462305359_50.png)

把这两行重新执行一下啊。

![](img/799b0091907d100eef1fa07462305359_52.png)

![](img/799b0091907d100eef1fa07462305359_53.png)

只需要把这两行，苹果是不是后边给他附的新的一列。

![](img/799b0091907d100eef1fa07462305359_55.png)

是不是都是我们的都是什么呢，都是啊，不看什么呢，看颜色是吧。

![](img/799b0091907d100eef1fa07462305359_57.png)

先看我们的red吧，red是这一列是吧，这列应该赋值的平均重量是31啊，对不对，而我们还有什么，是不是还有yellow跟green啊对吧，那yellow跟green的话，那么后边的平均重量是不是也有啊。

对吧也有吧，所以在这的话，我们需要把每一个颜色对应的平均质量，都放到最后一列吧对吧，那所以说这三个值，一定是不可以放到这六个位置的，是不是，那怎么办，我们可不可以这样啊。

能不能把我们原始数据当中color这里先取出来。

![](img/799b0091907d100eef1fa07462305359_59.png)

干啥呢，我能不能给red绑定成12是吧，给yellow都绑定成35，把green都绑定成31啊，这个绑定不就是映射吗，那点map一下映射啊，那映射里边是放映神分析表啊。



![](img/799b0091907d100eef1fa07462305359_61.png)

那这怎么给它生成一程位表呢，优生分类表不是字典吗，对吧，字典怎么来，你看这儿返回的不是一个series吗，serious是不是可以直接点什么呢，to看他们直接转成字典，是不是to杠BC。



![](img/799b0091907d100eef1fa07462305359_63.png)

看这可不可行啊，DC走。

![](img/799b0091907d100eef1fa07462305359_65.png)

我们看这方法叫什么啊，呃呃DF点to杠叫DICT啊，叫DICT。

![](img/799b0091907d100eef1fa07462305359_67.png)

OK吧看一下走，你那现在这块我们是不是做映射了对吧，将我们的这个35都赋值给了，我们的这个yellow啊对吧，那这映射完了之后是不是有六个结果啊，把这六个结果是不是可以，直接赋值回我们的什么呀。

我们叫做，min杠weight。

![](img/799b0091907d100eef1fa07462305359_69.png)

节列，现在是不是已经复制成功了。

![](img/799b0091907d100eef1fa07462305359_71.png)

这列表示的是我们的每一种颜色啊，每一个颜色所对应水果的一个平均重量对吧。

![](img/799b0091907d100eef1fa07462305359_73.png)

那在这是不是我们就充分使用了，咱们的映射的一个特性吧，对不对，OK吧好，那这块的话就是我们的一个分组和聚合。



![](img/799b0091907d100eef1fa07462305359_75.png)

的一个操作啊，那下边的话还有什么叫做高级的数据集合啊。

![](img/799b0091907d100eef1fa07462305359_77.png)

高级的数据集合这块指的是啥呢，你比如说哈在这我想干啥呢，我现在想对我们的这个水果啊进行一个分组吧，第二个rop five，对吧，by比如说还是跟我们的item，根据水果的种类分组吧。

然后取出我们的什么呢，取出price不在这求一个M啊，不求出每种水果的平均加减啊对吧，那在这我们是直接点的一个mean，通过这个min做的聚合操作啊，高级聚合值就是说我们可以干什么呢。

自定义我们的聚合运算的形式，比如说我在这儿想求一个均值，那假设如果哈原始的pandas当中，没有给我们封装好这个命对吧，那么意味着我们想求均值的话，我们只能是自己去实现一个求均值的操作啊，对不对。

那就是说这个高聚聚合什么时候用呢，比如说哈当我们分完组之后，想进行一个聚合操作，但是我们想进行的这个聚合操作，并没有被我们原始的pandas as封装出来对吧，那咋办呢。

那pandas没有封装的聚合操作，咱们能调吗，不能调吧，那怎么办，不需要自己去封装一个聚合操作啊对吧，那接下来咱们就可以自己去封装一个，类似于mean的一个操作，求平均的加减吧对吧，好。

比如说在这我去封装一个什么呢，封装一个my min可以吧，好那比如说my m我复制好了之后，那我在这能不能直接去掉我的这个my min啊，不一定不可以啊，因为你看这是打点调方法，应该是返回的。

你看是不是这个表达式所返回的对象，才能打点调这个方法啊，对吧，那你的这个对象有这方法吗，没有吧，这是我自己定义的，是不是，所以说是不是不可以这么玩啊，那怎么玩呢，我们就可以这样啊，如果你想让它分组聚合。

做的是你自定义的聚合形式的话，我们这可以先调调一个什么呢，Transform，Transform，transform当中我放谁啊，放我的这个MME就可以了，OK吧咱们试一下吧。



![](img/799b0091907d100eef1fa07462305359_79.png)

走走没报错吧对吧，那my min我是不是得实现一下，这咋实现呢，那看下，首先my m的话得有一个参数，这参数是谁，就是说你看是不是说，我在这个对象调transform的时候。

是不是给my me传入的一个值啊，对吧，那我这你看是不是对我们的每一种水果分组啊，每一种水果是不是有两个数据啊，比如说苹果是不是两组数据相交，两组数据吧，那每一种水果都有两组数据，是不是都有两个价格啊。

那这我传给他的，一定是每一种水果的两种价格吧，那S1定是一个复数啊，是一个列表，是不是，那要求S当中的均值怎么求啊，sum等于，比如说这个啊杠sum，M杠sum等于零，OK吧，怎么办。

for i ination是不是S啊，是不是让这个my m杠sum是不加等于一个I，OK了吧，最后return什么呢，return我们的M杠sum是不是除以啊长度啊。



![](img/799b0091907d100eef1fa07462305359_81.png)

那这求的不就是个均值吗，走走那这是不是求出均值了，你看这求出的均值跟我直接调点命是一样的吧，对吧，那所以在这，我就通过自己封装的一个区域和函数，作用到了我的分组聚合当中了吧，OK吧。

适用到了分组集合当中，你看这的话，你调transform是可以的。

![](img/799b0091907d100eef1fa07462305359_83.png)

同样你在这调上么呢，调我们的apply也是OK的。

![](img/799b0091907d100eef1fa07462305359_85.png)

a p p l y apply也可以实现我们的什么呢，高级的分组聚合吧。

![](img/799b0091907d100eef1fa07462305359_87.png)

只不过你看这块play跟transform返回的值不一样，对不对，因为transfer返回的是经过映射的结果，而我们的LY返回的没有经过映射吧，对不对，经过映射的就可以把它直接汇总到原数据了吧。

而如果你想把这三个值汇总到原数据的话。

![](img/799b0091907d100eef1fa07462305359_89.png)

是不是得对他再做一次映射啊对吧。

![](img/799b0091907d100eef1fa07462305359_91.png)

那这块就是我们的高级的分组聚合，那就是说再次强调一下，如果你分段组之后想做一个聚合操作，并且你聚合的属性是比较特殊，是没有之前被我们pandas封装好的，那怎么办，那只能是自己封装聚合操作吧。

那你自己封装的聚合操作，一定得作用到我们的transform或者play，这些个工具当中。

![](img/799b0091907d100eef1fa07462305359_93.png)

是不是才可以啊，OK吧好，那这块就是我们pandas当中的分组，分组是我们最为重要的一个操作，也是最为常用的。



![](img/799b0091907d100eef1fa07462305359_95.png)

各位一定要掌握啊。