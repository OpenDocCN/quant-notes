# Python金融量化+股票交易，计算机博士讲解！入门到精通！绝对是全B站把python金融分析与量化交易讲的最透彻的教程了！ - P38：38.38.4-股票池筛选(Av275101736,P38) - 人工智能前沿技术 - BV1pf421R7v4

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_0.png)

好了，那咱们现在啊就是这个中性化操作，我们也写完了，在这里回头来看一下吧。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_2.png)

现在我们是不是在这块就可以去执行，哎咱们刚才写那几个操作了。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_4.png)

好了，一个来执行吧，啊在在在在这里啊。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_6.png)

改写了预处理操作，预处理操作当中啊，咱们一个来写第一个第一个啊。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_8.png)

就是咱们去啊做一个三西格玛3C码当中啊，我们要传进来什么，哎对谁做呀。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_10.png)

哎对我的市值做还是对我因子做呀，对因子做吧，好了，把我们的因子拿到手呃。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_12.png)

这里边哦，这里边咱的一个结果还没有个返回值，我给他个返回值吧。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_14.png)

在这块哦，我说咱们现在得到一个返回值呃。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_16.png)

把它复制过来，把它复制过来，fundamental呃，fundamental当中它指定一个名字吧。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_18.png)

Fundamental，然后做data frame就行了，然后在这个data frame当中就有我们需要的啊，我们想要的这个指标了。



![](img/2e376ae5c60ca7b22822e54a2ad6ef51_20.png)

好了，把它拿过来fundamental，然后对其中谁操作呀，是不是咱们之前写好的，我们当前的一个实际试镜这个东西啊，好了把它传进来。



![](img/2e376ae5c60ca7b22822e54a2ad6ef51_22.png)

然后这样咱们做的第一步就是我的一个哦，去我们这个离群值。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_24.png)

去完离群值之后啊，然后咱们写一下吧，就是现在呃现在我这个指标就是没有什么。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_26.png)

没有我的一个呃极值了啊。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_28.png)

咱们现在做了一个没有极值的，做完没有进去之后还没完，我们还得再做什么。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_30.png)

是不是说再做下一个操作，做一个标准化的一个操作呀，好了。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_32.png)

把咱们当前这个结果传进去，下面我做了一个标准化的操作。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_34.png)

相当于额相当于一个标准化的操作，就是这个东西吧。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_36.png)

直接把它拿过来，然后再点上一个standard嘶呃。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_38.png)

DDER等于我当前的结果行了，这是我做了一个标准化的一个操作。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_40.png)

做完咱们这个标准化操作之后，接下来还有什么，还有一个中性化操作吧，好了再给他复制过来。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_42.png)

再次复制过来之后，我说哎呀他就就就叫这个名字得了。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_44.png)

他就就叫做预处理完之后，然后杠这个东西。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_46.png)

然后等于咱的这个结果好了。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_48.png)

等于我们这个结果，然后把上面这个值再传进来，是不是就可以了。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_50.png)

那现在我们就完成了，咱们所需要的所有的预处理操作了。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_52.png)

那接下来呢那接下来是不是说我现在啊哎呦，我要对这个因子做一些筛选了好了。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_54.png)

咱们来指定一下呃的对因子啊，不是对因子基于因子啊。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_56.png)

对池子，对咱们的股票池子做做一个筛选。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_58.png)

或者做一个调仓做筛选吧。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_60.png)

做一个筛选操作，筛选操作啊，咱们来想一想怎么去做啊，是不是这里哎你得给我指定一个指标啊。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_62.png)

比如说我是个QQ当中呢啊，你说是小于这个因子是小点好还是大点好啊，咱们之前不是说小点好吗，所以说我对当下这个指标我看一下吧。



![](img/2e376ae5c60ca7b22822e54a2ad6ef51_64.png)

他的呃比如说从小到大啊。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_66.png)

就是20%的时候，它是等于多少，就是我们希望选出来前20%最小的，可以吧，还有这里我们来指定一下。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_68.png)

切一下吧，咱们来选多少个，那我就选这么呃，0。2个吧。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_70.png)

相当于选了20%，然后呢这点这是我做了一个因子策略，然后接下来接下来是不是说我要去选股啦，那好了，现在我们要选股。



![](img/2e376ae5c60ca7b22822e54a2ad6ef51_72.png)

在这个选股过程当中，我需要再怎么样，我们看一下当前当前我得到这个结果。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_74.png)

这个是我的一个因子。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_76.png)

对我的因子当中，我要做一个所有的股票当中啊。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_78.png)

都有这个因子是吧，那所以说我现在可以做判断吧，做一个筛选吧。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_80.png)

在这里哎我说现在啊如果说啊它的一些值啊，如果说它的一些指标怎么样没有满足我的要求。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_82.png)

没有满足什么，咱刚才不是说了吗。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_84.png)

我们自己哎指定一个范围，通常啊就是我们这个市净率啊，我希望它不是小一点的时候，能怎么样能使得咱的一个收益，或者说我们的一个期望收益吧。



![](img/2e376ae5c60ca7b22822e54a2ad6ef51_86.png)

可能会更大一点吧，所以这里哎咱们说小于等于一个零。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_88.png)

小于等于一个20%那个值啊，是不是就行了，我们现在先来选小一点的那一些。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_90.png)

然后呢我需要把这些股票找到手点，你death一下，这是不是呃。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_92.png)

这个东西判断是基于值去判断的，均值判断完之后，咱们现在相当于传进来索引。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_94.png)

我得到了什么所有的股票吧，好了，那这这这这是什么股票。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_96.png)

这是不是说我这是我现在想要的这个股票，判断完的，我想要的这批股票好了。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_98.png)

我们拿到这个股票呃，一会儿咱要对这股票做一些做一些交易操作。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_100.png)

我们先把它传到这个context当中，context当中呃，stock list等于一下我当前的一个结果呃，这块不改了，直接把它传过来就行好了。



![](img/2e376ae5c60ca7b22822e54a2ad6ef51_102.png)

这是我们现在呃有了一个stole list，然后接下来呢就是我们要干什么。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_104.png)

我们要执行一些调仓，还有买进买出的一些操作了哦。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_106.png)

在这里就是我们要做买进买出啊，那你是不是说你得知道哎呀买什么。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_108.png)

或者说你把哪些要删除出去啊。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_110.png)

然后剩下的是在股票池子当中去选吧，那首先我们得看一看一会儿啊。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_112.png)

有哪些不在这个池子哦，我得写一下呃，删掉删掉不在当前呃。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_114.png)

当前那个呃因子选中的池子中的股票啊。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_116.png)

咱们要做一个删除。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_118.png)

删除怎么写呢，来写一下吧，呃删除我是不是说得把这些股票呃给它删一下。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_120.png)

删完之后呢，我也知道你删了什么东西啊，好了，这是一个返回值，返回值啊，包当中就包括了所有我要删的，那来想一想吧。



![](img/2e376ae5c60ca7b22822e54a2ad6ef51_122.png)

哪些哎是我要去删的，那肯定是之前咱有的啊，并且跟我当前池子是不一样的。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_124.png)

这个是我当前的我的一个池子吧。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_126.png)

好了，我把它复制过来，这是我当前的一个池子，我先给它括号括起来。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_128.png)

那我们要看的那肯定就是哎呀，现在手里有的股票跟我们当前池子那不一样的，我得有一个difference操作呃，d f f r e NC e different操作好了，这是对谁啊。

是不是说现在我手里有的这些呀，那好了，那我们先拿到手里有的吧。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_130.png)

啊这块呃咱们还再写一下，就是拿到拿到手里。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_132.png)

有的拿到手里，有的咱们也指定一下，在这个context当中把这个哦不用复制上面的。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_134.png)

咱这也有在这个context当中，我们要找谁呀。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_136.png)

是不是找我们现在哎，我的一些账户的一些信息啊，在账户信息当中我要看什么。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_138.png)

我持有什么东西吧，position诶，没有啊，这是position，找一下呃，看一下在我只有这是一个IO是吧。



![](img/2e376ae5c60ca7b22822e54a2ad6ef51_140.png)

哎没什么问题啊，他怎么没没有这个东西啊，position咱试一下吧，一会儿看一看这个API有没有问题。



![](img/2e376ae5c60ca7b22822e54a2ad6ef51_142.png)

有问题要改，我记着他是一个positions好了，这是我现在手里有的吧，咱现也拿到手啊。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_144.png)

然后指定个名字，这个就是我的一个context点儿呃。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_146.png)

咱们最后一次手里有的啊，咱指定一下我们最后一次手里有的这些个呃。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_148.png)

股票吧啊就叫做这个股票得了好了。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_150.png)

然后呢，我是不是用现在手里有这个东西啊，跟我当前池子的诶，跟我当前这个池子的做一个判断。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_152.png)

判断完之后，difference什么意思啊，那就是说当前你手里有这些股票。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_154.png)

不在你池子里边的，哎，这是difference吧，咱把这些股票给他拿到手吧。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_156.png)

啊是这个意思，然后这个这个我把这个前面就得给它复制一下。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_158.png)

好了，这完事了，这个就是咱们当前啊完成的一件事。

![](img/2e376ae5c60ca7b22822e54a2ad6ef51_160.png)

好了嗯，点set一下吧。