# 第42节课 EventEngine - P1 - 古辰诗提 - BV1Bx4y1e7r4

欢迎大家来到从零开始量化系列课程，Python基础课的第42课，上一节课咱们说到了队列。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_1.png)

Q import，大写的Q也介绍了他最主要的使用的几个方法，一个是get一个put，如果说咱们可以做个小的案例的演示啊，比如说我Q等于QUEEE，我Q点put，比如说里边放一个item item。

我就放一个1block，我就这个我就不用去设置了，因为你往里去放的话，我这又没有限制，他就是说放多少对吧，但如果说我这里边只让放一个一，然后我Q点put，然后再放一个二。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_3.png)

咱们可以运行一下，它就会卡死了是吧，就会卡死了，他就因为因为放不进去了。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_5.png)

你如果说默认这个就是他的这个put的，他的这个block它是一个，就是说你没写的话，它会有个默认值，就是阻塞，如果说我不阻塞，不等于false。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_7.png)

就是不让它阻塞，咱们再运行一下，看他会报错，报Q点for啊，Q点four，如果说我去get啊，get我把这个删掉啊，把这个也注释掉，然后Q点Q点G，然后这个里边我先什么也不设。

然后我先用一个IES等于接一下，然后print一个RES啊，你这个时候你获取到的就是一，如果说我再get一下，就是在它下面Q点get，然后我里边这个block我设置为false，就是我不阻塞它。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_9.png)

他会报什么呀，Q的empty是吧，他会报这样的错误，就是Q里面是空的，这就是队列呃，就是会经常用到的，包括在咱们伟大平台也会用到的，为什么跟大家讲这么详细一点呢，就是后面会给大家写一个就是维纳的核心。

就是image engine，就是事件引擎，然后里面会用到这一块，其实这个Q你会发现它实现起来其实也不难，哪怕是咱们自己去来实现的话，比如说就是咱们自己来实现的话，其实也不难。

完全可以通过列表去实现它对吧，我就class一个my q，然后下划线INIT，我初始化一下，然后窝里边传入的是这个，比如说我就先定义一个data list，等于一个列表，我先定义一下。

定义它完了之后我就定义一个put，就是往里去放吧，你这个里边是不是需要有元素item啊，如果写的严谨一点，是from typing，你就是这个里边放入的可以是任何的对象是吧，我给他标注一个any。

然后当然后面那个block什么的，咱们就不写了，咱们就给大家做一个简单的演示，我放进去之后，我放学之后，我其实就是self，第2data list，点append，我把它末尾添加进去。

就是我我给它放到末尾，因为它得就是先进先出，先进先出嘛，我给它放到末尾，或者放到最前面，我就给它先放到末尾吧，Item，好然后DF一个GC，我后边也不设置了。

就是self data list pop pop。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_11.png)

我把最先最前面这个给他pop出去，然后return直接把它返回数据，当然你得在里边，如果说这个data list里面没东西会怎么样，对不对，就是你再加一去进行呃，分门别类的去给他写。

如果说你实现一个简单的，这个不就实现了一个队列了吗，比如说呃Q等于my q实例化一个，然后我Q点put，我把一给放进去，然后Q点G然后这个IE等于，然后print一个IE。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_13.png)

啊你完全就可以获取出来了。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_15.png)

这就是你自己实现的一个队列，很简单，你这里边你比如说我再加上报错啊什么的，如果说他这个判定一下，它这个长度如果是为零的话，我再判定一下是不是需要阻塞什么的，如果不需要阻塞的话，我就那个去直接报个错。

rise一个就是说你的这个Q的这个empty是吧，这样的一个错误，如果说是嗯需要等待的话，我是不是可以，就是说把它整个的里边建一个县城，县城里边就随时的就是说去等待着去接，对不对，然后等待着去给。

不就是这样嘛是吧，然后我县城我再记个时，我满足时间了，我到了时间了，我再进行一下判定，就是那个time out嘛，如果到时间他还没有，那个就是里边还没有东西，我在rise一个就是错误啊。

这个你都可以自己去实现，其实很多东西没有你想象的那么复杂，这个其实就是个队列啊对吧，只不过它很不完整，很不完善，好说了，队列了，咱们昨天是从进程说到队列的，那进程能直接使用这个队列吗，那肯定是不行的。

因为这个是放在县城里面使用的，而且它实现的方式，你像咱们是咱们实现出来的，这个就是他肯定是在一个公用的一个，内存空间里边，你用进程去直接使用这个队列肯定是不行的，但是呢你可以直接从那个哪呢from。

multiprocessing import一个EUE啊，就是在这个多进程里边，就是这个类里边它有专门的进程的队列。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_17.png)

他是怎么给实现出来的呢，其实也很好理解，你两个进程是吧，或者N个进程，你要实现这个队列里面数据的相互传递，从逻辑上来说，我就在另外我新开辟一块内存空间，我把这个队列放到里面去，然后想要取的时候。

我就从这里面取，想要放的时候就从这里边放，对不对，但是呢Python它的这个操作它又涉及不到底层，所以呃一般情况下这个Q多进程里边，这个Q你如果说想单独开辟另外一块空间的话，你需要C加加去来实现。

C加加里边它有单，就是单独就是程序员控制的这个内存对吧，但是Python里边就是说不是说不能实现。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_19.png)

就是也没这个必要去实现它对吧，它也给你实现好了，有专门的这个亏Q啊，这个Q咱们就可以试一试，昨天没有完成的，就是单个的，我如果说复用就是这个。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_21.png)

如果说我是复复写我这个my process。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_23.png)

就如何把我的这个数据给传递进来是吧，如何把数据传递进来，我这一个multiprocessing啊。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_25.png)

把这个task也给它写在这个上面。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_27.png)

写到这。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_29.png)

![](img/8f8018eb8fc39bb20b3d75903d1c352c_30.png)

啊import一个OS好。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_32.png)

现在应该可以了是吧，然后如果从这我去实现一个呢。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_34.png)

我是不是可以给他传递一个Q。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_36.png)

就是这个Q，然后他应该是multiprocessing。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_38.png)

点Q我就不标注了是吧，我self点Q等于Q。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_40.png)

然后他执行完毕之后，这个run执行完毕之后，我把这个，cf点Q点put，把这个cf点下划线result给它放进去，然后这个drain june完毕之后，我不用给他return了是吧。

我直接哎我就不用去复写它了，就是我等他执行完毕之后，我再去我的这个Q里边来取值不就可以了吗，啊，1f，好这个呃mp吧，就是my process里边需要传入name睡觉，然后tom比如说两秒钟。

然后还有个QQ，我在这儿要去新建一下，Q等于multiprocessing点QUEUE是吧，QUE我实例化一个，然后把这个Q给他传递过去啊，把Q给他传递过去，然后我mp点start start。

完了之后就是MMP点join，Join，完了之后，我从Q里面去get一个，去get一个数据，然后这个IES等于git。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_42.png)

然后print这个RES，最后我print一个end。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_44.png)

是这个逻辑吧，好我现在去运行一下它，看看可不可以，紫禁城开始执行了，睡觉任务执行结束了，然后这个结果啊也获取到了对吧。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_46.png)

你可以通过这种方式来获取这个Q。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_48.png)

就是实现进程之间的这个数据传递，别的例子我就不演示了，因为都是你只要把Q给传递过去就可以了，Q你新建了这个他肯定是在就是我理解的啊，我也没就是去翻过这个c Python的，这个就是这个代码。

但是我理解的它是新建了一块内存空间，然后把你的数据都放到这个新建的这个。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_50.png)

内存空间里面去，所以说他们就可以去公用它啊，就可以去公用它好，讲到这儿呢，就是基本上所有的这个Python基础课的内容，就讲完了，就是最后呢再给大家写一个，就是咱们伟大平台里面的核心。

就是这个invent engine，给大家写一下，看看它invent engine是如何去实现的，咱们先新建一个int engine，点PY文件，在正式写之前呢，咱们先捋一下这个逻辑。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_52.png)

invent engine它究竟是来做什么事用的，在咱们之前写过的那个city template里面，它有很多的回调方法，比如那个on bar，包括on tick。

还有on order on trade等等这些方法，它最终是需要就是你去来调用它的，就是它虽然在这个类里边，因为这个类是个这个模板类，然后你会继承他，然后写成策略，这个策略这个类肯定会被实例化。

而且会被实例化多份，这个on tick肯定会被调用的，当有新的tick来了之后会被调用，但是是调用on tick呢，还是调用on order呢，还是调用on trader呢。

如果说你就是说仔细去考虑这个问题的话，如果不跳出来的话，你会发现他这个逻辑实现起来很复杂，那个维纳平台呢，给咱们提供了一个它的设计思路，就是什么呢，其实跟咱们之前讲的这个队列有关系，建一个队列。

然后一边呢往里边放数据，但这个数据呢比如说咱们把它叫做object o b j，这个object呢给它封装成一个数据类，其实它本质上也是一个类，这个类里边呢有类型，它是一个字符串型的。

比如说它是一个tick数据是吧，然后后边带着他的这个具体的数据，给它放到这个里边，这一端呢，比如说这样他在调用的时候，会根据这个类型来调用相应的别的类的方法，它是完成这样的一个分类。

这样你数据的放入和取出，然后再进行方法的回调，这样逻辑就会很通顺，当然这个你需要给它封装一下，你需要就是给它分门别类的，就比如说我建一个字典，怎么分门别类，比如说tick类型的这个里边放tick。

然后这个里边有一个列表，需要回调的方法有啊呃就是F一F2FN，然后有order，然后后边有一个列表，然后需要回调的方法就是F1F2F，这样如果说过来的数据是tick的话，我就直接遍历这个列表。

然后在这里边去把这个方法去执行它，或就是去调用它对吧，这样的逻辑就会变得很通畅，而且也会变得很灵活，也不会因为比如说你一个类里边的这个，比如你调用这个欧霸，它里边的逻辑有问题，而会导致整个程序的崩溃。

那咱们就具体开始写。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_54.png)

首先咱们肯定是要写咱们的这个，刚才说的这个事件的封装，就是把这个事件封装到咱们的这个，一个类里边来，Class invent。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_56.png)

首先初始化里面传入的type就是STR，就是它是字符串类型的呀，他还是就是说别的类型的up，就是他肯定是字符串类型的，它是tick类型的，还是order类型的，这个type是吧。

第二个就是data data，它肯定是一个any啊，any咱们从上面可以给它导入一下这个any，From typing，Import on，好在这里边咱们肯定需要定义一下。

self type等于type，然后cf点data等于data是吧，给他把这个类构造函数这个里边给写上。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_58.png)

这个写完之后其实就可以了，它就是每回你要往这个队列里边去放，这个数据的时候，你一定要把它封装成这样的一个IMMIT，然后这样的一个对象去放到那个队列里边去。

那咱们下边继续写这个invent engine，可能在咱们看维纳平台的时候，它里边有很多的这个engine，那个engine你不要觉得好像很复杂什么的，它其实就是一个类啊，它其实就是一个类。

只不过里面实现了不一样的功能，你像这个immit engine，它其实就是事件的一个传递，事件的一个传递好，首先先初始化。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_60.png)

这里面咱们不需要传入东西，首先你肯定得有一个cf点，Q是吧。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_62.png)

就是啊QEUE就是队列，你肯定是得有的吧，From q u e u e，Import q u e o e，这个就可以直接从这导入了，因为咱们这个是在一个县城里边去工作的啊，是从县城里边去工作的。

QU实例化一个对象。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_64.png)

这个里边咱也不放，就是里边这个max size是吧，也不用去放max size，然后这个里边肯定是有一个字典的cf点，handle handless吧，等于一个字典，这个里边就存放。

咱们刚才说分门别类的，把这个方法放在这个里边，把方法放在里边，那既然把方法放在里边，你必须得提供接口，他怎么样把方法放在里面，然后把对应的方法给取出来对吧，好register就是注册。

你注册第一个你肯定是tap，就是注册到哪个类型的啊，他的这个就是数据类型那个列表里面去是吧，这肯定是一个STR，然后第二个就是function。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_66.png)

就是它的这个回调的这个函数名，这个肯定是COLORABLE。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_68.png)

就是可以回调的，怎么往里放，就是if先判定if type in cf，点HANDERS，先看看这个type就是这个self handers这个字，字典里边有没有这个类型，如果有的话。

if not这个in方法就是self handers，然后后边这个type把这个列表取出来。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_70.png)

看看他在不在这里边，如果不在这里边，我就添加一下对吧，self handers这个tap点append，然后把这个function给它放进去，对不对，如果说else。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_72.png)

如果说这个type，就是说在这个handlers这个字典里面没有，我就需要cf点HANDERS这个type给它新建一个列表。

然后self handers这个type点append这个function是吧。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_74.png)

![](img/8f8018eb8fc39bb20b3d75903d1c352c_75.png)

这样是不是就可以了，是不是就可以了，咱们可以测试一下啊，invent engine等于limit engine，实例化一个，然后engine第2register，比如说我有一个tap就是tick。

然后里边放着这个function function，我定义一个function，process invent里面传入的首先肯定是一个tap，Tap，就是这个tick呃，tape这个是传参啊。

然后啊不是你传入的肯定是一个event事件event，然后这个里边就print这个invent点data。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_77.png)

![](img/8f8018eb8fc39bb20b3d75903d1c352c_78.png)

可以加一个判断，if event点data。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_80.png)

如果这个event data存在的话，我就print event data，然后我把它注册进去，就是process invent，注册进去之后。

咱们可以print一下这个invent engine handers。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_82.png)

![](img/8f8018eb8fc39bb20b3d75903d1c352c_83.png)

咱们可以看一下有没有注册进去是吧，Tick function，这是一个列表，对不对，在这呢跟大家介绍一个另外的一个模块，就是collect，不是from seal collections。

Import default dict，这个有什么作用啊，就是从collections里面import一个default dict，咱们可以从这把它变成default dict啊。

哎default dict，然后这个里边放一个list，这个有什么用，咱们可以给大家演示一下啊，就是比如说我先把这个先注释掉，Default dict，然后里面放一个list。

应该是你标注它的这个数据类型是吧，这就等于也是可以的啊，好他是这样的，如果说我DF点啊，不用点，这样我里边取name，按照正常的一个dict。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_85.png)

我是不是应该这会报错的对吧，但是他呢咱们可以print一下DF看一下。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_87.png)

他会给你创建一个，然后key为这个你获取的，然后他的这个是一个空列表啊，是个空列表，他就有这样很方便的地方，所以说你如果这么去设置设计的话。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_89.png)

你的这个代码是可以简化的对吧，如果说if type inserve the handers，就判断这个type就是这个key存不存在，其实咱们可以完全直接去获取。

就是说这个h panda list等于就是这个呃self handles。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_91.png)

![](img/8f8018eb8fc39bb20b3d75903d1c352c_92.png)

这个type是吧，我直接获取它，没有的话，就返回一个空列表，如果有的话，就返回那个列表，对不对，这个时候咱们判断就是说直接可以把它简化啊，if not funk in这个hle list。

如果这个函数名不在这个这个列表里面，然后这个handle list p这个function。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_94.png)

你这样你这样的话有个七八行代码。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_96.png)

就变成了三行代码，它的效果其实是一样的对吧。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_98.png)

咱们可以去看一下，一样的吧。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_100.png)

对不对，当然你有register，咱们可以就注视着吧，有register肯定有，on register就是取消注册对吧，type同样的STR，然后这个funk就是COLLAB，Collab。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_102.png)

你同样的h handle liu s t等于四点HANDLESS。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_104.png)

这个type对吧，然后先取出这个列表出来啊，当然如果说他没有的话，他会自己给你去在里面添加一个。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_106.png)

然后去判断if。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_108.png)

Funk in handle list，如果在里边的话，我HLIST点应该是什么。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_110.png)

remove吧，你用pop是不行的吧，top的话是它是删索引，remove是删里面具体的这个元素对吧。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_112.png)

这个而且这个元素必须得存在，如果不存在的话，它会报错的。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_114.png)

但是在这咱们已经判定了，它这里边是在这里边的，在里边我才把它给删除掉对吧，如果就是说你删完之后，它成了一个空列表了，空列表是不是，咱们就没必要让它就存在于咱们这个save handers。

这个字典里边了，所以说咱们判定一下。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_116.png)

If not self handless，然后type或者你直接if not handler list。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_118.png)

![](img/8f8018eb8fc39bb20b3d75903d1c352c_119.png)

然后就self handless点，用着用什么呀。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_121.png)

用pop pop是可以删除这个key值的是吧，把key给删掉，对不对，用pop里面填上咱们的那个key值。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_123.png)

key就是这个type吧，对吧，就是这个就是实现取消注册。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_125.png)

然后上面就是注册事件是吧。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_127.png)

这个很简单嘛。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_129.png)

好咱们再进行一下演示，我现在是注册进去了是吧。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_131.png)

我print一下，然后invent engine点on register。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_133.png)

然后同样的在tick这个类别里边，把这个process event就给删掉，然后这个时候我再print一个invent engine handless。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_135.png)

![](img/8f8018eb8fc39bb20b3d75903d1c352c_136.png)

看一下是不是跟咱们想象的是一样的，你会发现是一样的，它注册进去之后有一个tick，有个function，就是说这个其实是一个函数名嘛，它存放的这个就是函数存在的这个内存地址，然后如果说是取消注册的话。

它就是一个空列表里面没有也没有tick了对吧。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_138.png)

就是空字典，它是一个空字，点好这个咱们的目的就达到了。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_140.png)

那你有了register和UNREGISTER。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_142.png)

那你下边既然能注册进去，是不是。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_144.png)

当呃，我这个列表里边肯定是需要放数据和取数据的。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_146.png)

然后里面放了数据。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_148.png)

然后再取出来，再去把这个self handless，这个里边列表分门别类的去这个for loop。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_150.png)

就是去便利，这样不就可以了吗，对不对，所以说咱们肯定是需要有个放的put cf，你put里边放的应该是data对吧，你放的数据是啊，咱们一直在说这个一定要放进去啊。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_152.png)

一定要放进去，就是应该是cf点QUE点put往里边放这个。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_154.png)

你直接把这个给他放进去就可以了对吧。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_156.png)

你也不用什么阻塞呀什么的，本身咱们这个就没有设一个最大的这个值。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_158.png)

就是max size，所以说也不存在阻塞什么的。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_160.png)

这个是事件放入。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_162.png)

你放映之后你肯定得取啊，Df gate self。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_164.png)

git是怎么取啊，取就是cf点这个HANDLESS啊。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_166.png)

不是HANDLESS，就是cf点QUE就是队列里边点gate。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_168.png)

然后组就是等不等待呢。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_170.png)

我最好还是等待一下是吧，true等待一下。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_172.png)

然后把它设成这个等待的时间是多少呢，time out设成一秒，或者说你这可以写一个参数啊。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_174.png)

我把它保存一下，往右拆分一下。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_176.png)

然后把它放到这，从这儿你写一个参数，比如说就是time count啊，就是float也行啊，算法，然后从这就是当然得从这给它写一下，对time count啊，等于他count。

然后从这time out等于四点，Time count。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_178.png)

我阻塞多长时间，但是如果说到时间里边还没有数据，它是不是会报错呀，对吧，他是不是会报错，那这个应该怎么写呢。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_180.png)

咱们可以写一个try，尝试着去接它是吧，去接他，如果有有报错的话。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_182.png)

咱们就把它获取出来，这个错误肯定是什么错误啊，就是这个empty empty错误是吧。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_184.png)

咱们之前说过是empty，所以说咱们把这个empty给给接上。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_186.png)

然后呢下面写什么，我不可能就取一次就结束了，所以说我一定要把它写成一个循环，对不对，然后反复的去取它，所以说这个下面应该写continue，然后再回头再去取，但是这个continue咱们没有写循环的。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_188.png)

写循环的话，咱们得给他一个cf点下划线，active就是他是不是被激活了是吧，因为你如果一旦你反复去取的话，你这势必得用一个线程来操作它，你用一个线程来操作它，你用一个线程来操作它的话。

你就需要给它开启和关闭的这样的一个方式。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_190.png)

所以说你不能在这放死循环呃，你应该放一个while这个四点下划线active。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_192.png)

以这样的方式，然后你关闭的时候，你就可以把这个self active这个开关给他关闭掉，这样的话它就这个就会执行完毕对吧。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_194.png)

就会执行完毕啊，这个是git，一个是put，一个是git。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_196.png)

这样的逻辑应该是没有问题的吧，应该是没有问题的吧，对不对。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_198.png)

然后你从这是需要去给他建一个什么呀，就是说呃就是这个县城。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_200.png)

然后让他一直去取。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_202.png)

一直去取，所以说cf点thread等于我从这导一下包。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_204.png)

这个大写的thread啊。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_206.png)

然后导一下包，咱们刚学的这个thread是吧，然后里边target等于cf点gate。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_208.png)

然后你咱们这个参数啊就不用去传了。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_210.png)

就不用去传了，你就是来获取这个数据的，如果说获取数据，数据获取到了，咱们干嘛呢，就比如说这个MIT等于git。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_212.png)

然后获取到数据了，咱们应该是不是if event。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_214.png)

有这个数据，咱们是不是应该做一个方法，然后给他来处理这个数据啊，对不对，process这里边接的也是MIT对吧，接着因为你把他接过来，我先写pass啊，接过来干什么呢，咱们先放在后边。

这个时候如果说if m如果有数据的话，咱们就在下面写上什么呀，Shift process。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_216.png)

Serve the process，然后把这个event给它放进去。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_218.png)

对不对，invent给他放进去，Event，这怎么来处理呢，你想想咱们刚才一直在说的来便利，对不对，便利啊，便利咱们怎么便利呢，就是type等于这个invent点type吧。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_220.png)

![](img/8f8018eb8fc39bb20b3d75903d1c352c_221.png)

if type in self点handlers。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_223.png)

就是我这个self handers有这个类型，那就说明需要它能取出一个列表出来，对不对，取出列表出来，我就需要对列表里面的方法，就是colorful的这个方法进行遍历。

然后我for function in self handers这个type。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_225.png)

![](img/8f8018eb8fc39bb20b3d75903d1c352c_226.png)

然后他进行遍历，就是就是也就是执行这个方法嘛，其实就是调用这个方法括号，然后把event给它传进去，这样是不是就可以了。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_228.png)

是不是这样的写法没有问题吧，好咱们可以去演示一下，就说我不UNREGISTER了，我现在我从里边去存放一个数据啊，存放一个数据就是invent engine，点put一个event。

当然这个event我得包装一下是吧，invent等于invent，这里边放，比如说就放几个一，然后我给它放进去啊。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_230.png)

event那放进去之后，它是不是这个队列里边就有了。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_232.png)

但是我开始让他取了吗，我这个three的这个县城是没有进行启动的。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_234.png)

对不对，那我这肯定需要一个start启动线程啊。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_236.png)

这里边得传入cf启动线程。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_238.png)

就是cf点下划线active等于false。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_240.png)

然后self点点start启动。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_242.png)

它有启动，肯定就有结束对吧，Stop。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_244.png)

你结束怎么结束啊，就是cf点下划线active等于false。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_246.png)

上面这个应该等于true啊，是下面这个等于false，它是force了之后，我self点three是不是可以给他join一下。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_248.png)

就是等他把最后一遍运行完是吧，等他把最后一遍去运行完，这样整个这个就是它的这个循环。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_250.png)

是不是就会结束掉，就是这个Y这会就是它就会被结束掉。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_252.png)

对不对啊，这个就是就是它的开始和结束。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_254.png)

开始和结束，咱们从这invent，这个是不是可以从这invent engine start，给它启动这个线程，然后注册了一个事件，然后把这个invent这个tick给他放进去了。

然后从这这给接收到了这个process invent。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_256.png)

就可以接收到了，这个把这个event给输出出来了，能理解吗。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_258.png)

就是我一个队列，一个队列里边，我给他写了往里存放的这么一个方式。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_260.png)

然后呢这边有个县城是专门控制获取的，获取之后呢，获取了之后呢，就是他会什么呀，就是说获取了之后它会执行这个self process。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_262.png)

然后self process里面其实就是便利。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_264.png)

self handlers这个列表里边对应着的这个事件。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_266.png)

它对应着的需要回调的方法。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_268.png)

然后这个是注册里面的回调的方法，然后它就会执行下面的代码啊，一定要捋清楚这个逻辑啊，咱们这个时候开始运行一下。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_270.png)

It ending time count count count。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_272.png)

咱们就别加到前面了，这个加到前面也没有什么意义啊。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_274.png)

也没有什么意义。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_276.png)

咱们把这个就直接给它设成他帽子。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_278.png)

就等于一秒吧，好给他音频，你看就获取到这个111了吧。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_280.png)

你看这个它的这个我的这个主进程，其实是没有结束的，因为里边的这个有一个线程，子线程是没有结束的啊。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_282.png)

子线程没有结束，这个进程就结束不了，所以说我把它强制性的给关掉。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_284.png)

因为我这个three的这个线程，并没有设置成守护线程对吧。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_286.png)

我也没有去手动的去关闭它啊，如果说你从这最后加上一个你put。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_288.png)

你put进去之后，我比如说sleep一个LEEP。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_290.png)

我让他取一下，取的话，我运行一个其实一秒钟就够了对吧。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_292.png)

然后我invent engine点stop把它给关闭掉。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_294.png)

它会自己来进行关闭，取完之后你等一秒钟它就自己关了是吧。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_296.png)

这样的话这几个方法就都起作用了啊。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_298.png)

其实到这儿呢这个image engine就写的差不多了，但是有一些特殊的需求，就比如说我在创建一个。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_300.png)

就是这个Python里边如果说你好好学的话，你肯定会涉及到这个socket通信，就是一个进程和另外一个进程，这个指的可以是一台电脑上，也可以不是一台电脑的这样的进程之间的通信。

就比如说你想把一个你的服务端，放在另外一台电呃，另外一台电脑上接收数据啊，接收行情啊，接收这个委托单的呃，挂单撤单呀什么的，另外呢你会分几个就是另外的这个程序，比如说我这个是运行的一套策略。

这个是运行的一套策略，每每一套策略有个十几种，你要接的这套数据，你的底底层是往这儿接啊，这个时候呢需要你这个从这肯定得有invent engine，把整个的所有的事件全都接收过来，包括这也是由英文字解。

把整个事件全部给接收过来。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_302.png)

所以说他就需要有一个，完全就是你只要放到这个队列里边，所有的事件我都接收出来，然后去运行的那么一个就是列表，列表里面存放的是所有的方法。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_304.png)

所以说这个咱们可以写一个self handers下划线，这个应该是generator，我就直接GN啊。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_306.png)

Generator，然后它是一个列表啊，你从这给它添加成呢region。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_308.png)

![](img/8f8018eb8fc39bb20b3d75903d1c352c_309.png)

哎直接粘是吧，Regist，然后这写GN就是整体的注册，我就不分类，不分类别了，只要是里边有这个方法，不是有这个数据来，我必须得执行那个回调函数啊，必须得执行回调函数，所以这个就不用这么写了。

应该是cfha gcfh gin，然后从这surf handers jin，然后append这个function是吧，你得先判断它是不是在里边了，如果说有两个这个function了，它会执行两遍。

就会出问题啊。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_311.png)

就会出问题的好吧，然后肯定还有on register。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_313.png)

on register gen这个里边function。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_315.png)

然后你也不用去取出来了是吧，然后你也不用去pop它了，应该是not in啊。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_317.png)

应该是而不是not，应该就是in self de hle gen。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_319.png)

然后cf点HSDHG点remove这个function。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_321.png)

取消注册，就是整体的一个注册。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_323.png)

只要是有事件来了，它就会运行这个列表里边。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_325.png)

所有的这个方法都会被毁掉啊，当然你从这个process这你也必须得填上。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_327.png)

对不对啊，你也必须得添上，就是只要是有来的，我就是for就是four f u NC in sehgin handers g。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_329.png)

然后FUNC括号就是毁掉它。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_331.png)

然后把它传过去，咱们可以判定一下，If self handers g，如果这里边有对象的话啊，有这个元素的话，就这样去执行对吧，这啊写到这，咱们之前写过一个。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_333.png)

就是给大家讲过那个列表推导式。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_335.png)

还有没有还有没有印象，就是列表推导式。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_337.png)

比如说我想快速生成一个列一个列表，SUST等于这样I。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_339.png)

i in range100是吧。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_341.png)

或者十，这样你print一个LST。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_343.png)

这个就是列表推导式嘛。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_345.png)

它是它其实是在这里边做了一个循环，对不对，那我可以把可不可以把这样的列表推导式。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_347.png)

我写到这里边呢，因为它们本身就是不管是cf点这个HANDERS，还是这个self handers gm，它本身就是列表，我用列表推导式其实在里边也是做循环，对不对，那我这样的话我是不是可以把它这样来写。

就是它是一个列表推导式，前面做的是，比如说这个f u NC funk，然后括号，然后这个去执行它，然后把invent给它放进去，for f u NC in cf handers这个type。

这样能理解吗。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_349.png)

这样能理解吗，然后就在前面加一个if type。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_351.png)

in self handers判定这个tap在里边有没有。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_353.png)

有的话，我就我就这样写，这个没问题吧，只不过我这个列表没有接啊，这个列表它里边做的事，就是执行了一个for循环是吧，因为本身这个下面也就只执行了一个for循环呀，对不对，那那下面这个怎么写一样的列表。

就是FUNC这个里边执行这个EMT，然后for FNC in self handless gene是吧。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_355.png)

这样是你你这个代码是不是变得会很简洁。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_357.png)

对不对，能理解吧啊这样的一个写法，因为我为什么要给大家这么写啊。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_359.png)

因为就是咱们这个维纳平台下面呢，它的这个代码就是这么写的，一会儿咱们可以对照一下维纳平台里边，还有一个方式呢，就是在咱们实盘过程中。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_361.png)

他需要做一个什么事呢，就是你的position data，就是你的账户真实的持仓信息，和你的这个account data，就是你的账户信息，就是账户里边还有多少钱呀，冻结多少仓位啊什么的。

就是这两个信息是得你主动去申请，他才会给你反馈的，但是这两个信息呢，尤其是这个position data又比较重要，因为你的这个CT引擎里边肯定必须得放置，你就说有地方存储你实际的这个真实持仓的。

这个在你发送委托单或者转换委托单的时候，很重要很重要，所以说他就得隔一段时间，比如说隔个两秒，隔个三秒去申请，获取一下他的position data和这个account d。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_363.png)

所以你就需要往列表里边放一个计时器。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_365.png)

这个计时器用来干什么呢，就是就是去提醒那个获取这个position data和account，data的那个方法，告诉他们你现在该获取这个方法了啊，不是你现在该获取这些数据了。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_367.png)

就是隔一段时间告诉他们一声，隔一段时间告诉他们一声，就跟一个计时器。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_369.png)

然后加闹铃似的，它需要放到这个cf点这个key q里边去啊，然后那边会有接收的，那这个应该怎么写呢。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_371.png)

你计时器还是需要一个单独的，就是说这个three的。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_373.png)

然后里边target等于cf点。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_375.png)

比如说我time呃。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_377.png)

他们他们P吧，我从这我定义一个方法。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_379.png)

DFTPC啊。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_381.png)

从这里边我其实是就是定时的，我往里边去放，这个就是一个提醒的东西，所以说我就是Y哦。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_383.png)

嗯w h a w h i l e r y cf点active。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_385.png)

是不是得TT，他就是说这个被启动了之后，我才进行这么操作。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_387.png)

对不对，然后我先sleep1。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_389.png)

比如说我需要定时几秒钟啊，我这个几秒钟我可以放到这了啊。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_391.png)

这就是time count，float就是cf点。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_393.png)

time count等于time count，就是我多长时间去获取一回是吧。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_395.png)

我可以先休息啊。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_397.png)

time count就是shift time count啊，我可以先睡这么长时间。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_399.png)

然后我打包成一个event event，然后这里边比如说我定一个就是这个timer timer，加米亚这个这样的一个字符串类型啊，就是我这个数据类型，然后我后边其实你不用放东西，对不对，我不用放东西。

那我不用放东西。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_401.png)

我是不是可以把他这的这个默默认值，我填个N值啊。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_403.png)

就是它默认的是none值啊，默默认的是NN值。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_405.png)

那这个时候我就在这个啊这个timer啊。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_407.png)

我就这样就没就没问题了吧是吧，然后我cf点put，我把这个event给它放进去，我把invent给他放进去。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_409.png)

当然你这个timer你可以写一个变量m tom，就是等于比如说timer t i m e r。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_411.png)

然后你invent就是刚才写的哎呀。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_413.png)

就是刚才写的invent，这个tick等于比如说直接写TIK吧。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_415.png)

是不是这样就可以了，我把它可以写成event timer，就是invent这个time我给它放进去。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_417.png)

我从这我是不是直接可以写，注册的时候，我在这进行试验的时候，我是不是可以把这个tick写成就是EVENT，E v e n t event tick，这样这样是不是写的就是显得更好看。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_419.png)

或者说不容易错下来，你要进行注册的时候，你完全可以把这个这样的。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_421.png)

就是说你的这种事呃，事件类型单独放在一个，比如说咱们经常放的那个object里边，或者说是放到一个单独的点PY文件里边，然后就说你这样确保不会出错，不会因为就是这个单词的拼写而产生错误。

因为你这个字符串的拼写。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_423.png)

这个id是不会给你报错的，对吧好。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_425.png)

这样就会减少一些因为字符串拼写而产生的，这个错误产生的错误。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_427.png)

这个时候呃咱们可以去验证一下啊，就是说我别stop他了，我也别sleep email了，我把它注册进去，我也别单独注册这个tick了，我直接注册一个register，这样的话它每隔这个三秒钟或者几秒钟。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_429.png)

它是不是就会呃给传递过来。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_431.png)

比如说我给他设个默默认值，就是两秒吧，每隔两秒他是不是就会在这个Q里边。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_433.png)

就是队列里面会存会放一个这个timer。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_435.png)

就是咱们刚才写的就是这个timer对吧。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_437.png)

但是这个这个这个thread，你在start里边是不是没有启动cf点。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_439.png)

他们应该点start。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_441.png)

把你关闭的时候应该是SOFTIER，点join。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_443.png)

是不是这样就可以了，好咱们运行一下，看看接收过来的是event啊，If event data，这个还不能这么判断了，如果说你invent data，因为咱默认值是none，对不对，咱们就把它给注释掉。

然后直接把NN也给它输出出来啊。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_445.png)

因为它会输出那个NN值的，咱们这个timer里边并没有给他放这个。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_447.png)

具体的这个它的数据对吧。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_449.png)

好，咱们去运运行一下，看看它能不能正常的输出输出111。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_451.png)

这个没问题，那是吧，然后再隔两秒啊。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_453.png)

再来个NN，再来个NN，这样就可以了吧是吧，没有问题啊。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_455.png)

没有问题，就是这个其实就是咱们维纳平台最核心的。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_457.png)

我个人认为是最核心的代码，就是它并不见得有多难。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_459.png)

他其实就是在里边启动了两个线程，然后把这个你的事件包装了，包装成了一个MIT，但是它是整个从服务器数据过来，然后传输到你的这个strange，就是你的各个策略里边，它比较核心的地方。

要不以前包括在哔哩哔哩上那个课，我一直讲event engine。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_461.png)

它其实是一个类似于心脏或者血管啊。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_463.png)

这么一个东西，就是连接了就是这个维纳平台的各个引擎啊。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_465.png)

好吧咱们也可以看一下from invent，就是这个VNPY，Import event engine。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_467.png)

咱们也可以去看一下这个event engine啊。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_469.png)

当然因为咱们这有MIT了啊，你这看就看下面来了。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_471.png)

这样是不行的啊，所以说一定不能重名了，好这咱们可以看看他的这个image engine。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_473.png)

下划线INIT是吧，传入的它其实这个interval其实是一啊，它interval它也是从哪儿啊。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_475.png)

就是在run他们的run time er的时候。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_477.png)

他这个sleep self interval对吧，他是休息了多长时间，其实是一是一个意思啊，q active都有three的timer，timer也是一个thread，也是个县城对吧。

self handers啊，然后JANUARYHANDERS啊一样的意思。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_479.png)

run就是你在他是run。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_481.png)

我是用的这个get就是get啊，git然后他是用的pass，然后我是用的这个continue其实是一样的，意思就是你获取到了empty，你就continue接着这个循环吗。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_483.png)

这是用的pass啊，然后process是吧，它是用的这个列表。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_485.png)

我为什么非得要写一下这个列表的方式啊，列表的方式。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_487.png)

当然这个type我给它单独拎出来了是吧，一样的wrong timer就是也没什么别的。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_489.png)

start end put register就是注册嘛啊。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_491.png)

它是用的这个default dict on register啊。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_493.png)

Register general on register general，其实它就是这么来实现的好吧，然后呢那这节课长一点就到这呃，到到这儿，咱们整个的这个Python的基础课就先暂告一个段落。

如果说以后我这边有一些想更新的，跟Python基础有关的，我会接着往后更新，但整体的内容大概就是这么多，其实最主要的里边比较核心的内容，就是Python的基础，就像那些数据类型啊什么的。

咱们可以放一边啊，这边我看到了一个这个把它给删掉啊，放一边最主要的函数你得知道，尤其是传参是吧，然后后边的这个类很重要很重要啊，这个类很重要很重要，如果说你想把你的这个写代码的层次，从就是往上拔一拔类。

尤其是魔术方法那一块儿，你一定要弄明白，包括咱们讲的那个gate attribute和GDTR，就是那些东西其实挺重要的，如果你用的好的话，在灵活使用的时候，它们能起到很大的作用。



![](img/8f8018eb8fc39bb20b3d75903d1c352c_495.png)

而且对于你理解这个类它也很重要，就是魔术方法那块可能会比较绕。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_497.png)

希望大家好好去研究研究。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_499.png)

这个时候呢你最好不要尝试自己去写一个项目，你可以去看一看。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_501.png)

去扒一扒维纳的源代码啊，但是你不要尝试去自己写，因为离着自己能独立完成一个项目还很远很远，因为你后边还有很多的库和包没有学，尤其是三方包呃，和和一些就是说Python的标准库还没有学，有一些方法。

包括这个设计方法，就是你这个代码就是怎么去设计。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_503.png)

你像这个event engine，其实它就是一种设计模式嘛。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_505.png)

就是管道的一种模式呃，当然还有很这个不是管道，这个叫队列，它还有很多，比如像站，咱们之前提过站的这种模式，就是先进后出的这种模式，还有管道，管道就是两个啊，就是两个就是说数据从这儿过去。

然后从这儿回来啊，这边等着，然后这边等着收啊，然后这边等着发什么的。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_507.png)

有很多这样的模式，你还需要去慢慢的去接触，当然对于咱们量化来说。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_509.png)

咱们有这样委纳现成的这种开源的框架。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_511.png)

咱们把县城开源的框架研究明白了，我觉得就很可以了好吧。

![](img/8f8018eb8fc39bb20b3d75903d1c352c_513.png)

非常感谢各位老板的支持。