# 基于Python的股票分析与量化交易入门到实践 - P66：13.11 Python量化交易策略实战案例_量化交易策略实战--大小盘轮动策略（中） - 纸飞机旅行家 - BV1rESFYeEuA

![](img/e483311d975727a9a85a72b634396b92_0.png)

然后呢把一些统计工具这个呢sts model。

![](img/e483311d975727a9a85a72b634396b92_2.png)

这个是个常用的一个Python的类库，主要呢可以做各种的滤波啊。

![](img/e483311d975727a9a85a72b634396b92_4.png)

或者求导啊，或者是甚至是一些回归之类的，非常常用啊，最后我们还要把NPC导进来，好这个导入函数库呢现在就OK了，那么接下来呢，我们要把一些常用的基础参数给大家设计好。

这些包括首先这个string给大家看一个叫stream big。

![](img/e483311d975727a9a85a72b634396b92_6.png)

这个是什么呢，是大盘风格的指数，就是就是沪深300。

![](img/e483311d975727a9a85a72b634396b92_8.png)

那么接下来呢是我们给它定义一个叫小盘small。

![](img/e483311d975727a9a85a72b634396b92_10.png)

创业板指数。

![](img/e483311d975727a9a85a72b634396b92_12.png)

好然后呢还要有一个整个市场的一个代表基准。

![](img/e483311d975727a9a85a72b634396b92_14.png)

![](img/e483311d975727a9a85a72b634396b92_15.png)

![](img/e483311d975727a9a85a72b634396b92_16.png)

上证全尺，这个代表的就是整个上证指数。

![](img/e483311d975727a9a85a72b634396b92_18.png)

OK好，我们把指数打个列表。

![](img/e483311d975727a9a85a72b634396b92_20.png)

方便我们后面进行分析调用。

![](img/e483311d975727a9a85a72b634396b92_22.png)

好然后呢是各种ETF其实就两个了。

![](img/e483311d975727a9a85a72b634396b92_24.png)

首先是大盘的一笔大盘风格的ETF，沪深300的ETF，510300。

![](img/e483311d975727a9a85a72b634396b92_26.png)

同学们感兴趣的可以投资一下ETF，其实ETF它不光是有各种指数类，还有一些板块，比如说你们想投资芯片，那有芯片ETF，军工有军工ETF，还有一些新兴的。



![](img/e483311d975727a9a85a72b634396b92_28.png)

比如新能源ETF都可以好，那我们刚才把那个大盘的ETF。

![](img/e483311d975727a9a85a72b634396b92_30.png)

现在我们继续小盘的ETF，159915是创业板的ETF好了。

![](img/e483311d975727a9a85a72b634396b92_32.png)

![](img/e483311d975727a9a85a72b634396b92_33.png)

然后呢我们把一个信号的策略，当前信号策略用一个四点dictionary来存着，这个数据格式代表什么意思呢，就是说我们目标经过我们的信号识别，那我们目标应该是对于大盘的ETF和小盘ETF呢。

它的持仓比例好。

![](img/e483311d975727a9a85a72b634396b92_35.png)

然后呢我们设定初始化函数。

![](img/e483311d975727a9a85a72b634396b92_37.png)

![](img/e483311d975727a9a85a72b634396b92_38.png)

![](img/e483311d975727a9a85a72b634396b92_39.png)

![](img/e483311d975727a9a85a72b634396b92_40.png)

![](img/e483311d975727a9a85a72b634396b92_41.png)

首先设定了基准，然后呢开启动态复权。

![](img/e483311d975727a9a85a72b634396b92_43.png)

![](img/e483311d975727a9a85a72b634396b92_44.png)

然后呢输出一个全局日志。

![](img/e483311d975727a9a85a72b634396b92_46.png)

![](img/e483311d975727a9a85a72b634396b92_47.png)

![](img/e483311d975727a9a85a72b634396b92_48.png)

然后又是股票的交易手续费。

![](img/e483311d975727a9a85a72b634396b92_50.png)

因为ETF其实跟股票其实是类似，所以买入时的佣金也是万三。

![](img/e483311d975727a9a85a72b634396b92_52.png)

![](img/e483311d975727a9a85a72b634396b92_53.png)

卖出时的佣金是万分之三加1‰的印花税。

![](img/e483311d975727a9a85a72b634396b92_55.png)

然后最低手续费是五元，好然后呢，这个函数就是set order cost。

![](img/e483311d975727a9a85a72b634396b92_57.png)

![](img/e483311d975727a9a85a72b634396b92_58.png)

![](img/e483311d975727a9a85a72b634396b92_59.png)

![](img/e483311d975727a9a85a72b634396b92_60.png)

![](img/e483311d975727a9a85a72b634396b92_61.png)

这里好像少个零对，0。004。

![](img/e483311d975727a9a85a72b634396b92_63.png)

少个逗号，最低手续费等于五，然后type c sto，好的。

![](img/e483311d975727a9a85a72b634396b92_65.png)

那么呢这个交易佣金就写好了，那么下一个呢给一个。

![](img/e483311d975727a9a85a72b634396b92_67.png)

因为这个是个长线效率策略，非常常见，大盘变化怎么可能每天都变，所以呢我们给它进行。

![](img/e483311d975727a9a85a72b634396b92_69.png)

每个月来给他下运行或回撤一次。

![](img/e483311d975727a9a85a72b634396b92_71.png)

然后每月月初判断一下识别交易信号。

![](img/e483311d975727a9a85a72b634396b92_73.png)

然后该持仓的持仓该清空清空好。

![](img/e483311d975727a9a85a72b634396b92_75.png)

然后呢来计算交易信号了，因为我们初始化函数已经写好了。

![](img/e483311d975727a9a85a72b634396b92_77.png)

我们去信号就叫get signal。

![](img/e483311d975727a9a85a72b634396b92_79.png)

午餐就是个date。

![](img/e483311d975727a9a85a72b634396b92_81.png)

![](img/e483311d975727a9a85a72b634396b92_82.png)

我们先把时间做一下处理。

![](img/e483311d975727a9a85a72b634396b92_84.png)

![](img/e483311d975727a9a85a72b634396b92_85.png)

偏移1000天。

![](img/e483311d975727a9a85a72b634396b92_87.png)

转完格式以后，我们再把它给变成一个字符串。

![](img/e483311d975727a9a85a72b634396b92_89.png)

因为之前是data类型的，所以他才能去解嘛。

![](img/e483311d975727a9a85a72b634396b92_91.png)

![](img/e483311d975727a9a85a72b634396b92_92.png)

![](img/e483311d975727a9a85a72b634396b92_93.png)

我们要获取一定时间段的。

![](img/e483311d975727a9a85a72b634396b92_95.png)

各个指数的当前的市价。

![](img/e483311d975727a9a85a72b634396b92_97.png)

然后呢获取多少呢，这其实是个区间了，start date就是started，Landate，就是trade date，然后获取多久呢，就是这个时间段内每天我们都要获取。



![](img/e483311d975727a9a85a72b634396b92_99.png)

然后FRANQUEST呢就是daily，所以我们就是每天。

![](img/e483311d975727a9a85a72b634396b92_101.png)

只货它的收盘价就行了。

![](img/e483311d975727a9a85a72b634396b92_103.png)

不用考虑最高价和最低价。

![](img/e483311d975727a9a85a72b634396b92_105.png)

然后呢频率我们在开盘前，然后把结果使用close来存一下。

![](img/e483311d975727a9a85a72b634396b92_107.png)

这个data呢就是用来，我们要去计算RIS的一个重要的初始数据，1000个交易日呢相当于一年是250天嘛，1000个交易日是4年，平均是4年嘛，基本上可以有一次大的趋势的变化。

可以用来做长线的处理和比较，当然同学们也可以用更长更长的话，自己我们大家可以有兴趣的同学，可以自己去试一下。



![](img/e483311d975727a9a85a72b634396b92_109.png)

调一下才好，然后呢下面我们要为了这个算超额收益。

![](img/e483311d975727a9a85a72b634396b92_111.png)

也就是算rs做准备了。

![](img/e483311d975727a9a85a72b634396b92_113.png)

好data这个初始。

![](img/e483311d975727a9a85a72b634396b92_115.png)

好接下来算S。

![](img/e483311d975727a9a85a72b634396b92_117.png)

![](img/e483311d975727a9a85a72b634396b92_118.png)

这个是算什么呢，这个主要就是为了算超额收益，所以他们现在可以理解，为什么要有一个专门的marketing，他其实是要去比较超过十应用嘛，其实就是算本身这个标的的收益和整个市场，那么市场基准呢。

我们采用的就是上证来作为比较，这样呢我们就把这个超额收益给算出来了，那超额收益算完了，其实市场的指数string Mac也就不需要了。



![](img/e483311d975727a9a85a72b634396b92_120.png)

然后呢超过数据算好以后就开始算了S了。

![](img/e483311d975727a9a85a72b634396b92_122.png)

这时候我们用LAMBA表达式来算rs。

![](img/e483311d975727a9a85a72b634396b92_124.png)

那求个log就行了。

![](img/e483311d975727a9a85a72b634396b92_126.png)

求log的十其实就是LN好。

![](img/e483311d975727a9a85a72b634396b92_128.png)

S指标算完了，那我们接下来计算IS的正弦滤波，正弦滤波呢其实在那个整个Python里面呢。

![](img/e483311d975727a9a85a72b634396b92_130.png)

就是hp filter就可以实现了，首先要算到DF。

![](img/e483311d975727a9a85a72b634396b92_132.png)

那它会返回两个值，一个是cycle，一个是trade。

![](img/e483311d975727a9a85a72b634396b92_134.png)

这个需要用到刚才我们说的sex models，其实他就是为了算这块的，这个到他是不能提示这个区块的。

![](img/e483311d975727a9a85a72b634396b92_136.png)

得自己手敲。

![](img/e483311d975727a9a85a72b634396b92_138.png)

然后具体参数，同学们有兴趣可以去查他的官方文档。

![](img/e483311d975727a9a85a72b634396b92_140.png)

这我就不在这里解释了。

![](img/e483311d975727a9a85a72b634396b92_142.png)

前一个前20个数据的。

![](img/e483311d975727a9a85a72b634396b92_144.png)

其实就是前20个滤波的一阶和二阶导数。

![](img/e483311d975727a9a85a72b634396b92_146.png)

![](img/e483311d975727a9a85a72b634396b92_147.png)

一阶二阶导数求完以后就可以判断四象限了，那为什么是前20个呢，因为20个值呢其实相当于一个月了，那我们这个是夜行调仓的一个变化的交易策略，所以呢我们现在只算一个月就行了。



![](img/e483311d975727a9a85a72b634396b92_149.png)

然后呢这个我们用n p l range来存，把它尺呢放在一个list里面。

![](img/e483311d975727a9a85a72b634396b92_151.png)

![](img/e483311d975727a9a85a72b634396b92_152.png)

好嗯。

![](img/e483311d975727a9a85a72b634396b92_154.png)

![](img/e483311d975727a9a85a72b634396b92_155.png)