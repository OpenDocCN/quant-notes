# 第23节课 交易信号及委托1 - P1 - 古辰诗提 - BV1vetXeBECj

欢迎大家来到从零开始量化系列课程，MC课程的第23节课，这节课呢咱们开始讲这个交易信号及委托，讲完函数和指标部分呢，咱们就是研究最后一步交易，这个easy lemage，最重要的功能就是。

把我们的操作流程由代码实现，再透过客观的回测分析，回测很重要呃，回撤的越多，对你这个挂实盘的信心增长会越多，减少人性心理面的影响，量化的三大难题嘛，第一个是技术，第二个是这个心理啊，第三个是资金管理。

但是我个人认为应该把心理放到最前面，因为心理决定了，你能不能去长期的去挂这个量化策略，而一个量化策略，尤其是趋势性策略，它需要长期的去实践的，而并不是说挂这么几天或者几周，甚至就是一两个月。

我个人认为都不是很，除非你是交易很频繁的那一种啊，你可能通过一两天这种行情，你能判定它行不行，但是一般的趋势性策略，你最起码你得半年起步啊是吧，心理其实是很重要的，当然你还可以有个大招。

就是直接把这个程序化给关掉啊，嗯量化交易其实在能在很大程度上减少啊，人性这个心理面的影响，但是你需要做到什么呢，就是说让你这个心里面啊，就是说去认可你的策略，比如说我均线策略我经过回测。

而且底层逻辑也没有问题，我相信他能够挣钱，能够实现正向的这个收益，所以说你会坚持的一直挂下去，如果说没有历史数据作为支撑的话，你这个信息的来源就没法去确定是吧，好在讲这个具体的这个就是交易的这一部分及。

委托信号及委托这部分，咱们先得说一下，就是K线内价格变动的假设呃，为什么要说这个，咱们就是说这个相关指令之前呢，我们必须先了解一下回溯，也就是回测的这个概念，就是量化交易最大的优点呢。

就是可以利用历史数据来验证新的交易策，略及想法，这个动作呢我们称之为回测，通过回测可以帮助我们找找到相对优化的参数，这是相对优化啊，而不是绝对优化，绝对优化，你可能陷入就是过度优化的这个陷阱里边。

去增强我们对策略的应该是信心啊，啊如果一个策略在历史数据上取得良好的收益，我们往后交易也会比较有信心嘛，在实盘行情中呢，策略会获取到每笔即可的数据，但是在回测的时候，为了处理大量的数据。

我们会把数据简化为，只包含高开低收四个价格的K线数据是吧，这个咱们一直在讲的，但是MC里边，他这个数据不光包含了这个高开低收，还包含时间，还有这个你的这个成交量啊什么的，包括八线编号都是有的。

但是最重要的还是这个高开低收，这个四个价格嘛，仅靠这个四个价格，我们是无法判断出真正的行情的情况的，这什么意思，这个你一定要知道啊，就是可能一分钟就是这样的K线，你还不是能特别理解。

它里边为什么不能包含真身，就是真实的行情，如果说你用日线做交易，比如这是一根日线，日线做交易，你看到的比如说这是一个红的啊，开盘在这儿，收盘在这儿，然后这是最高价值是最低价。

你可能就是说如果说咱们光看这根线，你是不知道里边的行情是怎么变化的，比如说它有可能是这样的是吧，当然这个没有最高价了啊，就是他有可能是这样哎，然后下来啊，当然下到最低价啊，然后到到这，这个是开盘。

这个是收盘对吧，他也有可能在里边轮动了好几回最高啊，然后下载下载下来哎，哎然后又下来A这样A然后又下来一个，然后是吧，大部分行情是不是都这么走的对吧，是无序的，这个里边可能包含了很多个，就是来回的。

就是这种翻转是吧，你均线可能是这样的，所以它是包含不了这个真实的情况的，所以呢回测时呢，MC会对K线内的价格变化做以下的假设啊，这个做是不是写错了，做以下的假设，假设一。

委托可以成交在K线价格范围内的任何价格，这当然你得打开那个运RO呃，Intro bar order generation，你可以在坝内进行成交呃。

这个假设二呢就是如果high减open小于open减low，则假设K线的发展为先是开盘后是最高价，然后最低价，然后收盘，假设三呢，如果说H减open大于等于open减low。

然后呢就假设K线的发展为先是开盘价，再是最低价，最高价，然后收盘价，这什么意思啊，就是其实开盘和收盘你不用去假设它，就是他肯定开盘是最开始的价格，收盘是最后的价格是吧，不然它也不能叫开盘价和收盘价。

难就难在，你这个最高价和最低价是什么时候出现的，如果说就是同样的这根K线，就是最高价和最低价，如果说你不去假设它的话，那就会出现问题，比如说我从这是吧，这根K线是它前面一根K线，这呃如果说这是阳线的话。

这是阴线，就是这是阳包阴是吧，就是给他全部给包上了，或者说你不判定它的这个咳，就是颜色的话是涨还是跌的话，这个叫孕育线，就好像这个是在它里边呢要用于一波行情是吧，但是比如说我从这个价位开了仓了。

然后我设定的平仓就是假设是在这和在这啊，这个是止损，这个是止盈，那我在经历这根K线的时候，他会怎么去操作呢，它是先止盈呢还是先止损呢，这就是问题吧是吧，就是这个就是一一笔止盈单，一笔止损单。

尤其是在咱们这个CCTA策略里边，他可能对你整，因为你一年都成交不了多少笔嘛，因为你的交易次数少，一年成交不了多少，就是多少笔，这一笔可能影响就会特别大，对你的这个绩效啊。

对你的这个呃就是判断都会有很大的影响，所以说你必须得有这个逻辑来说，他是是从止盈还是先从止损啊，这个就是它的这个假设，你看它high减open，我这个是比如说是开是开盘价，然后这个呢是收盘价。

它是一根上涨的K线，然后呢这个是最高价，这个是最低价，它high减去open，如果说小于这个open减去low，其实就是这个跟这个来进行对比是吧，这个如果比它要大的话，就是咱们就先走最低价。

然后再走最高价，如果说它成为这样一根K线，同样是是上涨K线啊，然后它如果比它要小的话，就是先走最高价，然后再走最低价，能理解这个意思吗，就是看这个开盘啊，然后跟最高最低价就等于是什么呀。

我看开盘和最高最低价来进行对比，如果说它的比它要小要大，就是先走低价啊，就是不是它的也比他要大的话，就这儿先走低价，然后再走高价啊，先是走最低价，然后走最高价，如果说它比它要小的话，就是先走最高价。

然后再走最低价，它是这样的一个逻辑，但是这只是假设啊，当然MC就是这个逻辑，一会咱们去验证一下，你这个假设他也不能就是跟实盘，去真正的去拟合实盘，可能他来回了好几遍，对不对，你不知道他是怎么走的啊。

所以说这个是MC的一个假设，所以你要从这个从根本上要知道，它和实盘是有很大区别的，是有很大区别，当然你回测的周期是越小越好，肯定有很多老板说我不用日线，我就用这个tick来回测。

但是你得知道就是咱们现在可交易的品种，就是就拿呃这个上面，我给大家说的是可交易的品种啊，可交易的合约就是嗯就是这个TIK数据，每天呢至少也是500万条以上，因为我一直想做这个。

把这个数据给自己给录制下来，然后去分享给大家，但是呢录tick数据真的是量太大了，不是说一个小团队能完成的呃，录分钟数据，你想一分钟数据，要比这个数据就是要少很多很多，你想一分钟它才出现一笔提款。

你一天按六个小时来计算，你才一个合约才360笔数据对吧，你就算100个合约，他才3万多条数据，3万多条数据其实并不算多，但是你如果说乘以120倍，你就哪怕乘以100倍，你这一天你就要300多万条数据。

就是一个合约上啊，1300多万条数据，这个量就很大了，你再去回测的时候，如果说你多品种多合约去回测的话，它就会很慢啊，加载起来就会很慢，所以一般情况下不建议大家都用tick，尤其是大批量数据的时候。

不建议用tick来进行回测，因为可能会出现卡死的情况，而且执行起来会特别耗费时间，如果说你呃能用Python或者用C加加，当然建议用Python啊，这个代码会简单一些来进行回测。

你可以实时看见它是不是在跑动，如果说你用MC来进行的话，你不知道它是卡住了呀，还是没执行完呢，或者数据没获取到，这就是个很麻烦的啊，所以一般情况下不建议你用tick的，但是你用一分钟级别。

哪怕是一分钟级别啊，差异还是有的，尤其是你比如说写就是说日内策略，它差异还是有的，因为你不能完全的显示出它在，就是说这个行情实时行情它是如何去走的，它只能提供这一分钟的高开低收，以及它的这个成交量呃。

他的这个时间他们就是这些数据是吧，好，那咱们就可以去验证一下这个究竟对不对，就是他先执行的是哪一个部分，就是是高还是低，是低还是高啊，咱们来验证一下这个代码怎么写呢，我把这个新新建一个型号代码。

这个应该是23节课了是吧。

![](img/7ec248be13ba44b40923ba800e142f48_1.png)

23节课好啊，咱们先找一个数据啊。

![](img/7ec248be13ba44b40923ba800e142f48_3.png)

就找一个数据。

![](img/7ec248be13ba44b40923ba800e142f48_5.png)

咱们最好是能找到这个呃阴包阳，阳包阴的这一种，就是这样好测2U咱们用2U吧，嗯咱们找这个日线数据，一日时间2019年吧。



![](img/7ec248be13ba44b40923ba800e142f48_7.png)

时间长一点儿，好啊。

![](img/7ec248be13ba44b40923ba800e142f48_9.png)

咱们找什么数据呢，看一下。

![](img/7ec248be13ba44b40923ba800e142f48_11.png)

![](img/7ec248be13ba44b40923ba800e142f48_12.png)

![](img/7ec248be13ba44b40923ba800e142f48_13.png)

因为你要测这个的话，你得找到这种，就说后边这一根最高最低点，完全能覆盖前一根的，比如说这三根，我如果说从这儿进行开仓啊，就是说或者说从这儿进行开仓，因为它是完全给他包进去的嘛对吧。

就是完就是完全给他包进去的，就是这根完全给前面包进去的，所以说我从前面这三根哪一根开仓都可以，然后我开仓完了之后呢，我给他设一个从这儿卖出和从这儿卖出，两个一起设，咱们看他是从哪个点位出仓的啊，出场的。

那咱们就必须得指定出他进场的位置，你看他的坝编号是545啊。

![](img/7ec248be13ba44b40923ba800e142f48_15.png)

咱们就写代码545是吧，好参照着写啊，好就是if服k e d market position等于零，就是他的仓位是零的话，and but number你直接等于545吗，啊咱们要的是这根线啊。

这根线咱们直接等于545对吗，肯定是不对的啊，这个bar number和current number它最大的区别是什么呢，就是BUNUMBER可以进行回溯，就是它可以这样来调用。

就是这个就是可以五啊什么的，这个可以回溯，但是current number是不可以的，但是他们都是相对于这个max back的，就是这个他的这个你的参考bug，所以说你要加上这个max8spec。

它加上它等于545，因为这儿的八的编号是从一开始的，你可以回去去，你可以自己去测一下。

![](img/7ec248be13ba44b40923ba800e142f48_17.png)

它是从就是编号一开始的呃，给大家看一下吧，你看哎哦还是拉到这来了，你看他是从编号一开始的，但是你把number并不是啊，咱们还找到545Y4轴在这呢。



![](img/7ec248be13ba44b40923ba800e142f48_19.png)

你爸number不是啊。

![](img/7ec248be13ba44b40923ba800e142f48_21.png)

所以说你得加上这个max BIS back啊，Then，By this bon clothes，就是这是什么意思呢，这个就是在我当前这根霸线的这个收盘价来买，这个实际的写的时候。

就呃这个我给大家是做了演示啊，你如果说自己写回测代码的时候，你不用你不要这么去写，你不能说是我by this bar on clothes，为什么呢，因为你还没有收盘。

你就不知道他是就是你就不知道它是收盘价，他收了盘了，你就在这个收盘价你就买不了了，你只能在下一根K线的开盘价卖，所以说这个就设置的就涉及到这个未来函数了，或者未来这个参数变量都可以。

就是这个会优化你的策略的，好吧嗯你捋一下这个逻辑啊，然后我从这买进之后，if market position大于零或者等于一，因为market position如果说持有多仓的话，不管你持有多少。

就是多少手，它都是等于一的，持有空仓的话，它是等于这个呃一啊，Then begin，我从这儿呢，我写两个这个SRSR呃，See you next，爸爸，Next bat，第一个价格是什么呢。

我还找到这个545。

![](img/7ec248be13ba44b40923ba800e142f48_23.png)

545，第一个价格就是它的最高价就是15155啊。

![](img/7ec248be13ba44b40923ba800e142f48_25.png)

15155at啊，Next bat，15155or higher，就是买的要么等于154呃，15155，要么就是高于呃15155，你看他最高价是15155嘛，是吧啊，Sir next b at。

它的最低价是多少啊，最低价是14500at14500哦，l o w low了好，然后我进行一下编译。

![](img/7ec248be13ba44b40923ba800e142f48_27.png)

建立编译是没有问题的，然后我从这儿我插入信号。

![](img/7ec248be13ba44b40923ba800e142f48_29.png)

然后23啊，然后我把22给删掉啊。

![](img/7ec248be13ba44b40923ba800e142f48_31.png)

然后它就有了吧，你会发现它走的是这个最低价吧，他走的是最低价。

![](img/7ec248be13ba44b40923ba800e142f48_33.png)

然后咱们看一下，咱们最低价还是写在第二个的是吧，就是14500写在第二个的，如果说咱们把它钓上来啊，看一下啊，调上来我进行一个编译，他还是走最低价，所以说他跟你这个就是先写哪个和，后选哪个是没有关系的。

他就是先走的最低价，然后才会走最高价是吧，你咱们再看他这个啊，他的是上涨K线，所以说它的开盘价就是减去这个最低价，肯定因为开盘价减最低价就这么点嘛，肯定比这个最高价减开盘价要小。

所以说他就会按照你的这个假设。

![](img/7ec248be13ba44b40923ba800e142f48_35.png)

因为我的这个呃最高价减开盘价是大于，就是开盘价减最低价的嘛，所以说它是开盘最低。

![](img/7ec248be13ba44b40923ba800e142f48_37.png)

然后再走最高，然后再走收盘，它是按照这个逻辑来的啊。

![](img/7ec248be13ba44b40923ba800e142f48_39.png)

如果说咱们再找一根，比如说啊哪一根呢，还是给他给包住的。

![](img/7ec248be13ba44b40923ba800e142f48_41.png)

就是咱们能演示，就是说这个走另外一个他的这个逻辑的。

![](img/7ec248be13ba44b40923ba800e142f48_43.png)

![](img/7ec248be13ba44b40923ba800e142f48_44.png)

![](img/7ec248be13ba44b40923ba800e142f48_45.png)

好找到了啊，咱们就是是吧，这根这根是基本上把前面的都给包上了，那我就从这根开始进场，然后它的编号是486，然后这根咱们看一下啊，因为它是下跌线，它的开盘价是在这。

所以说它和最高价的这个差值肯定要比它要小。

![](img/7ec248be13ba44b40923ba800e142f48_47.png)

按照咱们这个逻辑来说，你看他的这个和最高价的差值。

![](img/7ec248be13ba44b40923ba800e142f48_49.png)

比这个这个要小的话，他应该是先走高位再走低位是吧，这个时候呢咱们把这个八线编号，咱们从这486好。

![](img/7ec248be13ba44b40923ba800e142f48_51.png)

咱们把代码改一下，改成486486，然后进行一下编译啊，这个咱们也得改一下啊。

![](img/7ec248be13ba44b40923ba800e142f48_53.png)

这个486这个它的最高价是14735。

![](img/7ec248be13ba44b40923ba800e142f48_55.png)

最高价是一四，额最高价14735，14735。

![](img/7ec248be13ba44b40923ba800e142f48_57.png)

然后他的最低价是14210。

![](img/7ec248be13ba44b40923ba800e142f48_59.png)

最低价是14210好。

![](img/7ec248be13ba44b40923ba800e142f48_61.png)

然后进行下编译，嗯嗯哈你会发现他是什么呀。

![](img/7ec248be13ba44b40923ba800e142f48_63.png)

他是先平了仓吧，先是走的最高价吧。

![](img/7ec248be13ba44b40923ba800e142f48_65.png)

咱们可以把它这个代码给轮换一下啊，进行一下编译，就是不管你是哪个写到前面。

![](img/7ec248be13ba44b40923ba800e142f48_67.png)

哪个写到后边，他都是先走的最高价，这个就符合咱们这个假设了，就是这个呃high减open小于open减low，它发展为开高低收是吧，你一定要知道这个逻辑啊，这个逻辑对于你的回测其实很重要。

如果说你回测有差异的话，就算你回测没有差异，你得知道它的逻辑是什么，尤其是你用一些大的周期来做的时候，你必须得知道它的逻辑好，这个说完，咱们就说这个经销商委托了这个easy language呢。

它是非常接近这个口语的语法，所以说他竞争章委托其实并不是很复杂，但是你也要知道他的逻辑呃。

![](img/7ec248be13ba44b40923ba800e142f48_69.png)

在这儿我就直接在代码里边给大家演示吧。

![](img/7ec248be13ba44b40923ba800e142f48_71.png)

把上面用大括号先给注释掉，好比如的话，If for close，大于A，啊我又给它用成这个中文了，大于average clothes，20then，这个then后边是一条执行语句是吧。

当然你也可以用begin啊，end嗯嗯的，然后这个里边我进行买卖操作，首先你的动作要么是sell，要么是sell sht，或者说是by和by to cover对吧，sell是平多仓的意思。

by是开多仓的意思，然后sa short是开空仓的意思，by to cover是平空仓的意思，你首先要知道这个四个的意思，然后呢它的写法呢，你想by和SR都是单个的英文单词，这个没得说。

然后sr shirt呢你可以整体写，就像这个你也可以把它拆开来，像这样来写，它是也不会有问题的，包括by to cover，By to cover，也可以拆开来写，当然也可以并起来写啊，这个都没有问题。

这是你的动作，然后by和这个shell sht咱们要单独说一下的，尤其是他们反手的时候，你可以把它理解为反手是一种状态，如果说加仓的话，它是代表数量的相加，什么意思，如果说我刚持有零首仓位，我掰一手。

你的仓位就是会变成正一手是吧，然后我再掰一手，你就会变成了两手，对不对，这个时候如果说我shell shirt1呃，shell sht1首的话，就是shell shot啊，然后一手一首它就会变成什么呢。

它就会变成一首，他做的动作其实是先把上面的两手先平了，然后再开一手空仓啊，如果我shell shot，我再加一手，它就会变成二首啊，这个反手这种情况咱们之前也讲过，这一点是你需要注意的。

然后他后边一般跟着的by也好，sell 也好，或者cell cell，就是这个by to cover也好，后边跟着的一般是数量是吧，数量呢可以省略，你像咱们上面写的，其实就没写数量，如果说你省略了的话。



![](img/7ec248be13ba44b40923ba800e142f48_73.png)

它其实默认是一手，但是这个一手是哪来的呢。

![](img/7ec248be13ba44b40923ba800e142f48_75.png)

你想在这个属性属性里边固定手数这一首，如果说你把他这给改了，它就会变成两首的啊，比如说啊他不是变成两首啊，是变成你所改的数值数值。



![](img/7ec248be13ba44b40923ba800e142f48_77.png)

如果说我把这改成十，你想这就会变成十了吧啊。

![](img/7ec248be13ba44b40923ba800e142f48_79.png)

这个就是呃你的属性，这设置多少。

![](img/7ec248be13ba44b40923ba800e142f48_81.png)

它会到这来找我，再把它改成一啊，它还是一是吧啊。

![](img/7ec248be13ba44b40923ba800e142f48_83.png)

这是你需要注意的地方，你可以省略，但是它其实并不是默认一首，它是默认跟你设置的属性值是一样的，当然那个舍性属性值的默认是一首啊，然后他这个手术你不能光是个一啊是吧，或者光是个十啊。

你应该后边跟一个单词是shell或者shells啊，share是分享的意思，share啊，或者shells是这个也可以用这个contract。

c o n t r AC t contract或contracts，这个几个都可以嗯，都随便，当然也没有单复数之分啊，你不能说我买十首就用contracts，然后买一手就用contract，没有这个啊。

你买十手也可以用construct，然后你买一手也可以用contracts啊，shell是一样的好，这个是这个解释他这个后边跟什么呢，跟你的买卖的位置嗯，就是我是在单根八线买呀，还是在下一根K线买呀。

还是在下一根K线买呀，你可以在单根八线买，就是this b，Close，你可以这么来写，这个编译是没有问题的啊，就是你像这样编译成功是没有问题，但是啊你这个this8你指后边只能跟close。

其实它是有这个呃，就是忽略字的，at on也好呀，这个at也好呀，是吧，Hat close，这个都可以的啊，这个编译没问题是吧，我这个往上拉一拉啊，都是可以的，当然这个忽略字可以被省略掉。

这个后边它是你用this bar的话，后边只能是用clothes，你不能用open，会报错的，看见没有，会报错的，this bar呢呃跟着的肯定是close this by，也可以跟什么是相等的呢。

是today today，这是以前MC的用法，就是today today，不是代表今天，是代表当前的K线，你编译一样是可以编译过去的啊，这个一般是用在哪呢，就是这个就是一般回测的时候。

不建议你这么去写啊，就是第一个你就算用this bar，你也别用这个today啊，你就用this SPA就可以，这是呃被这个this bar给替给替代了，另外你在回测的时候。

你不要用这个少用this sp，因为如果说你这儿没有加上intro bar，generation等于true的话，你不能在这个，如果说你没加上这句话的话，你不能在你的K线内进行交易的是吧。

你不能在这个K线内啊进行这个交这个交易的，就是不能在K线内发送委托的，如果说你打开了这个在实盘的时候，你可以进行，因为它是会接收到一笔一笔清的过来，你可以在这个内部进行这个交易的，你进行交易。

你可以用this bar clothes，因为这个时候这个clothes啊，就会代表它随时变化的这个价格，随时变化的，这个价格就是传过来的，这个价格会都是用这个用clothes来获取到的。

嗯你可以这么去写，但是在通常在你回测的时候，如果说你没打开这句话，你回撤的时候，你用this bug close，因为咱们执行的逻辑是什么，这根K线走完了，它才会执行一遍这个代码，你走完了这根K线。

你才知道它的收盘价呢对吧，在实盘的时候，你不走完这根K线，你不知道他是收盘价，他也不会执执行这一段就是这段代码，你这个执行这段代码，你就需要它走完这根K线，然后你还需要在他的这个收盘价去买，那买得到吗。

肯定是买不到的呀是吧，这就是一个是先有鸡还是先有蛋的问题了，就是你有收盘价，我才能执执行这段代码，我执行这段代码，我获取到收盘价了，我再在这根K线上买，我就买不着了，这根K线已经结束了呀，对不对好。

所以说当然他可以你像咱们这个代码，就是他可以在这个回测的时候去使用，但是它就涉及到了，其实叫未来函数这个问题了啊，不建议大家这么去用，当然你可以这么去写，在回车的时候就是this bar close。

然后呢一般咱们都用next bar，next8啊，next吧，next b比如说next bar close，哎这个咱们编译一下它是有问题的啊，next bar你不能呃就是直接跟这个close啊。

你不能直接跟clothes，因为我this bar clothes，就是其实它就是我就收盘价，就作为你的这个开就是开仓价格嘛，你这个价格其实是什么呀，我在下一根K线买用这个clothes。

这个clothes是当前的这个收盘价对吧，你看我这一根K线走完了之后，我才执行一遍这个代码，这个close是代表着这个价格，那我用这个价格你就必须得涉及到委托类型，你必须得涉及到委托类型。

我是用这个价格比它高呀，还是比他低呀，那用这个价格是发现价单呢还是发停损单呢，对不对，是发现价端呢还是发听损单呢，还是比他高呀，还是比他低呀，所以说后边一般都得跟着你的委托类型，比如说我stop。

你看这个变形就没问题，如果limit，啊这个编译也没有问题啊，包括ho hi higher，就是比它高，就是用我当前这个收盘价价格，或者比它高的价格去发送委托是吧，也没问题。

或者or lower去发送委托价格，他也没有问题，所以说这个你的位置后边必须得跟上你的价格，以及委托类型，如果说你bar的话，后边只能跟clothes，你next bar，这是next bar。

是咱们经常用的啊，Next bar，你这最好是写一个忽略字，这样容易理解next b啊，我在下日K线at就是用什么价格呢，用我clothes，或者比我当前收盘价更低或者更高的价格。

或者用我这个价格发停止单或者发限价单，逻辑你要捋顺了啊，然后这节课呢咱们就先到这，下节课给大家讲什么是停止单，什么是限价单，还有市价单啊，这漏了一个啊，还可以market。

啊这个at close next bar应该不能用at clothes啊，应该用at market next bat market，这个就可以了，就是试驾单直接去发，因为我用市价单去发，我就追求成呃。

立立刻成交，我不需要价格啊。

![](img/7ec248be13ba44b40923ba800e142f48_85.png)