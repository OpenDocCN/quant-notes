# A股如今行情,都是历史重演？Python找出A股相似K线,量化验证股价未来会怎么走？用代码一键计算K线相似度,揭秘为何A股行情总让人似曾相识 ｜ 量化投资邢不行 - P1 - 量化投资邢不行啊 - BV1aPBXYvENm

你周围有没有一些做交易很厉害的朋友，他们可能看一眼某个股票目前的K线状态，就好像能大概预测出后续的行情，虽然也说的不是百分百准确，但都能说个7788，究其原因呢，就是因为这些朋友他们在市场上面待了很久。

有着很丰富的交易经验，之前啊或多或少都见过类似图形，大概知道后面会怎么走，所以呢就有了一定的预测能力，准确来说啊，这应该是经验积累的结果，而不是真正的预测未来行情，而如果你的交易经验不多。

或者是纯小白呢，也确实很难在短时间之内用相同的能力，但是呢也别灰心，经验不够，就用科技来弥补，比如说面对任意一段行情走势，我们可以借助派森程序，帮你找出历史上面和这段K线最像的走势。

并去分析他们之后的表现。

![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_1.png)

本期视频呢我们就来做相应的研究，看这样操作对实战是否有帮助，以及是否可以据此构建一些交易策略。

![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_3.png)

![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_4.png)

大家好，我是专注于量化投资的，行不行，2024年国庆节前后，大A可以说是经历了一轮完整的牛熊，甚至还出现了大盘开盘涨停的情况，让很多人直呼活久见。



![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_6.png)

也有人来问我啊，这段行情怎么看，说实话呢，在我印象当中，我也没见过这样的走势。

![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_8.png)

但记忆可能出错，数据却不会骗人，最好的办法还是要从过去的指数K线当中去找。

![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_10.png)

找有没有和最近相似的行情，这些相似的行情之后又是怎么走的。

![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_12.png)

正好呢有同事跟我说啊，在支付宝里面就有个类似的功能叫做相似K线，我就顺着他的指引去看了一下。

![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_14.png)

乍一看还是挺不错的，只要你从中选择某个股票，它就会告诉你在这个股票的历史上，和最近30个交易日K线最相似的是哪一，同时呢也在所有股票的历史K线当中，找一段最相似的形态，并且还会展示相似K线。

后面几天的走势是什么样的。

![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_16.png)

对于一个免费的功能来说啊，其实已经做的很不错了，但对于我们量化加交易来说呢，看到这些功能就会想知道它是如何去计算的，再把它复现出来，为自己所用，那么在翻阅了一借研究资料之后呢。

别说还真被我们找到了复刻的方法，并且我们还在支付宝这个原本功能的基础上面。

![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_18.png)

做了全面的升级，整理出了一份极其全面的文件，包含了需要用到的数据代码，各类教程文档，如果你需要的话呢，可以加屏幕右下角或者置顶评论区，我的微信都是可以直接免费发给你的，那接下来呢。

我们就带着大家一起开始，本次寻找相似K线之旅。

![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_20.png)

要想在茫茫多的K线之间，找到相似度高的组合呢，我们就需要借助一个指标来帮忙。

![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_22.png)

这个指标呢就是皮尔逊相关系数，大学里面学过概率论，统计学之类的，同学呢，应该对它不会陌生，真是一个比较基础的概念，没学过的朋友也不用紧张，听我简单介绍就肯定可以理解。



![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_24.png)

这个皮尔逊相关系数呢，是用来衡量两组数据之间的线性相关程度，它的计算公式呢是这样的，别被吓晕了，关于这个公式我们不用理解的太深。



![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_26.png)

会用就可以了，excel里面就有现成的函数可以去使用，比如说针对这样两组数据。

![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_28.png)

你用这个公式就可以求出它们之间的相关系数，在Python中呢也有现成的计算函数，只要一行代码就可以解决，这个指标的用法也很简单啊，我们来看这张图，如果这几个点呢可以直接连成一条向上的直线。

我们就可以认为它们的相关系数是一，也就是说当X的数据增加的时候，Y也会按照相同的趋势增加，如果这几个点的分布呢是类似图中，环绕在直线的周围，则说明它们之间是正相关关系，相关系数呢是在0~1之间啊。

围绕的越紧，那么指标就越接近于一，与之相反啊，如果是向下的直线，那么就是负相关，如果这些点之间毫无关系，那么它们的相关系数就是零，了解了相关系数之后呢，就可以借此构建出计算K线相似度的公式，它是这样的。

根据公式我们可以知道相似度的数据啊，它是在-100~100之间波动，具体的用法呢也很简单，比如这是某股票在某段时间的K线图，A它的走势呢是这样的，下面这张图呢是K线图B，它和A的相似度啊高达98%。

从图形来看，他们的走势也确实很接近，再来看这张图C啊，它和A的相似度呢是75%，从走势来看确实给人感觉有点像，但又不完全像，再比如这张K线图D，它和A的相似度呢是只有0。05。

我们一眼就可以看出它们之间是毫无联系的，通过以上案例我们就可以发现啊，相似度越接近100%呢，K线之间也就越相似好，那么我们就可以尝试着用相似度去寻找。



![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_30.png)

历史上相似的K线了，比如我们想以上证指数，最近20个交易日的K线为基准，找出它在历史上和这段行情最相似的K线。



![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_32.png)

理论上你用excel也是可以做相似度的计算，我们呢就直接编写了Python代码来辅助计算，如果你需要这个代码的话，可以加屏幕右下角或者置顶评论区，我的微信都是可以直接免费发给你的。



![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_34.png)

好，那么我们点击运行一下，看看结果如何，程序运行结果呢就如图所是。

![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_36.png)

我们可以看到在上证指数的历史上，每个不同阶段的K线和最近20个交易日，K线的相似度关系是这样的，虽然我们之前一直说没有见过类似的行情啊，但好像计算出来的相似度在0。9。



![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_38.png)

也就是90%以上的情况也不少，足足有57次。

![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_40.png)

其中相似度最高的呢是，2016年的7月29号到8月25号，这一段时间高达96%。

![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_42.png)

把这两段的K线放在一起看一看，它们在走势上确实是比较相似的。

![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_44.png)

看来我们自己的经验和记忆，有时候确实会出现偏差，一些可能历史上存在过的K线。

![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_46.png)

如果不用数据和代码把它复现出来的话，就会被我们自然忘却，变得毫无印象。

![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_48.png)

然后呢我们也可以稍微修改一下代码，改一个参数就可以，比如可以去看一看最近指数，30个交易日的相似K线是哪一段时间。



![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_50.png)

结果呢是这个样子的，和20的相似K线啊就完全不同了，当然你可以拿到代码之后，调成自己感兴趣的时间段去做观察，类似的操作我就不多加赘述了，我们重新来看最近20个交易日的相似K线，其实找历史上的相似K线啊。

它根本目的呢还是想以史为鉴，去看看那段时间您后续发生了什么，以此来给我们当下的交易做出指导。

![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_52.png)

而且我们不能只单纯的看个例，在历史上让所有相似度大于90%的情况。

![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_54.png)

我们都应该去看一下，如果我们后续买入并持有未来的一天，五天，十天20天，他获取的平均收益大概是有多少，我们赚到的钱的概率又有多少呢。



![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_56.png)

要做这样的计算也很简单，我们只需要激活代码中的这一行，然后再运行一下程序就可以了。

![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_58.png)

运行结果呢如图所示，在上证指数历史上，总共有57个阶段的K线，和最近20个交易日K线相似度很高，在90%以上，如果我们在这些K线出现之后的第二天，开盘后去买入上证指数，那么上证指数第二天上涨的概率。

是63。16%，持有一天的平均收益呢是0。18%，第五第十天的上涨概率也都在50%以上，但是收益率呢都可以几乎忽略不计，持有20天的上涨概率骤降到43%，收益率呢也来到了负的1。39%。



![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_60.png)

由此可见啊，这个形态并不一定代表着只有收益没有风险。

![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_62.png)

有这样的数据，结果呢也可以给我们一定的底气和参考，去决定要不要做这样的交易，好到此为止呢。

![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_64.png)

我们所有的研究都都是基于上证指数进行的，我们当然可以把研究扩展到个股。

![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_66.png)

因为大家更多关注和交易的还是个股，比如我们可以随便找一个股票一段时间的K线。

![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_68.png)

我们不仅只看这一只股票的历史数据，我们是看所有股票的历史纸上面，有没有和它相似度比较高的情况，再去统计这些走势，后续的表现到底是如何的。



![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_70.png)

我们就以茅台为例，它最近20个交易日的K线呢是这样的，看到这个图，你能想到哪一只股票的哪一段K线呢，欢迎在弹幕里面留言，我们此时此刻站在这个时间点上，就想去知道之后几天茅台的价格会怎么走。

是可以直接进场呢，还是等它跌了再买呢，但谁都不能预知未来，所以我们可以在所有的股票历史上，找一些和它相似的K线，看他后面都是怎么走的。



![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_72.png)

以此来给我们一点参考，其实这个思路和技术指标中，归纳并整理特殊的形态是比较类似的，只不过呢我们的方法可以找到任意一种，随机相似的K线。



![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_74.png)

而不需要和技术分析一样，做各种特殊情况的归纳，如果要做这样的计算呢，你用excel或者肉眼观察已经无能为力了，毕竟如果一段一段的K线数过去，全市场5000多只股票是完全不现实的。



![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_76.png)

这个时候呢，我们还是请出祖传的Python代码相关功能啊。

![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_78.png)

我已经帮他准备好了，你只要根据文档中的流程来操作，就可以跑出想要的结果，那我们现在运行一下代码。

![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_80.png)

看看结果如何，代码运行结果呢如图所示，我们找出了从2007年至今，A股历史上和茅台最近这20个交易日，走势最相似的三段K线。



![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_82.png)

并且用代码把他们的K线都画了出来啊，不仅可以在图中看到它们相似度，分别是97。7和97。6，还可以了解这三段K线对应的是哪只股票，哪几天的交易日期，我们甚至还把这几段K线，后续的走势也画了出来。

供大家做参考。

![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_84.png)

当然如果仅仅是上述功能啊，支付宝的免费指标里面也是有类似的，虽然没有我们做的这么全面。

![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_86.png)

但也不值得我们去夸耀，我们还尝试了其他的功能，比如我们发现历史上和这段茅台走势。

![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_88.png)

相似度最大的1万组K线，它们相似度最低的也有92%，也就是说，这1万组K线和茅台这段时间的走势都很相似，那这1万组K线未来整体表现是怎么样的呢。



![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_90.png)

所以我们计算了这些K线出现之后，未来一天五天，十天以及20天的上涨的概率和平均的涨跌幅，大家可以自己仔细观察。



![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_92.png)

所以通过这样的工具呢，你首先可以去肉眼看一下，最相似的几个股票形态，未来一段时间的表现，还可以通过大数据去看一下，前1万名和他都比较相似的股票，未来整体的表现又是如何的。

这样确实对你做出交易决策是有一定帮助的。

![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_94.png)

当然我们这里只是以茅台为例，实际上你可以自己选择其他的任意股票，任意时间段的任意几根K线做走势的研究，我们代码是完全可以实现这些功能的，就看你怎么去使用。



![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_96.png)

如果你需要的话呢，可以加屏幕右下角或者置顶评论区，我的微信都是可以直接发给你的。

![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_98.png)

好到了视频的最后呢，不妨再给大家透露一个小秘密，既然我们计算相似K线啊，开高收低，价格的相似度，是不是可以把成交量因素也一起融入进去呢，这样是不是会更准准确呢，又或者我们是不是可以把一些技术指标。

如均线之类的相似度也融合进来，找出更广泛意义上的更相K线呢，这些研究呢时间有限，我们就不深入去聊了，但是完全是可以做的，也是非常有价值的，感兴趣的朋友可以找我一起讨论，也可以问我要的数据和代码。



![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_100.png)

自己去把玩，修改，这些实验起来其实并不难的好，本期视频呢就到此结束。

![](img/b6c4e66aaab3e4b8cd151a0522b6a2d8_102.png)

感谢大家的点赞，投币收藏和转发，我是行不行。