# 26集全！B站目前唯一能将【量化交易】讲清楚的教程！用AI从零开始打造你的交易机器人！大数据量化交易／机器学习／Python金融分析 - P11：第二课【AI量化交易】第二章 交易数据形成的价格 - 机器学习教程 - BV1w4421S7Zx

Hello，大家可以听得到吗，确认一下，在对话框里回复一下，打个一或者，OK我们八点钟准时开始哈。

![](img/12d14db7cd7a337cb35d5838541b418b_1.png)

![](img/12d14db7cd7a337cb35d5838541b418b_2.png)

![](img/12d14db7cd7a337cb35d5838541b418b_3.png)

好的嗯，那同学们我们就开始今天的课程，然后嗯好啊，来的同学在在对话框里打一下，然后知道一下你们在听，现在有15个同学，除去助教老师跟我还有13个同学，OK好，相比第一次课好像少了很多人吧。

好OK那就现在开始哈，然后嗯嗯这三个小时是这样的，嗯首先要跟大家爱，就是我看了大家第一课的feedback，然后有一些东西要跟大家讲一下，然后是我们来review一下，就是第一次作业。

然后以及有哪些可以改善的，然后嗯今天主要讲的知识点，其实是接着上一节课我们讲的市场微观结构，然后那么接下来就是说我们今天就要用交易所，官方提供的这套API啊，去帮助大家去嗯。

怎样去获取我们上一次得到的原始的tick数据，那这是这是我们今天的目标，我们要完整的理解，整个交易系统的数据是怎么产生的，然后还有第四个是上一期嗯，上一次的一些面试题的回答，然后包括一些新的面试题。

因为我看到我在微信群里，好像有不少同学还在讨论相关的面试题对，OK然后首先是feedback，然后就是呃第一点，我是希望之后大家就是在每次交的作业啊，最刚开始以后就是把每次作业难度评一下分。

就是0~10分，十分是很难，然后零分是很容易，然后大家就按照自己的尺度去评分，然后再写一下，就是大家在这个作业上花了多少时间对，因为我不希望这个课程占用大家太多时间，就是如果说作业太难的话。

就是说那我们就要考虑把最核心的部分，可能是说作业不需要放到作业当中去完成，而是留留做成项目，然后让学有余力的同学主动去探索，然后还有我看到第二点feedback是嗯，很多同学就是说在coding的方面。

可能会有一些问题，有的说是呃没有学过编程啊，那选这门课也是有点厉害对，然后那这一点就是我觉得嗯没有问题吧，就是如果刚开始的时候起步慢一点，我们可以慢慢就是把它跟上来，但是就是最重要的是。

就是说尤其是跟上这个节奏对，因为规划啊，然后第三点就是说嗯，大家提到说这门课也没有接触到AI的东西，如果说OK不要着急，就是会有，但是就总不能刚开始时，我们直接就去说讲神经网络，去讲预测。

那么就是得到了这样的东西，大家也不知道，也不会知道它的物理意义是什么，或者说就是我们怎么知道是不是过拟合，就是我觉得还是大家嗯，就是说至少在五一节前的话，我会帮助大家。

就是说去完整的说从数据采集包括之后啊，接下来两周是重点关注的，就是说怎样去建立一个回收系统，然后搭好了这样的基础之后，其实大家我觉得就是说我们把前面基础打好了，在后面的时候，我们就可以逐渐的就是说。

不管是从最基本的线性模型，然后到非线性模型，然后说加上你想要用各种所谓强化学习，或者说什么神经网络段预测预测，我觉得都OK，但是前面的话我觉得还是要给大家提供好嗯，整个流程就是把整个量化投资。

最前面最基础的部分给打好，因为呃说实话就是刚开始工作的时候，可能大家前面半年就不管是在国内外哪个房子，你可能都需要去做很多的数据信息，那么你因为我们现在倾斜数据很简单，就是其实已经是结构化的数据。

那可能正式工作的时候，还会处理非结构化的一些数据，那为什么要做这样的一个事情呢，那可能如果说作为一个小白，对于市场没有任何了解，那直接就是说去怼模型一些策略，但说实话啊。

我相信就是说有有物理或者数学背景的小伙伴，他做的会比现在所谓的框架做的好很多，但事实显然不是这样的对，就就就包括CCC，导致这些顶级的放在先招来的，新招来的就是顶级的深度学习研究员。

那也需要一段时间去理解这个市场，那我希望大家就是说，在前面课程没有那么紧张的时候，就是不要说太过放松，就是呃就是该做的事情还是要去做，无论是提到的阅读的材料，还是说嗯相关的coding skill。

然后对，因为只有我觉得把这些东西做完了之后，或者说做好了之后，我们才有能力去接下来做后面的事情，因为嗯从今天这节课会涉及到一些C加加对，然后就是说嗯应该说主要是C加加吧。

就是说教大家去用C加加去接这样的交易系统，就是去不去接交易系统，今天我们不讲交易系统，就是我们讲去接航天系统，行情跟交易系统后面会讲到，他们是就是很多在CDP内部是非常类似的对，然后包括接下来两周。

可能是就编程的工作会比较多，预计大概可能会有1000行的一些，至少是1000行的代码对，就接下来两周，就是因为没有考虑到是利用到五一节的时间，大家可以尽可能的去把这个非常heavy的工作。

在五一节把它给搞定，这样为我们后面的课程打下良好的基础，对嗯那好，然后我们所以说就是说AI这部分，我觉得大家不用着急，但我至少说得把嗯就是给大家打好基础，然后说如果大家已经有一些AI的基础。

想要去自己探索，那我觉得有这样的工具，那应该大家就可以做很多的尝试，就不一定要说跟着课程的节奏对，嗯然后然后接下来我们是就是呃，就是看一下上册作业吧，就是嗯就是嗯首先是就是我觉得我要强调的。

就是说exceptional handling，就是说在异常情况下要怎么处理，一个一个一个是集合竞价，那上一次课程是没有讲到了，集合竞价就是我们在期货期货当中会观察到，就是说大家看08：

59分为什么会有，就是有教育处理，但事实就是就可能8。55到，08：59分的时候会去进行集合竞价，那嗯这个时候我们叫market before market open，在开盘前我们要做集合竞价。

这个是什么意思，集合竞价说我们不产生成交，但是我们会买卖双方，就是大家都会去挂单，可能会去说嗯，我我我看涨，那我就去我就挂在上面，那什么时候成交呢，就是交易所会根据成交量最大的一个原则，就是说在8。

59分，我确定在怎样的设定一个怎样的价格，能够保证多空双方成交量是最大的，那么这个我们这就是一个开盘的，就是就是就就就就是在开盘之前，产生这样一个价格，就是集合竞价对。

然后然后所以说这个是大家肯定要注意的，就是为什么要有一个就是在rock to tick的部分，就是说嗯就是在我们目前课程部分当中呃，我觉得就是这本就是在盘前的信息，可能需要把把大家就是过滤掉。

对就是九点钟之前的数据，我们可能不是很需要对，然后还有一个就是说呃，呃INTRACTION就是在盘中的集合竞价对，嗯可能现在不会涉及到，但是之后在期权的时候会涉及到。

就是嗯为什么会有这样一个盘中集合竞价，其实含金老总就希望大家冷静一点，不要把牌面打那么夸张，大家还记得就是嗯18年还是19年，一一天齐全192倍对，这是很夸张的一件事情，对那就是在盘中结合竞价。

就是说我只价格波动到一定程度，比如说涨了50%的时候，那这个时候交易所有人说，那可能是说由于市场参与双方不是很冷静，那就有3分钟的集合竞价时间，还是跟开盘一样，大家去嗯都是去不断去出价。

但是这个时候不成交，我们只会看到就是在盘口两边的价格，就是单子会越来越多，越来越多，当然也有可能越来越少，因为有人可能会撤单，对那就是呃有有这样一个集合竞价的过程，就是说希望大家就是处理一下。

就是现在可能现在不需要处理，但以后涉及到期权数据肯定是要处理嗯，就是观察一下，那可能会有连续的时间成交量为零，但是哦然后盘口肯定就是保持盘口的价格，保持不变数，或或者说价格也有一些变动对。

那这个时候希望大家去注意，不一定是数据有问题对，然后嗯对，然后第二个是要说的是，就是在夜盘，夜盘的过程，就是哦我自己有一个小小的trick，因为就是典型的键盘，其实就这四个时间点。

那嗯一般来说就是说你为了你，你有时候可能要去判断，说这个这个合约是23点还是23点，30来结束还是一点，但其实有时候不一定要一个个去判断，因为嗯很很典型的来说，一般来说比如说23点结束的合约。

他的最后一个tick，一般不会超过23：00：00500ms，所以我这边取一个零一秒，那我只要用小于零一秒，我就可以把嗯500ms，那个最后一个tick会把它保留，为什么要保留，这个可能也是个人的习惯。

因为这是最后的一个tick，其实这一个tick对于价格，或者说你之后的预算来说，并不是那么care，就是那么重要，我一般个人习惯是保留的，那也可以说你你就严格那段时间去切，你就去掉最后一个体格。

其实无所谓，因为这并不会影响你整个的交易额，就是整个回收过程中的准确性，对在这四个时间段嗯，就是我还是希望就是大家这个这个东西呢是事，事实上就是说嗯夜盘的政策，就是夜盘有没有集合竞价这些东西。

还是希望大家自己去交易所官网上去，了解一下啊，就是我课程其实能给到，就是说我帮助大家去引导方向，然后有最核心的概念会告诉大家对，但是嗯就是很多功课是需要达到自己，课后去做的对。

然后第三点要提到就是live和limit down，这样一个就是涨跌停的时候，但是没有可能大家处理的数据没有看到涨跌停，那之后就这周结束的时候，再给大家找一份有涨跌停的数据。

然后大家看一看这个中间是会存在怎样的情形，就是你我们之前相同的合成分钟嗯，嗯合成分钟，或者是嗯就是更更低频率的K线的时候，会不会出现这样的问题，就是嗯就是大家应该是观察一下。

就是嗯怎样判断一个数据是不是出错呢，就是显然说是买一和卖一都是零，但是肯定是有问题，但是涨跌停的时候，如果说只是涨停的可能嗯涨停的话，那我肯定其实是嗯就是有无限的，有相对多的买单。

然后卖单的人这个价格可能是零，那这个可能是正确的，所以大家需要去特别关注一下，在涨跌停的时候，这个盘口到底是怎么样的对嗯，然后然后我这边挑了两份作业，然后跟大家来看一下，就是同学们完成作业的情况。

然后大家也可以看到其他同学，在这门课上大概付出多少，然后这位这位这位同学是嗯，如果好，OK我，Oh my，我的鼠标去哪了，OK我先暂停一下，对嗯这个是随机的，然后这个是我们表扬一下，是这位啊嗯对。

表扬一下这位同学是本次作业第一个上交的，对I让我看一下他的名字，我觉得一定要把他的名字给念念出来，这样这样就是鼓励一下大家，对我们要有这样的一个正向反馈的机制，嗯第一位啊，如果记得不错的是刘宁谦同学。

然后我们大家给他点个赞，对啊，他是什么时候提交啊，2020年4月3日23点呃，54分，我的天呐，就是这位同学写代码写到了12点对啊，还有就是作为一个count的良好修养对，Okay um，然后好。

我们来看看他的作业嗯，pd set option就是然后它也是一个notebook形式，然后我们看后面吧，就是，OTM对，连这位同学我觉得还是挺好的，至少真的是在去看这个，每个数据到底是什什么意思，对。

就这这个OTM应该是就是啊期权期权部分对，因为我们期权部分可能有叫叙事程度，但是好像我在CTP的数据里，还没有看到这里来有任何意义，所以一般来说做期货的话，就是说可能大家就直接。

就是说这些栏目有些不需要的，我们就可能就直接就JOP掉，就不需要了，对包括结算价，然后客户对等等，然后对的，然后，对，这位同学，然后这个部分他没有实现，这对就是强调一下是为什么要有这个函数。

就是说哦我们认为不是所有的数据都是有效的，但这部分其实应该要做的事情，就是说一个是嗯一个就是说就像我刚刚说的，如果这个数据是错误的，错误的就两个都是零对，那那那就ask别都是零。

那我们可能要把这样的数据给过滤掉，然后还有一个就是说盘前的集合竞价的部分啊，有时候我们是不希望他嗯，就是不希望他会出现对嗯，那所以这部分其实说嗯，是有一些偏个人经验的东西。

就是你看到出现数据意外的情况越多，你可能会不断地把这样的规则，就加到这个里面去对，然后对这部分我觉得写的挺好，就是他写了这样一个就是时间，然后他把它分了几种对嗯，然后有一个小小的建议。

就是最好就是嗯因为symbol的话，其实因为我们每个合约，比如说螺纹钢前面是2B，那其实用2B来来做法，但是可能处理会方便一些，因为你只需要把每个合约当中的，就是嗯英文字符给提取出来的。

就是他的那就是它的这样一个合约名字，这样可能我个人习惯是这样，当然这样也是OK的，然后对，然后take me list，哇，这个逻辑写的有点复杂，但是我应该是他完成。

所以他做的办法是ADD one in，就是一分钟一分钟去加对，OK然后就whatever就是，然后之后这门课结束的时候，会不是这门课结束，就是这周结束，待会就下课的时候，把我自己出了一份数据。

或者说交易所就是官方的一份数据，然后大家可以去对比一下，然后事实上在微信群当中看到，已经有同学在这样做了，我觉得很好，对自己其实是及时去验证嗯，OK这是一种方式，然后嗯然后我还随机挑了一位同学。

嗯嗯这位同学对，就是我看到我们助教很认真了，然后就是他每一个每一个同学作业，他基本上都写了很多的，就是很多的反馈对，然后OK这个很棒，这个这个同学是自己做了research。

就是对就是知道有那些那些交易所，我觉得很好对，然后这是合约，OK也就是说这部分就是说大家也可以看看，就是其他同学在用简易处理方式，然后是不是有相同的经验，也就是能够获取一些经验。

其实对我个人包括也在看同学们的代码，也是在想着说，OK是不是这个写的挺好，我是不是也可以去借鉴对，加上下午排creatic times，它是用这样一个函数嗯，这个OKROTTK，talk to me对。

其实这个是我比较想看到的一个答案对，就是RESAMPLE对，因为上次提到就是用这个东西嗯，那其实然后对，然后我再给大家看一下，就是嗯因为因为我说这这个简单的一个函数，不仅仅说是是希望大家做完。

然后我不知道啊，上一节课有多少同学就是拿这个脚本去处理了，给了二零嗯，20年2月份的数据对，这不是后来我又给了大家一份，整个2月份CCTV的数据大概是好几个，应该是4344个交易所里面对。

然后然后或者有尝试这样做的同学。

![](img/12d14db7cd7a337cb35d5838541b418b_5.png)

麻烦你再在这个框里打个一打，打个一，我来看一看有多少人做了这样的事情，对对对，回复一下啊，对对对，不不会一个都没有吧，就是因因为就是说处理这一份数据，显然不是我们这门课程的意义对。

就就是说如果说之后的话，这边是5年的数据，我们之后回测肯定是希望有比较长的一个，训练时间的维度对，那我们肯定要把5年的数据都拿过来，我不可能说哪一天的数据就做这样的回复，所以所以就是说。

如果这个时候还没有做的同学嗯，那反正在回测系统的过程当中，你也得把这个数据这份补上，因为不然到时候，别人可能就是拿5年的数据来回测你。



![](img/12d14db7cd7a337cb35d5838541b418b_7.png)

你到时候可能只能拿一天的数据来回测，那我觉得这样可能会有点尴尬对嗯，OK然后然后就是我我给大家就是看一下，我是怎么来处理这样的，还有数据的对嗯。



![](img/12d14db7cd7a337cb35d5838541b418b_9.png)

嗯首先就是对，就是说就是哦还有提到一点，就是说我个人的习惯是保留us跟big price。

![](img/12d14db7cd7a337cb35d5838541b418b_11.png)

就是为什么要这样做呢，就是因为我们现在在考虑，一分钟直接成交的时候，嗯就是说如果频率比较低，我就直接成交，就是我们叫叫market，就是试驾就成交了，但是但是但是有的时候，就其实我自己在做测试的时候。

会考虑说价格是不是一定能够cross，就一定能够成交，那么这个时候就要看盘口，就是说我希望我的单子只有在跟，比如说我要买一手，那我只有我的价格大于等于对价，那就是大于等于卖一的价格的时候。

我才会去考虑成交，所以我个人的习惯是在做这样的一个呃。

![](img/12d14db7cd7a337cb35d5838541b418b_13.png)

take two minute的时候会去保留一个beat price对，所以虽然我没有，就是我这边没有close price，但是我会保留us and beat对，就open hello。

Clothes，就这部分在回测下一部分的时候，我给你讲对，其实我希望大家用的是RESAMPLE对，然后就为什么要这样来做对，然后自己习惯是就是哦我要算一下，就是voluated price。

就是开盘就是这样一个加权的成交价格，加权的这个就是挂单价格对嗯对，其实其实整体的结构就是这样的，就是我会希望把它封装成一个类对，然后然后这个时候就是说，然后因为我之后给到大家的合约，或者说数据文件。

是每个contract每天都有一个问题，那我希望就是说我直接把它作为一个parameter，传入这样的一个文件，然后嗯对，然后就是说这时候肯定有数据预处理，就是job collins对。

然后rock your tick时候，那就是说我希望把非交易的呃，非交易的时间给过滤掉，然后我这边是写了自己写了一个function get daytime。

然后至于这个function我可能是给了两个parameter，一个交易日，一个是simple呢，为什么呢，就是说我们强调说在比如说在今天这个时候嗯，没有夜盘了啊，那这个时间是要变的。

所以所以它不仅仅是一个symbol函数，它也是一个交易日的函数对，然后用这样的时间把它过滤掉，那我就得到了这样一个，只在交易时间内的一个数据文件对，然后我在保存的时候，为了节约磁盘。

然后用来把它压缩了一下，然后是take to me。

![](img/12d14db7cd7a337cb35d5838541b418b_15.png)

然后就是说嗯就这是这是一个简单的，就是说写写就是给了大家一个notebook。

![](img/12d14db7cd7a337cb35d5838541b418b_17.png)

然后之后希望大家把自己封装成一个class，然后然后我这样要做的时候其实就很简单，我只要不断的去考这样一个函数就OK了，然后嗯对我事实上在做的时候还会去嗯。



![](img/12d14db7cd7a337cb35d5838541b418b_19.png)

谁是脚本，就是就是就比如说这么多合约，我我我我不想说自己去拍照里面就是一个线，那我可能就是那我刚开始给到的数据，可能是大家看到是一个RAR文件，那我可能就我不想每次每个新来的一个数据。

我都要自己手动去做这样一个流程的，OK那我可能就是写成bash script，然后把它一次次的去做，然后我可能只想保留主力和次主力，那其他的合约就不需要，然后包括对于每个asset。

然后把它放到相应文件夹下，其实就是说就是大家其实这些东西都是可以，大家自己平时平时去多多积累，这样积累之后，然后自己在后面去处理的时候，你就相当于有了一个完整的pipeline，就不用每次说啊。

这个东西我要放到哪里去了，这个程序怎么又不work，就是还是希望大家保留好严谨的，就是一个，那就是有有有一个代码开发的习惯，虽然我就是相比有一些同学，我应该不是专业的程序员。

但是我觉得就最基本的就是写代码的时候，还是要注意，就是包括做好test，然后就是把代码的结构保证好，对，应该还是要去注意的对，然后然后包括就是说嗯之后有一些嗯，就是有一些就是常见的utility。



![](img/12d14db7cd7a337cb35d5838541b418b_21.png)

其实其实是希望大家就是说自己去慢慢积累，因为每个人就是要做的事情是不一样的对，然后就是嗯就是你自己数据用什么样的习惯，就包括你是用什么，你你是用CONFIG文件，还是说你用其他的配置文件。

那其实都希望大家去嗯去，这样就都希望大家去自己做好，包括说你有一些嗯时间上的function对，然后包括交易日的话，那可能为了方便，我把历史上交易日都保存成TXT文件，然后然后在时间上面其实是。



![](img/12d14db7cd7a337cb35d5838541b418b_23.png)

然后包括自己说你要知道前一个交易日。

![](img/12d14db7cd7a337cb35d5838541b418b_25.png)

知道后一个交易日，那可能都希望这些函数，就大家自己去慢慢积累对，然后然后就是刚刚就说get two day time对，那就是其实其实这个东西的话是嗯对，然后就是希望大家就是说把它封装成一个函数。

然后这样最后自己要去用的时候，你要研究新的品种的时候，你其实直接往里面加新的symbol。

![](img/12d14db7cd7a337cb35d5838541b418b_27.png)

然后传好就OK对对，其实对我觉得整体上来说，大家作业都嗯，就是基本上就觉得，我看到大部分人都是交了作业，然后助教也都批改了，主角对，还花了挺多时间嗯，谢谢我们的主角岳鹏老师，嗯好的。

那到目前为止大家有什么问题吗。

![](img/12d14db7cd7a337cb35d5838541b418b_29.png)

嗯有什么问题，现在可以尽早题。

![](img/12d14db7cd7a337cb35d5838541b418b_31.png)

就是关于作业这方面，或者说按课程的一些反馈，可以有问题，我用的是什么编译器啊。

![](img/12d14db7cd7a337cb35d5838541b418b_33.png)

这你说的是嗯，你说的不是编辑，是编辑器的嗯，Visual studio code，就是可能因为大家看到就是嗯。



![](img/12d14db7cd7a337cb35d5838541b418b_35.png)

不要去海口的服务器哈，这个这个是这个是一个云服务器，对我有很多个云服务器放在不同的交易所，然后有的是连着互联网，对，这是在互联网上没有没有什么特别重要的东西，但是大家也不要尝试去hack它对。

就是因为vs code我觉得有一个好处，就是说嗯包括在公司，包括就是个人，然后你其实就是说我只要有个笔记本，连上服务器，我就能做开发，对对，因为因为就是我自己习惯使用LINUX的环境。



![](img/12d14db7cd7a337cb35d5838541b418b_37.png)

然后一般在金融行业当中做确定，大家可能用的是下面是三个OS呃。

![](img/12d14db7cd7a337cb35d5838541b418b_39.png)

CENTOS对，就是这个可能是就是在包括在高频交易，或者说其实不一定是高频交易，是正常的，券商托管服务器，可能因为这个系统其实是偏多的对，所以说有习有学有余力的话，是最好大家就去那个呃。



![](img/12d14db7cd7a337cb35d5838541b418b_41.png)

去就是自己熟悉一下LINUX系统。

![](img/12d14db7cd7a337cb35d5838541b418b_43.png)

如果之前不是很熟悉，然后有小伙伴提到说这个代码能不能给大家嗯。

![](img/12d14db7cd7a337cb35d5838541b418b_45.png)

就这其实刚刚我觉得就是因为这是有录屏的，其实大家都已经看的差不多了，然后再给源代码，我觉得就不太好了吧，同学们对，就是就是说还是希望大家自己动手去做，因为我相信就是说如果你自己投入时间。



![](img/12d14db7cd7a337cb35d5838541b418b_47.png)

你得到代码是适配对，就是相对来说更符合你自己的使用习惯对，就比如说你的呃就是没看，因为确实编码习惯不一样，然后我也不想说，因为我也不是专业程序员出身，我也不希望说OK就是这个就是大家都跟着我。

然后用用这样的东西，那万一把不好的习惯带着大大，其实还不是很好对嗯，其实我还我还是说，这就是希望大家自己动手做去做，然后因为因为这部这部分框架。



![](img/12d14db7cd7a337cb35d5838541b418b_49.png)

就是就是应该断断续续开发有一段时间了，然后所以现在就是最近其实有东西，我应该在用C加加又再重新写了，就是包括整个的回收系统，对，因为确实有时候发现就是速度，现在可能已经到11个瓶颈了。

所以对其实嗯大家还是动手自己去写，然后自己的慢慢积累成自己的，就是自己的就是量化研究的库，然后我觉得这样子传人来说会好一些，就是因为有了数据，有了自己的研究平台，其实就没有人去限制你去做什么样的研究了。

对嗯当然是说对于专业的研究，那就是在专业团队里那看到的这段库，可能是非常复杂，就是嗯就是可能可能就是说啊，一个简单的一个数据可能都会有很多人去做，我这边可能就简单的，就是说这几十个文件就做完了。

包括包括就是KTV，大家有兴趣可以了解一下，就是嗯也是一个非常强大的，就是按时间序列的数据库，对它嗯真的是非常非常强大，就是有兴趣的大家可以去了解一下，嗯一般来说而是用在投行当中，可能大家用的会比较多。

然后现在针对个人的话，好像是有一定的，就是可以免费使用的版本对，就是当时他的语言也是比较就是tricky，就是对于我非嗯非科班程序员选手来说，刚开始学习就是learning课还是有点抖对啊。

然后专业机构当中我想说的是，就是每一个事情，可能每一个你看到的每一个目录，可能都会有很多人去实现维护，然后对，然后也会迭代出不同品牌的，那我现在肯定说我就直接上线了对吧，但是他专业肯定不行的。

那肯定就是要一个个版本一个版本的迭代对，然后还有COREVIEW，那我这边就是自己给自己review嗯，但是所以说就是这门课程是希望大家，就是告诉大家，就是说机构你现在在做在做什么事情。

然后希望大家都说慢慢培养提升自己的能力，去看看，说我能不能说，不能不可能说跟机构做的完全一样，但是我是不是可以自己简易的打出一套啊，近似于机构，或者说相对来说嗯，不要那么韭菜的一个交易系统对。



![](img/12d14db7cd7a337cb35d5838541b418b_51.png)

然后OK那就是上一门课程的东西讲到现在，然后接下来是我们看一下，就是今天的重头戏，嗯对然后现在是这个之前就是我刚才也提到，就是说啊我们在就bar的时候。

我们可能要保留B跟ask price和volume，就是这个是为了方便嗯限价单的成交，因为嗯我单词量很少的时候，比如说一首两首十首，那我可以直接假设，我就按上一根分争霸的收盘价去成交，那是没有问题的。

但是当量大到达到一定程度的时候，比如说我有100首，那其实我并不能确定是不是一定能够，在这分钟内按照我给定的价格日成交，这个这个时候你可能需要稍微做一些成交，假设就是去嗯。

不可能说你完全跟交易所真实交易引擎一样，但是尽可能去靠近，他，说我大概知道我这个100手下去，平均成交价格是多少，那这个时候你就要用到嗯，盘口的挂单就一个个去撮合对。

然后接下来其实我们这门课程当中并不会去嗯，就是说在做回测的部分，可能不太会用到其他两种包，但是我个人觉得就是说，如果对机器学习感兴趣的同学，我是强烈建议去关注一下，用这两种伴来试试看。

做研究就不是用不是用嗯，用我们之前的分钟吧，或者是tick bar，就是就是就是其实背后的motivation，我觉得也很简单，就是说嗯一个是在一个成交，如果说一个tick里我成交了100首。

然后还有一个是我十个tick，每个tick成交了十首，那对于时间序列上来说，你看到的比如说价格都是一个X0的价格，一个是X0，然后一个是十个X0，那其实这十个X0在你做预测。

还是说你你相当于说你有了十个十个样本，价格都是十，那其实跟一个样本，那我觉得这里面权重是需要大家去考虑了，那为什么就是要这样子呢，就是就是有人认为就是有人认为学长。

就是说当我嗯用一个volume bar的时候说啊，对我什么是volume bar，就是我刚开始我们之前都叫tick8，按时间去切，那接下来我是不是可以考虑ENVOLUME来切。

比如说我每成交1万首玩到制作一个吧，这个概念大家理解吗，就是我我不是按成交的时间，而是按我是按成交量去切，就是我们刚刚看到看到这样的数据里面，就是我们应该是呃，这里面是有一栏是有成交量对。

那这个时候我不按我不按时间去切二三，就是我成交到比如我们这边看到的是嗯，比如说玩每1万×10000是不是有点少了，10万吧，那比如说我到第一个10万的时候，我作为第一个班，大概对这可能已经15秒。

25秒过去了，对那第二个20万的时候，到第二个10万变成20万的时候，我再去切，那这个半是不是会不一样，那这个时候我建议大家做的一件事情，就是嗯，就是大家去自己算一下，每个班的return。

是不是相比于用tick bar来或者分钟bar来做return，更近似于一个就是独立同分布的高斯分布，就是高斯distribution，我我把这个理做做，也就是有兴趣的同学其实不是必须的作业。

有兴趣同学自己可以去验证一下，对，这样是不是说，因为我们大家知道建筑是一个很严重的问题，就是它不是ID对，嗯这个时候嗯对，所以说希望大家动手去验证一下，然后还有一个非常类比的，就是一个是dollar吧。

dollar bar是什么意思，我们刚刚是说居然成交了，我们上面成交量成交额对，那这个这个这个dollar bar相比volume bar，他考虑的因素是价格对，因为同样的说我成交100首。

然后一个价格是3500，一个价格是3600，那嗯对同样成交100首，但我相信这个时候市场流入的资金是不一样的，对那这个时候如果按成交额来切，是不是就能获得更加不一样的新对，嗯所以对。

其实这些东西就是不会说在课上全部涉及到，但是说希望大家自己可以去探索一下对，然后接下来一个图，就是就其实说我们看到这三种这个bar的对比哈，那显然又看到就是说嗯是volume2。

volume bar相对波动已经比我们的tick bar要小很多，然后在然后是dollar bar的时候，它的波动更小，然后这个是他是做了一个指数的weight average对，就是什么是ea的话。

然后我把链接留在这课上就不讲了，大家就其实就很简单，就是如果知道移动频率的话，让你知道exponential moving average，也是就是顺其自然的一个概念对。

然后这这这个就是比较有意思的一个东西，而这个图是老子一本书，我把书名打给大家呃，Advances in financial machine learning，对他是考量一个教授写的啊。

就是我觉得不能全算他输的东西，但是有一些东西新的思路我觉得还是可以的，对然后嗯嗯这位同学有提到说这么切的话，在开盘收盘边界也需要特殊处理一下，呃那显然是这样的，但其实刚刚也提到了，说嗯，数据处理的方式。

其实是非常personal的一件事情，就是说有相对固定，但其实也有很多是说，我个人可以去按照一定的习惯去做的，因为嗯我们想思考一下，就是说我处理数据的动机，而是为了什么，我处理数据的时候，我如果在回测。

或者说在某研究的时候，我怎样处理教程数据，那我交易的时候，也会采取相同的方式去处理数据，比如说我要不要在集合竞价去挂单，如果你回去的时候没有去挂单，或者研究时没有挂单，但是你实盘交易去挂单，那显然来说。

你指望你的模型，在交易当中表现的跟回车道一样好，那就不是很现实对，所以就是我觉得亚太研究过程当中，不像其他学科嗯，有很多固定的东西，它很多有一些是经验性的东西，有一些是说现在大家也不知道是什么样的东西。

深挖下去会有一个很大的坑，但是在目前而言，比如说可能这是一个相对比较好的处理方案，包括比如说期货的肉，就是因为因为我们现在期货不是一个连续合约，就是5月换到10月之后，这个中间的价差怎么处理。

那其实有很多种方式，那每个人其实可以选择自己的方式，如果不知道用哪种方式，我觉得还是一点就是自己去做研究，我把几种方式都去写代码验证一下，那哪个方式效果好，那我再去思考，是不是我可以采取这样的方式对。

所以这门课程还是希望大家要多多动手对啊，所以刚刚那个海上流星这位同学提的很好，就说开开盘收盘编制就是特殊处理，那肯定就是说我们成交量成交额来签，比如说正好是10万首。

我总不可能每天成交量正好是10万首吧，那这个时候是怎么办呢，就比如到了收盘，我只有6万收，那我该怎样去处理，对有人喜欢说我我不管到不到十，还是我今天收盘就截止了，没有人说我可以把这个10万手接下去。

就到第二天的开盘，我第二天开盘加上4万手，这样合成一个半，那是不是也是可以的，就是我说嗯大家都是不确定的，都只能说通过去研究去做，甚至说我在这个市场这个品种上，这样做好比较好。

但是在其他品种上似乎也有一些新的因素，那就不一定能这么做，就是说交易是一个相对来说，它是有很多维度的东西，我不仅仅说仅仅是量价数据，那我还要去考虑每个品种的流动性对，然后就是有很多很多院校要考虑。

不是一个非常确定的答案，那有些有些事情就是说有些坑我踩过，可以告诉大家，OK那可以这么做，但有些事情就是说大家跟我一起踩坑，你就说这样是不是有更好的方案对，嗯好的，然后嗯就是到目前为止。

说关于市场就是market data这一部分，就是说theoretical，也就是说数据tick怎么是tick形成bar，那到这部分就是我们告一段落了，那这部分啊同学们没有什么不理解。

或者说你觉得有什么特别还有困难的地方，可以就是留言放在对话框里，或者说如果OK的话，我们就要进入下一部分了，嗯嗯嗯能或者这样就是换一个方式，就是对于第一部分掌握的内容，包括跟包括第一次作业吧。

大家觉得自己的掌握程度从0~10，给自己打一个分呗，就这这个真实一点，不用不愿意让同学们，就是因为我想知道大家掌握的怎么样对，然后如果有必要的话，我可能还会去在后面再去回顾对，KKB同学九分就是剧本。

我觉得就很好了，就是我觉得我觉得给大家底线是八分，对大家不要说吵过了，没有到八分就不敢说，我觉得OK很好很好，对对哦对，谢谢bingo同学，就是要把这本书纠正一下。

Advances in final machine learning，其实这本书电子版，但是也可以，基于我也觉得，就是我们还是不要说是去主动的宣传，宣传盗版啊，有些同学可能就是说对于这个东西比较困惑。

然后如果嗯有什么有什么困惑了，就可以在群里找我来私聊一下，就是说觉得这部分哪些掌握的不是很好，我觉得我我鼓励大家给我积极的反馈，因为上一次大家的留言，我都一条条都看过去了，就是有什么难点。

就是因为嗯这个客人会觉得第一次见，我还觉得挺有些挑战，就是每个人的嗯技能点是不一样，因为我相信这里面我看到有cs的同学，那我相信就是C加加肯定是打爆我，对比如今天是我介绍。

我还我还做了一个C家的COTEST，就呃就是一家券商的自营交易员的岗位，然后我上午狂写了四个小时，C加200多行，但是我觉得累的不行，那可能对于cs专业的同学，可能就是直接就是秒杀那嗯。

那有些同学可能金融背景觉得这些小菜一碟，然后有些同学就是说OK我们生产力很强，就是你讲的这些报道，但是所以说这门课程还蛮tricky，就是就是我只能说保证大家在每一个部分，就是说去取得平衡。

就不可能说完全偏重的一部分，我只能把每一部分都照顾到，因为每个人的背景不一样，但是如果哪部分大家觉得有特别困难的部分，那可以课后去主动找我沟通，然后我为我也期待大家的反馈对，因为这样子可以让我们的课程。

就是把它变得更好，如果下一期的话，那或者说之后有后续更深化的课程，也能够去更好的帮助到大家，对好的嗯，所以如果我简单的take care我，我的理解是八分，那基本八分或者是七分到八分的样子。

那基本符合我的预期，唉其他同学不给力啊，总共现在是20个同学，怎么只有12347个同学，那其他剩下13个同学也也打，给打给一个分数吧，至少对，我想我想，我想真实的知道，大家对前面这部分掌握的怎么样。

对然后因为我们接下来开始下一部分了，对就是没有问题，就是真实的评价，如果觉得自己掌握的不好，或者是拿到一代加强，我们课程也会真的去改善，对好的嗯，大概就是接着说，然后我们接下来开始讲。

就是比较接下来比较tricky的一部分对，就是讲我们就是cp comprehensive transaction，Platform，就是它是一个上上海期货交易所推出来的呃。

官方的一个平台能够保证让大家去交易，那我们今天就是说他这个平台是包括三部分，一个是trading system，就是简单来说交易交易系统，也是我们我们会关注的这样一个部分。

那这个交易组合系统做什么事情呢，就是说大家可以想象一下，量化交易是怎么来做decision，Making，怎么来做做决策的，就是说呃，我其实说我们不考虑其他的外部数据源，我就接托管服务器，托管到交易所。

对托管到券商，然后我收到了行情，那其实是说我是说的market data，我知道历史上所有的数据跟当前的Mark，最新的market data，就是我们课上看到的tick数据那些东西。

这是我们目前获取最高精度数据对，那我们只能获取这个数据，那接下来就是说，所以说其实交易简单来说，就是从market data到order的这样一个function，这样一个函数，我们根据已有的数据。

然后我们要去做order对，我们要去下单，但那其实所以第二部分交易系统核心的部分，就是说我要去做我的订单管理，但有时候我要去SORDER，我要去开order，我单子发出去了，但我发现诶市场价格已经跑了。

偏离很多，我不想安心买这个价格成交，那个叫撤展，这叫cancel对，然后比如说对，然后发呆的过程当中，我们就是说我们有我们刚刚提到有lion order，然后也有market order对。

然后又few or kill，就是说我希望我的单子力量有这个价格成交，如果不成交就撤单对，所以就是有很多很多类型的单，然后其实这今天讲的这个很多东西，是在CCTV的官方文档会有。

但是我我我估计可能大家没有精力去，把这几十页上百页的文章都读过去，那那我自己是读了大半对，就是说我们我们今天主要关注的是trading system，在这一块就是说我们怎么去接交易所的数据。

然后到课程的下一部分，就是到实盘的部分，我们再去讲说我们怎么去把我们的单子，以我们的交易信号转化成订单，然后通过交易系统，通过CTP把它发出去对吧，嗯然后然后第二部分是券商去做的事情。

risk management这个是什么意思呢，嗯就是因为中国其实交易所还挺严格的，就是在CCTP，我觉得还挺严格，为什么说为什么说他严格啊，你钱不够，不给你下蛋对人，那事实上不是所有的交易系统。

都会帮你做这样的事情，因为大家也知道哦，13年嗯嗯光某大证券乌龙指事件，那我账户里明明没有这么多钱，那也没有说去也没有说去，就是说他自己也没有去验资，我账户里有没有也没那么多钱，我只有50亿。

我发出150亿的订单，并且都成交了，这个就是一件很尴尬的事情，所以risk management，那那就是说期货，券商或者说期货公司要做一个事情，就是说我要去检查，我现在的你的账户里有没有这么多钱。

对这个是最难，就是我在发单过程中当中当中要做的risk management，那第二个事情就是说说我们上节课有提到的，几个leverage和margin保证金的概念，针对每个不同的客户。

我们有不同的保证金和杠杆水平，但有时候说我账，就是我账户里可能没有那么多钱对吧，嗯比如说我刚开始买了1万块钱的螺纹钢期货，然后结果他跌了，那我现在账户里可能只剩下6000块钱。

但是我现在就是保证金是7000块钱，那这个时候就是说我7000块钱除以6000，就是那这个时候，其实我就是说你会看到你的账户的就是leverage，实际的就是风险水平是大于100%的。

那券商会一般会做什么样的事情，就是说呃会收盘的时候会给你发短信，然后说你超过了100%，请于次日开盘前补足相应的资金到嗯，到你的账户里，然后嗯然后如果你还是120%对，然后然后一般是120是一个坎。

然后还有一个是150，150%是什么意思，就是说这个时候券商可能要叫body force cos强平，对，本人也有幸经历过一次抢拼，就是嗯对，就是那个应该是做空铁矿，我记得去年铁矿来了波大行情。

从400块涨到600块，然后我不断往里补钱，然后结果到最后还是被强平了，就一手吧，差不多亏了3万块钱，刚刚是5000块钱，5000块钱做空，然后最后还能亏3万块钱，所以同学们期货投资要谨慎。

这个是非常严肃的一个事情，就是但大家也要看到，就是说其实这个东西risk management，我觉得不是一个坏事，某种程度来说，你可能交易所交易API的交易API速度没有那么快，但是多了这样一个步骤。

能够帮帮助你去降低你的风险，就是如果说你账户里没那么多钱，就你你你你想下一首，结果下场了十首还得给你成交了，这个就比较尴尬，或者说你因为我原来比如说就100万的账户，结果下了1000万的单。

然后1000万的单下完之后，市场一个大变动，亏暴跌10%，然后你的100万都没了，那这个事情岂不是很尴尬，所以这个事情我觉得是分两方面来看，一个是说保证，有可能会对你的交易成交速度有影响。

但是另外一方面其实是保护众多的投资者对，然后第三部分是settlement，是结算是什么意思呢，就是我要知道我我看到的恒星，我每天在交易的时候，比如说这个呃，下下单下多少手，什么价格成交了。

那收盘之后我们要做一个什么叫reconcile，就是去看一下，就说我今天成交的单子嗯，是不是我自己盘中记录下来的，跟交易所发给我的，这样是不是正确的，那交易所发给我这个东西叫settlement。

叫结算单嗯，对结算单位，他清楚地记录了你今天每一笔成交的方向，价格手术对，然后也会也会去汇总你每天的仓位，对这个这个东西比较抽象的话。



![](img/12d14db7cd7a337cb35d5838541b418b_53.png)

就嗯OK我给大家看一个计算单。

![](img/12d14db7cd7a337cb35d5838541b418b_55.png)

来看看对，这是我的另外一个服务器，因为七选我的程序化账号刚刚打开之前。

![](img/12d14db7cd7a337cb35d5838541b418b_57.png)

是直接在把windows上面交易之后，有了API就会好很多啊，这个是OK这个是我期货交易的一个账户。

![](img/12d14db7cd7a337cb35d5838541b418b_59.png)

这是我看到的一个，虽然我是不是不应该打开这个app，里面有我的个人账号，这个我想起来PPT里面有这样的一个东西，对我们看看一下简单的结算单，对就是哦就是这个是我的一个期权的结算单。

然后看到就是说每天期货公司会在收盘之后，会给你推这样一个东西，那叫settlement statement，就是然后这里有一个概念叫market to market，就是定时。

那这个概念建议大家去查一下，就是逐日定时跟主笔对称的区别，然后日期，然后你账户里有多少钱啊，期数有多少钱，然后equity commission，你的手续费对，然后权利，然后这个这个是期权相关对。

然后保证金，然后rise degree，就就是说这个东西超过100的时候，其实就是会比较CHEK，券商会不断给你打电话，然后这里面有你transaction record，就是事实上我在机构做的时候。

就是呃我会就是用程序会，每天就我们这是一个TXT文件，但实际上是可以用一个party，用Python这种脚本，把里面每一笔成交记录都给他汇总下来，对然后嗯对，然后后面包会有持仓汇总。

然后这个时候然后跟持仓汇总去核对核对一下，然后包括把持仓明细加起来，也要跟持仓汇总去核对，以及也要根据我们自己白天交易系统里，记录下来的单子去核对，就是要确保呃这样的单子是不是正确的。

那大家不要觉得说交易所或者说其他的第三方，就是嗯一定一定给你的东西就正确，事实上我们被别人坑过对，就是本来不是我们的单子，结果我们结算单里莫名其妙的多了一笔单子，那那笔单子是亏钱的好几万块钱。

但事实上这是因为就是一个mom账户，就是说是一个就是多个管理员的账户，然后我们作为其中一个管理员，去持有其中一部分组合，然后中间相当于说他又加了一刀，那这个时候就是说，如果我们没有这样的一个。

每日的reconcile的程序，那我们这笔钱可能就莫名其妙就亏掉了，就是账户少了这么多钱，事实上我们那一天我们交易员发现，明明没有这笔单子，为什么解菜单里可有这份单子。

所以说就相当于一个说叫交叉验证的东西，我们有了这样一个东西，就能够去保证说我们的交易是不是按照，就是我们想要的去去发出并且成交了，然后另外一个意义就是说有了这个结算单嗯，那我需要我需要去。

就是一个是我每天都试探自己回顾，另外一个就是说我要看人，说我把这个数据和结构化数据存起来，然后因为如果在交易交易的时候，有时候你可能还有每一笔的成交时间，那这个信息也是比较重要。

就是方便于你自己开发偏向高频电系统，你要可能呃，就是你要去自己去测量你本地订单的时间，然后实际成交的时间，然后把这些延迟信息，这个我觉得是非常宝贵的一笔财富积累，积累多了之后。

我们今天只会讲到就是最简单的一个交易系统，然后跑起来是什么样的对，然后就是就是这个是我们提到的，就是CDP3部分，Trading system，risk management和SETMENT。

然后第一个是我们要做的就是每个clip去做的，第二个是气候功效做的，第三个是交易所要去做的，对好的，然后现在20。50分，然后我们到九点钟才正式开始，大家先休息一下。



![](img/12d14db7cd7a337cb35d5838541b418b_61.png)

![](img/12d14db7cd7a337cb35d5838541b418b_62.png)

![](img/12d14db7cd7a337cb35d5838541b418b_63.png)

![](img/12d14db7cd7a337cb35d5838541b418b_64.png)

![](img/12d14db7cd7a337cb35d5838541b418b_65.png)

![](img/12d14db7cd7a337cb35d5838541b418b_66.png)

![](img/12d14db7cd7a337cb35d5838541b418b_67.png)

![](img/12d14db7cd7a337cb35d5838541b418b_68.png)

![](img/12d14db7cd7a337cb35d5838541b418b_69.png)

![](img/12d14db7cd7a337cb35d5838541b418b_70.png)

![](img/12d14db7cd7a337cb35d5838541b418b_71.png)

![](img/12d14db7cd7a337cb35d5838541b418b_72.png)

![](img/12d14db7cd7a337cb35d5838541b418b_73.png)

![](img/12d14db7cd7a337cb35d5838541b418b_74.png)

![](img/12d14db7cd7a337cb35d5838541b418b_75.png)

![](img/12d14db7cd7a337cb35d5838541b418b_76.png)

好的大家可以听到吗，好的那我们第二节课开始了哈，然后刚刚给大家看的是一个，90分左右的同学对，然后你看到就是这个同学是很乖。



![](img/12d14db7cd7a337cb35d5838541b418b_78.png)

就是啊面试题其实也都做了对，然后嗯然后大家不要担心，然后就是这这两道题目会着重待会。

![](img/12d14db7cd7a337cb35d5838541b418b_80.png)

尤其是第二题，这个待会会在第三节课给大家着重讲一下。

![](img/12d14db7cd7a337cb35d5838541b418b_82.png)

然后我们刚刚看到有同学提到结算单，有同学提到结算单的问题，嗯是这样的，就是每天的结算单，就是如果说用四，大家可以尝试一下，就是有兴趣的话是可以用CTP，你是可以得到这样一部分结算单。

但事实上我们不管用的呃，任何的交易嗯，交易软件里面都会有导出结菜单这样一个功能，你可以手动导，然后如果稚嫩一点的话，就是你连CTP把每天的接单量给导出来，就是为什么说编程是一个很重要的技能。

就是在机构过程，当机构当中可能我们这个组有十几个交易账户，那我其实我每天我去一个个点击把下下载下来，是一个非常的花时间的任务，那如果说我有多个账户，我有CP，那其实我很简单。

就是一个for account in accountless，然后每一个账户，我去执行一个获取结算单的功能，你就可以得到，你就可以把一个字符串拼接起来，得到这样一个表，但事实上得到这样一个表之后。

你肯定还不可以直接去做pl的，calculation和reconcile的部分，那这个时候你需要用哦，应该是正则正则大家用的比较多，你其实把这样的表格去pass一下，其实这些东西你都可以去把它算出来。

那就是这部分，其实也是需要大家去画室人去做的，因为嗯，我觉得就是说很多的东西是只有自己动手做了，才会去知道是怎样一回事，就是我把我的pass程序给你，那之后现在只是期权，OK那期货怎么办。

然后说之后有股票就很难怎么办，其实就是我觉得大家有志于从事这个行业，就不要不要不要害怕动手，一定是积极主动的去嗯去写代码，然后把自己的想法去实现起来，然后嗯刚刚李建伟同学就不知道这个回答。

解决了你的问题了吗，就是结算单的问题，就是所有的这些东西都是一个T台，都是可以从CCTP，或者是相应的教育软件当中去获取到，那如何去pass这样一个东西，就是要自己去写程序去处理的。

嗯那如果没有问题的话，嗯我们接下来就是继续回到我们的CDP部分，然后刚刚我们说到，我们再强调一下，我们现在关注的是trading system，这一部分我们只看交易系统。

然后今天我们主要看market data，就是其实这部分东西嗯，就大家可以如果不是特别明白，或者没有相关的cs背景，就是我觉得不用特别在意，但是理解这些东西是对接下来去做回测系统，包括去交易的时候去去。

有助于你思考回收系统为什么要这么做，因为我们的目标就是贴近真实交易所，就是说就是说在它是基于一个FTD的，就是communication protocol，然后在事实上就是说在国外可能大家都用FN。

就是用fix协议了，然后就是就是其实不用像我们现在这么复杂，但是嗯这样这样我觉得也是可以，就是总归是事情发展都是有阶段，有一步一步的需要去做，然后我们要讲的就是这样一个dialogue。

对话的模式是什么意思，就是说嗯，就是在接下来，我们我们在communication mode里面有三种，然后这种是client client，client就是指我们每一个人的交易程序。

那这这个是是说指这个dialogue，只有在我交易程序就是我client主动去request的时候，我才会去，然后我们看到这个信息流是从request message，发到交易系统，就是我们发到这个呃。

就是通过CDP发过去，那这个时候才会去连到我们的交易所，那中间是这样的，就是中间这部分一般是有一个券商的柜台，对你可以对啊，一般来说就是我们在中国是不可以。

直接从client side到exchange，这样做一个直连，那伊士顿15年被罚，也就是说他绕过了这样一个部分，因为大家还记得我们刚刚提到呃，券商或者是期货公司。

需要做一个risk control的这样一个部分对，那这部分通常可能会在这部分去做对，然后如果说这部分有问题的话，直接返回error message，没有问题的话。

就是接着去request request到交易所，然后从交易所那我在response，response在一步步返回到我的client side，这然后这个常见的用处，就是说我去查询这样一个合约。

比如说查询这个合约的结算价格，或者是查询这个呃嗯对，就是这个时候是我一般来说是climb，主动去查询，然后接下来还有一种叫private mode，private mode是什么意思。

就是说这个这个时候我们看这张图，这个是由交易所主动发条消息给对应的client，那那这样子的话就是说呃，这个常见来说就是说为什么要说是他是private，就是这个信息我是不能跟别人共享的。

那比如说我自己的trade return，我成交了，我发了一笔订单，成交了，交易所发给我，那这个单子总不可能说我自己下的单成交了，结果发到其他的客户里面去，那显然是不合理的。

所以这是他需要有这样一个private mode对，但是大家可以想一下，就是我们的market data肯定不能用这种方式，因为因为交易信息他是一个公共的状态，就是交易单子。

我肯定我们我们在第一节课就讲到，交易所是为了保证公开公平的交易，那如果说我交易的单子的就是market data，发给大家不是同步的啊，就是有人先获取到，有人会获取到。

那事实上事实上这个就是有违公平公正的原则，那交易所也会去嗯嗯交易所也会去说，就是说嗯呃也会去想办法，就是尽可能保证交易公平，那大家也会自然文化上就想到一个问题，那所有人同时发的单子。

那交易所到底先接哪一个呢，但事实上就是交易所有多个撮合机器，然后为了为了保证，为了保证，就是说不是让大家某一个机器有固定的偏好，那可能在交易所我也会说以一定的概率，今天是这个单子，这个机器先开。

明天是另另另外一个阶级先开，那这样就是一个是一个概率，就是一个概率的问题，大家都不能知道我自己答的，是不是一定得先买先开，但是但唯一可以确定的是，你是说我把每一步的延迟都做到降低，都做到最低。

那这样是一个非常有意义的方式，然后第三个我们提的就是broadcast模式，那这时候很简单，就是popping message，Message，就是我们的市场行情数据，由交易所通过广播的方式去获得啊。

让让每一个client去获得这样的一个数据，那这个时候大家就可以想，自然而然我要去降低延迟，无非我就是把每一步中间的每一步给降低了呗，那呃这一步是比较好解决的，就是其实就是现在就是说我们。

我们我们大家知道，比如说我们现在在自己的家里，收到了互联网行情，对，那这个时候就是是client side，就是呃从券商的交易机房，再通过互联网发到我们的家里，那我自然而然要提高速度。

我可以把尽可能的把这个呃，尽可能的把这一部分给缩短，缩短的意思是什么呢，我可以把我的交易机器跟券商的撮合机，就跟券商的托管机，就放到券商的托管机房，那那这个时候我就不需要跨过物理的距离了。

我只需要就是说啊，那这个就是说这个时候物理距离也有，但可能就是几10米，几百米，因为我们可能就在同一个楼层，就在同一个机房，那通过通过就光光光光缆走起来是非常快的，然后如果说第二个我要去优化的。

就是说交易从从不同的broker到我的exchange，这个这个过程要做的，那就是说我选一个技术比较强的期货公司，那他有比较稳定的延迟，然后甚至来说在不同的交易系统，我们刚刚说到CTP是一种。

但事实上还有飞马，还有恒生嗯，然后还有金证，然后还有等等其他一系列的一系列的交易，一系列交易的API，但我可以选不同的柜台，但是他们都可以连到交易所，这个时候每家柜台走的速度就是不一样的。

那有以打造低延迟为主流核心的就是，但现在这个也是大家竞争比较激烈的一个方面，因为以前大家可能来说说我做了毫秒，就是呃就是高频，但现在没有人，就是我延迟10ms，但我觉得是完全没有竞争意义。

就是毫秒级别就是散户在我现在里面，那一般来说做的比较好的，可以把延迟就是延延讲到了微秒级别，对是个位数的微秒级别，所以这部分是就是这部分，大家可能嗯就是这三张图，其实就是讲一下就是整个的数据流。

是就是就是我对话模式是怎么样的，接下来还有一个概念就是data stream，就是数据流，就是说呃数据流，数据流这部分如果太长的话，其实大家可以可以可以不用看啊，然后然后就就只需要强调一点。

就是最后一点，就是说如果就是说我发了一个消息，就在我们前面的，就是说我在发消息等回复的过程，我信号断掉了，那你在重连的时候，你这个回复可能就收不到了，这个是大家要去注意的对，就是仅仅是这个就是嗯对。

这就是为什么就是说要去，就是说我每一个订单要给它唯一一个编号，因为我方便我之后要去寻找一个订单的源头嗯，然后就是数据交换的模式嗯，request和response就是一个是我发。

我从client我发回过去，然后通过fib总线，然后发到server server再回来，然后还有一种方式就是叫publish跟subscribe mode，这个这个这个意思就是说就是我只要订阅了。

就是它是它是异步的，什么意思，是说我这就是我不需要依赖于前面一步，是不是已经完成了，对，那这个时候我只要因为因为这样，可能会造成阻塞，异步，大家会相对来说会比较就是偏好一些，对。

所以在这部分如果大家觉得比较困惑的话，嗯有兴趣的同学，我觉得可以去看一下CTP的官方手册，里面有最为全面的解释，那如果说对这部分理解有些困难，我觉得不影响我们在今天的就是做code。

就是就是看一下这个CTP是怎么一回事，对，然后然后就是接下来我们今天要主要的部分，就是带大家去看一下，就是整个CDP的API是怎么一回事。



![](img/12d14db7cd7a337cb35d5838541b418b_84.png)

对就是今天也是大家要作业，自己去完成的一个部分，All right um。

![](img/12d14db7cd7a337cb35d5838541b418b_86.png)

就是呃我不知道有呃呃，我不知道就是有多少人去在课前去注册了，seminar的一个账号，呃有这样做的同学在讨论区打一下试一下，我希望知道大家有多少人做了这个功课，对，就是如果你之前没做的。

那现在也需要做起来了，那如果之前自己做的可能就比较清楚，我现在在做什么什么样的事情，Ok good，就首先就是我们拿到官方的CCTP的API的话，OK有就是这是一个期权的CP，那其实是类似的。

就是我拿到的其实主要就是呃SOO文，两个SOO文件，然后我这个是LINUX的，然后有的有的有有的人用的是windows，whatever大同小异，然后有MD，然后然后有一个trader。

这个是我们一般叫TD，其实我们主要关注的是trader，诶，就是market data，今天这两者有非常类似的地方，其实我们主要做的事情就是去继承啊，就是从这个继承这两个里面的两个两个一个class。

然后用它来实现各种各样的功能，然后这个里面就是说啊，这是交易所封装好的文件，这个对我们是封闭的，我们不需要知道它内部，我发完单子交给了CTPAPI，他是怎么去做处理的，其实我们不care这些。

说实话想care也care不了，现在对我们只需要说按照他官方给了API，他告诉我们怎么做，我们就去做什么样的事情，对这是我们今天主要要focus的地方，然后嗯这个是期权。

所以说我们刚开始拿到的就是这么多文件之后，其实我们要就是要去自己去去test这些东西，就是你其实简单来说写这三个文件，基本上就可以达到，我们把这个作业给完成的目的。

就是你自己去接market data对，然后这是我之前在这边，这个是嗯之前这边我写了一套，就是简单的去测试一下，就是现在我要强调一下，就是嗯就是对于程序化交易是有一定的监管的，所以如果要实盘交易的话。

是需要去写申请，去跟对应的客户经理需要相应的申请书，然后要去备案，然后被安娜是目的是为了保证啊，第一是知道这个程序化的交易账户到底是谁，实际掌握，然后这个这个交易部署在哪台机器上。

它会读取你电脑的呃硬盘号，磁盘号，然后也会读取你电脑相关相应的硬件的Mac地址，还有你像常见的IP地址，然后然后他会给你一个独特的授权码，在你去交易的时候会知道会，你需要去经过验证。

才能保证你就是经过验证的程序才可以验证的，就是备案过的账号才可以进行程序化交易，对这点是比较有意义，因为嗯说实话大家都不希望说谁程序写的不好，或者说故意去捣乱，把整个系统给blow up对。

所以就是如果大家去做实盘的话，我建议大家尽早去找客户经理，把这个程序员相应的备案给做了，那其实另外一方面就是说保证，大家也是希望交易所，也希望对大家的程序有一定的监控，在就是在备案的过程当中。

大家他会去评估你系统的呃，相应的风控，那你有没有做到对，因为除了券商和期货公司的风控，其实每个交易程序自己自身也需要，对自己的程序做风控，然后嗯对，然后我们来看一下。

这就让他给了四个头文件到底是什么东西对。

![](img/12d14db7cd7a337cb35d5838541b418b_88.png)

然后这个是user API stract，就是嗯大家就可以看到，就是说我之后用到了很多的class，它里面到底包含哪些东西，它其实都是在这里面，就是任何一个常见的呃交易的API。

其实都是参照类似于CCTP的这种方式，就是说如果我们学会了接CP程序，如果你想要不管是股票还是期权，其实接一下都是很快的，对那这个里面到底有哪些东西，那其实就是现在可能在就不一定要关注那么多。

但是以后如果说如果说以后出错了，或者是什么东西，那那大家可以知道就是从哪去来呃，从哪来去debug，对，包括其实CP大家看到不仅仅说我们刚刚说的，不仅仅是交易，那其实呃银期转账，然后期货资金转银行。

然后各种各样的东西，它其实里面我觉得写的还是相对比较清楚的，但是有一些坑可能是要大家自己去踩了，才能慢慢慢慢去指导，然后就这个里面是是我们待会儿要看的，MDAAPI里面。

他reference的一些数据结构到底是什么样的东西，对，然后嗯这个里面对这里面有个题目，encoding每次都要改一下。



![](img/12d14db7cd7a337cb35d5838541b418b_90.png)

就是还有一些就是这个是usa API data type，就是有哪些常见的数据类型，然后它其实是什么东西，是C的char char string，然后对这个我相信有很多呃cs背景的同学们。

应该看起来比比我这个导师要看的容易很多对，就是我自己说出来几千万，我是不可能全部看完，我现在只能做到就是说我要用的东西，我把它了解对，然后其实我们个人最为关注的是这两个，一个是AMDAPI。

然后一个是trader API，让我说你掌握了其中一个，其实另外一个是类似，我们先从简单一点来入手，就是我们刚刚说到我们交易系统是两部分，一个是负责market data，一个是负责chat。

里面就是order management，那这两个问头文件分别对应的这个功能，那我们今天主要来看的就是MDAPI，然后要告诉大家，就是说我们怎么去通过这个API去获取。

我们上一节课作业当中获得到的那些tick数据，然后这个里面有两个class嗯，一个是对，就这嗯就大家可以看到这个MDSPI，里面有很多的function，就是说呃就因为大家就是如果嗯对，我忘了提了一下。

就是嗯看了，就目前至少看得懂这些代码是大概什么意思的，嗯嗯同学打一下，再在discussion里面打一下，因为我不知道有多少人掌握C加加的课程，对就是说不一定说现在会写啊。

但是就是比较tricky的部分，如果是现在看不懂也不会写的话，那这周作业可能会有点麻烦，但是还是希望大家就说，我觉得因为代码不会很难，就只是希望大家去自己去把这个API打开看一下，然后去理解一下。

然后把CC加加常见的一些东西嗯，那很好啊，那如果不说话，我就默认就是剩下的都不知道，那当然现在是有五位同学就说，大概觉得看得懂这些是没有问题的，OK就是这样，就是我觉得就是如果想。

就是想严肃的做一个框的，我觉得C加加还是必须要去做的，对还是必须要去写的，如果觉得有困难的话，嗯不管是自学还是会其他语言，我觉得学一下C应该是很快的，嗯其实就是大家看到就是说。

其实真的头登进去看也没有说很很麻烦，其实无非我们我们如果说没有任何的常识，那就想一下我怎样去连接一个交易系统，那那那很简单，我平时炒股票的时候，我肯定要手机上要去登录吧，那我肯定要先去登录对。

然后登录完之后，然后我要想一下我们是不是要去看哪只股票，今天什么价格，那我那我想当我点开这个股票的时候，是不是就订阅了这个股票的行情，然后他然后市场就是不断的把最新的行情嗯，推给我们。

我们觉得看到了K线图或者是日内的这种线图，那其实也就是也就是MDIN，就是这些东西是要做的事情，对其实大家也都看到，就是一个是嗯我去连接那on front connected，然后然后我去login。

然后log out，然后然后然后我去去订阅行情啊，然后OK嗯这边我看一下啊。

![](img/12d14db7cd7a337cb35d5838541b418b_92.png)

这个是2B对。

![](img/12d14db7cd7a337cb35d5838541b418b_94.png)

这个是我之前就是说这门课后嗯，就是这门课的作业，是希望大家自己去收一下行情，应该来说你能够是我稍微写一下，应该是可以收到，就是我看了一下，是从夜盘的开始到夜盘结束两个小时，是一个tick都没有丢掉的。

就是如果你服务器稳定，不会出现丢包，而不会出现丢掉丢包的问题，你应该是能够获取到当天的呃，Market data，大家可以看到一下，就是跟我们的这个上一节课，看到tick data是非常相似的。

那其实这个这个程序该怎么写呢，就是我个人的习惯是会去继承这样一个类，就是就是因为刚刚我们刚刚看到他是virtual function，这个时候必须要去去把它去，把它必须要去实现对吧。

就是你CP就是说要去，至少把这些东西全部去实现，那其实这个很简单，就是你现在我们主要去做的事情，就是嗯嗯就是你在收到了呃市场行情的时候，你到底要去做什么样的事情，其实你主要我觉得这个也没有很麻烦。

就是你把on response subscribe subscribe呃，就是market data，然后呃呃不好意思，这个是这个是订阅，订阅成功，就是订阅成功之后，市场会告诉你，就是它会返回一条消息。

那其实就是大家没看到，其实它是CCTPAPI，我觉得还是非常好理解的，它一般是on就是on，意思是在这个事情完成的时候，你就会收到一个反馈，然后你在看到就是说当我连接前置from，前置是什么意思。

就是券商的交易柜台就是一个IP地址，就是他那个前置机会不断的给POS场景，或者当我连上的时候会让你去，你可以自己打一个log，然后当我断断开的时候，我也可以去打打一个log。

然后然后然后就是说heart heartbeat什么意思，就是说你可能就是说，你不确定这个它是不是断掉，那有时候就是说，如果如果如果一段时间没有反应反应的话，你自己是不是要去查一下是不是断线了，对。

然后就是login logout，所以然然后刚刚我们提到说我们要去订阅market data，那我就subscribe subscribe之后，其实就是说你你response你可以记录一下。

OK我这边是SUBSTRACT成功了，然后那这个事其实就是我们要做的就是，On return deaths，Market data，就是我我我刚刚提到的，就是它是一个深度市场行情。

就是包含有beat dusk对，然后如果你付费了，有就是你你有level2的行情，你可能收到五档，那我们现在可能只能收到一档，如果呀我刚刚看2B的话。



![](img/12d14db7cd7a337cb35d5838541b418b_96.png)

应该是只有一档的数据，后面其他应该都是零，应该把这个打开对，所以我这边我这边可能都没有对，我这边把其他的都drop掉了，我只留了保留了ask one和beat one。



![](img/12d14db7cd7a337cb35d5838541b418b_98.png)

所以其实我们要做的事情就很简单，自己去把这样的一个东西去实现，把这个函数去实现就好了，那其实怎么实现，就是嗯然后就是说这个是什么意思呢，就是说我希望我在说到这个函数的时候。



![](img/12d14db7cd7a337cb35d5838541b418b_100.png)

大家看到就是我把一个个function去实现，那最主要的就是你在你收到market data这一行的数据。



![](img/12d14db7cd7a337cb35d5838541b418b_102.png)

你把它其实记录下来，就OK了，对，其实其实整个CTP，我个人觉得就是没有那么复杂的事情，就刚开始可能大家看到有这么多东西，但是你现在我们要用到的东西。

就是说是on return depth market data，那其实只要大家自己去实现一下，那其实为什么要让大家做的事情，就是我希望大家自己去看一下这个数据结构。

然后再跟我们上一节课对应到的depth，就是tick data，对比一下这两个里面有什么有什么异同，然后深刻的去理解一下，这个市场数据是怎么获取到，其实我觉得核心就是就是，可能就是那么十几行程序。

但是可能中签了，大家把它跑通会花一点时间，然后这个是我们讲的，就是说你要去自己去实现这个方式，那怎么实现，我肯定不能告诉大家，这个是大家推自己要去做的部分对。

然后大家自己看一下这个数据结构是market data field，是什么东西，然后我们刚刚提到这个东西到底应该在哪里看，然后大家去相应头文件里去找一下对，然后怎么去跑这样一个程序呢。

就是这这这里面看起来应该也还好对，其实就是说我们去import相应的header就行了对，然后然后我们刚开始就这样这样一个做的事情，就是说你要去呃，对就是这里面就是MDAAPI相对来说会好一些。

就是他这个有一个就是啊有一个存储目录，一般默认你自己放一个地方，然后然后然后主要我们要做的就是自己去，implement的一个market handle md handler。

就是就是我们刚刚看到gala，就是gala md handler是继承于我们的那个诶，继承了我们的呃，在CD就是这个MDAPI的一个class对，然后然后这个这一部分就是嗯，就是然后这个是呃。

我这边写的是create fire，就是说我希望我把我保存数据收集到行情，而收集到CSV文件当中，但事实上就是说嗯，要知道这个你一旦写入到文件，甚至都不用写入到文件，写入它内存的时候。

可能就已经造成了很大的延迟，就真正的高频他们在做的时候是不会这样做，他肯定就，并且他们也不会用通过就是TCP的方式去连接，而是用UDP，或者是他们甚至有自己的专用的航天员。

要有自己的专用的硬件芯片去来做这样的事情，但是我还是希望大家去就是这个是就是去模仿，就是看一下就是交易系统是到底是怎样做的，我们我们未来说你在工作中接触到的，可能不是说是发，你可能是写到你的内存数据库。

或者或者你甚至可能就不用内存数据库，你就直接放在怎样的一个数据数据结构里，对，然后然后这个就是说你要去这个叫register，你要告诉他就是我有这样一个market handle，然后你要去告诉他。

我注册了他，然后这个然后接下来就是，然后你要去连接你的潜质，就是嗯如果说大家自己有去连接sim note呃，有下载sim note的话，应该有在他的官网上看到这样的地址。

然后然后对然后你register之后其实就是in it，in it上之后，然后你再去相应的login就OK了，然后大家看到这个是我记不到账号，也不要大家都拿我这个账号就删了，这样可能都乱掉了。

就是虽然我现在里面没跑什么模拟交易，但是对你就是我，我建议他还是自己去注册一下账号，这个是动能动能少12分钟的事情对，然后其实呢我实拍的账号，其实就是说这个东西实盘的时候，如果你真的要实盘。

你就是券商那儿申请申请了之后，你的UID跟password，其实一改你的程序可以源源不断的就就去跑了，理论上就是这样对，所以所以然后我们我们刚刚说，我要回顾一下整个过程，就是说我们先HAMDAAPI。

然后我们去自己写一个market data handle，然后去注册到这个呃，注册到这个NSPI里面，然后然后再去说去连接前置，然后连接前置之后。

我们再去request user login login之后，然后接下来就是我们订阅market data，订阅到market data之后，然后去subscribe。

然后就是然后订阅到market data之后，大家有没有看到我们这边其实嗯大家在想说，哎那我数据怎么接受啊，大家要想要就是回顾一下我们刚刚提到的那种，Part2，就是我们的数据数据流，我订阅完之后之后。

那数据里我们这是公共的，那实际上交易所就直接通过power，就是public的方式就发送给我们，那我们在哪接收呢，就是我们自己on return that smarket data，我订阅了之后。

只要我只要订阅之后，这个函数里面你就会收到，那那就是说每次每次只要每次，只要说有返回数据，他就会去call一次，你这个return market data，那这个时候你就可以把你的数据给写下来了。

那其实整个的逻辑我觉得还是嗯嗯嗯，没有那么复杂，然后其实整个c TP market这块逻辑就是这样，然后呃我不知道大家理解了没有，然后就在群里反馈一下吧，因为这一块的话。

那我自己就坦率来讲就是这个东西我接触不多，也差不多也就是半年的时间，因为之前嗯之前是就在机构以后，我们就都有T就是把成熟的API给写好，然后只不过说现在我自己想研究一下这个东西。

然后我把它给自己的跑起来，尤其是因为是期权程序化，最近是刚刚开放，然后我正好也刚刚备好I，所以所以说还是想去系统研究一下，因为说实话大家看到我那个前面那个交割单，一天几十单，然后我觉得他手手手动下。

真的是比较困难的一件事情，对也就是疫情期间在拉工作还可以，每天对每天可以手动交易代之后，现在公司肯定是不行的，所以就是说就是如果说大家有志于说，想要去做量化投资。

那么我觉得了解一下各个系统的app还是很好，很有好处的，因为如果你看完这个，你再去看V派，或者再去看恐怖，其他其实非常类似的，结果，写起策略来就会非常简单，然后嗯所以这块呃我讲清楚了。

对我肯定这一块如果讲的不是特别好，大家见谅对，然后如果有什么不懂的，我再给大家进行解释，那其实就是说嗯想要深度去理解它，我的建议是看官方的手册，对我个人一直这样，如果你想理解一个东西。

你就看它最原始的东西是什么样的对，然后如果想要把它用起来，你可以copy我的程序或者是怎样对，但是出了错之后怎么办呢，还是得自己去找源代码，那其实就是呃我就是这节课总结一下，这节课要做的作业。

就是你可能就是写这三个嗯，就是把这三个东西给写写出来就OK了，你写一个头文件，你就是继承一下，就是market data，然后你自己就是自己去处理的时候。



![](img/12d14db7cd7a337cb35d5838541b418b_104.png)

到底要怎么来做对吧，然后然后你test的时候，你怎么怎么去主动连接，是这样，所以呃呃然后这这这个大家还有什么问题吗，因为其实这这这门课，就是就是就是到讲这交易系统，APL不希望花太多时间。

然后只希望大家能够去赶快的，就是说把这些动起来，因为就是我把AK一个个都go over过去，没有什么意义，然后嗯把每个数据结构都讲过去，我觉得意义不大，但是只要告诉大家这个东西是怎么用的。

然后我觉得更多的时间是大家自己去探索，因为我当时其实也差不多也就花了半天时间，把手册看一下，然后自己对照了，也就能写出这样简单的程序了，对所以如果大家觉得有困难的话，嗯反正也及时跟我沟通。

无论是说是啊C加加不是很懂的话，嗯但但是我相信这个程序应该不是特别复杂对，因为只要知道基本的C加加的class是什么样的，对吧，有constructor destructor。

然后用member function，然后对其实我觉得是差不多了，然后稍微了解一下就call back，就是是什么意思，然后可能会呃有助于你理解，就是说啊为什么我在这边洗完之后。

另外一边能够收到相应的数据对，好的，那如果没有什么问题的话，其实就是呃，就是我这节课主要给大家讲述的内容，就到此为止，然后那到这一部分就是说我们已经讲了，就是market data是什么样的呃。

就是总结一下，到现在差不多四个半小时，market data是什么样的，然后我们怎么去获取这样的market data，对这其实量化投资说难也不难，但其实就这样了，我就是我去收集数据，然后去处理数据。

有了数据之后，我们才能逐渐去建模，但只不过嗯对，那接下来两周可能会跟大家讲一下，就是为什么说我们要借助，要借助back testing这样一个程序，然后可能跟machine learning不太一样。

我们machine learning有了数据之后，我们就直接开始，就是可能就做feature engineering对，当然就是说可能要那个，然后有future engineering。

然后可能就要然后再，然后就可真的就是上GPU去训练了，训练完之后，然后就出结果了，但是嗯在金融方面，或许做CONTRADING的时候可能会不太一样。

就是有一些the man knowledge需要大家去了解一下嗯，那其实到目前为止只是CCTV这一块的东西，就是我先来简单给大家介绍这么多呃，之后呃就是我们回收系统会参考一下，就是参考CDP的API。

就是为什么要这样做呢，就是希望大家给大家达到的目的，就是说嗯我一套程序既可以回测，又可以上十台，那那热量是比较好的对，但是如果说回测系统的话，用C加C可能会花大家比较多的时间。

那可能就是说我们回收系统还是用C加按，用Python去实现，然后如果你真的想把程序换到实盘，那再用相应的API实现一下，也不是很麻烦，并且在没有经过再次强调一下，如果在没有经过严格的测试情况下。

不建议直接大家把自己的数据上试探对，还是要在seminar里面就是先模拟观察一段时间，对这样这样对自己的资金需要负负责任，对然后其实包括业界也有成熟的交易系统，也是，其实我自己个人实际使用的。

也是在用功夫教育系统对，只不过他们那我不能泄露，他们报价还挺贵的，就之前说想要用他的期权交易，但那个价格确实是有点贵，惊到我了，所以期权这部分，可能我只能自己花时间慢慢去实现，但是在期货上面。

他们CP应该是开源的，就是他你可以直接用功夫交易系统，去接他们的CDPAPI，然后对上节课应该也提到，就是他们的交易系统，我觉得做的在国内还是挺不错的，嗯哈喽那嗯。



![](img/12d14db7cd7a337cb35d5838541b418b_106.png)

那我们回到课上来的话，其实就是主要的，今天主要的授课内容就是这么多，然后大家有什么问题吗，接下来我们可能会花一点时间，就是回顾一下上周的，就是呃这有一道probability问题。

然后还有一些面试问题对，还是说这部分我可能讲的不是很清楚，大家没有没有太明白整个过程发生了什么，然后其实然后就是一些就是关键的概念，然后就是有后面两个没有讲，就是逐日丁是跟主笔对冲。

然后就是在结算的时候提到的，那建议大家去自己了解一下，就是对好sim now在国外连不上，OK简单的一个方案就是嗯嗯腾讯阿里华为，百度二三家四家轮流好吧，不是各种学生免费的，还不是免费。

接近于免费十块钱一年的腾讯云，对这个这然后然后把服务器放在上海，然后注册一个账号就OK了，对然后你把服务器，事实上我的服务器就是放在上海，因为离交易所比较近嘛对吧，就这这个东西就是嗯。

这这这这部分就是coding的部分，不太好说，带大家一行行去过过去，就是我觉得可能自己动手写一遍呃，感悟会比较大一点对，然后关于前面这种数据模式的话啊，只是想就是有兴趣的同学自己去了解一下对，对。

然后其实就是如果客人就说我们不做高频交易，那是上一两百毫秒的延迟，我觉得是完全可以接受的，因为我我一天可能就下个几首对，那我不是追求毫秒微秒级的延迟的啊，其实我觉得在互联网上就是用云去下单，完全没问题。

因为呃托管虽然不贵吧，但是毕竟也是几万块钱一年的成本，然后如果说你确定就是啊这部分优化，就是这部分延迟的优化，能不能给你带来相应的，能不能把这几万块钱给赚回来，然后还有一点就是说除了延迟之后。

对主要是这部分物理距离，然后其实程序的话现在有很多就是去优化的话，应该延迟不会造成特别大的影响，对，呃账户注册的url all right。



![](img/12d14db7cd7a337cb35d5838541b418b_108.png)

嗯为什么我们不一起看一下呢。

![](img/12d14db7cd7a337cb35d5838541b418b_110.png)

就这个网站是什么。

![](img/12d14db7cd7a337cb35d5838541b418b_112.png)

不用那就挂了吧好吧。

![](img/12d14db7cd7a337cb35d5838541b418b_114.png)

Sam now come down cn，对其实对，我还是建议大家有有有有什么事情，可能就是多多看一看交易所，我觉得就没事的时候看看交易所，应该能够浏览到比较多的东西对。



![](img/12d14db7cd7a337cb35d5838541b418b_116.png)

然后然后我们来看一下那个OK，上一周的几道题目。

![](img/12d14db7cd7a337cb35d5838541b418b_118.png)

![](img/12d14db7cd7a337cb35d5838541b418b_119.png)

嗯OK然后第一是，然后所以这次的作业就是REGSL，然后mt data API，然后你把这些数据收一下，然后收完之后，然后再跟大家对比一下，就是你收到的数据跟我就是第三方提供数据，是不是一样。

跟万德上数据是不一样对，然后上一次就是二这样一下，这个中间是怎么回事，这就是这样一个问题，就是二嗯就是随机选一个数，然后你猜对了，我给你多少钱，那其实就是刚才我提到。

就是有一个risk appetite的问题，就是一般来说我们默认的话，就是没有没有risk preference，就是嗯我默认大家都是嗯嗯就是风险，就不考虑风险偏好，因为考虑风险偏好。

就是说我极度风险厌恶的人，我觉得很简单，我就不玩这个游戏，为什么要玩这个这个游戏嘞，然后其实大家可以想一个这样一个事情，就是说嗯那你就假设我就是嗯，那就是我来选这个数字，然后大家来来付钱找我玩。

那那很简单，就是说我肯定就是说嗯我自己我自己选的话，那我作为我选数字，我肯定希望选的越小越好，因为因为如果我选的越小的话，我即使说被你猜对了，那你这样获得的钱是不是也就越少了，比如我选个一。

你猜对了就一块钱，我不可能选个100，然后被你猜100，哇塞，那我真是亏大了，那既然说我想到越小会越好，那作为对手的你是不是也会想到这个事情，你会知道我会故意去pick smaller number。

那你是不是也会去考虑smaller number，那这样的时候就是说嗯，就是其实这个也转化成一个博弈论的问题，就是说我每我们我们双方都会有这样一个策略，那这个时候就是说我们怎样有一个。

optimal的策略，就是说就是说你要考虑考虑到时候我期期望的，Expected winning，跟我跟，就是说我跟我选择的这个什么数是没有关系的，是独立的，就是说我不管选什么N还是选1~100。

那是没有关系的，那如果如果大家核心理解了这样一个概念，那我觉得这个问题就迎刃而解了，对就是千万不要去考虑说嗯我风险厌恶我，或者说我风险偏好，我就我我每次就玩个大的，那这样其实没有意义。

就是说我这样一个optimal的策略，就是说呃双方就是说我不不管我选什么，我都有可能获得这样一个的呃最优解，我来看一看大家嗯对，然后那那其实这样的就很简单，就是我pk with probability。

proportional to one hour k这个是什么意思呢，就是说嗯因为我K乘以K分之一就等于一嘛，那那就是说如果我选我选我，我选100，那我这个100的概率比较小哈，就是要正比于一比一。

那是什么意思，就是即使说我被选到了这样一个数，期望也就是一也期望也就是一，那如果我选的是五的话，那就5×5分之一，我也是一，那这样子我就见我就实现了，说我选的这样一个数字独立于。

也就是说我what expected winning，独立于我选的数字，那那那这样的其实那也就是要做的事情，就是one over k，然后你再把它弄一下对吧。

因为我把把所有的normally normalize之后，然后在这个时候expected pay out，就是把这个东西再乘以一个K，也就是在算下这个这个东西期望，那就是这样一个数。

其实其实这就是一个相对来说比较，就是intuitive的事情，那那整个问题就是说在面试的时候，遇到这样的一个问题的话，如果按就是如果没有接触到的话，说实话那可能还会有点困难。

但如果你类似的知道有一些就是偏game theory的话，那就是你知道这个就是关于抓住问题的核心，我觉得这个问题就会迎刃而解，对嗯所以这个问题的话，我不知道大家理解了没有，然后如果现在暂时理解不了。

可以回去，就是再想一想，然后我们课后再保持相应的交流，对，对这是一个interview的problem，然后还有一个啊，然后还有一个上次就是一个MAJORDAN的问题。



![](img/12d14db7cd7a337cb35d5838541b418b_121.png)

Majord。

![](img/12d14db7cd7a337cb35d5838541b418b_123.png)

![](img/12d14db7cd7a337cb35d5838541b418b_124.png)

![](img/12d14db7cd7a337cb35d5838541b418b_125.png)

OK稍等我打开一下。

![](img/12d14db7cd7a337cb35d5838541b418b_127.png)

就是max的问题，我看大家应该写的还都挺好的，对，其实其实这个问题就是我个人觉得是一个，就是如果学过动态规划的话，那做起来应该相对来说比较简单的，就是我觉得把这个问题分解成两个部分。



![](img/12d14db7cd7a337cb35d5838541b418b_129.png)

看不见的话放大一点，OK就是就是是这样，就是首先是呃其实就关键就是这样一行代码，Max jdg，就是我现有就是我随着价格序列，从前到后这么走过来，路不过来的时候，我现有的max jd。

max drawdown是等于当前的max drawdown，跟当前的DRAWDOWN，跟历史上的major down选一个最大值，这不就是最大回撤的这样一个定义嘛对吧。

然后我们只要循环的时候去更新它就行了，那那怎么怎么就那就是说关键，然后然后有一个定义问题，就是说怎么去计算当前的回撤了，当前的回撤，这个其实也就也就很简单，就是说我在我前面的最高。

就是在我这个价格之前的最高减去当前的价格，那不就是当前的回撤吗，那其实就是我只要记得就周down的定义就OK了，那那然后再去算q me max，那这个也就更简单，也就是说嗯如果我当前的价格创了新高。

那我就update当前的呃，kimi max对吧，那所以整个接下来应该就是，几行代码就搞定的事情，但是如果说嗯就有同学可能会陷进死胡同啊，我怎么知道这个最高的在前面还是在后面呢。

那这个时候可能就会比较麻烦，可能会写了一堆if else，然后又是各种index，然后嗯对，就是就是如果说知道动态规划的呃，这个概念的话，你会知道这个问题的核心是去寻找max之间的，递推的。

或者说叫迭代的关系，对如果你一旦把这个写出来，我相信这个问题就迎刃而解，如果真实在面试过程当中，我觉得对于一个我遇到的嗯，就是candidate写这个问题啊，嗯你开快的话。

其实是12分钟就可以把这个搞定，但也有就拖了20分钟了，还没写出来的，那这个就比较抱歉了，就是对，因为嗯就是如果大家想要严肃的去，就接下来要找矿工作的话，现在一般都会有coding test。

就我今天上午今天上午也写了四个小时的代码，对对，所以所以所以如果说这个问题觉得有困难的话，还是就去那个没刻度上多练，这个我觉得可能没有什么其他更好的办法，对嗯好，所以这个问题大家OK了吗。



![](img/12d14db7cd7a337cb35d5838541b418b_131.png)

呃然后OK那其实主要上次就是讲的这两个问题，然后嗯这周的话给大家留了这样一个题目，就是嗯suppose，就是我有一个random random walk，随机游走在0~1000，然后我们从80开始。

然后然后就是说我们接下来就每一步的话，像上回消杀的概率都是1/2，那接下来就要问的问题是，如果然后我们一定会停的，达到零或者1000的时候，我们就停止，然后我们问达到临停止的这样一个概率是多少。

对就是这个里面如果没有学过随机过程的同学，我觉得随机工程还是要就是找，如果是要找矿工作的话，还是要去去学的吧，就是应该说是一定要去学的，就是martin gale的这样一个概念。

就是然后大家我不知道有没有接触过，就是交易所市场也可以吗，就是呃我我我只要赚了钱我就出金，然后我亏了钱我就死扛，或者说不断的加仓，就是我原来只亏我亏了十个点，我就再加一倍仓位，我再亏十个点。

我再加一倍的仓位，另外说只要有无限的资金，我总会找到市场的，就是mi version，就是市场反弹回来的时候没有这个机会，我就可以，因为我仓位后面反弹回来的时候，我操作很重。

我就可以把前面的亏损就都给弥补回来，相当于抛硬币嗯，就是抛抛对了，给一块钱，然后抛输了要亏亏钱的话，那那其实就是我可以不带你去double，然后直到我直到我把前面亏的都给弥补回来，对对，那。

这个问题的背景，其实就是来自于martin game的这样一个概念，我个人比较偏好，就是说你用随机过程的一些定理，你可以得到一个相对比较优雅的解，然后然后如果说一下子得不到。

analytical solution的话，其实那很简单嘛，我们就跑个代码对，然后去验证一下，就是跑一个跑一个蒙特卡罗的模拟，然后就是我跑个10万次，然后看一下有多少次是零，有多少次是一。

那我相信你得到的数字就跟最后的结果，应该也不会太长，对这个问题呢，嗯就留给大家，还有一个问题就是嗯帮助大家复习一下linear，algebra跟统计，就是就COVERANCE两个随机变量。

COVERMETRIX是smy positive definite，然后这个就不用我多讲了，因为这个很熟悉，我就很拉多出来，然后不熟悉的东西就是那那那面试的时候，这些问题是一定会被问到。

什么是随机变量啊，什么是conversion matrix，然后什么是positive definite，然后怎么去证明，就是希望大家不要把本科学的这些东西给忘掉，因为这些东西在后面的呃。



![](img/12d14db7cd7a337cb35d5838541b418b_133.png)

偷偷出去回里面其实也都可以用到，OK所以今天就留了这两个。

![](img/12d14db7cd7a337cb35d5838541b418b_135.png)

然后对其实今天的内容就这么多，两个小时就跟我预期差不多，因为就是CTP这一块的话，想一下，就没有必要带大家去一个一行行的高位代码，就是我还是把大家整个的整个这一块，CDP是怎么work的，稍微勾勒一下。

然后更多的时间就给大家自己去探索，所以然后呃这门课到今天就是今天的课程，我觉得就OK了，然后有什么问题的话，大家还可以跟我反馈，对我等到十点吧，今天内容比较会少一些。

就相当于说dj market我们可能就暂时先收尾，然后嗯接下来两周可能大家稍微辛苦一点，多写点蛋吧，就是呃讲back testing，因为只有把back testing跟data拉出来之后。

实际上我们呃可就会做很多事情啊，那个作业的话，这边实际上写到就是就是你我们要做的事情，就是把market data implement呃，就是把market的API实现一下。

然后那个功能比如说去收集数据，那刚开始你可以先收集一个品种，但我的建议是希望就是理想的状态，是说这个程序你可以放上去，然后你写好定时任务，交易日自动启动，自动收集数据，然后对理想状态是你不需要人去维护。

这个教育程序，基本上可以理想的就是365天，24小时不断的帮你收集数据，这是最理想的情形，但事实上可能大家可能刚开始达不到嗯，确实呃，我但是我相信大家就是花了一段时间，不断去优化这个程序。

我觉得这个目标还是完全可行的，就就这样的来说，我们可能就可以获得两份数据，一个是我自己在服务器上收集的，然后另外一个就是从嗯就从第三方购买的数据，然后这两份数据可以帮助你交叉二，那个交叉验证啊。

作业的呃，我不知道就是作业的内容是什么意思，就是这其实就是刚刚我们说的就是提到的是，我们只要去把那个像一个sim node code给削下来，然后自己去实现API，然后你看一看。

我你收集到等到周一到周五的时候，你看收集下来一天2B的tick的数据，是不是跟我们拿到了第三方的ARBET数据一致，对，这就是这部分如果完成了之后，我相信就到大家到目前为止，大家应该了解的就是嗯。

就是历史的数据是怎么来的，然后包括我每天生产的数据是怎么收集的，然后接下来就是把我们的回收系统搭起来之后，就不管你有什么想法，其实都可以大家开始去测试了，对，嗯好的，那其实今天课程差不多就是两个小时。

然后大家还有什么问题吗。

![](img/12d14db7cd7a337cb35d5838541b418b_137.png)

短信到嗯。

![](img/12d14db7cd7a337cb35d5838541b418b_139.png)

等到开盘时间再试试吧，包括就是我自己也试了一下，就是好像就是非交易的时候，他不是特别稳定，然后这个所以所以说我说嗯。



![](img/12d14db7cd7a337cb35d5838541b418b_141.png)

最理想的信息就是强烈诡异达拉行为时。

![](img/12d14db7cd7a337cb35d5838541b418b_143.png)

去期货公司网上开个户，然后一分钱都不要入金，也可以跟期货公司客户经理，去要一个实盘的账号，要完实盘账号之后，事实上就是关就是实拍的，我觉得会更稳定，他不会说盘中莫名其妙就延迟或者断掉。

那我觉得这样可能会帮助大家去做，就是做我们的这样一个工作，对，所以就是强烈的鼓励大家是去开个实盘账号。



![](img/12d14db7cd7a337cb35d5838541b418b_145.png)

因为手机app就是真正就是稍微搜一下嘛，就是我也不知道是，7号我在排名看看主流的排名哈，这个是国行，就这么多打广告的，期货公司排名，因为这种对不不过像一般来说嗯，看这种官方评级是相对比较靠谱的。

我觉得就是前面那一般来说大的期货公司，你可能手续费上拿不到特别大的优惠，但是不会出什么岔子，然后小期货公司，你很有可能是说你手续费会有优惠对，然后当然也要看了，就是有些不同的期货公司肯定有特殊的资源。

可能给你的那个相对会快一点，但事实上在国内做CC交易的时候，他们我也不知道人家快，那唯一能做的就是我每个期货公司，我都去开个户，然后去测试一下他们是哪个的，就是延迟最低的。

但是他买率是期货公司是有挺多的，然后我对我自己是有国海军跟中信期货，中信期货这两个对对，中信跟国泰君安对，事实上这排名前面的，我觉得大家都可以随便选，应该相对来说是资本比较呃，呃向后对。

然后有人提到就是开通品种嗯，我不太确定现在有哪些需要特殊品种，可能螺纹螺纹肯定不需要，就是铁矿，原油原油可能是还是股指期货，就原油和股指应该是50万资金的权限，然后铁矿是10万对。

所以正常来说嗯嗯他的期货户很多的，就是期货品种，我们都可以就去交易了，就是没有，所以我个人会觉得，就是说对于入门程序化交易的话，可能在中国期货是比股票更好的一个选择，就是大家看一下这个上市品种嗯。

对同这些相对来说，上期所是会呃，也不能说正规，我觉得各个交易所之间不能有特别偏好，因为曾经有段时间是交易所是比较多很乱，大概是九几年的啊，现在是嗯上海期货交易所相当于正规一些，也包括CTP。

也是它下面上海期货所推出的也CTP，也适时形成上形成了中国期货交易的一个规范，包括后后年的大后，后面的大连期货交易所，郑州商品交易所，他们所提供的API也都是仿照CP，所以说大家把CP学会了之后。

自己要去接其他的一天就会比较容易了，然后这个螺纹钢是中国特有的一个品种，然后其实它的交易就是是非常活跃，然后其实我也是鼓励大家，就是说从这个东西可能该自己去尝试一下。

对就相对来说就是我们我们刚开始做兰花交易，可以选择流动性好的合约，不至于如果真的是失败，就不至于说没有成交，然后拼单拼起来很麻烦，对那这样的话可能就是说流动性好，那程序员的差一点也无所谓，对不对。

那是然后对原油的话，这个合约就是相对会就是绘门槛会高一点，然后并且波动原因最近波动也很大，就是就是大家常常会有人说说是商品期货币嗯，期货觉得炒期货风险比股票高，但事实上大家看到就是，每天23%的波动。

跟股票10%的波动到底谁会更高，对就是就是不能把杠杆，更就是跟风险主要割裂割裂开来看，就是你还是说你你风险是我自己，一个是我品种本身的风险，还有一个是我的杠杆水平，在控制有相同杠杆水平的情况下是嗯。

我个人觉得期货的风险是比股票去低的对，所以估计大家有空的话可以去尝试，嗯好的，那今天课程可能就这么多了，如果没有什么问题的话，那今天就先到这边了，为什么也早点休息吧，嗯去啊狗嗯。

有有没有装那个那个我刚刚看到有没有装，怎么会没有呢，我不好说有没有，就是我们刚刚看到的，大家有没有看到这个第一名，那个嗯期货公司排名里面是第一名，工资可能如果不是很熟悉的话，大家没有知道过。

但他很有可能他就是最大的庄，就是这个公司的特征是我做资管很强，但是我发现我手续费要交给别人那么多，算了，我自己开个期货公司吧，就相当于OK这样把手续费给省了，然后自己对所有的交易我也不用从其他公司走。

别人也不知道我的仓位，所以你说有没有装，那不厚道，说他就是最大的庄对，然后因为相对来说大家都知道，就是股期货的资金相比于股票是非常少的，股票，大家看到成交量上万亿的那期货可能显然没有。

比如说一个品种龙龙流入几亿资金，其实是非常大的，也就说你有股票市场是，所以相对来说气候会比股票上面，就是受资金面影响会大一些，但是期货又有另外一个方面，会直接就是嗯，他在到期的时候会跟现货的价格去收敛。

但股票就不是这样的，股票没有一个现货的基准，所以从这个角度来讲，期货要炒也是可以的，那个去炒就是别人炒期货，你可以把价格用你的资金，或者是用信息优势，达到一个靠而非常离谱的地步。

但是到最终归根结底他还是会回归现货，所以这个是一个相对来说它有的优势。

![](img/12d14db7cd7a337cb35d5838541b418b_147.png)

然后嗯有感兴趣的话，大家可以去搜一下，327国债期货事件对我就不暴露，我的知乎账号。

![](img/12d14db7cd7a337cb35d5838541b418b_149.png)

对就是这个这个事情是比较有意思的，就是是类似于B仓，对，就是杀红眼了，那这个时候我还记得，还记得我们上节课提到一个结算价吗，我按照这个价格来去确定，我是按什么价格就交割，那么那么我如果自定雄厚的话。

显然是可以去影响结算大的，那还有一个很重要的概念叫自成交，自成交什么意思，就是我自己挂的单，跟自己挂单成交，那这个也是有可能的，尤其在不流动不流动的合约上，那么交易损失规定嗯，如果你不是故意的。

那就是小于五首，一天小于累计小于五首的这种自成交时，可以没问题，但是多的话你要写报告，甚至会被暂停交易，然后那自成交易是什么，有什么意义呢，说自己跟自己交易不是亏损的，但是有一点问题。

就是说我可以去manipulate，为了计算价，假定一个不流动的远就是远月合约，结果我把价格打到了涨停和跌停，就这一手价格打到涨停和跌停，那么是不是也可以影响主力合约和次，主力合约呢，然后换句话来说。

如果嗯如果别人跟我正好要去交割的时候，我自己通过呃自成交，把价格达到了一个非常离谱的方式，那是不是也可以获取巨额利益，那这个是非常危险的一个事情，所以说会去呃，哎就是去大家就是交易的时候要去。

要根据你的就是order id，能够去避免就自成交的现象，对嗯是不是在收敛的时候开始做空，去做空的话，但是就是说我知道这是高志中同学，意思是说你收敛，你是希望就是把它说，期货跟现货的基差是给收敛。

当然可以把这个基差去做空收敛，但是有一个问题是我们没有现货呀，对就是嗯理论来说，大家说就是说期货并不是没有成本的，就是你持有到哪，事实上你期货也是要付出成本的，这个就是返回在你到期一定会收敛。

就有个叫升贴水，对，这个，这个实际上就是我们在持有期货所付出的成本，对嗯收敛的时候做空，那还有一个可能就是说你基差确实是现货炒期，或者收敛了，就是期货价格靠近现货，但是嗯比如说期货价格高，现货价格低。

但是千万不要忘记现货本身也是有价格的波动，比如说苹果期货从4000块钱一吨涨到了1万2，一吨，是基差由原来的，比如说期货是5000块，最后变成了1万220，可能只有200的基差。

那虽然说是基差有1000收敛到200，但事实上苹果期货本身的价格，还是涨了7200对，所以说如果没有没有没有期没有现货的话，那是肯定不能做这样的事情，也就是如果大家有关注，最近有关注原油的话。

其实也挺有意思的一个事情，就是远期的期货跟现期的期货，就是有一个神贴水这样的倾向，但事实上大家就是不少交易商，靠这个赚了不少钱，因为我那无论是买进买进卖人还是买进卖淫，我只要能够找到合适驾照就可以。

并且手上有现货就可以锁定这样的一个利润，对这个是非常有意思的一个事情，就是期货其实刚开始最投出的就是，最初推出的目的，并不是为了大家就是speculation投机，而是为了是去对冲风险。

因为就有价格远期的波动风险，但事实上就是主流，这在期货当中嗯，看基本面试其实是挺靠谱的一个方向，但是没有相关的呃资源的话，其实做这个方向也是挺困难的，就是说其实期货参与方除了说个人交易者，机构交易者。

那还有就是非常重要的一个叫贸易商对，好的哦，就跟大家扯了这么多，那如果今天没有什么的话，我们课程就先到这边就先结束啦，感谢大家，然后嗯对作业好好做就是这样，然后然后有什么任何的feedback。

欢迎是在微信群里或者是跟我个人私聊，今天课程就先这样了。

![](img/12d14db7cd7a337cb35d5838541b418b_151.png)