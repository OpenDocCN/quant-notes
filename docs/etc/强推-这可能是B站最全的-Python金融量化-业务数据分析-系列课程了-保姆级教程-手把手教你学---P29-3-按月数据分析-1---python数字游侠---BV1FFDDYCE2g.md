# 强推！这可能是B站最全的【Python金融量化+业务数据分析】系列课程了，保姆级教程，手把手教你学 - P29：3.按月数据分析~1 - python数字游侠 - BV1FFDDYCE2g

那么接下来我们来看一下第二部分的实现啊，第二部分主要是按月，对我们的数据进行一个分析吧对吧。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_1.png)

那按月的话，那这块的话，咱们原始数据当中，是不是已经有一列表示是mouth。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_3.png)

Mouth，对应的是我们每一个用户他消费的一个月份。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_5.png)

对不对啊，那这块的话，咱们来看一下它的具体需求有哪些啊，第一部分啊，第一部分，他说用户我们要求出用户每月花费的总金额啊，用户每月花费的总金额。



![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_7.png)

那么这块的话咱们该基于怎样的技术去实现呢，对吧，是用我们的映射呢，分组呢，透视呢还是交叉呢对吧，用什么呢，你会发现这一块我们要求出的是每月是吧，每月用户花费的总金额，那如果是3月份。

3月份有多少个用户去消费的呀，不知道吧，可能有一个可能有十个吧对吧，那么这块的话咱们的重点是放在月份当中啊，那这块咱们是不用分组比较好啊，将我们原始数据按照月份分组吧对吧，按照月份分组啊，那分完组之后。

我们要求的是不是我们消费的总金额，对不对，好，我们再就是d f d r group by对吧，这块的话就是by等于什么，等于我们的month吧，是根据月份分组啊，对吧好，然后的话那分完组之后。



![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_9.png)

我们要求的是谁，求的是不是金额呀，金额是哪一列。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_11.png)

是我们的order amount呀对吧，对order amount进行一个求和吧对吧。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_13.png)

好在这的话是点儿sum走，是分组聚合，那在这咱们就求出那一共啊，一共是有这么多个月份吧对吧，因为会有97年跟98年不同的月份，是不是OK吧，那月份有了之后的话，后边对应的是我们每个月份。

所对应的一个时间吧，把所对应的一个呃这个这个这个消费的总金额，是不是OK吧。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_15.png)

那这块的话咱们就求出我们对应的需求了吧，然后说我们在这可以基于一个什么。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_17.png)

基于一个线性图进行一个展示吧对吧，那现在我们能不能把这两组数据。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_19.png)

绘制成一个线性图呢，对吧，怎么绘制线性图呢，是不是可以用我们的matt pat leap呀。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_21.png)

对不对，matt pl的lib啊，在这是这个PLLTD是plot是吧，然后将我们这个表达式所返回的series，是不是作用到这里边就可以了，对不对好，我给他复制一下啊，好放进去走。



![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_23.png)

你现在这样的话，我们的线性同时就出来了对吧，当然你还可以这么去玩啊。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_25.png)

这么去玩啊啊这是一种方式啊，还可以这样啊，然后是直接在这个series后边点一个plot也可以，OK吧。



![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_27.png)

在series后边直接点一个float走，不图也出来了对吧，我们会发现你看下边对应的是不是月份对吧，月份是我们的X轴Y，然后上边的这个Y轴，对应是每月它的一个总消费的金额吧。

你会发现这组商品的话是不是在前三个月对吧，他的这个消费金额是直线上升的吧，比较快，对不对，从第三个月以后，他就会急剧下降，是不是啊，所以说他前三个月是他的高峰期，是不是啊，那完了之后呢。

用户的一个消费的总金额就下降了吧，然后到我们的这个什么呢，4月份和5月份又有逐步的环升，后边又有下降吧对吧。



![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_29.png)

通过这样的图，咱们就能够知道不同月份，所对应商品的消费的一个总金额。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_31.png)

他的一个上升跟下滑的一个趋势吧对吧，上升跟下滑的趋势啊。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_33.png)

好这是我们的一个需求，那再看啊，再看下边。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_35.png)

我们说要算出所有用户，每月产品的一个购买量啊。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_37.png)

产品的购买量，那这块的话我们是基于什么呢。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_39.png)

基于我们的月份去统计用户产品的购买量吧，对不对，那就是说我们要算出我们的3月份，到底有多少人啊，到底到底这些个用户呢到底买了我多少商品吧，我不管他花了多少钱吧，我只是看他购买我商品的数量吧。

那这跟上一个需求差不多吧，是不是也对我们的月份分组啊对吧，group by对月份分组by等于month month之后。



![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_41.png)

我们需要单独把我们的什么呢，购买产品的量，把这些列举出来吧。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_43.png)

产品购买量是不是我们的order杠product呀，这不是用户购买产品的数量啊。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_45.png)

对吧，对它进行一个什么呢，点sum取货是不是就可以了，造那现在这个值也有了。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_47.png)

它也是一组serious吧，对不对，当然你看这的话。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_49.png)

我们还可以干什么呢，在这我们也可以点一个plot，把这个图画出来吧。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_51.png)

对不对，你会发现你看哎，这个图跟我们刚才所看到的是什么呀。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_53.png)

用户消费的一个总金额啊，用户就是我们每月用户消费的总金额。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_55.png)

跟每用户每月购买产品的数量，这个线性图是不是几乎一样啊，对吧一样，那肯定是一样的，因为他购买商品的数量多了，你的总金额就上去了吧，购买商品的数量少了。



![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_57.png)

总金额是不是就下来了对吧，这俩图是不是几乎一样啊对吧，几乎一样啊。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_59.png)

好然后再看第三个，我们要算出什么呢，所有用户每月消费的总次数对吧，这个是消费的次数吧对吧，消费的总次数，那什么叫做消费的总次数呢，各位讲一下每月用户消费的总数，你想一下，那比如说我4月份。

4月份到底有多少用户来我这消费了呢对吧，那有多少用户就是消费多少次吗，不是你要知道啊。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_61.png)

你看我看一下原始数据，你看DF当中，你看这块啊，在1月1号这天是用户第一消费了一次对吧，然后的话在1月12号这一天，二用户消费了一次吧，1月12号二用户是不是又消费了一次啊。



![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_63.png)

那所以说是不是在同一天，不可能会有用户消费多次啊对吧。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_65.png)

可能会有用户消费多损啊，那我们在这要统计出我们每月用户消费的总数，你要知道在原始的数据当中每出现一行，就是每一行表示的是一个用户消费的次数啊，对不对，你要知道啊，在原始数据中。

原始数据中啊的一行数据表示一次消费记录吧，对吧，那我们要求的是每月用户消费的总数，就是说我们首先是先对用户分组啊，是先对这个月份分组啊对吧，group by还是先对我们的这个月份分组，月份分组完了之后。

我们干什么呢，我们要求什么呢，消费次数吧对吧，要去求消费的总次数，那么这块的话消费的总次数，我们说那么每消费一次，对应的是不是一行数据啊，对应的是一行数据吧对吧，那我们按照月份分完组之后。



![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_67.png)

我们要求什么呢，求一下count，count是啥啊，各位count是啥，count指的是不是我们的这个什么呢，这个基于月份分组完了之后分分成，比如说分成了十组吧是吧，分十组每组到底有多少行数据吧。

有多少行数据意味着我们就在这儿，这个消费了多少次吧，对不对，有多少行数据有效消费多少次。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_69.png)

那在这的话咱们直接点com rol，你看一下，那这块的话，我们的1月份消费了什么呢，8928次吧，2月份消费了1万1272次，是不是，4月份消费了1万一一千五百九十八次吧，OK吧，是消费了这么多次吧。

对不对，那在这的话我们还可以在这干什么呢。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_71.png)

比如说我在这就直接用一下user guid，是不是也可以啊对吧，这样的话让它返回一个serious，是不是也行啊对吧，那如果不用它的话，是不是意味着我的count是对我们这个原始数据当。

中所有的列能进行个数统计的数据，都统计下个数啊对吧，那么在这加上一个user id的话，就是说对我们的用户啊，所对应的出现次数是不是进行了统计啊，不一样啊，一样吧，最终这些值我们是不是拿到就可以了对吧。

这些值我们拿到就OK了啊，那在这的话我们就算出了每月每月啊，用户消费的次数了吧，会发现是不是前三个月消费的总次数是比，是是是直线上升的，是不是从第四个月开始就下降了吧。



![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_73.png)

对吧好，那这块的话就是我们的这个呃。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_75.png)

A还有一个需求吧，还是说统计每月消费的人数是不是OK吧。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_77.png)

刚才我们实现的是不是第三个，我们是所有用户每月消费的总次数吧对吧。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_79.png)

总次数有了之后看最后一个啊，最后一个还有一个是统计每月消费的人数。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_81.png)

OK吧，那这个消费人数跟消费的总次数有什么区别呢，你要知道有这样的区别，就是说可能可能这个同一天同一天，然后一个用户会消费多次吧，对不对。



![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_83.png)

那么同一天我们刚才会看到啊，刚才在我们的原始数据里边，是不是看到了这个什么这个用户二。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_85.png)

是不是一天之内消费了两次啊对吧，那现在我们要统计的是消费的人数。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_87.png)

而不是消费次数了吧，我们说原始数据的一行表示一次消费记录。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_89.png)

对不对，那现在我们能不能把原始数据当中的一行，当成一次当成一个消费人数啊，不能吧，因为我们会知道，那同一天可能一个用户会消费多次吧对吧，我们这统计是不是人数啊，那这怎么去做，是进行一个驱虫就可以了对吧。

DR还是group by，是不是是先分组啊对吧，各位by啊，这根据谁分组呢，还是根据我们的MK分组吧，根据mars分组，然后干啥呢，然后的话在这我们拿到什么呢。

是不是拿到我们的这个user guid这样的一列啊，对吧，这样的一列啊，那拿到user id之后，下一步干什么呢，在这儿进行求和吗，是进行求和吗。



![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_91.png)

不是求和吧对吧，你这个用户id是不可以求和的吧，那有同学说那在这统计次数呢怎么办。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_93.png)

是不是可以啊，count是不OK啊，要是有这统一次数的话。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_95.png)

是不是跟上面就一样了，就没区别了吧对吧，那我们说啊，这个count是用来统计我们最终根据月份分组之后，每一个组当中出现数据的行数吧，我们说出现一行表示一条消费记录吧，那我们就知道。

那我们现在要求的是消费人数，因为一天可能有多个用户进行消费吧，你在这我能不能对user id进行一个去虫呢，可以吧，驱虫。



![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_97.png)

那怎么驱虫呢，我们叫做uni queen，是不是驱虫啊，那它仅仅是去虫。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_99.png)

我们想要的是驱虫之后还得是统计个数啊，你看在这说1月份驱虫之后，是不是这些啊，这些用户都是在1月份消费的人数啊，这是2月份消费的人数吧，对不对，我们知道1月份消费人数二是不是消费两次啊。

这怎么只有一次呢，是不是去虫了对吧，我们是不需要把去虫之后的这个人数统计一下，怎么办，在N在不在这个unit queen下面加一个N，N表示是不是number啊，走那这个就表示什么表示。

就是说我们统计一下去除之后的人数统计吧，是吧，N啊表示什么呢，n unit qu啊，表示统计去重后的个数吧是吧，去除后数据的够数吧，就在这你直接用uni queen不行。

unit queen仅仅是给驱虫吧，去重完了之后，我们得统计个数吧对吧，去冲完了之后还剩下多少用户，那么这些用户加起来对吧，他就是我们当月消费的人数吧，你看1月份一共有7864人消费吧。



![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_101.png)

对吧，那前边这个是不是9000，不是8928，这个是不是1月份的消费消费的次数啊对吧，就是一共啊一共有7846个用户，一共消费了8928次，是不是这意思吧。



![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_103.png)

OK吧好那这块的话是我们第二部分啊，他的一个实现啊。

![](img/296dbcc2af7fdc9d5c9ff5c5f10501b5_105.png)