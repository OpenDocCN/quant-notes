# 吹爆！Python金融分析与量化交易实战课程全详解，迪哥手把手教你基于Python实现金融量化+股票交易，究极通俗易懂！ - P64：2-Pandas数据重采样 - 迪哥带你学CV - BV1KT421Y73G

![](img/a5d13b281cf7fc1545e30f109435d87b_0.png)

这节课呀咱们来讲一个就是对于时间序列啊，我们在一个实际应用当中啊，最常用的一种手段叫做数据重采样，现在大家来解释一下。



![](img/a5d13b281cf7fc1545e30f109435d87b_2.png)

咱们今天要讲的这个数据重采样是怎么一回事，比如说啊你现在有一份数据，那这份数据呢可能之前你的一个统计啊，是按天进行统计的，比如说从这个17年的6月份，一直统一到18年，然后持续这么一年。

但是呢每一个时间点他都是这么一天，那你现在一个问题来了，就是说嗯你不光想去按天去看一下数据的变化，你想啊，就是说能不能通过一个月的变化来去看一下，就是整体的一个数据，它变化的程度呢。

这回啊我们就要涉及到一个数据重采样的问题，也就是说原来呢我们统计的一个频率啊，是一个以天为频率的，那现在呢我想给他换到一个以月为频率，这个时候我们就需要啊做这样一个转换了，那在我们的数据重量当中啊。

其实我们不光可以把这样天变成这样一个月，那其实大家可以这么想，就是说原来啊假设说咱们统计一年，那一年啊是有365天，那现在我想统计成月，那是不是由365个点变成了12个点啊，那相当于什么。

相当于我们数据变少了吧，那这是一个降采样的过程，那既然啊有我们的一个降采样，那肯定还有对应的一个升采样的过程，比如说现在呢嗯我是由12个月，我统计了是12个月的数据，我想要把这12个月的数据给它变拉长。

就是让数据点变多，由这样一个月份变成这样一个天数，这样咱们频率就升高了吧，所以说啊我们还有这样一个生产上的问题，在数据层嗯，在数据冲量样当中啊。



![](img/a5d13b281cf7fc1545e30f109435d87b_4.png)

一会对家就给大家来演示一下，怎么样用这个pandas as来完成这样一个降采样，还有升采样的过程，呃，首先啊咱们还是嗯先生嗯，先就是做这样一批数据，随便啊就是拿出来一批数据，然后这个数据啊。

就是我是用安排随机生成这些数据啊，就是由咱们的一个201年1月1号啊，随便指定个日期，然后呢从这天开始随便造了90个数据啊。



![](img/a5d13b281cf7fc1545e30f109435d87b_6.png)

咱们的一个frequency啊，是等于D啊，以天为单位的，然后这个是我的数据啊，那现在我的一个要做的来了，就是说我要做这样一个重采样啊，重采样在pandas当中啊。

我们有一个函数叫做一个RESIMPLE，直接啊，可以用这个RESIMPLE，帮我们就是完成了这样一个重采样的过程，比如说现在你不是以天为单位吗，我想要给它转换成以月为单位。

咱们只需要就是把咱们刚才指定好的这个time series，咱们的一个时间嗯，时间周期数据啊，拿过来，拿过来之后呢，我们调它的一个RESEMBOL的一个方法，里边要传进来的，就是说嗯。

接下来你这一个转换的一个频率是什么，在这里啊，我们如果说想把天转换成月，在这里我们只需要把一个M值传就可以了，相当于是一个mouse，然后呢咱们转换完之后啊，哎是不是说你这个就是原来是一天。

那现在转换成一个月，咱频率降低了，那你要统计一些指标吧，你是想看就是每一个月的一个总和呢，还是想看每一个月的均值呢，这些啊，就是说你要按照一个什么样的指标去观察，这样的数据，也需要咱们先给它指定。



![](img/a5d13b281cf7fc1545e30f109435d87b_8.png)

好，比如说我现在想看一下，就是嗯对于这个1月份。

![](img/a5d13b281cf7fc1545e30f109435d87b_10.png)

2月份3月份来说啊，它的一个总和是等于多少啊，上面就是我随机产生的一些数据。

![](img/a5d13b281cf7fc1545e30f109435d87b_12.png)

下面呢是我随机啊，就是不是随机，下面就是说直接啊receive完，看他的一个点sum。

![](img/a5d13b281cf7fc1545e30f109435d87b_14.png)

点sum就是说进行咱们的一个求和的操作。

![](img/a5d13b281cf7fc1545e30f109435d87b_16.png)

求出完之后啊，我就得出来张当前的一个结果了，原来是有90天，那现在是不是变成三个月了，对应于1月份，2月份，3月份我分别啊可以算出来在月份上啊，他的一个总和是得多少，2月份的3月份的总和啊。

分别求出来了吧。

![](img/a5d13b281cf7fc1545e30f109435d87b_18.png)

那这里呢我们来看就是嗯，当咱们在进行一个RESIML的时候。

![](img/a5d13b281cf7fc1545e30f109435d87b_20.png)

如果说你要进行一个，就就是进行一个咱们的生产啊，降采样的时候。

![](img/a5d13b281cf7fc1545e30f109435d87b_22.png)

当我们进行教材上的时候啊，一般也可以指定一个周期，比如说我们现在不指定一个帽子。

![](img/a5d13b281cf7fc1545e30f109435d87b_24.png)

不指定一个月，指定三天，可不可以啊，也是可以的吧，我们来看三天，你求一个和一号4号七号相当于啊这个一号啊，就是之前一号4号呢相当于前面三天7号。



![](img/a5d13b281cf7fc1545e30f109435d87b_26.png)

前面三天10号，前面三天，这样我就分别把我的数据啊又给算出来了。

![](img/a5d13b281cf7fc1545e30f109435d87b_28.png)

那在这里呢就是我们不光可以算它的一个总和，还可以算它的一个均值，就是有这样一个命值嗯，通常就是SAM和和main值啊，是我们经常统计的两个指标，或者说呢你可以自己写这样一个apply函数。



![](img/a5d13b281cf7fc1545e30f109435d87b_30.png)

然后apply里边怎么去计算，我们也可以自己进行一个指定的嗯。

![](img/a5d13b281cf7fc1545e30f109435d87b_32.png)

那下面我们要想的一个问题来了，就是刚才我们说了两种方法嗯。

![](img/a5d13b281cf7fc1545e30f109435d87b_34.png)

这个降采样比较好理解，那升采样它会不会有一些问题啊，咱们来想啊，假设说啊。

![](img/a5d13b281cf7fc1545e30f109435d87b_36.png)

现在你的一个数据嗯是以三天为单位的，你想要给它进行一个就是生产样，变成一个以天为单位的，那现在就是比如说你三天为单位的，是不是说嗯123这三天是一个单位，但是呢一是多少，二是多少，三是多少，你不知道。

你可能只知道这三天的一个总和，那这个情况下怎么办啊，这个情况下我们就需要指定一个策略了，或者说你只到知道第一天的数据，而不知道第二天，第三天，这个时候怎么办呢，我们需要进行一个差值的填充了。



![](img/a5d13b281cf7fc1545e30f109435d87b_38.png)

比如说啊对于上面的数据，我们来看，我们是每三天进行一个统计的吧，那现在我想给它进行一个生产样，让它频率增高，变成一个以天为统计的，那这个2号的数据长什么样，3号数据又长什么样，现在我们不知道吧。

因为咱们的原始数据，原始的数据集当中啊，也没有这个东西吧。

![](img/a5d13b281cf7fc1545e30f109435d87b_40.png)

假设说啊，你原始数据集就是一个以三天为单位的，那这个时候怎么办呢。

![](img/a5d13b281cf7fc1545e30f109435d87b_42.png)

我们可以啊，就是啊首先我们给它指定，就是进行一个直接你什么都不指定的时候，我们指定这样一个生产上的过程，然后看一下它的一个结果啊，然后as思一下咱们当前的一个frequency。

就是当前是一个以天为单位的。

![](img/a5d13b281cf7fc1545e30f109435d87b_44.png)

现在就是什么第一天有数据，第二天an第三天a an a an什么not a number吧。

![](img/a5d13b281cf7fc1545e30f109435d87b_46.png)

就是说它是一个空值，那空值的情况下怎么办啊。

![](img/a5d13b281cf7fc1545e30f109435d87b_48.png)

很多情况下，空值是影响着我们的一个计算和统计的吧，在在这里呢就是可以基于啊。

![](img/a5d13b281cf7fc1545e30f109435d87b_50.png)

一种最简单的一种插值的方法，我们来看在这里啊。

![](img/a5d13b281cf7fc1545e30f109435d87b_52.png)

就是我们有啊三种插值方法啊，最常又是最常用的三种。

![](img/a5d13b281cf7fc1545e30f109435d87b_54.png)

第一种啊就是一个f fail，第二呢是一个b fail，还有一个就是咱们进行一个线性的取值，嗯第一个就是说嗯当我们出现空值的时候，我可以让我的空值啊跟前面的值是相等的，我们来看一下。

还是啊之前的数据我写了一个点f file，然后里边传进来一个一相当于什么，相当于啊就是说我对前面的一个空值，按照它前面的值进行了这样一个差值，原来啊这个2号数据是没有的吧。

那现在我写了一个fill里边传进来一个一，相当于什么，对于咱们的其中的一个空值，按照他前面的那个数据，前面那个数据啊等于0。015，那当前啊我计算出来的一个2号数据，也是等于一个0。015的啊。

就是说按照前面数据等于什么，我这个啊现在不知道数据它就等于什么，那field啊，咱们还可以填一个值吧，填一个一啊，相当于是我要填就是对我的一个呃note number的值啊，进行一个值的填充。

那我写个二呢。

![](img/a5d13b281cf7fc1545e30f109435d87b_56.png)

写个二，就是说把我缺失值都填充上去了吧，那这点啊就是说你写一个个数。

![](img/a5d13b281cf7fc1545e30f109435d87b_58.png)

相当于是你要对多少个这样一个缺失值，进行一个差值的填充，这是啊咱们的一个啊以FF啊，就是front by啊。



![](img/a5d13b281cf7fc1545e30f109435d87b_60.png)

B啊就是指的是一个以后值，就是说我们可以取前面，也可以取后面进行这样一个填充。

![](img/a5d13b281cf7fc1545e30f109435d87b_62.png)

我们再来看当咱们指定一个B的时候，我们来看就是这块3号原来没数据的吧，它按什么进行填充的，按他后面的数据，按4号去填充的。



![](img/a5d13b281cf7fc1545e30f109435d87b_64.png)

你也可以指定二，指定二它就相当于是填满了。

![](img/a5d13b281cf7fc1545e30f109435d87b_66.png)

然后呢在我们填充的时候啊，如果说嗯拿前面的或者拿后面的填充啊，有点太绝对了，我也可以啊做这样一个线性的拟合，比如说现在啊我是不是有一些点，那这些点他之前还是以三天为单位的，那我把这些点连在一起。

连在一起啊，相当于什么，相当于做了这样一个折线图吧，做完了这样一个折线图之后啊，我就知道了，比如说这个一号和4号这两个点，原来是我有的吧，把它俩之间连成一条线，连成一条线，中间啊。

就是有2号也有3号的吧，那2号的点对应在线上什么样位置，3号点对应在线上什么样位置，也是可以知道的吧。



![](img/a5d13b281cf7fc1545e30f109435d87b_68.png)

这相当于什么，相当于啊做这样一个线性的填充，先把我的点连在一起，再在我点上呢找这样的间隔相等的间隔，取2号和3号的一个数据啊。



![](img/a5d13b281cf7fc1545e30f109435d87b_70.png)

再作为我的一个时间值的一个填充，这样呢，我们就可以完成一个生采样的一个策略了。

![](img/a5d13b281cf7fc1545e30f109435d87b_72.png)

生产量当中啊，我们有三种比较常用的方式，刚才大家说了。

![](img/a5d13b281cf7fc1545e30f109435d87b_74.png)

分别是咱们的一个前后差值，还有这样一个曲线性的一个差值。

![](img/a5d13b281cf7fc1545e30f109435d87b_76.png)

那这个就是我们数据重采样的一个过程啊，主要两种降采样和升采样。

![](img/a5d13b281cf7fc1545e30f109435d87b_78.png)

主要啊就是用我们pandas as的一个函数，叫做RESEMLRESEMBLY，指定一个操作。

![](img/a5d13b281cf7fc1545e30f109435d87b_80.png)

我们就可以帮咱们完成这样一个数据重，采样的过程中，采样啊是咱们比较应用的多的一个内容，因为呢在我们的数据当中啊，我们经常会按照各种各样的频率统计吧，不同频率啊统计出来的结果应该都是不一样的。

也就是说我们在做数据分析的时候。

![](img/a5d13b281cf7fc1545e30f109435d87b_82.png)