# 基于回归模型的股票收益预测及量化策略中的运用-量化金融与机器学习2024 - P1 - 背包2004 - BV1bb421b7iU

![](img/419fe4e9c799eb645ee984e07a5711bd_0.png)

接下来呢我们呃要用另外一种方式来做模型，然后来做策略，这种方式我觉得可能会更加更加靠谱一些吧，那我们试一下啊，我们试一下，就是我们用回归来做回归的话。



![](img/419fe4e9c799eb645ee984e07a5711bd_2.png)

那显然就是做什么呢啊我们先先复制收益啊。

![](img/419fe4e9c799eb645ee984e07a5711bd_4.png)

就是我们呃之前我们是预测股票涨跌，然后呢用它会涨的这个概率来排序，然后用用，然后然后去买最能涨的，那这里的话我们呃改换一下思路，我们不再去预测股票的所谓的二分类做涨跌啊，虽然说那那种方法可能会比较稳妥。

但是我们预测什么呢，我们预测股票的收益，然后呢我们把我们认为收益最大的那些股票，我们来买，它能理解吗，那就直接去买收益最大的就行了，我们预测股票的收益嘛，然后到了那一天我们买买，我们预测出来收益。

未来30天收益最大的股票啊，这个思路就很简单啊，很简单，那么前提是我们先要把这个东西给算出来啊。

![](img/419fe4e9c799eb645ee984e07a5711bd_6.png)

先要预测，把这个模型做出来，模型做出来，其实套路是一样的啊。

![](img/419fe4e9c799eb645ee984e07a5711bd_8.png)

机器学习的套路就是呃是一样的，我们。

![](img/419fe4e9c799eb645ee984e07a5711bd_10.png)

我们把这个上面的代码先拿过来吧，啊先把它放一起拿过来好不好。

![](img/419fe4e9c799eb645ee984e07a5711bd_12.png)

然后再慢慢的改它啊，再改一改就行了。

![](img/419fe4e9c799eb645ee984e07a5711bd_14.png)

把上面这些代码上面，我们做二分类的代码拿过来，模型还是用一样的模型啊。

![](img/419fe4e9c799eb645ee984e07a5711bd_16.png)

用一样的模型。

![](img/419fe4e9c799eb645ee984e07a5711bd_18.png)

看到这里，然后还有哪些我们要重新训练嘛是吧。

![](img/419fe4e9c799eb645ee984e07a5711bd_20.png)

![](img/419fe4e9c799eb645ee984e07a5711bd_21.png)

都拿过来好。

![](img/419fe4e9c799eb645ee984e07a5711bd_23.png)

这就是一个模型的完整训练，但是呢现在我们需要干嘛呢，我们需要预测收益，那么意味着我们不需要这个东西了。



![](img/419fe4e9c799eb645ee984e07a5711bd_25.png)

我们看看我们的收益在哪里，我们收益实验算过的啊。

![](img/419fe4e9c799eb645ee984e07a5711bd_27.png)

收益之间是算过的。

![](img/419fe4e9c799eb645ee984e07a5711bd_29.png)

![](img/419fe4e9c799eb645ee984e07a5711bd_30.png)

呃我们这个应该是未来30天的收益是吧。

![](img/419fe4e9c799eb645ee984e07a5711bd_32.png)

所以说我们拿这个就行了，我们在上节课其实之前就算过了。

![](img/419fe4e9c799eb645ee984e07a5711bd_34.png)

所以我们拿这个，收益需要标准化吗，我觉得，收益需要标准化吗，我觉得可不可以可以也可以标准化吧，也可以，那还是不标准化吧，我们只是把特征标准化，收益不做标准化，先试试好不好。

特征做特征我们已经做了标准化了啊，就这个这个还是选择0。4吧，0。5好吧，时间是一样的，也是18年到222年，然后收益拿过来是这个，我们其实待会可以试一下，如果把收益也标准化，是不是会效果更好呢。

啊这个这个就不知道了，呃这些都拿过来的话，我们现在要干嘛，要把这个改掉，我们不再用这个了，我们得用GBDT的一个回归器。



![](img/419fe4e9c799eb645ee984e07a5711bd_36.png)

而不是用这个分类器啊，这是GBT的一个分类器。

![](img/419fe4e9c799eb645ee984e07a5711bd_38.png)

回归器的那个函数，名称上面我导入的时候应该拿了。

![](img/419fe4e9c799eb645ee984e07a5711bd_40.png)

是这个啊，四个。

![](img/419fe4e9c799eb645ee984e07a5711bd_42.png)

![](img/419fe4e9c799eb645ee984e07a5711bd_43.png)

啊这样就好了，然后我们运行一下，先，看一下效果。

![](img/419fe4e9c799eb645ee984e07a5711bd_45.png)

好出来了，有了这个的话，我们看一下这个呃决定系数是多少，决定系数是啥呢。

![](img/419fe4e9c799eb645ee984e07a5711bd_47.png)

决定系数应该是代表的呃，拟合优度表示模型，就是说模型靠不靠谱。

![](img/419fe4e9c799eb645ee984e07a5711bd_49.png)

大概这个意思啊，我们看一下决定系数好吧，1。10。01就是有那么一点点靠谱，那就这个意思啊，有那么一点点靠谱，什么意思呢，如果是零就没啥靠谱的，完全不靠谱啊，零或者是负数的话，那就还不如不不搞了啊，0。

1的话就是还可以一点点啊，一点点当然是越大比较大一点会好啊，这是所谓的R方啊。

![](img/419fe4e9c799eb645ee984e07a5711bd_51.png)

就是这个决定系数，我们看一下这个均数，那绝对就平均绝对这么差。

![](img/419fe4e9c799eb645ee984e07a5711bd_53.png)

![](img/419fe4e9c799eb645ee984e07a5711bd_54.png)

我看看啊，平均绝对误差啊，就这个东西啊。

![](img/419fe4e9c799eb645ee984e07a5711bd_56.png)

平均绝对误差，13%啊，他的这个就是呃他的这个收益的一个预测的，一个平均的差异在13%啊，13%，一个月的收益预测差距在13%，其实也挺高的啊，其实也挺高的好吧。



![](img/419fe4e9c799eb645ee984e07a5711bd_58.png)

这就是呃我们的模型啊，模型就是这个模型有了这个模型的话呢。

![](img/419fe4e9c799eb645ee984e07a5711bd_60.png)

我们还是把这个模型放到我们的程序里面。

![](img/419fe4e9c799eb645ee984e07a5711bd_62.png)

跑一跑啊，就是看看能不能用啊，这个其实其实过来直接运行就行了啊，我看看需不需要改，应该是不需要改的，我们的那个呃啊不是不是这个啊。



![](img/419fe4e9c799eb645ee984e07a5711bd_64.png)

不是这个，呃我们的模型依然是这个名称。

![](img/419fe4e9c799eb645ee984e07a5711bd_66.png)

看见没有，模型依然是这个名称哦，对这个时候不需要不需要这个了，要改啊，要改。

![](img/419fe4e9c799eb645ee984e07a5711bd_68.png)

好那我们把这个拿过来吧，我们在下面改一改，因为我们现在不再是预测呃。

![](img/419fe4e9c799eb645ee984e07a5711bd_70.png)

预测下面的东西了，我们来。

![](img/419fe4e9c799eb645ee984e07a5711bd_72.png)

![](img/419fe4e9c799eb645ee984e07a5711bd_73.png)

![](img/419fe4e9c799eb645ee984e07a5711bd_74.png)

![](img/419fe4e9c799eb645ee984e07a5711bd_75.png)

这里也得去掉，这里没毛病。

![](img/419fe4e9c799eb645ee984e07a5711bd_77.png)

同样是拿一样的这个呃，这个特征特征变量特征矩阵是吧。

![](img/419fe4e9c799eb645ee984e07a5711bd_79.png)

关键是这个位置我们拿到，我们先break一下。

![](img/419fe4e9c799eb645ee984e07a5711bd_81.png)

我们拿到这个之后啊。

![](img/419fe4e9c799eb645ee984e07a5711bd_83.png)

拿到这个之后我们得干嘛呢，还是得获取这个东西啊。

![](img/419fe4e9c799eb645ee984e07a5711bd_85.png)

这个是没毛病的，我们依然是获取我们的特征矩阵啊，这而且这已经是那个呃标准化了的。

![](img/419fe4e9c799eb645ee984e07a5711bd_87.png)

但是呢我们现在用用什么呢，用cl f点predict，他直接做预测。

![](img/419fe4e9c799eb645ee984e07a5711bd_89.png)

用它来预测我们的那个收益，你看收益真这么。

![](img/419fe4e9c799eb645ee984e07a5711bd_91.png)

我觉得这个东西是不是要做一个那个收益啊。

![](img/419fe4e9c799eb645ee984e07a5711bd_93.png)

预测收益。

![](img/419fe4e9c799eb645ee984e07a5711bd_95.png)

收益预测好了之后呢，我们得给到什么呢，啊对吧，这个东西啊给到我们的这里的态代替一下。

![](img/419fe4e9c799eb645ee984e07a5711bd_97.png)

能理解吧，那其他的就应该差不多了，收益预测好了之后代替一下就行啊，其他的是一样的啊，其他是一样的啊，然后给到这个值，然后再排序，然后取取最大的嘛是吧。



![](img/419fe4e9c799eb645ee984e07a5711bd_99.png)

显然是tell点tel尾部取最大的。

![](img/419fe4e9c799eb645ee984e07a5711bd_101.png)

那我们直接上就好了。

![](img/419fe4e9c799eb645ee984e07a5711bd_103.png)

好这是模型，是不是，这是模型。

![](img/419fe4e9c799eb645ee984e07a5711bd_105.png)

然后我们这里运用上去，我们运行一下吧，也是那一天那一年的啊。

![](img/419fe4e9c799eb645ee984e07a5711bd_107.png)

运行之后我们看看啊，这个借借看一下能不能赚钱啊。

![](img/419fe4e9c799eb645ee984e07a5711bd_109.png)

这个激动人心的时候。

![](img/419fe4e9c799eb645ee984e07a5711bd_111.png)

我们就直接用这个吧，反正都一样。

![](img/419fe4e9c799eb645ee984e07a5711bd_113.png)

![](img/419fe4e9c799eb645ee984e07a5711bd_114.png)

哎呀赚了1%，占了1%。

![](img/419fe4e9c799eb645ee984e07a5711bd_116.png)

夏普率还是个负数啊，太坑啊，我们是100万嘛是吧。

![](img/419fe4e9c799eb645ee984e07a5711bd_118.png)

只能说没亏啊，只能说没亏。

![](img/419fe4e9c799eb645ee984e07a5711bd_120.png)

只能说是没亏，而且他这个这里还还还还被坑了，这里应该是被坑过一次，他买什么买，被坑了，我也不清楚啊啊，之后还可以，你看看这里被被坑过一次。



![](img/419fe4e9c799eb645ee984e07a5711bd_122.png)

所以说他的那个回撤比较大，回撤比较大。

![](img/419fe4e9c799eb645ee984e07a5711bd_124.png)

怎么到啊。

![](img/419fe4e9c799eb645ee984e07a5711bd_126.png)

还可以吧啊，没亏没亏，反正流程就是这样子。

![](img/419fe4e9c799eb645ee984e07a5711bd_128.png)

就是呃做出模型，然后在这里进行修改，然后三四天来。

![](img/419fe4e9c799eb645ee984e07a5711bd_130.png)

然后再买啊，然后就OK了就OK了，好同学们。

![](img/419fe4e9c799eb645ee984e07a5711bd_132.png)

同学们试一试啊。

![](img/419fe4e9c799eb645ee984e07a5711bd_134.png)