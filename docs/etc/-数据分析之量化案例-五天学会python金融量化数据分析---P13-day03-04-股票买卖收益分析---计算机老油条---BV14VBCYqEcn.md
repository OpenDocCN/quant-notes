# 【数据分析之量化案例】五天学会python金融量化数据分析 - P13：day03-04 股票买卖收益分析 - 计算机老油条 - BV14VBCYqEcn

哈假如一个人呢从2010年1月1日开始。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_1.png)

每月的第一个交易日买入一手股票，然后每年最后一个交易日卖出所有的股票，那么迄今为止他的收益如何，我们先不管他有多少钱，如果按照这样的一个策略去买卖股票的话。



![](img/648e6dabd6179c2a5289cdc917d8b3b1_3.png)

我们需要算一下他最终的收益如何吧对吧，算一下啊，好那在这的话咱们就来看一下怎么去实现哈。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_5.png)

那首先的话这个是咱们的一个需求，是不是需求啊。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_7.png)

那么需求有了之后，接下来我们首先得对需求呢进行一个分析吧，对吧。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_9.png)

进行一个分析，首先它的时间时间节点啊，是不是从2010年到是2020年啊，不起今为止是到到昨天为止啊对吧。



![](img/648e6dabd6179c2a5289cdc917d8b3b1_11.png)

那这个是它的时间节点吧，那原始的数据呃，你看原始数据哈。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_13.png)

原始数据它的时间是不是从01年开始的呀，是吧，那所以说我们需要将时间节点给它把控，给它拆分到2010~2020吧对吧，这是分析的第一条，我们需要拆分时间节点。



![](img/648e6dabd6179c2a5289cdc917d8b3b1_15.png)

第二条我们要知道什么呀，一首是什么意思吧，一首股票哈，那么我们说每月的第一个交易日买入一手股票，每年最后一个交易日卖出所有股票吧，这块一手股票就是100只股票，100只股票，OK吧啊100只。

所以说我们想买股票的话，只能是一手一手的买吧，不能一股一股或者一支一支买吧，对不对啊，这一手股票表示是100只股票吧，那就是说每月的第一个交易日。



![](img/648e6dabd6179c2a5289cdc917d8b3b1_17.png)

买入100只股票吧，对吧啊好，那接下来我们来算一下，那这个人呢从10年到20年这几个年头之间，都需要遵从同样的一个规律，进行股票的买和卖吧是吧，我们要算他的收益，你说收益怎么算，就是说他卖股票挣的钱。

就是卖股票到手的钱，是不是减去他买股票花的钱对吧，那么这两个值的差不就是他的一个总收益吗，OK吧，那所以说我们要计算他买卖股票花了多少钱吧，对吧，那首先我们先来看一下那买股票啊，买股票还有一个是什么呢。

卖股票吧对吧，那么买卖股票分别需要啊这个花多少钱呢对吧，那以此来看一下，首先那买股票的话，我们要知道，那么什么时候买呢，我们说每月的第一个交易日买入一只股票吧，那通过这样的一个条件。

我们会知道那么一个完整的年啊，一个完整的年，那么这个人需要买多少次股票呢，一个完整的年，一个完整的年，那么需要买入买入多少只，股票对不对，那你算一下子呗，是不是一个月买入一手股票啊。

那一个完整的年不就是12个月吗，不就买12首股票吗对吧，那么12手股票乘以100的话，不就是1200只股票吗，所以说一个完整的年有12个月，1月买一手股票，那么意味着一个完整的年需要买入多少啊。

是不是十二十股票啊，十二十股票不就是1200只股票吗，对不对，这是买是不是好，然后再看卖，那卖的话，我们说每年最后一个交易日卖出所有的股票吧，对吧，每年最后一个交易日卖出所有股票，那看一下。

那一个完整的年需要卖出多少只股票，比如说2010年过完了吧对吧，到2010年最后一个交易日的时候，需要把股票都卖出去，是不是啊，都卖出去啊，那卖多少只呢，就是说这一年他买了多少只，全部卖出去啊。

那一个完整年数不需要买1200只股票，最后你也需要把这1200只股票都卖出去，是不是，那所以说一个完整的年，是不需要卖出1200只股票啊对吧，就是买和卖对应一个完整的年是不是好，那我们再想啊。

那你买卖股票的话是不是得有单件啊对吧，买卖股票的单价用什么来衡量呢，啊那这块我们就定一下，比如说我们就使用什么呢，就使用开盘价，开盘价啊，开盘价开盘价作为我们买卖股票的一个单价，可以吧对吧。

比如说我买股票和卖股票，我用开盘价去买和卖是不就可以了对吧，我也不用什么最高价，也不用最低价，也不用什么收盘价了吧，我们就明确一下，就用开盘价可以吧，好那么这些咱们都分析出来之后的话。



![](img/648e6dabd6179c2a5289cdc917d8b3b1_19.png)

那么接下来咱们就可以去逐步的实现了啊，逐步实现，那首先的话咱们来看一下哈。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_21.png)

第一点，我们的时间节点需要控制在，10年到20年之间吧。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_23.png)

这怎么控制呢，我们首先你看原数据，它的行索引变成时间序列了吧，那么变成时间序列，我们就可以去切一下，怎么切呢，就从2010年零一杠01月份啊，切到什么呢，2020年杠零二是不是2月份的对吧。

现在是不是2020年2月份对吧，现在就这么去切啊，这么去切，然后返回的是一个new杠DF。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_25.png)

可以吧，好在这看一下new杠DF走。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_27.png)

现在你看new和DF是从2010年1月4号，是不是第一个交易日。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_29.png)

一直到我们的2020年的2月18号。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_31.png)

是2月份的这个昨天的这个日期啊对吧。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_33.png)

那现在这个时间节点就控制在了，2010年到2020年之间吧，对不对好，那如果你的原数据使这个行索引是时间序列，你才能这么切，如果这个行索引不是时间序列，你是不能这么切的。



![](img/648e6dabd6179c2a5289cdc917d8b3b1_35.png)

OK吧好，现在我们就需要基于new杠DF。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_37.png)

进行后续操作了吧，那首先咱们在这干啥呢，首先咱们在这的话先去进行股票的买的操作吧。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_39.png)

对吧，需要需要买股票。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_41.png)

好买股票，我们说一个完整的年，需要买入1200只股票吧对吧，那我们买股票的单价用的是不是开盘价对吧，用的是开盘价啊，那我们就来看一下，你比如说啊。



![](img/648e6dabd6179c2a5289cdc917d8b3b1_43.png)

那这个2010年1月份，咱们1月4号是1月份的第一个交易日啊对吧，那么第一个交易日的开盘价是109吧，那我应该是用109是不是乘以100，是不是买一只股票啊对吧。



![](img/648e6dabd6179c2a5289cdc917d8b3b1_45.png)

2月份的第一个交易日是几号呢，看一下是2月1号啊，再用2107×100。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_47.png)

是不是再买入一手股票啊对吧。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_49.png)

那就意味着我想买股票的话，首先啊首先我得先找到什么，是不是找到，个月的第一个交易日，交易日对应的行数据啊对吧，那么从行数据当中可以捕获到捕获到什么呢，是不是开盘这样不使用开盘价乘以100。

是不是买一手股票啊对吧，那怎么找出每月第一个交易日呢，那这块每月第一个交易日，是不是每月的第一行数据啊，看每个月份的第一行数据。



![](img/648e6dabd6179c2a5289cdc917d8b3b1_51.png)

是不是就是每月的第一个交易日，你看1月份第一行数据是不是1月4号对吧，这行就是我们的第一个交易日。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_53.png)

对不对，当月的第一个交易日吧对吧，那所以说我们怎么可以获取，每一个月的第一个交易日呢对吧，那这咱们就可以使用一个技术，叫做数据的重新取样，OK吧，new杠DFDR啊，叫做RESEMPLE啊。

RESIMPLE好，RESAMPLE叫做数据的重启选项啊，叫做数据的重新取样是吧，那么它是根据指定的条件进行数据的提取吧，对吧，那现在咱们是说想要根据月份，想根据月份去原始的数据里面去提取数据啊，对吧。

那月份怎么表示呢，月份的话我们就用一个什么呢，就用M就可以了，M是不是可以表示月份啊对吧，那这行代码的含义就是说啊根据根据月份啊。



![](img/648e6dabd6179c2a5289cdc917d8b3b1_55.png)

从原始数据中提取指定的数据吧是吧，那这块的话我们就可以根据月份去取数据。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_57.png)

你比如说哈，那如果是针对10年的话，10年是不是有12个月啊，我们就会将每一个月对应的数据，是不是都取出来，比如说我这儿选中是1月份的数据。



![](img/648e6dabd6179c2a5289cdc917d8b3b1_59.png)

可以吧，取出来，比如说这是2月份的数据，是不是再取出来啊对吧，那我们想要的并不是1月份。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_61.png)

2月份所有的数据吧，要的是一个月份对应的第一行数据啊，怎么办点儿，第二什么呢，first一下，这样的话我们就可以取出什么呀。



![](img/648e6dabd6179c2a5289cdc917d8b3b1_63.png)

取出每一个月份的第一行数据了吧，你看1月31，2月28，3月31是表示都是月份的对吧，但你会发现，这块并不是每一个月份的第一行数据吧，你看这个31是不是最后一行数据啊对吧，OK啊这块我告诉你啊。

这个数据是没错的，只不过索引有问题好。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_65.png)

我们来比对一下，你比如说哈。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_67.png)

来看一下啊，你看我们1月份啊，1月份的第一行数据是不是1月4号啊，1月4号对应的数据是不是109，是不是这行数据，你看这行数据跟我现在提取出的这行数据一样，不一样吧，OK吧，那所以说数据是没问题。

只不过前面索引有问题吧，索引有问题没关系啊，我最终要要的是个数据啊，那从这行里边是不是取出open这一列，就取出109了，109不就是1月份的开盘价吗，是不是1月份第一个交易日对应的一开盘价，是不是好。

那这我就存一下叫做DF杠monthly，OK吧，Df monthly。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_69.png)

里面存的是不是每月第一个交易日，所对应的行数据啊。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_71.png)

对吧好，这里边存储的是每月第一个交易日，对应的行数据，是不是OK吧，那么行数据有了之后，我们是不是说我们需要从这个什么的。



![](img/648e6dabd6179c2a5289cdc917d8b3b1_73.png)

DF杠monster类里边进行什么呢，open这个单价的提取啊。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_75.png)

你就说现在我DF杠monster类里边有几行，这个人是不是就需要买几只股票啊，就是说10年1月份买一次股票，2月份买一次股票，都基于这个开盘价去买股票啊对吧。



![](img/648e6dabd6179c2a5289cdc917d8b3b1_77.png)

有几行就买几只股票吧，那么接下来咱们在这能不能去算一下什么。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_79.png)

算一下好这个人啊，这个人干什么呢，是买入股票花费的花费的总金额是什么。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_81.png)

OK吧，那怎么算呢，那首先是不是说从DF杠monthly里边对吧。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_83.png)

我们要取出什么，是不是取出open节列对吧，你就说是不是从让109是不是乘以100，是不买一手股票，107×100买一手股票，就是说这一列当中每一个值都得乘100吧，是不是再求和就可以了，那怎么办。

我能不能先让它求和，再乘以100，这个是不是它的总花费对吧好，这个是我们的什么呢，叫做cost是吧，总花费总花费是多少呢。



![](img/648e6dabd6179c2a5289cdc917d8b3b1_85.png)

我们打印一下，看看结果呗，整理一共是花了400多万吧，百千万10万百万是不是400万对吧，花了400万啊，买了这几个股票，那这是买股票花的钱算出来的吧。



![](img/648e6dabd6179c2a5289cdc917d8b3b1_87.png)

那么接下来啊在这不得算一下什么，算一下卖给出股票到手的钱呀对吧，让卖出股票到手的钱减去买股票花的钱，不就是他的收益吗，OK吧就是他收益啊，那这个卖股票到手的钱怎么计算呢，首先这块有一个什么呢，特殊情况。



![](img/648e6dabd6179c2a5289cdc917d8b3b1_89.png)

你要知道什么都是情况，我们说一个完整的年，需要卖出1200只股票吧。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_91.png)

因为我们知道是不是每年最后一个交易日，卖出所有股票，你想现在是2020年，2020年现在是不是2月份呢，意味着2020年他需要买两手股票，是不是，这是2020年买入的这两手股票，他能卖不不能卖吧。

因为2020年还没有到最后一个交易日。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_93.png)

是不是，所以说2020年买入的股票卖不出去吧。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_95.png)

2020年啊，买入的股票卖不出去对吧，因为没有到2020年的最后一天。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_97.png)

是不是，所以说2020年的股票卖不出去吧，对吧好，那这样的话咱们先忽略2020年先看什么呢，2010~2019呗，对吧，那啥时候卖股票呢，啥时候卖，就是说每年最后一个交易日卖股票。



![](img/648e6dabd6179c2a5289cdc917d8b3b1_99.png)

那咱是不需要将每年的最后一个JI，就是最后一行的数据取出来呀，能取吧，能取出，还根据resume去取啊对吧，new杠DF点RESAMPLE，完了之后，我们根据年去取数据吧，年是谁，年是AOK吧。

年是AOK吧，不是Y了，是AOK吧，它是年，然后点last，它是不是最后一行数据。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_101.png)

看2010年最后的数据吧，2011年最后一项数据。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_103.png)

是不是一直到2020吧，你看这行数据咱不能要吧，你要知道，虽然这是2020年12月二啊，31号到这一天了吗，没有吧，那这一行数据对应的是昨天18号的数据，OK吧，只不过索引没有改OK吧。

那么这一行咱们是不要的吧，那只能是前半的几行怎么样啊，因为2020年咱不能卖股票，对不对，这行是不是给他先删掉啊。



![](img/648e6dabd6179c2a5289cdc917d8b3b1_105.png)

不删掉对吧好，那么在这呢给它删掉一下啊，这怎么删呢，不给他切一下的呀。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_107.png)

切一下是将最后行切出去啊，对吧好，将2020年最后一行，一行切出去对吧，因为2020年不能卖出来。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_109.png)

是不是好，这怎么切呢，好那在这的话把这一组数据拿到，拿到的话只有切一下，是中括号，中号这怎么切的，冒号一是不是2020是不是就没有了，对吧好，那现在这个我们就DF杠，OK吧，那DF杠幺四里边存的是不是。

每年最后一个交易日对应的行数据啊对吧，那么意味着这里边有几行数据。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_111.png)

咱们就需要卖几次股票吧，那一次卖多少只股票啊，是不是一次卖1200只股票啊。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_113.png)

对不对，是不是根据开盘价，一次卖1200只股票，那这我们就来算一下什么，算一下卖出股票到手的钱对吧，那首先是我们的这个DF杠YERDAY对吧。



![](img/648e6dabd6179c2a5289cdc917d8b3b1_115.png)

DF杠YTHDAY啊。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_117.png)

取出什么呢，取出open这列吧，是不是根据开盘价去买股票啊，先求一个sum对吧，SAM不再乘以1200只啊，对不对，就是卖股票到手钱吗，是receive，OK吧看一下receive。

走是一个430多万吧对吧，然后的话让他减去我们买股票花的钱，就是总收益吧对吧，其实还不是为啥呢，因为你看啊，就是最后他手里边是不是还剩余了两只股票啊，是2020年1月份和2月份买的。

这两只股票没有卖出去，是不是对吧，那怎么办呢，那你手里边剩余的股票算不算你的总收益呢，需不需要算到一个总数据当中啊，需要吧，就是说最后手中剩余的股票需要什么呢，估计需要估量估量其价值，然后计算到。

总收益中吧对吧，那首先我们知道，那2020年一共是买了两手股票吧，是不是这个200只股票啊对吧，200只好，然后让它乘以一个什么呢，乘以一个单价吧，那用哪个单价作为剩余股票的价钱比较合适呢，点下。

那使用使用是使用我们的昨天的昨天的收盘价，作为剩余股票的单价。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_119.png)

可以吧，那怎么可以拿到昨天的收盘价呢对吧，这是我们原始数据，是不是最后一页的最后最后一行的收盘价，new杠DF先找到什么呢。



![](img/648e6dabd6179c2a5289cdc917d8b3b1_121.png)

close吧，怎么取出它的最后最后一个数据呢，是一啊，是不是一对吧好，那它就是什么呢，就是我们的最后一天的收盘价对吧。



![](img/648e6dabd6179c2a5289cdc917d8b3b1_123.png)

然后呢在这让它进行一相乘，就是我们剩余股票的一个价值呗，然后是不是让他然后是不是加到哪儿啊，是不是加到我们的receive当中啊，不加了吧，这我单独写一下吧，这个是我们的last last杠money。

OK吧，那接下来咱们就来算一下总收益呗，好计算总收益一定是赚了吧，总收益就是说首先我们要是什么，是说我们这个卖出股票到手钱吧，Receive，是不是加上last money股票的这个剩余股票收益啊。

是不是减去cost就可以了。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_125.png)

那叫什么，不是要cos吗。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_127.png)

Cost。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_129.png)

对不对，走那这块的话就是他的一个组合率吧，一共是赚了57万，是不是啊，赚了57万，OK吧，那这样的一个案例咱们就结束了啊。



![](img/648e6dabd6179c2a5289cdc917d8b3b1_131.png)

就结束了，那就是说通过这样的一个案例，咱们就来计算了一下最终这个人的一个总收益。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_133.png)

是不是啊，并且在整个需求的实现过程当中。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_135.png)

咱们是不是在这大量使用到了，我们的索引跟切片的操作啊对吧。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_137.png)

并且我们还学了几个新技能，比如说我们如何将我们的这个数据进行。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_139.png)

重新解压，是不是重新选择条件，怎么制定，这些是我们新学到的技能吧。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_141.png)

OK吧，那么这些技能都需要记录到你的笔记当中，OK吧好。

![](img/648e6dabd6179c2a5289cdc917d8b3b1_143.png)