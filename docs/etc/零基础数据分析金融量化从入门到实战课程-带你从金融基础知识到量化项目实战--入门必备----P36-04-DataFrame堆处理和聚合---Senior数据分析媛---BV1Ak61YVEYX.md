# 数据分析+金融量化+数据清洗，零基础数据分析金融量化从入门到实战课程，带你从金融基础知识到量化项目实战！【入门必备】 - P36：04 DataFrame堆处理和聚合 - Senior数据分析媛 - BV1Ak61YVEYX

![](img/b9c262d2ae6d18017b10c3e373a1d286_0.png)

然后我们看另一个啊，这个。

![](img/b9c262d2ae6d18017b10c3e373a1d286_2.png)

张三考试放弃考试，这就是一个复制操作对吧。

![](img/b9c262d2ae6d18017b10c3e373a1d286_4.png)

不说了啊，然后看下一个索引的堆，索引堆是什么呢，它指它指的并不是内存这个堆啊，它指的是呢，我们对这个多层级索引的一个，数据的格式的一个转换，有点类似于人shift操作啊，类似于那个东西。



![](img/b9c262d2ae6d18017b10c3e373a1d286_6.png)

那我们经常呢会在多层级索引上，使用这个堆操作。

![](img/b9c262d2ae6d18017b10c3e373a1d286_8.png)

比如说我们这个data frame啊，我们现在想对这个数据啊做一个变换，比如说我想把这个上下学期啊，以这个行多级的方式展示，然后呢我第一集是上下学期，第二集是人物的姓名，然后列标签呢，我变成学科啊。

如果想做到这样一个变换啊。

![](img/b9c262d2ae6d18017b10c3e373a1d286_10.png)

那这种变换呢我们不需要说这个重组，我们只需要通过这个堆堆的一个处理就行了啊。

![](img/b9c262d2ae6d18017b10c3e373a1d286_12.png)

![](img/b9c262d2ae6d18017b10c3e373a1d286_13.png)

![](img/b9c262d2ae6d18017b10c3e373a1d286_14.png)

这个stick是什么呢，steak是把列索引列索引给它变成行索引，列索引转换成行索引，但这里边呢我们怎么去指定，我们到底变的是哪一集呢。



![](img/b9c262d2ae6d18017b10c3e373a1d286_16.png)

可以通过里边的这个level参数啊，这个level啊level默认值是一。

![](img/b9c262d2ae6d18017b10c3e373a1d286_18.png)

一指的是哪个呀，说他把这个变下来了对吧，这边也来了，他是一，那往外数，这是二啊，从上往下数。

![](img/b9c262d2ae6d18017b10c3e373a1d286_20.png)

这是零，这是一，所以我们就用负数吧，用它文档里面给的值啊，那它是一。

![](img/b9c262d2ae6d18017b10c3e373a1d286_22.png)

往上数就是二啊，如果你想把上一期下一期变下来啊。

![](img/b9c262d2ae6d18017b10c3e373a1d286_24.png)

就变成这样子了，然后那我们把它保存一下啊。

![](img/b9c262d2ae6d18017b10c3e373a1d286_26.png)

这个我们叫DF1，现在如果我想把这个汤姆LUCY杰克给他编上去。

![](img/b9c262d2ae6d18017b10c3e373a1d286_28.png)

想变上去啊，那我可以用安STC。

![](img/b9c262d2ae6d18017b10c3e373a1d286_30.png)

ATHIC啊，level等于它还是等于一对吧。

![](img/b9c262d2ae6d18017b10c3e373a1d286_32.png)

一指的是哪个啊，指的是这个啊，这个如果你直接按steak的话。

![](img/b9c262d2ae6d18017b10c3e373a1d286_34.png)

是把这个东西变上去了是吧，那我可以把这块调一下，level等于二。

![](img/b9c262d2ae6d18017b10c3e373a1d286_36.png)

啊这样他就变回去了啊。

![](img/b9c262d2ae6d18017b10c3e373a1d286_38.png)

通过这种变换可以干嘛呢，通过这种变换啊，我们可以去就是这个值不论怎么变啊。

![](img/b9c262d2ae6d18017b10c3e373a1d286_40.png)

这个逻辑不会变的，比如说我汤姆上一期的C是27分。

![](img/b9c262d2ae6d18017b10c3e373a1d286_42.png)

你看这里边汤姆上学期的C是27分啊，啊你不用担心这个数值啊，他只是呃就是不用担心这个逻辑啊，跟标签的对应关系是不会错的啊。



![](img/b9c262d2ae6d18017b10c3e373a1d286_44.png)

那通过这种变换呢，我们可以做一些，有的时候呢做一些访问呢可以更加方便。

![](img/b9c262d2ae6d18017b10c3e373a1d286_46.png)

比如说呃我们对这个DF啊，我想访问这个呃，比如说上下学期我这个每一个人的，每一个人的C的成绩，上下学期每个人C的成绩啊。



![](img/b9c262d2ae6d18017b10c3e373a1d286_48.png)

那我们正常访问的话，应该是我直接DF，然后去点lock是吧，先冒号。

![](img/b9c262d2ae6d18017b10c3e373a1d286_50.png)

第一维是全流，然后第二维写个列表啊，第二个写列表，我写下上学期的C加上下学期的C对吧，得这么写，然后加个逗号。



![](img/b9c262d2ae6d18017b10c3e373a1d286_52.png)

![](img/b9c262d2ae6d18017b10c3e373a1d286_53.png)

是吧，这样是这么访问啊，那其实这么访问呢。

![](img/b9c262d2ae6d18017b10c3e373a1d286_55.png)

你不如直接怎么样呢，直接做一个变换啊，直接做这样一个变换是吧。

![](img/b9c262d2ae6d18017b10c3e373a1d286_57.png)

这多得劲儿啊，我做完这一个变换之后干嘛呢，我把这个保存一下。

![](img/b9c262d2ae6d18017b10c3e373a1d286_59.png)

我直接这去一取这个C就完事了嘛是吧。

![](img/b9c262d2ae6d18017b10c3e373a1d286_61.png)

对吧，所以说有的时候呢我们去做一些变换呢。

![](img/b9c262d2ae6d18017b10c3e373a1d286_63.png)

这个问题呢就变得简单了啊，就是取在取值的时候呢。

![](img/b9c262d2ae6d18017b10c3e373a1d286_65.png)

就逻辑就会变得清晰一些啊，但还有些时候呢可能是我们为了展示数据。

![](img/b9c262d2ae6d18017b10c3e373a1d286_67.png)

一些格式的要求啊，我们也可以通过它做一些变换啊。

![](img/b9c262d2ae6d18017b10c3e373a1d286_69.png)

好看这个啊分两行，期中期末啊，还是拿这个来说啊。

![](img/b9c262d2ae6d18017b10c3e373a1d286_71.png)

现在我想把它变成上一期和下一期两行怎么变，啊咋变啊，是把它把它背下来，把它变上去就行了呗，是不是把上面变下来，用什么用steak，然后我们要指定一个level，是不是level等于什么二，把它变下来。

然后再把汤姆LUCY杰克变上去，再来一个UNSTAKE。

![](img/b9c262d2ae6d18017b10c3e373a1d286_73.png)

level数还是二，两行了，完事了啊。

![](img/b9c262d2ae6d18017b10c3e373a1d286_75.png)

那这个因为变为四行，分别为四个科目，然后我们这只能变三行是吧。

![](img/b9c262d2ae6d18017b10c3e373a1d286_77.png)

我想变三行啊，本来啊变成三行。

![](img/b9c262d2ae6d18017b10c3e373a1d286_79.png)

三个科目怎么变呢，把它先变下来对吧。

![](img/b9c262d2ae6d18017b10c3e373a1d286_81.png)

Steak，先变下来，然后再把什么，再把把汤姆LUCY那个变上去，level等于几啊。

![](img/b9c262d2ae6d18017b10c3e373a1d286_83.png)

二，少了个L。

![](img/b9c262d2ae6d18017b10c3e373a1d286_85.png)

啊加上三行了啊，嗯好。

![](img/b9c262d2ae6d18017b10c3e373a1d286_87.png)

然后就是我们这个聚合操作，聚合操作的我们已经说过了啊。

![](img/b9c262d2ae6d18017b10c3e373a1d286_89.png)

说过了，那无外乎要注意的地方是什么，2。1点就是这个data frame的聚合默认是什么，是列方向的聚合啊，然后第二点这个空值空值会被自动优化，所以他没有什么man sam，那个N灭那种类似的函数啊。



![](img/b9c262d2ae6d18017b10c3e373a1d286_91.png)

然后这里边我们做个练习啊，还是以这个为例啊。

![](img/b9c262d2ae6d18017b10c3e373a1d286_93.png)

现在我们要算各个科目，期中期末的一个平均成绩。

![](img/b9c262d2ae6d18017b10c3e373a1d286_95.png)

这怎么算的，各个科目期中期末的平均成绩，那那就是把这个每一个人的成绩加一块，然后再除三呗，是不是这个这道理啊，那我们对它求均值的话。



![](img/b9c262d2ae6d18017b10c3e373a1d286_97.png)

是不是就直接灭就行了，默认是不列方向啊是吧，上一期Python的52，java58可以吧。

![](img/b9c262d2ae6d18017b10c3e373a1d286_99.png)

![](img/b9c262d2ae6d18017b10c3e373a1d286_100.png)

第二个计算各科目张三李四的最高分嗯，各个科目他们的最高分嗯。

![](img/b9c262d2ae6d18017b10c3e373a1d286_102.png)

这怎么算啊。

![](img/b9c262d2ae6d18017b10c3e373a1d286_104.png)

各科目里边的最高分，比如说汤姆，我要求汤姆最高分应该是给的是哪个，应该给这个值是不是啊，这是40，然后LUCY的话应该给的就是74，是不是杰克就给的是119。



![](img/b9c262d2ae6d18017b10c3e373a1d286_106.png)

所以它就是行方向的聚合呗，行方向我们算一个最大值max。

![](img/b9c262d2ae6d18017b10c3e373a1d286_108.png)

好汤姆的最高分是40，如果他是74，他是119啊。

![](img/b9c262d2ae6d18017b10c3e373a1d286_110.png)

![](img/b9c262d2ae6d18017b10c3e373a1d286_111.png)