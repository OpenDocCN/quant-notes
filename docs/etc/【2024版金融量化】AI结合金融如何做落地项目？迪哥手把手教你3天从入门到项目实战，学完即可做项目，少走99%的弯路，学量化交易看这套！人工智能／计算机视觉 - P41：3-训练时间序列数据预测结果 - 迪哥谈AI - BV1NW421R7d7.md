# 【2024版金融量化】AI结合金融如何做落地项目？迪哥手把手教你3天从入门到项目实战，学完即可做项目，少走99%的弯路，学量化交易看这套！人工智能／计算机视觉 - P41：3-训练时间序列数据预测结果 - 迪哥谈AI - BV1NW421R7d7

接下来啊咱们实际的执行这个函数啊，得到我们想要得到的这个距离就可以了。第一步还是先把咱们数据啊做一个基本操作，咱先把所有数据做一个标准化标准化其实方法非常简单，就是一个X。

然后减去它的一个均值在比上一个标准差检验均值的目的啊就是让数据哎以零为中心点做一个对称，减验均值之后，大家注意这样，就是原始数据要拿红色化吧，它可能浮动范围都挺大的一堆点的数据。然后呢减完均值之后。

各维度减验均值啊，拿绿拿黄色吧，各维度减哎黄色看不出来拿蓝色吧，各个维度减验均值之后，它肯定是以原点为中心进行对称的吧。然后呢再比上标准差，让各个维度啊取值范围尽可能是一致的，都在一个比较小。

可能负的一点多到正的一点多的一个范围区间上。这一步啊是一个标准化操作。然后做这个标准化时候，大家注意点啊，就是我们不能用验证级或者是虚练解数据参与到做标准化的计算当中。其实说白了就是让你训练过程当中啊。



![](img/774db7276f69d635b994657f3017ed5d_1.png)

![](img/774db7276f69d635b994657f3017ed5d_2.png)

无论哪一步都不能用到之后验证集或者是测试集当中信息。所以说咱们全部的操作都是基于训练级来去做的。你看这里。我们是不是说在这一块，我说把训练节哎把这个实际把这30万是吧，把实际渲集数据取出来算均值。

实际的训练集数据取出来算一个标准差2。然后接下来再去执行这样一个标准化操作吧。没有涉及到任何跟验证级，还有测试集啊相关的一些操作的。好了，然后我们指定的参数吧，第个参数。😊。



![](img/774db7276f69d635b994657f3017ed5d_4.png)

第一个参数就是呃我当前来去指定一下呃，我的一个窗口大小，咱刚才说了，窗口大小，你希望连续多少天，不是连续多少个样本的数据，这里20连续20个数据，然后这个t值为0什么意思啊？咱来看一下吧。

这一块有这样一个操作，就是实际的一个label值等于多少一加上一个t值，如果它也值为0哎，不是如果t值为零什么意思？相当于它是取训你的一个序列完了之后的下一个吧，默认就是下一个t是为一。

那就是下两个哎这个意思这个是我们啊去指定了一下参数，指完参数之后啊，然后对我们的一个训练集，还有一个验证级，分别去执行一下咱这个操作这就可以了。这里啊就是就是该指定一个参数。

30万表示的是从整个数据当中取多少当训练解取多少张验证级，这个两个函数执行完之后啊。

![](img/774db7276f69d635b994657f3017ed5d_6.png)

![](img/774db7276f69d635b994657f3017ed5d_7.png)

咱们就有了我们当前所需的一个训练数据，还有验证数据。然后到时候大家你可以执行完之后啊，打印一下它的设备值来观察一下。我先打印一下，就是咱训练数据的一个设备值等于多少啊。

等于呃2999980原始数据多少30万个。那为什么这近少了20呢？因为这里啊是这样啊，就是呃它默认情况下，你说咱能取到最后一个吗？不是就是能从最后一个开始吗？不能吧，因为我们要保证每个序列都是20的。

所以说前面怎么取的，我不管了。最后一个序列一定有多少，一定是后20个。那你说最后20个取完之后，相当于怎么样，就得到了2200，就是这个少了20个，哎，这个意思，后面我们只会少取20个。

因为在后面的时候它的序列长度已经不足20了，没办法，咱就取了，这是第一个维度，咱一共得到了多少个序列。😊。



![](img/774db7276f69d635b994657f3017ed5d_9.png)

然后第二维度呢，第二维度它是不是说表示每个序列它的一个长度啊？好了，一个序列当中啊有20个就是20个时间步长。然后呢第三个维度每个时间不长当中啊，咱用到了几个特征啊，这里我刚才不是给大家说了嘛。

咱们这一块呃先做一个简单的方法只选单特征。所以单特征啊这块体验出来了，就是一个一哎只用一个特征来去做这样一件事。然后呢对应的Y值我们来设个值也可以发现Y值哎第维度跟XD纬度边然是一样的。

相当于Y它只是接下来要预测的一个值而已啊，这个意思。然后大家还可以实际打印出来某指标，比如说打印出来第一个样本第二位数据当中，这一块有20个数据。

然后这个是它实际对应下一个点实际的一个Y值这一块咱已经把数据啊全部准备好了。接下来咱们就要马上来进行一个训练操作。😊。



![](img/774db7276f69d635b994657f3017ed5d_11.png)

![](img/774db7276f69d635b994657f3017ed5d_12.png)

![](img/774db7276f69d635b994657f3017ed5d_13.png)

![](img/774db7276f69d635b994657f3017ed5d_14.png)

![](img/774db7276f69d635b994657f3017ed5d_15.png)

![](img/774db7276f69d635b994657f3017ed5d_16.png)

![](img/774db7276f69d635b994657f3017ed5d_17.png)

![](img/774db7276f69d635b994657f3017ed5d_18.png)

![](img/774db7276f69d635b994657f3017ed5d_19.png)

然后呢，现之前啊这块还是有这样一个展示，展示比较简单啊，画图的这个这块不给大家去说了，就是把它这个呃Z这不有几0个点嘛，把这几十个点数据拿出来，然后呢再把它的一个标签值拿出来。

只不过说用不同的线条描述一下。你看这里就是我们要预测的当前的一个结果，比如这块画差的这是我的一个标签值咱要预测一下，比如说给我输入的是这样一个序列。

我看它能不能够预测出来最终的结果是跟这个差是有多大的一个差异啊，这个就是我们要预测的一个结果。然后这块呢先给大家做了一个 baseline baseline的意思就是说呃用一些统计方法看能不能去做呢？

这一块做的比较直接啊。比如说现在我拿到了20天数据，那统计方法，第21天的怎么办？我说我把这20天数据做一个平均吧，平均结果当做第21天的，感觉好像不太靠谱是吧？好了，这块就是有一个平均值啊。你看这里。

😊。

![](img/774db7276f69d635b994657f3017ed5d_21.png)

![](img/774db7276f69d635b994657f3017ed5d_22.png)

![](img/774db7276f69d635b994657f3017ed5d_23.png)

![](img/774db7276f69d635b994657f3017ed5d_24.png)

![](img/774db7276f69d635b994657f3017ed5d_25.png)

一会儿我们会呃拿跟这个平均纸啊来做一些对比的。然后呢，先给大家来说这个模型，说完模型咱再来看这个结果吧。做这个模型啊其实很简单。😊。



![](img/774db7276f69d635b994657f3017ed5d_27.png)

![](img/774db7276f69d635b994657f3017ed5d_28.png)

第一步指定一个 size，因为咱这个数据啊说实在的比较小，你可以把这个 batchch设置的偏大一些，这也没关系。第一步还是去做这个数据数据当中，咱之前数经做好了。

做好了就是都是咱们拿到矩阵数据X数据Y是吧？好了，直接填data把咱们数据转一下是不完了，转完之后咱们点 batch，然后去构建我们的训练集是不是可以了，非常简单的方法吧。

点当中构建一个detX和Y分别传进去，这是我训练没问题吧。好了，在训练当中洗一下牌写完牌之后做一个bach是不是完事了，跟咱之前给大家解释的方法是不是都一模一样，非常容易啊。

咱就把X或者说把训练集我们构建出来了。那验证集啊，咱构建方法啊，可以说是一模一样的，一般情况下就是验证集，咱就不需要再做操作了。正到时候圈全跑一遍做一次验证是不就得了。

这是咱们现在已经是为尔摩做好准备了，数据已经都有了。😊。

![](img/774db7276f69d635b994657f3017ed5d_30.png)

![](img/774db7276f69d635b994657f3017ed5d_31.png)

![](img/774db7276f69d635b994657f3017ed5d_32.png)

然后呢，下面我去打印了一下当前解果值，看是不值没有什么问题。21页没问题吧，第一个段值表着by size多少无所谓啊。然后下面flow64，这没问题吧，以及当前我的一个哎再往下看吧，这个就是打印压维度。

看看有没有一些信息跟他刚才描述不一样的，看起来都是相同的。然后呢去构建这个LRTM模型，这个也比较简单啊，到时候大家自己指定隐测声渊源吧，大点小点无所谓。反正咱这个任务也不难，数据量也不大。然后呢。

这块就是第一个加上一个LRTM。😊。

![](img/774db7276f69d635b994657f3017ed5d_34.png)

![](img/774db7276f69d635b994657f3017ed5d_35.png)

LTMLTM当中啊，你返回的这回应该返回什么？应该是最后一个结果值吧。最后一个结果值，比如说它是8维的一个向量吧，或者是1个64维或者1220128倍随便啊直接的向量。那最终啊咱有几个结果。

最终我只要一个结果吧，那这一块还需要再连什么？再连上一个全连接层吧。好了，这里啊咱准备了一下，哎，再准备一个圈阶层属以完事了。那接下来我说我构建一个呃构建个损失函数，然后去训练，那是不是就得了。

方法是不是非常简单啊，只是简单的构建一个LTM模型，咱就完事了。然后接下来就是呃这块是打印出来预测结果，预测的结果就是预测结果的一个维度。😊。



![](img/774db7276f69d635b994657f3017ed5d_37.png)

![](img/774db7276f69d635b994657f3017ed5d_38.png)

预测结果维度啊，它是256-1。咱之前说那个 batch值多少啊？我们是不是指定 batchch就是256啊，一次迭代得到256个样本，就是256个序列，它所对应的结果，哎，这是256-1。

然后呢接下来训练选涡程当中啊，这一块就是呃在实际这就这里有参数啊，这个参数就是ts per一，它的意思就是说呃你这里要迭代多少次，在一在一个一当中，我要迭代多少次，这个值啊我设置的可能偏小。

因为到时候大家可以算一下，就是。

![](img/774db7276f69d635b994657f3017ed5d_40.png)

咱当前这个200，然后呢再乘上1个这个256，可能没有达到什么咱们当前整体的一个数据量的一个要求啊。因为就是在这块，反正速度比较快，咱写的稍微小点，这个认为也没关系，大家都是可以改一改实际的一个参数。

如果说你觉得着训练速度比较慢的情况下啊。然后下面就是它训练的结果训练结果也比较简单啊，损失值一直在下降，最终下降的偏低。你看包定lo也是一个在收敛的一个状业当中。然后呢接下来给大家看一下吧。

就是呃咱训练完的结果，因为这个模型都比较简单啊，所以这块咱不给大家细说了，直接看结果就行了。

![](img/774db7276f69d635b994657f3017ed5d_42.png)

![](img/774db7276f69d635b994657f3017ed5d_43.png)

![](img/774db7276f69d635b994657f3017ed5d_44.png)

![](img/774db7276f69d635b994657f3017ed5d_45.png)

![](img/774db7276f69d635b994657f3017ed5d_46.png)

看结果吧，结果当中我这边画了几个不同的线条，然后这个红色的是我的一个出la，然后呢这个绿色的是我的一个预测值的一个结果。然后这个蓝色的是之前那个序列，它的一个走势，看起来就是给我们感觉啊只用一个特征。

你看效果好吗？好像不是特别好吧。预测值个真实之间啊，还有那么一丁点的一个差异。然后这个你看差异可能就更大一些了。然后最后一个哎在这里就是我取了随机取了不是随机啊，就是只取了其中三个样本。

你看这里点t一下，取了三个样本，这三个样本分别展示了一下它的一个预测结果，把这三个样本分别传入到咱当前的网络当中哎得到它的一个结果，然后把这个结果值画出来了，这里给大家看了，就是呃只用一个特征的时候。

哎咱得到结果，嗯反正看起来还凑合吧，可能稍微有点差。一会儿呢咱把这个任务稍微的再改一改，看一看问题能不能变好一点。



![](img/774db7276f69d635b994657f3017ed5d_48.png)

![](img/774db7276f69d635b994657f3017ed5d_49.png)

![](img/774db7276f69d635b994657f3017ed5d_50.png)

![](img/774db7276f69d635b994657f3017ed5d_51.png)

![](img/774db7276f69d635b994657f3017ed5d_52.png)

![](img/774db7276f69d635b994657f3017ed5d_53.png)

![](img/774db7276f69d635b994657f3017ed5d_54.png)