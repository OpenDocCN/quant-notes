# 【比刷剧还爽！】这太完整了！量化交易和python金融分析实战课程，全程干货无废话 入门到精通一步到位！（数据挖掘分析／大数据／可视化／投资／金融／股票／算法） - P24：26. 26.26.策略效果演示与指标分析(Av1302064773,P26) - AI算法-溜溜 - BV1iC411n7XN

![](img/f1e109a46299e47b5c9a623cbcbc0db1_0.png)

我们想法什么样，我们想法它是横着来是吧，就是横着去写每个股票名字啊，第一个股票，然后第二股票，然后第三个股票，然后第四个股票我们一般怎么样，我们一般大家是不是都喜欢这样啊，就是竖着去写。

唉我说第一个股票，然后他的一个财务的一个营收啊，怎么怎么样，第二个股票营收怎么怎么样。

![](img/f1e109a46299e47b5c9a623cbcbc0db1_2.png)

第三股票，第四个股票是不是咱把它稍微改一改，这个咱们来改一改啊，这块我说我在执行这个结尾的时候，然后我说把最后的一个结果，稍微的给他去变一下吧，呃来把这个东西稍微改一改，对这个跟frame做什么。

其实只需要对它做一个转置，是不是就可以了，然后呢咱们来看一下吧，就是打印一下它的一个转置的一个结果，现在试试这个结果对不对，对的话，咱再往下走啊，转置一下，转制完之后，其实这一步咱还没完。

在before trading的时候，我们最重要的目的是什么，不是说打印出来给你看一看吧，是把那什么那十个找到手吧，所以这块就是呃我们最终想要得到的这一块，我是再写一下吧，最终我说我们想要得到的结果。

应该是对它先做一个转置来看转制的结果。

![](img/f1e109a46299e47b5c9a623cbcbc0db1_4.png)

转接结果你看就是竖着的，就是这个东西就是一个股票名字，然后后面是他实际的一个指标吧，那第一个第一个就是一个index，一个索引，后面就是一个实际的一个值是吧行了，那此时我们只需要把索引拿到手就行吧。



![](img/f1e109a46299e47b5c9a623cbcbc0db1_6.png)

你看有没有什么变化，看起来就是这间隔太短了，看不出来什么变化行。

![](img/f1e109a46299e47b5c9a623cbcbc0db1_8.png)

咱不管了，一会儿策略分析吧，在这里我说我把他的index拿到手啊，这个是我想要的一个股票名字，然后我把股票名字给他重新设置一下，在这个context context当中啊，我说把它当做是一会儿啊。

我要返回的一个结果，或者说你就把它存到我的一个connect当中，这一块，这个就是咱们要的，这个就是沪深300当中选了一个十个啊，随便指个名字得了好了。



![](img/f1e109a46299e47b5c9a623cbcbc0db1_10.png)

这是我们现在哎这个打印咱一会也不需要了，打印这东西没什么用行了，这是我们的一个笔触trading，我们在做交易之前，已经能够把这些个筛选工作给做完了吧。



![](img/f1e109a46299e47b5c9a623cbcbc0db1_12.png)

那接下来就是一个HANDBAR啊，这里就是呃我们要实际的做一些事情了，这里咱就不pass了，咱们写啊，往下一点再往下一点吧。



![](img/f1e109a46299e47b5c9a623cbcbc0db1_14.png)

放中间给他好了，我们来写吧，第一步要干什么，首先我们要去做一个判断吧，判断什么，当前啊，哎呀我这个context当中，或者说当前啊我是否是持有一些股票。



![](img/f1e109a46299e47b5c9a623cbcbc0db1_16.png)

这里给大家看这个API，先看这个API，然后咱们再参考API去写。

![](img/f1e109a46299e47b5c9a623cbcbc0db1_18.png)

其实啊就是给大家准备的，所有的这些例子都是一点点翻API翻出来的。

![](img/f1e109a46299e47b5c9a623cbcbc0db1_20.png)

API当中可解释的东西其实蛮多的，找一找那个context。

![](img/f1e109a46299e47b5c9a623cbcbc0db1_22.png)

那东西我找一下context啊，不不是在这里。

![](img/f1e109a46299e47b5c9a623cbcbc0db1_24.png)

在这里在这个找一找他的一个context，这是行情股票。

![](img/f1e109a46299e47b5c9a623cbcbc0db1_26.png)

这是它的一些数据，没有数据还是看那里边。

![](img/f1e109a46299e47b5c9a623cbcbc0db1_28.png)

但是这里边有这个context来找一找交易相关的。

![](img/f1e109a46299e47b5c9a623cbcbc0db1_30.png)

咱们之前咱们一会也要去用啊，找到了这块。

![](img/f1e109a46299e47b5c9a623cbcbc0db1_32.png)

我们需要这个呃咱们的一些组合的信息了，我直接把这个复制过来，咱们来写这一块，就是我要看一下我当前我的一个账户当中啊。



![](img/f1e109a46299e47b5c9a623cbcbc0db1_34.png)

我的一些信息的情况，然后这一块有一个指标叫做一个position。

![](img/f1e109a46299e47b5c9a623cbcbc0db1_36.png)

咱们来看一看啊，这块啊这块儿就是它有一个咱们点进去。

![](img/f1e109a46299e47b5c9a623cbcbc0db1_38.png)

点开之后呢，它有一些属性啊。

![](img/f1e109a46299e47b5c9a623cbcbc0db1_40.png)

咱们来看一看，我们会用这个就是一个position position，你看啊，他说的是一个呃包含所有仓位的字典，相当于就是这里边描述的是，你现在手里有哪些个东西吧。



![](img/f1e109a46299e47b5c9a623cbcbc0db1_42.png)

你都买啥东西了，是不是好了，那咱们来写一下吧。

![](img/f1e109a46299e47b5c9a623cbcbc0db1_44.png)

首先第一步呃，把这个context找到手，我刚才是不是复制了一下context。

![](img/f1e109a46299e47b5c9a623cbcbc0db1_46.png)

来这里把它，我说我先复制过来，先看看我手里有啥东西吧。

![](img/f1e109a46299e47b5c9a623cbcbc0db1_48.png)

这个关掉好啦，在这里我说我先去做判断了，呃，我看我手里有什么东西。

![](img/f1e109a46299e47b5c9a623cbcbc0db1_50.png)

都手里东西的什么来着，position吧是吧，因为position当中描述的是呃，啊你的一个所有仓位的一个字典，所以说咱把它先拿到手。



![](img/f1e109a46299e47b5c9a623cbcbc0db1_52.png)

那既然它是一个字典，那肯定是一个点，kiss当中存的是你所有的东西吧，那好了，我说我先做一个判断吧，如果说呀在你的字典当中啊，你这个所有买的东西那都是空的，那是不是说你现在手里啥也没有啊，好了。

先做个判断，如果现在啊都是为空的时候，如果能为空的时候，我要干什么，那我说我现在是不是就不等于零，就是现在我是一个不为空的时候，不为空的时候，咱们是不是要去卖一些东西了啊，因为只有第一次的时候。

咱们是去把所就是买这么十只股票，然后后续啊就从第二天开始，咱们都是要去不断做判断吧，因为后续后续的时候就都不为空了，只要不为空的时候。



![](img/f1e109a46299e47b5c9a623cbcbc0db1_54.png)

我们就要去卖出一些东西吧，咱要看一看，我手里有的和现在唉这个股票池当中。

![](img/f1e109a46299e47b5c9a623cbcbc0db1_56.png)

给我筛选出来的是不是一样吧，那好了，我说我现在要去便利一下了，便利我手里有这些东西，便利啊，我的一个所有咱手里有的，那就是这个kiss吧，这个kiss当中保存的就是咱所有有的这些个。

就是买买买了这些股票是吧，好了，如果说如果说当前这个股票，那没在咱当前指定的我的这个股票池当中。

![](img/f1e109a46299e47b5c9a623cbcbc0db1_58.png)

股票池啊，这里我看一下哎，这块呢咱是不是指定好一个名字了。

![](img/f1e109a46299e47b5c9a623cbcbc0db1_60.png)

好了，我说我做一个判断吧，如果说呀你没在我当前的这个股票池当中呃，我看一下这个股票池当中。

![](img/f1e109a46299e47b5c9a623cbcbc0db1_62.png)

然后我就是给他要去卖掉吧，来看一看吧，卖怎么写API当中啊。

![](img/f1e109a46299e47b5c9a623cbcbc0db1_64.png)

啊这里他会给你有详细的一个介绍在上面。

![](img/f1e109a46299e47b5c9a623cbcbc0db1_66.png)

这是交易相关的吧，交易相关的其实有挺多东西去做啊，咱有一个呃比较方便的就是这个函数啊，order我们的一个不算值。



![](img/f1e109a46299e47b5c9a623cbcbc0db1_68.png)

相当于你贴个百分数就行了，点进去给大家看一看，这里需要你主要就是传递两个参数，第一个参数就是卖谁，第二个参数就是呃你希望经过你交易完之后，然后他的一个就是占你现在的一个百分比，那比如这样。

你说你现在经过了一个交易，经外交易之后，你要写个零，什么意思啊，那写个零的意思就是全麦吧，你看这边写了就是投资组合现在的一个总和啊，这是一个百分比，如果一呢，那你就是把它买满零呢，就全卖了啊。



![](img/f1e109a46299e47b5c9a623cbcbc0db1_70.png)

这样一个意思行了，我把这个东西直接复制过来吧，复制过来，然后咱们要进行一个交易了，然后他的一个id就是我的一个股票，然后右边这个第二参数，咱们现在要干什么来着，是卖还是买啊，你不在我的交易池当中诶。

那我是不是不在我筛选的结果当中，你不咋地，那我是不是就卖了，卖完之后你就空了，那是不是占零占0%就行了，这个是我的一个Mac操作好了，那其实不光我们得有卖操作，还得有什么，还得有买操作是吧，每天好了。

咱们这里在写啊，在这块还是一个便利的操作复制过来吧，好了便利一下，咱们这个股票在这块就不用这个了，便利什么便利我的股票池吧，然后把这个复制过来，便利咱们现在筛选的这个池子，那接下来我是不是说要去买了。



![](img/f1e109a46299e47b5c9a623cbcbc0db1_72.png)

卖完了，那是不是剩下的就该买了呀，好了再来看一下吧，怎么样去买，还是这个函数啊，我直接的给他复制过来就行了，然后去买我当前的股票，但是买多少呢，这个策略啊都是大家可以自己定。

你可以根据它的一个咱不是说了吗。

![](img/f1e109a46299e47b5c9a623cbcbc0db1_74.png)

有财务数据，你可以跟他的一个财务数据，它的一个涨幅设置一个百分比。

![](img/f1e109a46299e47b5c9a623cbcbc0db1_76.png)

但是也行啊，或者说咱们工咱们简单点吧，那就是平均啊，平均一下得了，每一个都占到一个整体的一部分，然后看一下context当中，然后咱们之前我直接把这个复制过来就行了，我第一个300一共有多少个。

那咱们这一比上整体啊一个浪值相当于什么，我做了一个平均买的一个操作吧。

![](img/f1e109a46299e47b5c9a623cbcbc0db1_78.png)

好了，咱们也不管买多少，就平均买就得了，下面这个给他删掉行了，然后最后我来检查一下啊，最后一个pass没问题行了。



![](img/f1e109a46299e47b5c9a623cbcbc0db1_80.png)

这个咱们基本大家写完了，然后先来运行一下吧，看一下它这个结果啊，看没有什么问题，看这个结果，一会儿咱们来给大家说一说啊，就是这个结果当中包含的哎这些个信息啊。



![](img/f1e109a46299e47b5c9a623cbcbc0db1_82.png)

它都是什么意思，哎呦看着咋咋这么恐怖呢，直接给我干到负的30%多。

![](img/f1e109a46299e47b5c9a623cbcbc0db1_84.png)

可能因为咱们这个时间的选择呀，稍微的可能这个东西就是跟时间是有关的啊。

![](img/f1e109a46299e47b5c9a623cbcbc0db1_86.png)

一会儿咱们来去换个时间再来看结果，哎行了，刚才吓死我了，刚才可能就是刚开始的时候可能比较赔吧，这个回溯的年化收益，比这个基准年化收益都要都怎么样，都看着更可怕，是不是行，再来看这个结果。

那现在我说我设计了一个策略，先从整体来看吧，这些指标是不是主要给大家说了，还有些指标咱现在不用的，咱们等到时候后续咱们说策略用的时候，给大家解释，就先看前四个得了，看指标其实就主要看什么。

你的一个回测就是我们设计的策略啊，它的一个效果，以及呢你跟着这个指数走的时候啊，就啥也不玩的时候，它的一个效果看起来反正都是赔了，是不是，但是我们的策略能让你怎么样少赔一点吧。

然后最大回撤区间占的有点占的还行吧，不是特别大，占了17%点多啊，这是咱们基本的一个指标，那夏普率那肯定是一个负的，因为这都已经赔了，咱们单位风险肯定不值得，是不是好了，这是一个收益的概况啊。

咱们大概画出这样一个结果，然后呢右边还有这样一个交易详情，我对大家点进来。

![](img/f1e109a46299e47b5c9a623cbcbc0db1_88.png)