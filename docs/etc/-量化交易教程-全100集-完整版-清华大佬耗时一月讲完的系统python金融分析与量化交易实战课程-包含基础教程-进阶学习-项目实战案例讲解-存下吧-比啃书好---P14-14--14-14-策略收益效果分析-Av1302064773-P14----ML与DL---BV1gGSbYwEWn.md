# 【量化交易教程】全100集（完整版）清华大佬耗时一月讲完的系统python金融分析与量化交易实战课程，包含基础教程，进阶学习，项目实战案例讲解，存下吧，比啃书好 - P14：14. 14.14.策略收益效果分析(Av1302064773,P14) - ML与DL - BV1gGSbYwEWn

行了嗯，先写一下吧，就是我们的一个收益吧，收益咱之前是不是给大家说过了，就是当我们做这个收益的过程当中啊，这个咱们得用什么，因为我们要算啊，就是最终的就最开始一块钱相当于最终多少钱。

这是不是一个累加的一个过程啊，啊有这样一个累加过程，咱们别说了，累加的时候你不能直接算，我们得引入什么，引入一个对数吧，好啦。



![](img/109131841b23b890ed8b05141f4c79c9_1.png)

在我们的data当中对谁去算的，是不是说我这个算这个报酬率。

![](img/109131841b23b890ed8b05141f4c79c9_3.png)

我得对我这个股价把股价拿过来啊，这是我的一个股价好了，然后对我这个骨架，然后当前算什么，它比上一下当前哦我直接复制吧，比上它的结果怎么样，去shift一下吧，当前的比上前一天的啊这样的一个结果。

然后呢这块我点shift一下，shift当中传进来一个一，是不是就可以了好了，这块咱们执行一下，就是有一个return值啊，return的结果就是啊什么都不管的时候，不是什么都不管吧。

就是咱这个通过这个走势算出来了啊，我们的一个增长率它是等于多少的，那接下来呢，接下来就是按照我们的一个策略来去算吧，我们的策略是什么意思啊，那现在好像是这样一件事，哎呦我们的策略当中啊。

是不是得考虑什么了，永远都是赚的啦，好啦，我写一下咱的这个策略当中，大家可能觉着啊，就是你这个策略有点像开挂似的，有点未卜先知了行，咱就假装是开挂吧，实际当中啊可能没有那么好去算啊，好了。

在这里我们来看啊，得需要多加上一个什么东西，多加上什么，之前的，我们这个就是我们这个增长率已经算出来了，但是现在呢我们要干一件什么事啊。



![](img/109131841b23b890ed8b05141f4c79c9_5.png)

是不是说现在这块我们之前算了一个position，这个东西啊。

![](img/109131841b23b890ed8b05141f4c79c9_7.png)

position代表什么，哎呦当前这个位置要么是一，要么是一是吧，那咱们来看一下，就是当前我们这个策略当中啊，呃就是对于什么时候position会等于一。



![](img/109131841b23b890ed8b05141f4c79c9_9.png)

来看这个图，position等于一的时候有哪啥，这两两个区域是吧，那对于这两个区域来说，咱之前来说我们是怎么办的，之前啊，如果说原始的情况下，在这里它是由100变成80，它是亏了。

但是我们反而要给它反过来，反成一个转了，是不是就是这块我们应该把这个一乘上什么。

![](img/109131841b23b890ed8b05141f4c79c9_11.png)

乘上我的一个returns吧，这没问题吧。

![](img/109131841b23b890ed8b05141f4c79c9_13.png)

因为这块我说了哎，这两个地方是我在测试当中我观察到的，对于这样两个区间，我得怎么样把它反转过来啊，相当于我倒着来跟实际它的走势正好相反了啊。



![](img/109131841b23b890ed8b05141f4c79c9_15.png)

我这么去玩啊，这么算算收益是吧，所以这里咱们来算啊，就是我我的一个策略结果等于什么，肯定是用position乘上我的returns吧，因为position当中啊等于一的表示的是哦，我原封不动。

就是跟你正常走势一样，然后procession当中呢，如果它是等于一个一的代表。

![](img/109131841b23b890ed8b05141f4c79c9_17.png)

我恰好给你的一个收益，我应该是反过来的，咱是不是要做这样一个策略啊，好了，我把这个position给传进去，但是大家要注意点，这个position当我们用的时候，应该怎么样，哎。

你看这里我们是不是也应该去做一个shift操作啊，哦不要忘记这里咱对于这个position来说，也有这个shift操作跟之前要对应上吧，好了。



![](img/109131841b23b890ed8b05141f4c79c9_19.png)

这一块我们做完了，做完之后呢，我可以把这个结果啊再展示给大家看一下好了。

![](img/109131841b23b890ed8b05141f4c79c9_21.png)

此时你看呃前几个看起来都一样的是吧。

![](img/109131841b23b890ed8b05141f4c79c9_23.png)

这样咱一会看整体吧，因为在这数据当中啊，可能前面大部分都是position啊。

![](img/109131841b23b890ed8b05141f4c79c9_25.png)

它都是一个为正的一个结果，那行了。

![](img/109131841b23b890ed8b05141f4c79c9_27.png)

那我们想看一个最终最后的结果，怎么算最后的结果哎，对于我们的一个增长率来说。

![](img/109131841b23b890ed8b05141f4c79c9_29.png)

我们可以做一个累加吧，好了，咱把这个所有结果都加一起，挺烦人的一点是吧。

![](img/109131841b23b890ed8b05141f4c79c9_31.png)

这块又出现缺失值了，我得把这个缺失值再也照不掉一下好了。

![](img/109131841b23b890ed8b05141f4c79c9_33.png)

再把缺失值给他job掉一下，好准没缺失值了，没缺失值，值完之后没这个缺失值之后啊，再来看一下，就是我们的策略啊，和什么都不做的情况下，咱的一个收益到底哪个高，是不是要做还原了，之前做的那个对数是吧。

现在给它还原回去啊，还回去的过程当中，第一个值啊，就是data当中，我把这两列都得传进去，直接复制名字吧，一个叫return啊，第一个叫这个return这个东西，然后呢。

第二个就是我们自己所指定的这个策略好了，这是我们自己所指定的一个策略，然后这里就是还原回去完之后，大家不要忘记一点什么，你要做的是一个加法吧，啊把增长率每一天的全加进去。

就相当于第一天跟最后一天的结果了吧。

![](img/109131841b23b890ed8b05141f4c79c9_35.png)

就是此时这还有什么，这还有一个点sum一个操作来执行一下呃，执行完这个操作之后，我怎么感觉这个值这么大呢，应该没这么大啊。



![](img/109131841b23b890ed8b05141f4c79c9_37.png)

不可能一块钱相当于之前的1700多块钱了，检查下之前没有什么问题啊。

![](img/109131841b23b890ed8b05141f4c79c9_39.png)

应该不会这么大的，因为苹果这个股价它实际值才相当于四块多啊。

![](img/109131841b23b890ed8b05141f4c79c9_41.png)

我检查一下嗯，这里这个点SAM操作加错位置了，我怎么给他加到外面来，应该对什么，应该对我里边的结果做这样一个点sum操作，然后接下来再什么再把那个对数还原回去吧。

所以说这里应该这块加上一个点sum操作啊。

![](img/109131841b23b890ed8b05141f4c79c9_43.png)

就完事了，执行一下行了，看一下吧，这个returns什么意思啊，就是呃正常情况下。

![](img/109131841b23b890ed8b05141f4c79c9_45.png)

你什么什么策略都不都不做啊，一块钱相当于现在的四块钱是吧。

![](img/109131841b23b890ed8b05141f4c79c9_47.png)

那现在呢如果说我加上了咱之前什么，我们的双均线策略之后怎么样了，一块钱相当于五块八了吧，是不是说赚的会怎么样更多一些了吧。



![](img/109131841b23b890ed8b05141f4c79c9_49.png)

啊这是给大家先说了一下这个双切权策略啊。

![](img/109131841b23b890ed8b05141f4c79c9_51.png)