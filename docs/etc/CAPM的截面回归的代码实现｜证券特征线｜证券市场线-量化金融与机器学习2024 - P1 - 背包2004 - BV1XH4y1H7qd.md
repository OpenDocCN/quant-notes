# CAPM的截面回归的代码实现｜证券特征线｜证券市场线-量化金融与机器学习2024 - P1 - 背包2004 - BV1XH4y1H7qd

![](img/c62d05baffe7fa19fc78814900682247_0.png)

所以我们好，我们来学习这个CPM的一个横截面回归，以及这两根线以及这两根线。

![](img/c62d05baffe7fa19fc78814900682247_2.png)

我们这里看到他讲了一下。

![](img/c62d05baffe7fa19fc78814900682247_4.png)

横截面回归到底是要怎么来实施，而且要注意点，横截面回归它是要建立在什么呢，建立在对每一只股票的历史数据，进行时间序列回归的基础上。



![](img/c62d05baffe7fa19fc78814900682247_6.png)

我们之前跟同学们一起。

![](img/c62d05baffe7fa19fc78814900682247_8.png)

应该是对某一只股票是吧，我们上节课对某一只股票做了啊。

![](img/c62d05baffe7fa19fc78814900682247_10.png)

做了所谓的时间序列回归。

![](img/c62d05baffe7fa19fc78814900682247_12.png)

大家还记得吗，我们已经做过是吧，得到了它相关的这个。

![](img/c62d05baffe7fa19fc78814900682247_14.png)

阿尔法和贝塔的一个系数啊，阿尔法贝塔的系数。

![](img/c62d05baffe7fa19fc78814900682247_16.png)

但是我们上节课只是对某一只，但是我们的。

![](img/c62d05baffe7fa19fc78814900682247_18.png)

这个资本资产定价这个模型的横截面回归。

![](img/c62d05baffe7fa19fc78814900682247_20.png)

它的前提是，先对每一只股票都做这样的时间序列回归，当我们对每一只股票都做了之后呢。

![](img/c62d05baffe7fa19fc78814900682247_22.png)

我们会得到非常多的背单词，这个大家能理解吧，一只股票一个嘛是吧，当然还有阿尔法值啊，还有阿尔法值，但是实际上这里呃主要是用背单词啊，主要是用背单词，就会得到很多的一个背单词呃，有了很多的背打词。

然后呢有了很多个股票的历史数据，然后呢在这个基础上再做所谓的横截面回归，横截面是个横横，横截面是个啥意思呢，啊是这样的，就是什么叫时间序列，时间序列是一只股票的历史的行为，是不是横截面是什么呢。

横截面是取某个时间的切片来看，在这个切片上面，所有股票的行为才能理解这个吗，就他看的不是一只股票，他看的是某一个时间切片上面所有的股票啊，所有的股票这个称之为横截面啊，不知道大家能不能想象出来啊。

假设我们你看我们的股票市场，有两千两千多只股票，是不是这2000多只股票，它的各自的时间序列数据，是不是都会形成很长的一条，很长的一条，是不是你可以把这2000只股票。

它的历史的股价数据看成2000根绳子，那所谓的横截是什么，它是在这一这一捆绳子的基础上，切一刀能理解吗，切一刀去看这个断面的一个情况，大家能理解这个吗，啊就它是所谓的横截面，是这么个意思。

就形象来讲是这么个意思，嗯当然当然你做这所谓的切一刀，看那个断面，只是我们物体上这么想，但是实际上我们要看在某个时间，去看所有股票的情况，你这个时间不可能是一个时间点，肯定得是一个时间段，能理解吗。

所以说一旦你是取某个时间段的所有的股票，那么这个时间段是某一个股票的话，你就不能把这个股票，这时间段每个时刻的都拿出来，但他得干嘛呢，得取这个股票在你所截的那个时间段的均值，作为这个股票的代表。

能不能理解，那这取什么做均值呢，他应该是这样的啊，他选择了我们上面通过对股票进行回归，得到的每一只股票，是不是就一个贝塔，是不是，然后呢，现在的问题是什么呢，我们上面每一只股票其实是有非常多收益率的。

它不同的时间不一样，是不是他这个时候呢，他这个收益率啊，就不再是真实的某一个历史数据，而是什么呢，而是君子他取得什么呢，取得你选择的那个时间时间周期啊，那一段时间的所有的收益率的均值啊。

这样的话任何一只股票是不是就有两个数据了，一个是真实的那个收益均值，一个是不是，然后还有一个A大值，是不是，每一只股票都有一个收益均值和一个贝塔值，是不是，那么我们上证几千只股票。

是不是就有几千个收益均值和几千个贝塔值，能理解吗，那几千个收益均值和几千个非大值，是不是正好就可以用来做回归了，哈哈能不能理解这个这一点哈，就把这两个数据也作为什么贝塔作为自变量。

然后呢某个股票的收益均值作为因变量啊，作为因变量，这样的话呢啊这个时候这个是因变量，这注意这是要求均值啊，然后呢这个是之前得到的贝塔，然后呢求什么呢，求这个系数和这个系数，当然这是残差啊，是残差值啊。

主要是求这个系数和这个系数呃，求这两个系数，大家要调节一点什么呢，首先是这个系数，这个系数是个啥啊，在我们的CAPM这个模型里面，这个系数是啥对啊，是风险溢价啊，那同学们同学这个，很不错啊，很不错。

就是市场的风险溢酬，和这里的这个东西是对应的，是不是和这里的这个东西是对应的啊，这是这本质上就是在这个模型里面的，市场的风险啊，风险溢酬因子风险一筹，因此啊这个呢就是我们的，类似于我们这个阿尔法。

但是呢这个时候这个因子啊有个很重要的作用。

![](img/c62d05baffe7fa19fc78814900682247_24.png)

它可以起到对于CAPM理论的一个，适用性的一个检验的作用，这个因子是怎么来实现它检验的作用呢，就是如果你这个理论是符合CPM的理论，假设所谓的市场均衡，市场获得得到了均衡这样一个假设啊。

那么理论上哈拟合出来这个应该是个零啊，应该是个零，就不应该有别的啊，大家想想这个东西不为零，是不会击穿这个CPM的，因为这是个股的，我们讲了在CPM理论下面，个股它会围绕围绕这边的这个值做泊松分布。

能理解吧，但是当你但是到到了这这这个礼盒里面，我们是对2000多只股票同时做礼盒，那么这个时候拟合出来的这个值，理理应是一个灵，至少在这个所谓的市场均衡的情况下面，就是所谓的CAPM的假设情况下面。

这个值应该是零，如果他不是零，就不就违背了它最初的假设，什么假设呢，就是所有股票的收益率应该是围绕着呃，市场这个收益率的一个破松分布，那他如果不是零，那就不普通了啊，不破松，那说明就不符合这个理论了啊。

所以说截面回归的第一个作用，它是用来检验这个理论的一个有效性的啊，通过它是否等于零啊。

![](img/c62d05baffe7fa19fc78814900682247_26.png)

来检验，通过它啊是是否等于零来来检验。

![](img/c62d05baffe7fa19fc78814900682247_28.png)

当然其他的作用还有肯定是。

![](img/c62d05baffe7fa19fc78814900682247_30.png)

它也可以用来做什么呢，做估值来看什么呢，那看真实的啊，真实的收益是不是是在这个曲线的上面。

![](img/c62d05baffe7fa19fc78814900682247_32.png)

还是下面啊啊等等，这样的话也能够起到呃，判断某个证券股票，被高估还是低估的一个情况啊。

![](img/c62d05baffe7fa19fc78814900682247_34.png)

![](img/c62d05baffe7fa19fc78814900682247_35.png)

好吧这是这个东西最核心的内容，我们稍微讲一讲。

![](img/c62d05baffe7fa19fc78814900682247_37.png)

然后呢我们来做实现啊，我们来做实现啊，就写代码是老师的强项，就是呃具体的投资学理论是老师的弱项啊，我们还是多花时间写写代码，我们把它实现下来。



![](img/c62d05baffe7fa19fc78814900682247_39.png)

我们把它实现下来，实现这个大家要了解一点。

![](img/c62d05baffe7fa19fc78814900682247_41.png)

这个就像不像刚才了，之前呢我们一个股票就行了，这个是得拿全全市场的所有股票呃。

![](img/c62d05baffe7fa19fc78814900682247_43.png)

因此呢得动用我们自己的那个数据库了啊，就这个数据库上节课我跟同学们提过的，就老是在在淘宝上花了20块钱买来的啊，大概是他是给了我10年吧，就是反正这样一个数据库，老师做了做了一些那个做了一些整理。



![](img/c62d05baffe7fa19fc78814900682247_45.png)

好我们运行一下连接这个数据库。

![](img/c62d05baffe7fa19fc78814900682247_47.png)

然后呢呃从这个数据库里面呢，我们不搞全量了吧，因为这个数据应该是有10年的数据，还是几年，我忘了5年吧，好像是5年啊，我为了那个为了这个数据稍微小一点，我应该是只只拿了5年的数据。

虽然说他给了我所有的历史数据啊，但是但是老师只拿了其中一部分来上课，所以这应该是2018年到2023年的数据，数据，我们拿其中的什么呢，拿其中的2020年的数据啊，拿2020年全年的这个怎么拿。

同学们能够看得懂吧，学过circle的人应该对这个不是特别陌生吧，就是获取这个表里面所有的记录，满足什么条件来满足这个条件，在这个日期，然后只获取其中的几个字段，就这么个意思啊，这个老师已经获取到了。

大家运行的时候可能稍微要稍微等等，因为这个交易日期老师并没有把它做成key，所以说大家可以稍微等等啊，获取到的话，这里老师应该已经获取到了啊，已经获取到了对。



![](img/c62d05baffe7fa19fc78814900682247_49.png)

也获取到了哦，现在我们要做横截面回归，意味着我们先要干嘛呢，先要对所有股票做做时间序列，回归所有股票做时间序列，回归呢我们需要需要把这个数据给整一整啊，整一整怎么整呢。



![](img/c62d05baffe7fa19fc78814900682247_51.png)

我们得这样，我们要把这个股票的这个列和行标和列标，要进行一个变换，变换成我们想要的形式，变换成我们想要的形式，变成变成什么呢，我们的我们需要什么呢，需要股票代码作为我们的需要，我们的需要。

我们的index要做，用我们的交易日期，然后呢股票代码做我们的COLUM，然后只要用什么呢，Value，只要用这个收盘价，看看行不行啊。



![](img/c62d05baffe7fa19fc78814900682247_53.png)

是不是不是就这样这样就好了。

![](img/c62d05baffe7fa19fc78814900682247_55.png)

啊这样做成这样子。

![](img/c62d05baffe7fa19fc78814900682247_57.png)

做成这样子会比较舒服一点啊，待会儿会舒服一点。

![](img/c62d05baffe7fa19fc78814900682247_59.png)

待会呃注意一下啊，这个这个价格应该是后复权还是前复权，反正应该是付过权的，应该是后复权，老师有点忘记了，因为这个数据是我一两年前处理的啊。



![](img/c62d05baffe7fa19fc78814900682247_61.png)

我也忘记，这应该是个后复权的数据，股价股票价格啊，而且我们拿的是收盘价。

![](img/c62d05baffe7fa19fc78814900682247_63.png)

是，做成这样。

![](img/c62d05baffe7fa19fc78814900682247_65.png)

做成这样之后干啥呢，你看这里有很多空子。

![](img/c62d05baffe7fa19fc78814900682247_67.png)

我们我们空值就直接不要吧，为什么是空值啊，这个这应该是这些股票啊。

![](img/c62d05baffe7fa19fc78814900682247_69.png)

应该是在2022022年的时候，2020年的时候才上市。

![](img/c62d05baffe7fa19fc78814900682247_71.png)

所以说他没有我们干嘛呢，我们做一件事情，我们把所有空值的列全都给不要啊，这样很实际上我们也会把所有停牌的，停盘的股票都给去掉，但是无所谓啊，我们只要一部分吧，只要一部分注意一下这个job a。

如果没有这个的话，它是会去行，这个时候我们要去列啊，所有包含NA的。

![](img/c62d05baffe7fa19fc78814900682247_73.png)

包含制空的列，我们都去掉这样，你看这样，这样的话，我们这里都是没有滞空的股票了，然后它包含了多少多少多少个呢。



![](img/c62d05baffe7fa19fc78814900682247_75.png)

应该是1000 11918，也就是一千一千九百一十八个股票在这里了。

![](img/c62d05baffe7fa19fc78814900682247_77.png)

好吧，我们把这个给到给到我们的，给给一个变量吧，给到一个量点，啊就给到他吧。

![](img/c62d05baffe7fa19fc78814900682247_79.png)

给到这个有了这个之后呢。

![](img/c62d05baffe7fa19fc78814900682247_81.png)

我们这是股价，我们要拿什么呢，我们要拿收益率，是不是股价要变收益率，股价变收益率的话，点shift，我们要我们最好是不搞一天吧，搞一天吗，一天的话有点波动有点大，我们搞稳一点好不好，我们换个换十天。

就是我们只看十天的收益率行不行啊，其实也是滚动的啊。

![](img/c62d05baffe7fa19fc78814900682247_83.png)

也是滚动的，你看当然都会导致前面几天是那个。

![](img/c62d05baffe7fa19fc78814900682247_85.png)

前面几天是是空子啊，这个没问题，大不了把它做掉就行了。

![](img/c62d05baffe7fa19fc78814900682247_87.png)

![](img/c62d05baffe7fa19fc78814900682247_88.png)

啊从这里开始，我们这个是10日收益率。

![](img/c62d05baffe7fa19fc78814900682247_90.png)

是不是10日收益率十天的。

![](img/c62d05baffe7fa19fc78814900682247_92.png)

这个收益率呢我们给到一个新的值吧，给它一个新的词好有了这个时日收益率的话。

![](img/c62d05baffe7fa19fc78814900682247_94.png)

这样的话呢我们现在要什么呢，呃我们现在要大盘的收益情况，大盘的收益情况应该怎么怎么拿呢。

![](img/c62d05baffe7fa19fc78814900682247_96.png)

大家知道大盘收益情况应该怎么拿吗，是不是每个股票的收益情况取平均就行了，能理解吧，我们不需要求助别的嘛是吧，就这里的每个股票的收益情况取个平均，是不是就是大盘的组合收益率了啊，所以求个平均。



![](img/c62d05baffe7fa19fc78814900682247_98.png)

但是再瘦一点，这么求平均是不是不对啊，要求求对什么，怎么求平均，对行还求平均，还是对列，求平均啊，你看啊我们是要干嘛，我们是要对每个股票做时间序列分析，所以说我们每个点是什么。

是股票在那那那十天的一个收益，它对应的是什么，对应的是不是大盘在那时间收益，他他是要对行取平均。

![](img/c62d05baffe7fa19fc78814900682247_100.png)

大家能不能理解这一点，他是要你看啊，他是要对对所有这1000个这个这一行。

![](img/c62d05baffe7fa19fc78814900682247_102.png)

这一行取平均能理解吗。

![](img/c62d05baffe7fa19fc78814900682247_104.png)

就得到什么呢，得到整个大盘在这个时间点的10日收益率。

![](img/c62d05baffe7fa19fc78814900682247_106.png)

10日收益率，要怎么怎么做呢，这个其实老师在数据采集的课上面，其实是讲过的，只是那个时候很少用到啊，哦它它等于一啊。



![](img/c62d05baffe7fa19fc78814900682247_108.png)

你看这个时候就是对行求平均，行求平均，这个我们给到给到，index给到一个词吧。

![](img/c62d05baffe7fa19fc78814900682247_110.png)

这个有了这个有了之后呢，我们还缺个什么呢，还缺一个无风险是无风险收益率。

![](img/c62d05baffe7fa19fc78814900682247_112.png)

是不是无风险收益率。

![](img/c62d05baffe7fa19fc78814900682247_114.png)

我们假设一个吧，好无风险假设是0。03，假设一年是0。03，如果一年是0。13，那10日平均是多少呢，我们这里用最简单的方法，我们用呃算术平均一年如果是0。03的话，那么我们看一下这里有多少个交易日啊。

这里有多少个交易的，我看看。

![](img/c62d05baffe7fa19fc78814900682247_116.png)

啊怎么是233个哦。

![](img/c62d05baffe7fa19fc78814900682247_118.png)

是230，但是是233个。

![](img/c62d05baffe7fa19fc78814900682247_120.png)

因为他10日嘛做10日了啊，所以说要干嘛呢，就这样吧，让它除以233，其实应该是243吗，我也不太确定啊，因为我们这里只有233个数据，因为我们取了10日啊，十十的滚动这个所以说前面有很多是空值啊。

我觉得是不是才应该243啊。

![](img/c62d05baffe7fa19fc78814900682247_122.png)

243是什么呢，是为是，因为这里啊，啊这里是有243个交易日的啊，那这里是143的交易，我们去用243，用它除以243之后要干嘛呢，还乘以个十是吧。



![](img/c62d05baffe7fa19fc78814900682247_124.png)

就得到了10日交易的这个君子啊。

![](img/c62d05baffe7fa19fc78814900682247_126.png)

好这些东西都准备好了，准备好了之后呢，就要进行时间序列回归了啊，时间序列回归，我们这个R里面有多少有哪些啊。



![](img/c62d05baffe7fa19fc78814900682247_128.png)

我们可以看看。

![](img/c62d05baffe7fa19fc78814900682247_130.png)

啊有这些呃，我们先拿之前的代码过来搞一个。

![](img/c62d05baffe7fa19fc78814900682247_132.png)

然后再做个循环就OK了。

![](img/c62d05baffe7fa19fc78814900682247_134.png)

是不是先先拿之前的代码啊，之前的代码来搞一个就行了。

![](img/c62d05baffe7fa19fc78814900682247_136.png)

这是不是我们之前的代码。

![](img/c62d05baffe7fa19fc78814900682247_138.png)

把它拷贝过来啊，拷贝过来。

![](img/c62d05baffe7fa19fc78814900682247_140.png)

啊拷贝过来之后呢，我们搞搞一个就行啊。

![](img/c62d05baffe7fa19fc78814900682247_142.png)

一个怎么搞呢，我们取其中的一个取这个就取第一个吧，我们先试一下啊。

![](img/c62d05baffe7fa19fc78814900682247_144.png)

先试一下，先试一下这个这个是什么呢，这是，我们的个股注意一下我们的2F等于什么呢，我们2F应该等于他是2F，应该等于他也就是无风险收益，而我们的index在这里就是市场收益，应该在这里是吧，其实就好了。

这样是不是就好了，啊其实啊其实我们不需要我们直接放到这里吧，不需要那个啊一行就搞定了，这样会更简洁吗是吧。



![](img/c62d05baffe7fa19fc78814900682247_146.png)

是不是这样是不是就好了。

![](img/c62d05baffe7fa19fc78814900682247_148.png)

这是我们的001号股票，001号股票的，那既然一个可以搞。

![](img/c62d05baffe7fa19fc78814900682247_150.png)

那我们是不是可以搞N个N个怎么弄呢。

![](img/c62d05baffe7fa19fc78814900682247_152.png)

我们肯定得先做个循环，循环怎么弄呢，取这个东西的index，这个东西叫COLUM，诶是吧，基于它做循环，但是我们先先搞一两个吧，啊这样的话I就是我们的那个呃这个。



![](img/c62d05baffe7fa19fc78814900682247_154.png)

然后我们在这里的话，我们，要干嘛呢，要用I来做这个事情，这个不用变，这个也不用变。

![](img/c62d05baffe7fa19fc78814900682247_156.png)

都是常数嘛是吧，关键是什么呢，关键我们需要把这个东西呃系数给保留起来。

![](img/c62d05baffe7fa19fc78814900682247_158.png)

系数给保留起来，所以说我们设两个词吧，贝塔贝塔等，一个等于这个，然后呢二阿尔法等于这个阿尔法我们也留着，万一有用呢，谁知道啊，阿尔法也留着嗯，然后我们看看这两个东西怎么取，他应该是这么取的啊。

就是当我们设置好，弄好了之后啊。

![](img/c62d05baffe7fa19fc78814900682247_160.png)

它应该是可以通过这个哎我我，我记得这个字单词怎么写了，同学们，para是什么PAR是吗。

![](img/c62d05baffe7fa19fc78814900682247_162.png)

啊这个吗，完了我不记得了。

![](img/c62d05baffe7fa19fc78814900682247_164.png)

我去看看，我去看看，我不记得这个单词怎么写了哈，我得我必须得回忆起来是这样写的。

![](img/c62d05baffe7fa19fc78814900682247_166.png)

我刚才怎么写出来，我没写错，我觉得我怎么写错了。

![](img/c62d05baffe7fa19fc78814900682247_168.png)

A的位置写错了啊，是这个看到没有。

![](img/c62d05baffe7fa19fc78814900682247_170.png)

啊老师主要是用惯上课用惯了这个notebook，其实老师平时也用那个用那个vs code来写，那个时候它会自动补全，那就不用这么这么这么那个好，这是这个，然后呢我们的阿尔法应该是这个东西。



![](img/c62d05baffe7fa19fc78814900682247_172.png)

是吧，然后呢那个贝塔就应该是，所以说我们在这里拿到之后，我们就把贝塔贝塔点a pen，把它加进去，这是常数项的啊，还有，这个应该是阿尔法，而beta的应该是什么，应该是他的零，为什么是他的理论。

大家看看就知道了啊，因为他这就两个词吗。

![](img/c62d05baffe7fa19fc78814900682247_174.png)

一个是零，一个是这个啊，所以说我们搞完，应该是可以把可以把所有2000只股票搞完了，我们先试一下啊。

![](img/c62d05baffe7fa19fc78814900682247_176.png)

你看速度还是很快的，我们看一下贝塔和二是吧。

![](img/c62d05baffe7fa19fc78814900682247_178.png)

![](img/c62d05baffe7fa19fc78814900682247_179.png)

而阿尔法的。

![](img/c62d05baffe7fa19fc78814900682247_181.png)

好这样的话有了这个我把它去掉，我们去来做这19181918个，好了，速度还可以啊，这样的话我们其实像拿到了啊，拿到了这个，拿到了这个拿到之后呢，我们啊做一件事情，就是做我们什么呢。



![](img/c62d05baffe7fa19fc78814900682247_183.png)

做我们所谓的证券特征线，70证券申请，我们上节课做过。

![](img/c62d05baffe7fa19fc78814900682247_185.png)

就是那个礼盒出来的，就时间序列，你合出来的那条线就称之为哈。

![](img/c62d05baffe7fa19fc78814900682247_187.png)

就称之为。

![](img/c62d05baffe7fa19fc78814900682247_189.png)

我们，证券特征线。

![](img/c62d05baffe7fa19fc78814900682247_191.png)

我们只做一条吧，我们就做我们刚才的这个0001好不好，1001，首先呢0001的这个。

![](img/c62d05baffe7fa19fc78814900682247_193.png)

散点我们可以很简单的就做出来，为什么呢，因为他的，我是不是还要点value4好一点，呃这是001，然后这是它对应的stock index，啊这这两个东西的散点也是一个因变量，还有一个是自变量是吧。

需要减RRF吗，要不我们还得减一个吧。

![](img/c62d05baffe7fa19fc78814900682247_195.png)

是吧，你这个看起来还不错嘛，就捡了一个那个一起捡了一个无风险收益，无风险收益。

![](img/c62d05baffe7fa19fc78814900682247_197.png)

还是说可以不剪，然后呢我们做把直线做出来。

![](img/c62d05baffe7fa19fc78814900682247_199.png)

直线它的是啥呢，它的两个系数应该就是我们的贝塔，贝塔一是不是贝塔零和阿尔法，你，它的两个系数，一个是贝塔012法零嘛，就第一个第一个。



![](img/c62d05baffe7fa19fc78814900682247_201.png)

然后我们把线画出来就行了，画线其实我们之前写过。

![](img/c62d05baffe7fa19fc78814900682247_203.png)

要不copy，copy之前搞过这个事，是不是是不是之前搞过这个事。

![](img/c62d05baffe7fa19fc78814900682247_205.png)

![](img/c62d05baffe7fa19fc78814900682247_206.png)

啊我们的贝塔零是在这个位置，阿尔法零是在这个位置是吧。

![](img/c62d05baffe7fa19fc78814900682247_208.png)

额范围呢X的范围是在0。00。2。

![](img/c62d05baffe7fa19fc78814900682247_210.png)

-0。2到0。2是不是，所以说我们改一下范围，0。2到0。2是吧。

![](img/c62d05baffe7fa19fc78814900682247_212.png)

改一下范围，然后把XY求出来。

![](img/c62d05baffe7fa19fc78814900682247_214.png)

然后再把它做出来。

![](img/c62d05baffe7fa19fc78814900682247_216.png)

是吧，那这个就是所谓的证券特征线。

![](img/c62d05baffe7fa19fc78814900682247_218.png)

![](img/c62d05baffe7fa19fc78814900682247_219.png)

它仅仅属于我们的这个股票啊，这个证券特征线有啥用呢，其实它的用处。

![](img/c62d05baffe7fa19fc78814900682247_221.png)

就是我们之前讲过的这个CAPM的一个使用，还记得吗，就是当我们有了这些量之后呢，我们去算他的预期收益，然后和什么呢，和他的。



![](img/c62d05baffe7fa19fc78814900682247_223.png)

实际收益进行比较，看什么呢，看这个实际收益啊是否在预期收益之上。

![](img/c62d05baffe7fa19fc78814900682247_225.png)

如果在预期收益之上的话，那说明他怎么了。

![](img/c62d05baffe7fa19fc78814900682247_227.png)

说明就被低估了啊，如果用这个图形来表示呢。

![](img/c62d05baffe7fa19fc78814900682247_229.png)

就是什么呢，如果啊等一下啊。

![](img/c62d05baffe7fa19fc78814900682247_231.png)

如果，因为这边对应的是什么呢，这边对横轴对应的就是预期收益啊，预期当然他捡了一个那个减了一个无风险啊，无所谓，这边大致就是呃2H减RF嗯，就是如果真实的收益，如果是在这根曲线。

你看在这根这根线的上面的话，在这上面的话就说明什么呢，他已经在这个位置能理解吧，但是他在这里就说明了，它的真实比你预期的是要高的，真实的收益比预期高，能理解吗，真实的收益比预期高。

就意味着它被低估了能理解吗，被低估了就买就买，所以说如果你看到它如果在它下面啊，就说明它被高估了就抛啊，这是不是一个非常简单的一个一个一个，一个股票的一个策略，就是这样子啊，就是如果发现它被高估就买入。

如果发现被低估了就给就要卖出就卖出啊，所以说我们同学好像经常听到一些财经新闻，里面会说，哎你把什么东西的评级调了调是吧，然后评级被调为什么呃，买入还是卖出卖出啊，这都是通过他们内部当然不会这么简单。

但它内内部一样，也是会有这样的一个证券特征线，如果发现黑真实情况在它限制上面，说明它被高估被低估啊，然后可以买入好吧，这是呃所谓的证券特征线的啊，怎么怎么用以及怎么来做出来啊。

其实就是拟合出来这条线嘛啊。

![](img/c62d05baffe7fa19fc78814900682247_233.png)

然后呢我们还得做横截面回归呢哈横截面回归。

![](img/c62d05baffe7fa19fc78814900682247_235.png)

横有了这些东西的话。

![](img/c62d05baffe7fa19fc78814900682247_237.png)

横截面回归就非常的简单了啊。

![](img/c62d05baffe7fa19fc78814900682247_239.png)

就非常简单了，因为我们已经完成了大部分事情，完成了大部分事情。

![](img/c62d05baffe7fa19fc78814900682247_241.png)

![](img/c62d05baffe7fa19fc78814900682247_242.png)

啊现在我们有了beta也有了什么呢，有了我们的这个东西啊，收益率有了收益率啊。

![](img/c62d05baffe7fa19fc78814900682247_244.png)

![](img/c62d05baffe7fa19fc78814900682247_245.png)

有了收益率，有了贝塔，接下来我们要干嘛呢，我们可以做横截面回归了啊。

![](img/c62d05baffe7fa19fc78814900682247_247.png)

我看看。

![](img/c62d05baffe7fa19fc78814900682247_249.png)

呃刚才讲过。

![](img/c62d05baffe7fa19fc78814900682247_251.png)

在这个公式里面，在这个公式里面哈。

![](img/c62d05baffe7fa19fc78814900682247_253.png)

它是一个君子beta，我们也有了这个均值，我们还没有，我们只有真实的词。

![](img/c62d05baffe7fa19fc78814900682247_255.png)

我们得取取平均，而这次取平均就不像刚才了。

![](img/c62d05baffe7fa19fc78814900682247_257.png)

刚才是要求整个大盘的这次球呢就直接求平均。

![](img/c62d05baffe7fa19fc78814900682247_259.png)

是每个股票在这一年这一年的，我们我们横截面取，就是取这一年能理解吧，就整个这一年所有股票的这个呃进行比较，所以横截面的这个时间，这个时间截面我们取的就是当前这一年。

所以说呢我们对当前这一年的啊10日收益率啊，做了一个均值啊，做了一个均值就得到这个东西，然后我们有beta，这样的话呢，我们直接来做做做，做这个东西就行了啊，做回归就行了，你看啊我们的beta。

别打在这里。

![](img/c62d05baffe7fa19fc78814900682247_261.png)

![](img/c62d05baffe7fa19fc78814900682247_262.png)

哎贝塔贝塔在这里注意一下这里面的贝塔，它的那个值啊，它的值和和它的值是一一对应的。

![](img/c62d05baffe7fa19fc78814900682247_264.png)

它的顺序没有变，因为这个顺序也是从从第一个开始，他贝塔排列也是一样的，所以说我们可以直接把它放进去。

![](img/c62d05baffe7fa19fc78814900682247_266.png)

好直接把它放进去，这，啊然后做回归。

![](img/c62d05baffe7fa19fc78814900682247_268.png)

然后做回归，那就出来了。

![](img/c62d05baffe7fa19fc78814900682247_270.png)

出来了，这样这样能得到什么呢，这样就横截面回归其实就完成了啊，首先我们得看一点他的决定系数，决定系数它它是什么呢，他是要得越接近一越好，这个决定系数一看就不靠谱啊。



![](img/c62d05baffe7fa19fc78814900682247_272.png)

一看就不靠谱，然后看什么呢，看他的所谓的常数项，它的常数项是0。00252，不行啊，就他没有没有不对，他要接近于零，这个就这个常数项接近于零，就说明这个CPM是能够比较好的，适用于这个市场。

但是从这个计算计算来看，它是常数项是不为零的，所以所以CAPM这个就是市场，就是我们的这个至少在2020年这一年，我们的这个上证是没有达到均衡哈，没有达到市场均衡，就不不用这个模型是并不合适的啊。

是要从这里能看出来，从这里能看出来啊，好吧，这是这是他的贝塔啊，这是他的贝塔，然后我们，在干嘛呢，我们把它把这个线也就是所谓的什么线呢。



![](img/c62d05baffe7fa19fc78814900682247_274.png)

就是所谓的呃证券市场线。

![](img/c62d05baffe7fa19fc78814900682247_276.png)

把它做出来。

![](img/c62d05baffe7fa19fc78814900682247_278.png)

证券市场线，就是我们刚才拟合出来的这个东西啊。

![](img/c62d05baffe7fa19fc78814900682247_280.png)

拟合出来的这个东西我们把它做出来吧。

![](img/c62d05baffe7fa19fc78814900682247_282.png)

![](img/c62d05baffe7fa19fc78814900682247_283.png)

啊这个时候我们的我们就直接取吧，我就不用了，他的阿尔法是这个东西是吧，然后呢他的贝塔是这个东西。

![](img/c62d05baffe7fa19fc78814900682247_285.png)

就是这个，然后呢我们还要做什么呢，还要做真实的情况。

![](img/c62d05baffe7fa19fc78814900682247_287.png)

真实的情况，我们把拷贝过来。

![](img/c62d05baffe7fa19fc78814900682247_289.png)

先做真实的啊。

![](img/c62d05baffe7fa19fc78814900682247_291.png)

真实的是什么呢，真实的是我们的这个。

![](img/c62d05baffe7fa19fc78814900682247_293.png)

![](img/c62d05baffe7fa19fc78814900682247_294.png)

要不要剪，好像不需要减啊，啊不剪的话，他就不他的那个就不在你那里，就会有个结局啊，就会有个结局先不减吧，这是真实的啊。



![](img/c62d05baffe7fa19fc78814900682247_296.png)

然后我们的贝塔贝塔值贝塔只在这里。

![](img/c62d05baffe7fa19fc78814900682247_298.png)

![](img/c62d05baffe7fa19fc78814900682247_299.png)

啊然后我们先把这个做出来，看看这个啥样子。

![](img/c62d05baffe7fa19fc78814900682247_301.png)

这么个样子诶，这个XY不一样啊。

![](img/c62d05baffe7fa19fc78814900682247_303.png)

应该用上面的，我看一下他在哪个位置啊，0。05到到0。15。

![](img/c62d05baffe7fa19fc78814900682247_305.png)

-0。05到0。15。

![](img/c62d05baffe7fa19fc78814900682247_307.png)

-0。05是吧。

![](img/c62d05baffe7fa19fc78814900682247_309.png)

到0。15这个区间，0。15这个区间。

![](img/c62d05baffe7fa19fc78814900682247_311.png)

![](img/c62d05baffe7fa19fc78814900682247_312.png)

这是啥，为什么弄出来是这么个情况呢。

![](img/c62d05baffe7fa19fc78814900682247_314.png)

啊那个老师再重申一下，我犯了个错误啊，为什么呢，就是这个XY搞混了啊。

![](img/c62d05baffe7fa19fc78814900682247_316.png)

要要掉个头，就是在这个曲线里面，这个里面啊，这边是贝塔，这边是贝塔啊，这边是我们的那个个股的啊，平均期望啊，平均期平均那个啊，平均收益啊，下面是贝塔啊，下面是贝塔啊。



![](img/c62d05baffe7fa19fc78814900682247_318.png)

这样的话就是正常的，他是这样的一根一根一根线啊，这样的一根线就你是你合出来的，但是显然并不那个啊。

![](img/c62d05baffe7fa19fc78814900682247_320.png)

就是并不满足，这个就是并不并不是围绕这个曲线的啊，显然还没有。

![](img/c62d05baffe7fa19fc78814900682247_322.png)

上面这个，上面对上面这个老师也之前也是弄错了，应该是这个啊，应该是X应该是市场组合啊，Y应该是这个收益啊。



![](img/c62d05baffe7fa19fc78814900682247_324.png)

就是个股的收益啊，这边也是一样，就要调换一下。

![](img/c62d05baffe7fa19fc78814900682247_326.png)

调换一下，调换完了之后，他这个区间啊也也得换一下啊，不管怎样，我们把市场啊所谓的什么啊。

![](img/c62d05baffe7fa19fc78814900682247_328.png)

![](img/c62d05baffe7fa19fc78814900682247_329.png)

所谓的证券市场线我们也做出来了啊。

![](img/c62d05baffe7fa19fc78814900682247_331.png)

做出来了，把这里标识一下啊。

![](img/c62d05baffe7fa19fc78814900682247_333.png)

标识一下。

![](img/c62d05baffe7fa19fc78814900682247_335.png)

啊这就是所谓的证券市场线。

![](img/c62d05baffe7fa19fc78814900682247_337.png)

我们再回头看看看他证券市场线。

![](img/c62d05baffe7fa19fc78814900682247_339.png)

首先啊那个证券特征线其实我们已经熟悉了，因为上节课其实我们也讲过，他无非就是用来做估值嘛是吧，不用来做估值啊，然后证券市场线呢，它首先一点，它是用来检验CAPM的模型的解释力的，刚才也讲了。

他那个阿尔法算出来的。

![](img/c62d05baffe7fa19fc78814900682247_341.png)

那个阿尔法最好是要等于零，但是实际上我们算出来是不等于零的。

![](img/c62d05baffe7fa19fc78814900682247_343.png)

是等于0。0052是吧，刚才算出来。

![](img/c62d05baffe7fa19fc78814900682247_345.png)

等于0。052不等于，其实从这个从这个角度就看出。

![](img/c62d05baffe7fa19fc78814900682247_347.png)

我们的市场，不太符合这个模型的一个理论假设啊，咳就反映了这个有没有均衡啊，不没有这个均衡假设，另外的话也是，也是可以用来给资产进行定价的啊，资产定价，而且注意一下证券市场线，用用它来定价的话会更加保守。

或者因为他是用的什么呢，他用的是整个周期里面的君子啊，整个周期里面的均值，呃显然是会，变化更加缓慢一点啊。



![](img/c62d05baffe7fa19fc78814900682247_349.png)

变化更加缓慢一点，好其他的呃。

![](img/c62d05baffe7fa19fc78814900682247_351.png)

这个方法就是这么这么搞的，同学们自己完成一下啊。

![](img/c62d05baffe7fa19fc78814900682247_353.png)

自己完成一下。