# Pandas基础（二） - P1 - Crypto小白书 - BV1Rx4y1a7XG

![](img/96c0a92c4a3649d676adf370d0b7af69_0.png)

SI大家好，这里是加密小白书，这节课我将为大家介绍一些关于pandas。

![](img/96c0a92c4a3649d676adf370d0b7af69_2.png)

列操作和统计函数的知识，首先我们来看一些列操作的例子。

![](img/96c0a92c4a3649d676adf370d0b7af69_4.png)

我们有一个data frame，首先我们有一个data frame，里面是比特币的5分钟K线数据，包括它的时间戳，开盘价，最高价，最低价，收盘价和成交量，那我们将使用一些简单的代码，对这些数据进行操作。



![](img/96c0a92c4a3649d676adf370d0b7af69_6.png)

首先我们进行行列的加减乘除，那举个简单的例子，我们将收盘价乘以100。

![](img/96c0a92c4a3649d676adf370d0b7af69_8.png)

运行一下这个函数，可以看到原本的收盘价是一个五位数。

![](img/96c0a92c4a3649d676adf370d0b7af69_10.png)

乘100以后变成了一个七位数，我们还可以新增一列，并给它赋值。

![](img/96c0a92c4a3649d676adf370d0b7af69_12.png)

我们新增一列叫time stamp two，将原本的time stamp列加上一个UTC时间，复制给time step two，这一列运行一下试试。



![](img/96c0a92c4a3649d676adf370d0b7af69_14.png)

嗯可以看到呢。

![](img/96c0a92c4a3649d676adf370d0b7af69_16.png)

我们这边产生了一个报错，报错的原因是timestamp不能直接和stream相加，那我们可以用一段代码，把on time stamp转化成string格式，使用s type。

把ST这一列中所有的tom stamp格式，转换成string格式，并且赋值给原来的那一列。

![](img/96c0a92c4a3649d676adf370d0b7af69_18.png)

运行一下，好运行成功以后，我们再运行一下。

![](img/96c0a92c4a3649d676adf370d0b7af69_20.png)

刚才这个代码。

![](img/96c0a92c4a3649d676adf370d0b7af69_22.png)

成功我们print看一下，可以看到我们成功添加了一列。

![](img/96c0a92c4a3649d676adf370d0b7af69_24.png)

并且这一列呢是我们原本的T列，加上了UTC这个标识。

![](img/96c0a92c4a3649d676adf370d0b7af69_26.png)

好我们现在再添加一列叫做交易所，并且赋值这一列中每一个值都是ax。

![](img/96c0a92c4a3649d676adf370d0b7af69_28.png)

可以看到我们现在新加了一列，并且它每个值都是KX。

![](img/96c0a92c4a3649d676adf370d0b7af69_30.png)

我们再来看一些关于统计函数的例子。

![](img/96c0a92c4a3649d676adf370d0b7af69_32.png)

这些函数可以帮助我们，计算数据的各种统计指标，比如说我们来计算一下close这一列它的均值。

![](img/96c0a92c4a3649d676adf370d0b7af69_34.png)

也就是说对于close这一列取均值，结果是421。93。

![](img/96c0a92c4a3649d676adf370d0b7af69_36.png)

我们也可以对多列进行操作。

![](img/96c0a92c4a3649d676adf370d0b7af69_38.png)

这里我们对两列close和volume都取均值，返回一个serious数据类型，对于close这一列，它的均值是这个，对于volume这一列。



![](img/96c0a92c4a3649d676adf370d0b7af69_40.png)

它的取均值是这个，这里需要注意的是，当main函数括号中xxx等于一的时候，指的是对多列进行操作。

![](img/96c0a92c4a3649d676adf370d0b7af69_42.png)

也就是说对close和volume这两列进行求平均值。

![](img/96c0a92c4a3649d676adf370d0b7af69_44.png)

那具体的计算方法就是41997。8，加上这个数除以二。

![](img/96c0a92c4a3649d676adf370d0b7af69_46.png)

41985。0，加上这个数除以2ax等于零的时候呢。

![](img/96c0a92c4a3649d676adf370d0b7af69_48.png)

就是取两列分别的均值xxx等于一还是零呢，很容易在实际中弄混，到时候试一下，其实就知道了，另外还有很多统计函数，比如说取最大值，最小值，取标准差，取非空的数量等等等等。



![](img/96c0a92c4a3649d676adf370d0b7af69_50.png)

这里就不一一列举好，接下来我们介绍一些余力相关的其他常用函数。

![](img/96c0a92c4a3649d676adf370d0b7af69_52.png)

首先是shift类，我们通过一个一个的例子，来看看函数的具体用法。

![](img/96c0a92c4a3649d676adf370d0b7af69_54.png)

我们定一个新的列列名，叫做下周期收盘价。

![](img/96c0a92c4a3649d676adf370d0b7af69_56.png)

它的值等于收盘价点shift-1，我们看一下整个的data frame。

![](img/96c0a92c4a3649d676adf370d0b7af69_58.png)

方便理解，可以看到下周期收盘价中，上一行等于下一行的close，上一行等于下一行的close，上一行等于下一行的close，也就是它将整个close列向上扭转了一行。

那同样的我们如果做一个shift等于一的操作，这里当shift等于一的时候，整个close行向下挪动了一行。



![](img/96c0a92c4a3649d676adf370d0b7af69_60.png)

所以shift这个方法的作用就非常好理解，它就是将列数据向下或者向上偏移若干行，好，我们来把这个下周期收盘价这一列来删除掉。



![](img/96c0a92c4a3649d676adf370d0b7af69_62.png)

可以留两个方法，一个是drop，用了drop函数以后，这个data frame中已经没有了，下周一收盘价这一列。



![](img/96c0a92c4a3649d676adf370d0b7af69_64.png)

这一列已经被删除，我们也可以用delete方法来删除某一列。

![](img/96c0a92c4a3649d676adf370d0b7af69_66.png)

具体操作就是delete data frame等于下周期收盘价，接下来我们来看一下diff这个method，这个函数，直接看一个例子。



![](img/96c0a92c4a3649d676adf370d0b7af69_68.png)

定义一列名叫涨跌，它等于close点，第一，Friends did friend。

![](img/96c0a92c4a3649d676adf370d0b7af69_70.png)

看一看，可以看到涨跌这一列的数据，等于close的下一行减去close的上一行，-29。1，等于41955。9，减去41985。0，同样的16。8等于41972。7，减去4195。9。

当DIF等于一的时候，涨跌这一行等于close的下一行减上一行，那么不难想象，当DIF等于一的时候，就是上一行减下一行，我们来看一下。



![](img/96c0a92c4a3649d676adf370d0b7af69_72.png)

接下来我们来看一下percentage change这个函数，它非常类似于def，唯一不同的是def求的是两数相减，percentage change求的是两数的变化幅度。



![](img/96c0a92c4a3649d676adf370d0b7af69_74.png)

也就是说它带有百分比代入这里就是涨跌幅。

![](img/96c0a92c4a3649d676adf370d0b7af69_76.png)

![](img/96c0a92c4a3649d676adf370d0b7af69_77.png)

我们继续看cumulative类的函数，首先我们看一下CSN这个函数。

![](img/96c0a92c4a3649d676adf370d0b7af69_79.png)

举个例子。

![](img/96c0a92c4a3649d676adf370d0b7af69_81.png)

我们定义了新的一列叫累计成交量，然后将volume这一列做一个CSM的操作复制给他，通过观察我们可以发现，累积成交量等于之前所有的trading volume之和，也就是说他做了一个累积的操作。



![](img/96c0a92c4a3649d676adf370d0b7af69_83.png)

我们再来看一下king pro这个函数，好我们看一下这个例子，定义新的一列列名叫资金曲线，将涨跌幅加一做一个cut操作。



![](img/96c0a92c4a3649d676adf370d0b7af69_85.png)

print出来看一下，资金曲线其实是涨跌幅的累成，可以理解成当初始投资为一元时，在任意时刻这一元会变成多少钱，将它画成曲线的话，就可以理解成是零投资额的净值。



![](img/96c0a92c4a3649d676adf370d0b7af69_87.png)

我们再来看一下其他函数。

![](img/96c0a92c4a3649d676adf370d0b7af69_89.png)

首先是rank，rank函数顾名思义是用来排序的，看一个操作，定义新的一列叫收盘价排名，将收盘价做一个rank操作，print出来看一下。



![](img/96c0a92c4a3649d676adf370d0b7af69_91.png)

可以看到我们对close收盘价这一列做了一个排序，ascending等于true or false。

![](img/96c0a92c4a3649d676adf370d0b7af69_93.png)

决定了它是顺序排序还是逆序排序，我们再来看value count这个函数。

![](img/96c0a92c4a3649d676adf370d0b7af69_95.png)

返回一个serious，结果代表的含义是，每一个数在该列中出现的次数，比如42242出现了三次，42170。3出现了两次等等等等。



![](img/96c0a92c4a3649d676adf370d0b7af69_97.png)

以上就是我们认为最常用的函数，如果想要看pandas库可以支持哪些函数，可以访问这个官方链接。

![](img/96c0a92c4a3649d676adf370d0b7af69_99.png)