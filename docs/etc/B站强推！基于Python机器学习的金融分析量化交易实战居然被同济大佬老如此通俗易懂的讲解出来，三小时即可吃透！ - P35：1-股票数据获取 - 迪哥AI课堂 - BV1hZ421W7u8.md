# B站强推！基于Python机器学习的金融分析量化交易实战居然被同济大佬老如此通俗易懂的讲解出来，三小时即可吃透！ - P35：1-股票数据获取 - 迪哥AI课堂 - BV1hZ421W7u8

接下来我们就来看一下，刚才哎咱们说的一个因子选股的策略哎，先把我们的一个因子拿过来做一些预处理，我要去基值哎，我还要去做标准化，还有中性化操作，做完这些基本操作之后啊，咱们来看一看基于因子啊。

我设计个策略哎，比如说像他们说的因子当中啊，选择某些指标，然后我们来衡量一下哪些股票好，这样能在股票池当中啊，咱把这批数据哎，咱把这批股票拿过来，我去买，然后呢我们的因子啊会随着时间的变化。

每天都在发生变化吧，那其实啊相当于这样一件事，哎我过一段时间我要做一个调仓，就是说果实当中啊，可能就是我买这么十只或者买20支，但是呢一定得是符合我的一个因子，选股策略的吧，咱们就要来完成这样一个任务。



![](img/49df8df39f3adfa3369ee2dc426a8c16_1.png)

好了，来咱们来看一下怎么去写啊，第一步哎，在这里我是新建了一个我们的文件，叫做二杠因子策略，在这里呢呃一开始它有些注释信息啊，都删掉了，没什么用啊，咱把我们一会儿啊，会用到的一些工具包先导进来。



![](img/49df8df39f3adfa3369ee2dc426a8c16_3.png)

在这里啊，就是呃它也是支持，就是你的一些额外的工具包，像是咱们常用的这个南派啊，pandas as啊，这些东西哎都是只能导进来的，然后呢第二个就是一个pandas，然后as as一个pd。

然后接下来还有一个还有一个就是呃，一会儿我们肯定要做一个回归方程吧，因为当我们在做这个中性化的时候，你要求解一个回归方程，所以说啊咱们得把回归方程哎，这个东西导进来呃，有两个可选的工具包。

一个叫sk learn啊，非常经典的一个Python机器学习工具包，还有一个呢就是统计分析当中啊，也会比较常用的叫steve models呃。



![](img/49df8df39f3adfa3369ee2dc426a8c16_5.png)

对比一下，就是还是觉着space models用起来更简单一点啊，基本上咱们两行代码就能把这个事做出来。



![](img/49df8df39f3adfa3369ee2dc426a8c16_7.png)

所以这里啊咱们把呃state models给它导进来。

![](img/49df8df39f3adfa3369ee2dc426a8c16_9.png)

在啊咱们当前模块当中我们导入一下呃，其实只需要导入啊它的一个回归模块就可以了。

![](img/49df8df39f3adfa3369ee2dc426a8c16_11.png)

其他的咱们暂时还用不上，这个是我们要用的几个工具包呃，一会儿看看吧，一会儿看看咱们还能不能用上，其他的用什么。



![](img/49df8df39f3adfa3369ee2dc426a8c16_13.png)

咱们现导也行，然后咱们就按照这个顺序一步步来去写吧，首先第一步咱们的一个初始化模块，在这个初始化模块当中啊，我们要设计来设计什么。



![](img/49df8df39f3adfa3369ee2dc426a8c16_15.png)

一会儿呢我们要肯定要做的一件事，大家想一想，你看啊，我一会儿我会选择一个时间。

![](img/49df8df39f3adfa3369ee2dc426a8c16_17.png)

比如说这个时间要改一改啊，从2016年的1月1号，到这么2017年的一个1月1号吧。

![](img/49df8df39f3adfa3369ee2dc426a8c16_19.png)

咱们就这么一年时间，一会儿啊。

![](img/49df8df39f3adfa3369ee2dc426a8c16_21.png)

咱们是这样，我说现在啊我去选了一个策略，然后在这个策略当中我选了一个股票啊，咱们有大池子，在这个池子当中啊，可能呃我每个月都要做一个调仓啊，每个月我都要选一选，看看哪些哎不符合我策略了。

我给它卖掉哪些呢。

![](img/49df8df39f3adfa3369ee2dc426a8c16_23.png)

符合我策略可以买进来，是不是这样一件事啊，那这个就是当我们设一说啊，咱没想好你是按月来执行呢，还是按天来执行啊，按天你说是不是有点太频繁了，没必要吧，一般情况下咱们还是按月来执行。



![](img/49df8df39f3adfa3369ee2dc426a8c16_25.png)

所以说这里在我们这个全局当中啊，咱们得写一下啊，因为我们的定时器，需要写到我们的一个构造函数当中啊。

![](img/49df8df39f3adfa3369ee2dc426a8c16_27.png)

咱写一下，咱们之前是不是说过，有一个模叫什么叫做一个哎。

![](img/49df8df39f3adfa3369ee2dc426a8c16_29.png)

就这个我们这个定时器吧，指定好咱的定时器，定时器当中啊。

![](img/49df8df39f3adfa3369ee2dc426a8c16_31.png)

你可以去指定，你看我这块点run，它是不是出来了，你是按天呢还是按月呢。

![](img/49df8df39f3adfa3369ee2dc426a8c16_33.png)

还是按这个周呢，咱们按月数就行了好了，我们指定一个按月指定按月的时候啊，然后你需要去指定交易日不管了，然后你需要去指定一个值，就是呃按月啊，你在做的过程当中，咱们该怎么样去调吧，好了，那我们写一下吧。

呃咱们写一个REBS。

![](img/49df8df39f3adfa3369ee2dc426a8c16_35.png)

一会儿呢我们要定义这样一个函数啊，相当于在这个函数当中啊，我们就去执行一下。

![](img/49df8df39f3adfa3369ee2dc426a8c16_37.png)

实际咱们的一个哦池子该怎么去选哦，这样一件事好了，然后把这个复制一下，名字稍微改一下就行，在这里名字我复制过来。



![](img/49df8df39f3adfa3369ee2dc426a8c16_39.png)

REBALANCE这里啊，咱们来想一想，我们都需要做什么，是不是说一开始的时候啊。

![](img/49df8df39f3adfa3369ee2dc426a8c16_41.png)

哎呀我得去看一下，而不是一开始的时候我得去先找一批股票出来，然后在这股票当中我去选哪个是我要的，哪个是我不要的吧，我们有这样一件事吧，那这个啊咱们该怎么去做啊，是不是说第一步。

我先得把咱们的所有的股票数据，哎我说都得给它读进来，然后呢。

![](img/49df8df39f3adfa3369ee2dc426a8c16_43.png)

接下来咱们在这池子当中一个去选吧，先把我们的数据给它读进来。

![](img/49df8df39f3adfa3369ee2dc426a8c16_45.png)

数据读啊，其实有很多种方法，这里咱们就暂时啊先选所有的一个股票数据了。

![](img/49df8df39f3adfa3369ee2dc426a8c16_47.png)

你看他这API咱们点进去啊，点进去的时候不用点进去，就是你鼠标放到这的时候。

![](img/49df8df39f3adfa3369ee2dc426a8c16_49.png)

他就会给你解释啊，当前哎你用的函数它是什么意思，他说这样啊，往上一点啊，他说了，现在呢我们要去哦，这个哎这个我再往下点吧。



![](img/49df8df39f3adfa3369ee2dc426a8c16_51.png)

让我看不清好了，他说啊，现在哎你要获得某个国家市场。

![](img/49df8df39f3adfa3369ee2dc426a8c16_53.png)

然后一些所有科学信息了，在这里我们就玩股票就行了，所以说一会儿我们会传建个tab值。

![](img/49df8df39f3adfa3369ee2dc426a8c16_55.png)

等于cs啊，咱们找到这批股票，找到所有的股票。

![](img/49df8df39f3adfa3369ee2dc426a8c16_57.png)

咱们先来写一下，在这里呢咱们该说了，看到有一个参数type叫什么，叫做一个cs吧，好了，我把这个cs传进去，这样他会把我的一个股票啊给拿到手。



![](img/49df8df39f3adfa3369ee2dc426a8c16_59.png)

拿到股票之后啊，然后我们还得对股票构做什么，其实一会儿啊咱还得对股票做一个操。

![](img/49df8df39f3adfa3369ee2dc426a8c16_61.png)

就是做个过滤的事吧，因为这些显示所有的。

![](img/49df8df39f3adfa3369ee2dc426a8c16_63.png)

咱一会儿呢可能不会用到这么多个股票啊，一会儿我们可能只会用其中一部分，所以这里我们把这些股票的id怎么样，把这些股票id啊，我要做一个筛选了，看看有些怎么样，它是不符合的，那我们在前面还得写。



![](img/49df8df39f3adfa3369ee2dc426a8c16_65.png)