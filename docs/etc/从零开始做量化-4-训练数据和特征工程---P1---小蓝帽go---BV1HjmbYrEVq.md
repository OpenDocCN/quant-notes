# 从零开始做量化｜4 训练数据和特征工程 - P1 - 小蓝帽go - BV1HjmbYrEVq

![](img/f408367b3066ce4c316f5c9f33969aab_0.png)

OK我们来到了，把那个基础的准备工作做完了以后呢，我们就来到了一个最重要的一个环节，也就是说准备他的那个训练数据，以及我们要把这个模型给构建和训练起来，我们先来看这个训练数据的一个啊够紧。



![](img/f408367b3066ce4c316f5c9f33969aab_2.png)

![](img/f408367b3066ce4c316f5c9f33969aab_3.png)

可以看到我的主函数里面，从这上面都是一些模型的一个准备工作，我们可以看到这个从这个get alala开始呢，就它的一个呃特征工程了啊。



![](img/f408367b3066ce4c316f5c9f33969aab_5.png)

我们看看一下这个阿尔法这个概念呢，在量化金融里面呢，就是说就是说额指的是投资组合，相对于基准指数的一个超额收益额，在量化的交易的这个模型里面的，阿尔法呢就会不会被指代来。

就说能提供代带来这个超额收益的一个因子，或者一个特征或者模型，呃，其实我们在这里面这个阿尔法的概念呢，就是呃比较重要的一个特征工程，或者说比较重要的特殊工程，筛选下来一个以后一个比较重要的一些特征。

然后我在这边的是，其实我对，因为我对量好交易其实并不是特别的嗯，特别特别懂，那我也是只是根据我的那个机器学习，或者说我之前的一个呃，机器学习的一个一个一个一个背景下的，一个特征工程，并且去结合了一些嗯。

像那个公开公开发表一些配音乐，或者说是像基金基金经理，他们也会发一些那个市场的一个调查，或者说是一个一些呃一些报告吧，他们也会把他们觉得呃，有一些比较觉得就是比较比较可以的，阿尔法因子给公布出来。

或者说开源出来，当然说当然其实开源或者公布出来的阿尔法，可能都已经是过时了，但是我觉得啊，因为我们用的是的一个深度学习的一个呃，神经网络，我觉得可能还是能够代表着，就是说这些阿尔法还是能够代表着一些呃。

一些内在的一个联系，跟那个未来的一个呃，股票的一个涨幅的一个情况，嗯我们来看一下具体的一些那个特征，就ma的话其实我已经在之前讲过了。



![](img/f408367b3066ce4c316f5c9f33969aab_7.png)

ma其实就是它一个滑动平均的概念，那在当前时间窗口的它的ma和moving average呢，其实就是它那个最高价和一个，他的那个最低价的一个平均的一个值啊，然后呃ma change。

它其实就是它的一个呃平均价的平，平均的一个一个变化，一个差分，它的一个different，其实就是一个差分的一个数值，然后嗯像ma15day呀，呃m m m a m day。

fifteen day这种概念，其实就是他过去15天的一个呃滑动的，移动的一个平均价，像包65，对的话，他就是其实就是成交价的一个啊，过去15天的一个变化，就是给他开一个你可以看到啊。

大家可以看到在rolling60，Roll60，其实就是4×15的一个一个意思，就是说过去15天的意思，一个意思，如果你要选择ma30，and就是说那个新浪，新浪的以30分钟为一个我一个时间节点的话。

那你这边可以选择120天，或者说你也可以不动，那60的话，那就是七七天半，那你最好还是去凑个整嗯。

![](img/f408367b3066ce4c316f5c9f33969aab_9.png)

OK然后接下来个ma change rate的话，其实就是嗯，应该也是一些那个比较常用的一个呃，嗯一一些特征吧，它的概念就是呃，以滑动平均价格的一个变化率的一个情况。

然后这里啊有个ts s tm的概念呢。

![](img/f408367b3066ce4c316f5c9f33969aab_11.png)

在这里面是一个rank，就是一个排序哦，我会把他的那个交易的一个情况做一个排序。

![](img/f408367b3066ce4c316f5c9f33969aab_13.png)

然后排序，然后把他那个就把它当前的一个是，把它当前或者说最近的一个交易的一个量，在过去15天他排名第几，这个的话我感觉还是一个比较重要的一个特征，因为你其实用啊深入学习，你很难学习到。

因为这是一个非常怎么说呢，这是一个非常呃，因为他不能从一个嗯加减乘除来得到，它是一个一个排序的一个概念，还是很难被那个深度学习学习到的，因为深度学习都还是嗯不太能够学习到，这种额排序的一个变化。

嗯然后像这个double ma rate，它的一个意思就是呃双移动平均价格，就是说把它一个短期的一个价格，和它一个长期的一个价格哦，进行一个比较，可以看到就是它过去一段时间。

就过去一个一段时间窗口的一个滑动评价，和它一个过去15天的一个，平均价格的一个比较，其实这些都是一个比较常用的一些呃，在股票分析里面一些常用的一个技术指标，然后这个动量，动量。

其实在那个生物学系里面也有一个动量的意思，然后他在他那个量化交易里面的，它的一个意思呢就是代表它那个上跌，或者说是嗯下跌的速度，其实都是差不多一个概念，然后均值回归的一个指标的话。

就是说啊当前价格和过去嗯，时间部的一个平均价格之间的一个偏差，也是在额量化交易里面，可能会被用到的一个呃技术指标。



![](img/f408367b3066ce4c316f5c9f33969aab_15.png)

然后这个volume ratio呢就是一个量比，就是说它哦过去一段时间成交的一个量，和他最近的一个成交量，和过去一段成交量的一个平均价，平均的一个一个比值，因为我们大家都可以听到那个股民和老股民。

或者说是股票专家在分析的时候说，比如说放量放量突破，什么什么什么一个ma的一个一一个一一条线，它其实就是这边就是有有会有放量的，给一个概念换的话，就是说你最近的一个成交价格比过去的一个哦。

最近的一个成交量比过去会多很多，那他的这个volume ratio呢就会就会比较高啊。

![](img/f408367b3066ce4c316f5c9f33969aab_17.png)

这个的话就是一个比较还算是一个比较简单，但是我觉得还是还是一些比较常见的，并且比较重要的一些那个啊技术指标。



![](img/f408367b3066ce4c316f5c9f33969aab_19.png)

那这一步结束了以后呢。

![](img/f408367b3066ce4c316f5c9f33969aab_21.png)

我们就是哦比较重要的就是那个这个get label，其实这个我这个get label是做了很久很久的一个。



![](img/f408367b3066ce4c316f5c9f33969aab_23.png)

一个考虑，因为因为因为说实在没有学过金融的同学，真的很难去，就是你在做一个量化模型的时候，很难把这个标签给设的准一点，就是说或者说是能让那个模型，很好的去学习出来。

我在这边的话是呃做了这么一个是一个比较，那个呃怎么说呢，是一个分，把它作为一个那个分类模型的一个概念去做，并且我这个分类模型，最后会结合我的那个focal loss呃。

去去做那个一个一个一个整体的一个思考，我这个标签在这边可以稍微解释一下，然后到最后这个loss里面，其实也会运用到这个分类标签嗯，这个意思呢就是说你未来的那个上涨，上涨的一个呃比例大于3%。

那这个就是一如果说超过8%，并且他那个feature，low price和feature high price的那个比值是大于，就是这这个比值大于98%的，那就上这个什么概念，这个就是说上涨的比较好。

那就是超过8%，并且上涨的比较稳定，它不是说是他不是这种波动型的一个上涨，它是直接是上涨，假如果波动型上涨，那它未来的这个价格这个low price呢可能要比嗯，可能是少于最高价的98%。

我我的这是我的一个不成熟的想法，因为我想把这个这个，因为我觉得这个还是能代表一个风险的，一个概念，就把这个风险能筛选出来，那这个就更加好的一个一一个股票了，那这个更加好的股票，就是说额上涨了超过14%。

因为我这个其实是嗯，可以看到我这个这个有个future change length，Change change length。



![](img/f408367b3066ce4c316f5c9f33969aab_25.png)

就是说未来机会的一个，就是看待未来机会的一个一个一个周期，我把它设置成了一个八，那你8÷4个时间窗口，就是说四个四个时间窗口的话。



![](img/f408367b3066ce4c316f5c9f33969aab_27.png)

其实就两天咳，未来两天如果能够啊，上涨的比率能够超过14%，并且呢它一直是上涨的，那我就把它会设置一个三，这个就是一个我那其他的这就不上涨不多。



![](img/f408367b3066ce4c316f5c9f33969aab_29.png)

或者说是下降的，那我就都把它设置成零嘛，这个的话其实我是我的那个一个思考的方式。

![](img/f408367b3066ce4c316f5c9f33969aab_31.png)

就是用那个分类的一个一个想法去做，当然这可能不符合实际的一个情况，大家也可以就是也可以也可以，大家一也可以一起交流或者一起讨论，我最后呢可能也会把这个标签会嗯会会会变，会给他改一下。



![](img/f408367b3066ce4c316f5c9f33969aab_33.png)

OK啊，然后接下来这些呢就是一个数据的一个呃，处理的一个情况，其实加这些呢，就是想把他们的维度呢尽可能的哦，凑到同一个额数据的一个范围里面，然后加log的话，其实也是那个金融的量化领域。

一个比较常见的一个一个手段，它呢可以减少那个数据的偏度，因为很多数据其实它是偏态分布，它不是标准的一个哦，有一个类似一个正态分布的一个一个情况啊，把它那个加一个对数呢，也可以把它起到一个压缩。

可以把它比较大的一个情况，或者说把它把它极端的一些数据啊，把它压缩回去，然后也可以把它的稳定，把它那个方差呢呃稳定啊，然后减小它的那个数据数据尺度，然后减少它的是个额数据范围。



![](img/f408367b3066ce4c316f5c9f33969aab_35.png)

然后这一步的话就是这部话，其实就是把他那个一些NOP的一些那个。

![](img/f408367b3066ce4c316f5c9f33969aab_37.png)

文字给它拼接起来，然后这一步的话，其实就是我们还是要把整个的数据回归到。

![](img/f408367b3066ce4c316f5c9f33969aab_39.png)

一个嗯时间序列的一个情况哦。

![](img/f408367b3066ce4c316f5c9f33969aab_41.png)

可以看到sequence length，我给它取了，OK取了32。

![](img/f408367b3066ce4c316f5c9f33969aab_43.png)

它是什么意思呢，它其实就是一条数据，我们预测未来的，因为我们是未来预测未来两天的一个，收收益的情况吧。



![](img/f408367b3066ce4c316f5c9f33969aab_45.png)

然后我们取过去的，再看一下过去八天的一个交易的一个情况。

![](img/f408367b3066ce4c316f5c9f33969aab_47.png)

并且每个八每一个时间窗口呢，都是有这些那个呃阿尔法的一个特征。

![](img/f408367b3066ce4c316f5c9f33969aab_49.png)

那个一一些一些一些数据的，因此然后我们把它一个嗯拼接在一起，比如说这是呃八天，就是最八天以前的一个情况，然后基本上八天七天啊，一直到一直到最近，然后我们把它一整个序列拼接在一起。

那它就是一条我们的一个哦。

![](img/f408367b3066ce4c316f5c9f33969aab_51.png)

训练日训练的一个数据了。

![](img/f408367b3066ce4c316f5c9f33969aab_53.png)

OK那到这里的话，就是整一个的特征工程的这一部分呢。

![](img/f408367b3066ce4c316f5c9f33969aab_55.png)

就结束了嗯。

![](img/f408367b3066ce4c316f5c9f33969aab_57.png)