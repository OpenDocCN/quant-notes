# 带权重的多因子策略框架-backtrader-量化金融与机器学习2024 - P1 - 背包2004 - BV1dz42127VU

![](img/15d89997c5a05fffbf7bae474a735693_0.png)

啊搞完了那个两个银子的话，我们现在把这个事情更拓展一下啊，跟拓展一下，拓展什么什么呢，就是说我们只需要我们可以定义任意因子，而且呢每个音节的取取小值还是取大值，我们可以在这里定义好。

然后呢我们还给每个因子定义一个权重，就是说不再是两个序列等全的相加，而是呃加权的求和加权求和，这样的话就给了我们这个因子策略，有比较好的一个更大的一个参数可调的空间啊，只要我们把这个东西定义好。

然后我们的策策略就能够走下去，我们来完成这个事情，就是能够实现任意数量的因子，并且能够让它加权求和啊，通过加权来进行排序。



![](img/15d89997c5a05fffbf7bae474a735693_2.png)

我们把上面的代码先拷贝过来。

![](img/15d89997c5a05fffbf7bae474a735693_4.png)

啊就刚才的代码。

![](img/15d89997c5a05fffbf7bae474a735693_6.png)

![](img/15d89997c5a05fffbf7bae474a735693_7.png)

![](img/15d89997c5a05fffbf7bae474a735693_8.png)

啊就是刚才老师之前不是老是出警告吗，啊现在老师改用这种方法，我我把那个股票代码的列表和排序列表，用慷慨的方式把它弄到一起啊，把它弄到一起，这样的话就不会有警告了啊，不会有警告了，就换一种。

不像之前那样把它给放到原始的那个啊，这个代码里面去啊。

![](img/15d89997c5a05fffbf7bae474a735693_10.png)

就做了一个改变啊，做了一个改变，那么接下来我们要做这个事情啊。

![](img/15d89997c5a05fffbf7bae474a735693_12.png)

做这个事情有一些东西我们可以用一下。

![](img/15d89997c5a05fffbf7bae474a735693_14.png)

就这个top我们还在这里呃，做这个事情的话，我们需要把这个分开。

![](img/15d89997c5a05fffbf7bae474a735693_16.png)

然后呢。

![](img/15d89997c5a05fffbf7bae474a735693_18.png)

我们把它给。

![](img/15d89997c5a05fffbf7bae474a735693_20.png)

把它给注释一下，我们只做只做一个循环试试看啊，Break，只做一个循环。

![](img/15d89997c5a05fffbf7bae474a735693_22.png)

啊首先呢我们有多个因子，显然我们肯定是要做循环的啊，我们显然肯定是要做循环的，然后呢在循环里面引入这些量啊。



![](img/15d89997c5a05fffbf7bae474a735693_24.png)

引入这些量。

![](img/15d89997c5a05fffbf7bae474a735693_26.png)

那么实际上呢我们在这里。

![](img/15d89997c5a05fffbf7bae474a735693_28.png)

我们还是一样，我们我们先干嘛呢，先，呃其实这个就不需要了哈，这个就不需要了，我直接来直接来弄啊，直接这样就可以啊，这样就可以，不需不需要加这个IDILLOCL，其实hello是为了挣钱的事情。

但是现在其实不需要了。

![](img/15d89997c5a05fffbf7bae474a735693_30.png)

我们先干嘛呢，我们先获取，假设我们已经有了这个东西，假设我们已经有了这个东西。

![](img/15d89997c5a05fffbf7bae474a735693_32.png)

我们获取这个东西的。

![](img/15d89997c5a05fffbf7bae474a735693_34.png)

我们获取这个东西的。

![](img/15d89997c5a05fffbf7bae474a735693_36.png)

![](img/15d89997c5a05fffbf7bae474a735693_37.png)

我们获取它的字典，获取这个东西的。

![](img/15d89997c5a05fffbf7bae474a735693_39.png)

获取它，获取它，然后呢我们先对其中一个，先对其中一个来做，drink rank的话，我们这里干嘛呢，我们的排序的方式也是要用什么呢，也是要用ZG的，他的，排序的方式在哪里呢，在在第一个。

所以说是0号位能理解吗，就这个啊这个是我们排序的方式。

![](img/15d89997c5a05fffbf7bae474a735693_41.png)

是不是，然后这是我们具体的那个啊，第一个啊，第一个，第一个因子有了这个呢，我们接下来就干嘛呢，接下来对其他因子做同样的事情，这个时候第一个我们就不要了，我们已经做过了，做同样的事情，这样的话我们是。

I和什么呢，和I的零，然后呢，然后把这两个纵向的合并起来，这1Z2，把它不能不是吧，不是不能这样啊，不是不是这样子，这个是要加起来啊，是要加起来A1，所以说实际上就这样就行了。

对于A1加上他他们的那个索引是对是对齐的，所以说可以可以可以这样直接加啊，可以这样直接加，这样加到最后的话，我们应该就得到了啊。



![](img/15d89997c5a05fffbf7bae474a735693_43.png)

得到了我们这个总的一个序列好。

![](img/15d89997c5a05fffbf7bae474a735693_45.png)

![](img/15d89997c5a05fffbf7bae474a735693_46.png)

这应该就是我们的总的序列，就是通过这个加了一个循环的方式把它给，啊把他逐个的排序，然后它的序号加起来。



![](img/15d89997c5a05fffbf7bae474a735693_48.png)

但是呢加的时候，因为我们有一个什么呢，我们有一个权重，所以说我们还需要这个权重，权重放哪里了，放这里，权重乘以乘以什么呢，乘以这个，他是一号位，哦这个也是一样，啊这是乘上权重。

也就是对每一个序列加权求和啊，加权求和。

![](img/15d89997c5a05fffbf7bae474a735693_50.png)

![](img/15d89997c5a05fffbf7bae474a735693_51.png)

然后就得到了知道这个东西就这边是权重，这边是排序的方式，然后有了这个东西。

![](img/15d89997c5a05fffbf7bae474a735693_53.png)

那么最后的方式跟之前是一样的。

![](img/15d89997c5a05fffbf7bae474a735693_55.png)

我们把它放上去了。

![](img/15d89997c5a05fffbf7bae474a735693_57.png)

这个就不需要了，因为我们弄过，然后这个是一样的。

![](img/15d89997c5a05fffbf7bae474a735693_59.png)

依然是，把最终的这个结果和之前的股票代码进行慷慨，然后呢再获取他的排序啊，他这么直接加进去，他那个排序就是零啊，对他那一列排序排序呢，拿股票代码，然后获取它的前面五个。



![](img/15d89997c5a05fffbf7bae474a735693_61.png)

前面几个，然后把它转换成列列表。

![](img/15d89997c5a05fffbf7bae474a735693_63.png)

然后给到这个值啊，就可以了。

![](img/15d89997c5a05fffbf7bae474a735693_65.png)

啊为什么有问题呢，因为我这里用了同样的东西啊，不能用同样的东西啊，这应该是J，否则就乱套了，这样应该没问题。



![](img/15d89997c5a05fffbf7bae474a735693_67.png)

![](img/15d89997c5a05fffbf7bae474a735693_68.png)

然后还是把这个代码拿过来调音形象。

![](img/15d89997c5a05fffbf7bae474a735693_70.png)

![](img/15d89997c5a05fffbf7bae474a735693_71.png)

这个应该是老师这门课里面找到的，收益最高的一个策略啊，收益最高的策略。

![](img/15d89997c5a05fffbf7bae474a735693_73.png)

![](img/15d89997c5a05fffbf7bae474a735693_74.png)

那大概是七倍多吧，好气被拖。

![](img/15d89997c5a05fffbf7bae474a735693_76.png)

![](img/15d89997c5a05fffbf7bae474a735693_77.png)

就是加上这三个这三个因子和这样的权重。

![](img/15d89997c5a05fffbf7bae474a735693_79.png)

应该是能够相比之前的三倍多的话。

![](img/15d89997c5a05fffbf7bae474a735693_81.png)

应该是增加了一倍，收益增加了一倍。

![](img/15d89997c5a05fffbf7bae474a735693_83.png)

看起来不错，是不是啊好吧。

![](img/15d89997c5a05fffbf7bae474a735693_85.png)

同学们试一下啊，就是在之前的基础上加了一个这个，那加权求和就就可以了啊。

![](img/15d89997c5a05fffbf7bae474a735693_87.png)