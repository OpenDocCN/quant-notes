# 因子回测与alphalens因子分析比较-量化金融与机器学习2024 - P1 - 背包2004 - BV1xp421Q7FR

![](img/6007a05431cbb156a4955b7b350bd9c4_0.png)

好刚才和同学们一起用这个数值，做了我们的一个单因子的一个策略啊。

![](img/6007a05431cbb156a4955b7b350bd9c4_2.png)

然后5年时间赚了小赚20%啊。

![](img/6007a05431cbb156a4955b7b350bd9c4_4.png)

小赚20%啊。

![](img/6007a05431cbb156a4955b7b350bd9c4_6.png)

费了老劲啊，费了老劲。

![](img/6007a05431cbb156a4955b7b350bd9c4_8.png)

但是赚的不够多啊，呃我们来试一下其他的因子来来啊。

![](img/6007a05431cbb156a4955b7b350bd9c4_10.png)

是这样的啊，呃关于因子的一个测验呢，其实有两种，一种是我们通过回测来看某个因子的一个，有效性啊，通过回撤就是我们刚才这个这种东西啊，我们就要回撤啊，通过假设啊，就通过以这个因子来进行特指导。

我们直到我们买股票来看它的收益，这种是偏实践的。

![](img/6007a05431cbb156a4955b7b350bd9c4_12.png)

还有一种呢就是我们以前搞的，就是通过我们的阿尔法line来来看这个。

![](img/6007a05431cbb156a4955b7b350bd9c4_14.png)

因此对于这个收益的预测的一个有效性啊。

![](img/6007a05431cbb156a4955b7b350bd9c4_16.png)

这应该是两种因子分析的，可以可以说是两种因子分析的方式啊，这两种方式呢啊各有千秋啊，各有千秋啊，这如果是做单纯的做因子分析来说。



![](img/6007a05431cbb156a4955b7b350bd9c4_18.png)

显然是通过阿法论做因子分析。

![](img/6007a05431cbb156a4955b7b350bd9c4_20.png)

显然是能够看得更全面啊，但是从这个赚钱的角度，交易的角度，这个方式呢肯定更更灵活，因为它可以做很多的一些不同的东西啊，我们来看一下别的啊。



![](img/6007a05431cbb156a4955b7b350bd9c4_22.png)

重新看，还是看一下总市值吧，总市值在我们这里5年增长了20%。

![](img/6007a05431cbb156a4955b7b350bd9c4_24.png)

而且我们可以看到他并不是单调的上涨，你看这个金黄色的线啊，他也就是我们最后收尾的时候稍微涨了一点，所以涨了20%，我们看一下我们的因子分析啊。



![](img/6007a05431cbb156a4955b7b350bd9c4_26.png)

我们的因子分析这个因子分析同学们下下来，然后运行一下啊。

![](img/6007a05431cbb156a4955b7b350bd9c4_28.png)

让他占点内存，然后呢这个结果和我们之前结果有点不同，为什么不同呢，是因为，在处理空值的时候啊，我们运行一下吧。



![](img/6007a05431cbb156a4955b7b350bd9c4_30.png)

在处理空值的时候，我们这里和我们的策略那边，用了一样的一个方式来处理我们的空子啊，处理处理空值。

![](img/6007a05431cbb156a4955b7b350bd9c4_32.png)

啊所以得到的结果和我们之前不一样，因为之前我们是直接把有空值的股票，全绿掉了啊，全滤掉了。

![](img/6007a05431cbb156a4955b7b350bd9c4_34.png)

这一次我们是把空子给填补了啊，给填补了啊。

![](img/6007a05431cbb156a4955b7b350bd9c4_36.png)

所以你看下面应该就是这个东西的结果，我们看一下这个图，最关键是这个。

![](img/6007a05431cbb156a4955b7b350bd9c4_38.png)

你可以看到我们之前我们我们运行一下吧。

![](img/6007a05431cbb156a4955b7b350bd9c4_40.png)

还是这是收益率分析吗。

![](img/6007a05431cbb156a4955b7b350bd9c4_42.png)

![](img/6007a05431cbb156a4955b7b350bd9c4_43.png)

你看我们之前记得吗，大市值他也也是一个也也是一个呃正收益，但实际上这里这个能看出来，你看它只有在小的时候是有正收益的啊，在大的时候都没有正收益啊。



![](img/6007a05431cbb156a4955b7b350bd9c4_45.png)

这看起来还正常一点啊，还正常一点。

![](img/6007a05431cbb156a4955b7b350bd9c4_47.png)

嗯而且。

![](img/6007a05431cbb156a4955b7b350bd9c4_49.png)

从这个最高交易的分布的日差异啊。

![](img/6007a05431cbb156a4955b7b350bd9c4_51.png)

![](img/6007a05431cbb156a4955b7b350bd9c4_52.png)

从这个日差一看，其实没不怎么样啊，他的均值呃。

![](img/6007a05431cbb156a4955b7b350bd9c4_54.png)

它都是围绕灵在转在变化的啊。

![](img/6007a05431cbb156a4955b7b350bd9c4_56.png)

围绕林子在变化呃，这是10日的就会变化的。

![](img/6007a05431cbb156a4955b7b350bd9c4_58.png)

波动的剧烈一点，我们是30啊，其实我们是30。

![](img/6007a05431cbb156a4955b7b350bd9c4_60.png)

而且从这个累计收益啊，啊，你看这个累计收益跟我们之前又有些不一样了。

![](img/6007a05431cbb156a4955b7b350bd9c4_62.png)

但是，但是大家看出来没，这个十天，然后是前百分之百分之25。

![](img/6007a05431cbb156a4955b7b350bd9c4_64.png)

还是挺成长的，挺稳定的呀，比我那个好啊，这是不是意味着什么呢，是不是因为我们取的是5%，大家能理解吗，要不我们取的是五只股票，五只股票是非常顶尖的了啊，但是这里是取得全部股票的20%，20%。

但20%还是他的这个成长非常稳定啊，你看它这个它是属于在哪里呢，在是应该是这根线啊，它这根线它它的成长在这里看挺稳定的，比我们的那个收益啊。



![](img/6007a05431cbb156a4955b7b350bd9c4_66.png)

比我们这里的这个收益稳定多了，我们这个车一点都不稳定。

![](img/6007a05431cbb156a4955b7b350bd9c4_68.png)

但是我们不一样的地方，我们取的是啊。

![](img/6007a05431cbb156a4955b7b350bd9c4_70.png)

取的是top5，这里取的是呃。

![](img/6007a05431cbb156a4955b7b350bd9c4_72.png)

前20%就最小的20%，所以说很可能我们把这个这个五改成什么呢。

![](img/6007a05431cbb156a4955b7b350bd9c4_74.png)

改成，改成改成200，为什么改200呢，因为我们这里大概有1000只股票，前20%应该是200，很可能会取得一个稳定的成长，很可能会取得稳定的，但是我们不能改，同学们千万不能改，为啥呢。



![](img/6007a05431cbb156a4955b7b350bd9c4_76.png)

这跟那个black trade这个这个啊。

![](img/6007a05431cbb156a4955b7b350bd9c4_78.png)

这个这个交易程序的这个性能有关，如果我们取的是五的话，这个运行还还还可以接受这个速度，如果取的是100就慢很多了，我们取十看看啊，取十其实就挺慢的。



![](img/6007a05431cbb156a4955b7b350bd9c4_80.png)

这里不慢，关键是这里慢啊，这里慢，取十的话，他的那个list就应该会会加很多了啊，股票一度一旦多起来，black trade的交易性能就很显著的下降了啊，所以这是他的一个很大的问题，其实我觉得啊。

这是他后台优化的不够的一个问题啊。

![](img/6007a05431cbb156a4955b7b350bd9c4_82.png)

取十的话是不是你看我们取了十的话，收益率是增长，看见没有，我们之前是1万120万，现在是变成了176万。



![](img/6007a05431cbb156a4955b7b350bd9c4_84.png)

这说明啊这说明呃如果是取20%，很可能是能够录得这样的一个成长啊，很可能是能够录得这样一个成长，所以这个市值收益还是个很好的，很不错的一个因子嘛，还是很不错的啊，这都多少年了，已经过了那个年代了。

那个年代更更更厉害，但是他还挺不错的啊。

![](img/6007a05431cbb156a4955b7b350bd9c4_86.png)

挺不错的，这5年如果是76%的一个收益的话。

![](img/6007a05431cbb156a4955b7b350bd9c4_88.png)

已经算是可以了啊，已经算是可以了，我看一下它的曲线。

![](img/6007a05431cbb156a4955b7b350bd9c4_90.png)

其实大家可以看到啊，最主要是什么时候开始的呢，最主要还是这里，从大概这里开始看没有，从这里开始的，以前其实都没有啊，以前都没有，就四只因子啊，最主要是猜大家知道是什么时候开始的吗，疫情啊，疫情期间。

中国股市是发生了一个，它的体系发生了一个变化啊，当然我不知道这个趋势到了2024年的今天，是不是还有估计没有了啊，但是从疫情开始，这个趋势其实是很明显的啊，很明显。



![](img/6007a05431cbb156a4955b7b350bd9c4_92.png)

这是市值因子啊，我们可以从这两个方面来来对比来分析啊。

![](img/6007a05431cbb156a4955b7b350bd9c4_94.png)

来对比来分析。

![](img/6007a05431cbb156a4955b7b350bd9c4_96.png)

当然其他的我们也可以看一看啊，其他的我们也可以看一看什么IC分析。

![](img/6007a05431cbb156a4955b7b350bd9c4_98.png)

但是其他的效果并不明显啊。

![](img/6007a05431cbb156a4955b7b350bd9c4_100.png)

你看这是收益的相关性是负相关，负相关是肯定的，因为越小我们的收益越高，所以肯定是负相关，这个没问题啊，而且从这里能看出来看没有，从这一段是不是，大部分时候都处在领取零线的下面，看没大部分存在零线的下面。

所以这里是存在负相关的，负相关就意味着我们买小是能够不买小，是能够获得收益的，懂吗，负相关其实是有用的。



![](img/6007a05431cbb156a4955b7b350bd9c4_102.png)

有用的。

![](img/6007a05431cbb156a4955b7b350bd9c4_104.png)

呃我看看这个这个东西。

![](img/6007a05431cbb156a4955b7b350bd9c4_106.png)

啊其实这个主要看什么呢，看他在的位置啊，这个相关性相关性其实还还行啊，其实还挺还行，这个是一个是一个比较比较比较，看起来比较合理的一个一个一个状态啊。



![](img/6007a05431cbb156a4955b7b350bd9c4_108.png)

一个状态好吧，这是用我们的那个好用。

![](img/6007a05431cbb156a4955b7b350bd9c4_110.png)

我们的周期性应该是没有的，我们我们看一下它的周期性啊。

![](img/6007a05431cbb156a4955b7b350bd9c4_112.png)

就是季节性，季节性季节性没有。

![](img/6007a05431cbb156a4955b7b350bd9c4_114.png)

另外如果季节性有的话，它的竖条竖条会比较相似颜色，他这里好像没有比较相似的颜色吧。

![](img/6007a05431cbb156a4955b7b350bd9c4_116.png)

没有不不明显啊，不明显。

![](img/6007a05431cbb156a4955b7b350bd9c4_118.png)

好吧，这是我们的，啊是是值这个因子。

![](img/6007a05431cbb156a4955b7b350bd9c4_120.png)

然后我们看一下吧，我们看一下另外的因子还有个什么名字呢。

![](img/6007a05431cbb156a4955b7b350bd9c4_122.png)

市盈率。

![](img/6007a05431cbb156a4955b7b350bd9c4_124.png)

我们用市盈率吧，我们来看看市盈率的音质怎么样。

![](img/6007a05431cbb156a4955b7b350bd9c4_126.png)

先用适应力这个因子做回测，我们还是用五吧，还是用用十也行哈，实际上会看起来稳定一点。

![](img/6007a05431cbb156a4955b7b350bd9c4_128.png)

然后。

![](img/6007a05431cbb156a4955b7b350bd9c4_130.png)

是盈利取取小的还是取大的呢，市盈率其实应该市盈率应该是取小的，就取大的越大市盈率。

![](img/6007a05431cbb156a4955b7b350bd9c4_132.png)

但是我们这里取了小，我们先看一下，小小的应该是不会赚钱的啊。

![](img/6007a05431cbb156a4955b7b350bd9c4_134.png)

不要这么小的，就就那个，小的并不好啊。

![](img/6007a05431cbb156a4955b7b350bd9c4_136.png)

不要看那个那个什么它的它本身的意义啊，诶那你看亏了一半，我们是100万，同学们。

![](img/6007a05431cbb156a4955b7b350bd9c4_138.png)

所以中国市场不要去去买那种吸引力比较小的。

![](img/6007a05431cbb156a4955b7b350bd9c4_140.png)

就是虽然说从那个那个投资学的理论来说，市盈率小说明什么，说明你的回报很回报期比较短，就很容易能够把你的收收回来，是好的事情，但是投资上来说不是买股票，这不能这么干，我们可以看一下市盈率的那个呃因子分析。



![](img/6007a05431cbb156a4955b7b350bd9c4_142.png)

看一下数据的因子分析，我们换一下啊，换一下。

![](img/6007a05431cbb156a4955b7b350bd9c4_144.png)

只需要在这里啊把他的那个换掉换掉。

![](img/6007a05431cbb156a4955b7b350bd9c4_146.png)

![](img/6007a05431cbb156a4955b7b350bd9c4_147.png)

在哪里呢，在这里哈，换市盈率吧。

![](img/6007a05431cbb156a4955b7b350bd9c4_149.png)

好看一下其他的。

![](img/6007a05431cbb156a4955b7b350bd9c4_151.png)

好看一下其他的。

![](img/6007a05431cbb156a4955b7b350bd9c4_153.png)

想看这个哎他怎么那么奇怪呀。

![](img/6007a05431cbb156a4955b7b350bd9c4_155.png)

这，么奇怪啊，大的反而还亏了，小的还能赚，但是我们这里体现不出来呀，我们买小亏亏亏亏了一半啊。

![](img/6007a05431cbb156a4955b7b350bd9c4_157.png)

但他这个市盈率怎么，越小还能还能好，好像还能赚点，他最高的这个位置，最高的这个位置，这是百分之多少，这是20%到40%的，这个区间里面的股票，这个地方的股票最赚吗，我不是不清楚啊。



![](img/6007a05431cbb156a4955b7b350bd9c4_159.png)

不清楚哈。

![](img/6007a05431cbb156a4955b7b350bd9c4_161.png)

要不我们改一改真的会这样吗，我们试一下。

![](img/6007a05431cbb156a4955b7b350bd9c4_163.png)

我们改怎么把它改成这个要改这个东西啊，算了吧，我们其实也可以改啊，就用那个顺序顺序，我们要不要试一下，把它去掉，改什么呢，点点ILLC，然后呢他是要取什么呢，取排名多少是20%到40之间。

因为大概大概是1000只股票吗，也就是说200多，300~400，我们就300~310，我们就搞十个，不能搞多了，搞多了就慢了哈，搞多了就慢了，我们试一下是不是能赚钱啊，试一下能不能赚钱。



![](img/6007a05431cbb156a4955b7b350bd9c4_165.png)

但他那个是10日啊。

![](img/6007a05431cbb156a4955b7b350bd9c4_167.png)

我们这里是30日。

![](img/6007a05431cbb156a4955b7b350bd9c4_169.png)

![](img/6007a05431cbb156a4955b7b350bd9c4_170.png)

咋这么慢呢。

![](img/6007a05431cbb156a4955b7b350bd9c4_172.png)

他不去，他这个就是这样啊，就是股票一多，它就慢起来了啊，他就慢起来了，他为什么会慢呢，因为他可能在那个区间换手率特别高，所以说呢他很可能在这段时间，它覆盖了很多股票，股票一多不去，他就卖，股票是一大。

他就卖，这没办法，他不会出不来结果吧，不会出不来结果吧。

![](img/6007a05431cbb156a4955b7b350bd9c4_174.png)

我们要不要等一下，我们看看那个呃。

![](img/6007a05431cbb156a4955b7b350bd9c4_176.png)

这是市盈率啊，我们看看它还有有了。

![](img/6007a05431cbb156a4955b7b350bd9c4_178.png)

那应该应该快出来了。

![](img/6007a05431cbb156a4955b7b350bd9c4_180.png)

![](img/6007a05431cbb156a4955b7b350bd9c4_181.png)

![](img/6007a05431cbb156a4955b7b350bd9c4_182.png)

没多少，只是没亏而已。

![](img/6007a05431cbb156a4955b7b350bd9c4_184.png)

只是没亏而已，100万变成99万，这没啥意思啊，这啊这这这这没用啊，没用还不如，啊这没啥用啊，没啥用好吧。



![](img/6007a05431cbb156a4955b7b350bd9c4_186.png)

至少证明这个好像不是很起作用啊，按照这个来买。

![](img/6007a05431cbb156a4955b7b350bd9c4_188.png)

但是我们可以看一看嘛，可以看看它。

![](img/6007a05431cbb156a4955b7b350bd9c4_190.png)

主要它不是单调的啊，不单调就非常不好啊。

![](img/6007a05431cbb156a4955b7b350bd9c4_192.png)

就非常不好非常不好。

![](img/6007a05431cbb156a4955b7b350bd9c4_194.png)

看下累计收益，累计收益情况，它就是这条线，你看这条线怎么看起来这么好呢，是不是我们要把这里改成10日才行啊，我懒得改了，因为改了之后他运行速度很慢。



![](img/6007a05431cbb156a4955b7b350bd9c4_196.png)

影响我们上课节奏啊，至少从这里来看，是不是因为时间的问题啊，这是一天，是不是改成一天，十天改成十天会更好一点。



![](img/6007a05431cbb156a4955b7b350bd9c4_198.png)

![](img/6007a05431cbb156a4955b7b350bd9c4_199.png)

好我们换另外一个，另外一个看起来特别牛逼的一个因子啊。

![](img/6007a05431cbb156a4955b7b350bd9c4_201.png)

看什么呢，换手率同学们换手率的那个收益。

![](img/6007a05431cbb156a4955b7b350bd9c4_203.png)

同学们会吓一跳。

![](img/6007a05431cbb156a4955b7b350bd9c4_205.png)

好首先我们看一下换手率的这个因子分析啊，换手率的因子分析。

![](img/6007a05431cbb156a4955b7b350bd9c4_207.png)

这个换手率的因子分析绝对是绝对是没谁了。

![](img/6007a05431cbb156a4955b7b350bd9c4_209.png)

![](img/6007a05431cbb156a4955b7b350bd9c4_210.png)

但是他他他他他会给我讲一下，我讲一下换手率这个因子。

![](img/6007a05431cbb156a4955b7b350bd9c4_212.png)

![](img/6007a05431cbb156a4955b7b350bd9c4_213.png)

在看到没是这么个情况。

![](img/6007a05431cbb156a4955b7b350bd9c4_215.png)

换手率，他是很单调的，看见没有，非常单调的啊，非常单调的一个因子，而且呢越小越挣钱，看见没，这是一个就是如果他真有用的话，这是一个非常看起来非常有效的一个因子，它是单调的啊，我们之前都是乱七八糟。



![](img/6007a05431cbb156a4955b7b350bd9c4_217.png)

但是这个单调的哈，证明这个这个因子看起来很有效啊。

![](img/6007a05431cbb156a4955b7b350bd9c4_219.png)

然后我们看一下什么呢，看一下它的收益率差异啊。

![](img/6007a05431cbb156a4955b7b350bd9c4_221.png)

你看他一直在零线以下啊。

![](img/6007a05431cbb156a4955b7b350bd9c4_223.png)

这个很稳定啊，这个因子你看一直在这个地方，这个音质非常稳定好。

![](img/6007a05431cbb156a4955b7b350bd9c4_225.png)

然后看他累计收益，看到没，这个音质是不是很牛很牛很牛叉，看到没有。

![](img/6007a05431cbb156a4955b7b350bd9c4_227.png)

所有的线都是一直向上的啊。

![](img/6007a05431cbb156a4955b7b350bd9c4_229.png)

哈要上了，换一首绿色音符，我们来我们来去回测给大家给大家看看。

![](img/6007a05431cbb156a4955b7b350bd9c4_231.png)

就知道他多多牛了啊，这个音质。

![](img/6007a05431cbb156a4955b7b350bd9c4_233.png)

在这里啊，我们换换手率，我们不要十个吧，五个得了，快一点，十个五个吧。

![](img/6007a05431cbb156a4955b7b350bd9c4_235.png)

省得我上课等等半天，同学们，你猜猜他收益会多少，收益收益是多少多少多少，啊等一下啊等一下。

![](img/6007a05431cbb156a4955b7b350bd9c4_237.png)

![](img/6007a05431cbb156a4955b7b350bd9c4_238.png)

你看没有，100万，我赚了5000多万，5000万，同学们是不是大家觉得会发财啊，但是但是但是同学们这里面有问题啊，啊有问题这个因子其实还可以，首先啊，但是这种财简直就是这是一夜暴富的节奏啊。

啊它会它会让这个沪深300的指数五一要。

![](img/6007a05431cbb156a4955b7b350bd9c4_240.png)

他就这是属于遥遥领先，看没有，你看换手率的，因此他，5年涨了50倍50倍，而且是从应该就是从疫情开始启动的，疫情开始启动是特别变态的啊，从这里开始启动，大概就是疫情开始的时候啊。

但是这个是这是不真实的不真实的啊。

![](img/6007a05431cbb156a4955b7b350bd9c4_242.png)

为什么不真实呢。

![](img/6007a05431cbb156a4955b7b350bd9c4_244.png)

![](img/6007a05431cbb156a4955b7b350bd9c4_245.png)

是这样的，因为换手率啊，如果但但这里指标都看起来可以啊，啊就看起来很好，但是它它不真实的地方在于什么呢。



![](img/6007a05431cbb156a4955b7b350bd9c4_247.png)

在于我们本身的一个处理啊，本身的处理和我们的买卖的方式。

![](img/6007a05431cbb156a4955b7b350bd9c4_249.png)

首先一点啊。

![](img/6007a05431cbb156a4955b7b350bd9c4_251.png)

呃这个我们在下下下面一个下面一个小节呃，再讲吧，好不好，同学们先复习一下这几个东西好不好，就是拿进去运行一下，然后待会儿老师再把这个事情讲清楚。



![](img/6007a05431cbb156a4955b7b350bd9c4_253.png)