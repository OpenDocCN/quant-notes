# kaggle收益率预测金牌选手代码解读 - P1 - 高频交易dragon - BV1t6421Z77R

好，那么现在来看看这个其中一个，拿到金牌的一个方案啊，我看两个方案吧，这个就是它的整个的coding，那么它的是用rider gbm加上这个呃，WEETY的皮尔森系数，加上一个lag target啊。

还有一个就是这个引巴go CV，就是做了这种这种这种交叉验证啊，这种bug这个这个单词的话，我看了他就是bog in bug，就是禁止死路的意思，也就是说，这个因为它这个里面有个3700多个天数。

是分钟数啊，不能那个那个是他做了一个指数的移动均平滑，所以说很多时候，那个时候他是有很多的这种空值对吧，因为他做了loading，所以说很多时候你做交叉验证的时候，这个进行五折呀。

那么时候就是要把这个很多的地方。

![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_1.png)

是是要截掉的，那么OK那么我们来看看它首先的几个模块，第一个模块是import and load data frames，那么就是把这个DF有data frame的话。



![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_3.png)

全部给载入进来，那么首先的老套路，把mp np，那么整个的整个的这种这种包括这种激励，Stage critter，那么这个应该来讲是他的一个API，KAPI的一个应用，那么这个GC的话是这个收集垃圾。

就是清理垃圾的这个东西啊，那么这个里面呢。

![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_5.png)

还包括一些迭代器的一些工具啊，那么后面就是把这几个文件啊。

![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_7.png)

训练和测试拿进来啦，还有权重啊，类似的这个东西，那么还有一个问题是什么呢，他就是B啊，做了一个文件。

![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_9.png)

就是进行呃，就是read csv呃，Strict，它一定是6月10号之前的一个文件啊，那么首先就把他的这个文件给load进来了啊，那么ra cs v df chan。

那么在骑士把他的这个SS的detail的拿进来了。

![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_11.png)

拿进来之后呢，呃进行圈定了，那么然后DFS这个做了一个什么，就是刚才还原的就是处理这种丢失的数据，对不对，那么他在这个里面呢一样的啊。

set index的time stamp group by按到SSD啊，进行这个重新的话，进行的这个啊v index的就是6060啊，怎么样去填充。



![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_13.png)

那么再把这个重新把它contact一下，然后把很多的这个呃东西该该整理的整理。

![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_15.png)

该排序的排序啊，该重新立index的，那么就把中间的过程的文件给杀掉，就是DELDFS以及TS等等，就是包括GC点collector，使用内存等等。



![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_17.png)

Ok，那么下面呢就是start lag target的这样的calculations here，那么这个里面呢也就是说啊，目标的这种函数的值得计算，那么我们都知道他有个16天呃，也就16分钟啊。

然后他就是你看见没有，他locate ten呐，他就做了一个15，做了一个这样的16啊，那么跌f chain，他要把两个的这个作为特征值一样的东西，把它给merge，就是把它合成在一起，重塑啊。

把数据合成在一起了，那d f chain的M等于什么。

![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_19.png)

等于这LR15乘以这个df chain wait，然后这个里面的就是，然后呢又去做了这个sum除以sum，其实有时候就没了，去做什么，去拿到他的TT点的值对吧，再加df train，拿着job点VIT。



![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_21.png)

可能就是用过了就拿掉了啊，那么我们来看看他做的，这里做了一个大堆的注释，这个其实呢这个里面呢其实就是为了什么，就就是生成更多的future，就是along legs。



![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_23.png)

这个里面呢它把这个这个这个L15L16，IASID找了一个copy之后，这个里面呢其实很重要的一个点呢，就是说这个要判定这个数据啊，是否会小于3750，如果小于的话，它贝塔number就是也是空的啊。

那么m two也是空的，如果大意的话才会有这个值的啊，就loading这个3750这个值去做一个mean，对吧，你可以看到他的这样的这样的一个处理的方法，如果这这1no NO。

就是这个这个这个我们说的这一行有值的话。

![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_25.png)

那么就会去做了这个这个去对它的起，最后的一个值去去做了一个什么样的处理呢，它好像就是说又又把那些就是关于上影线，下影线的一些东西的特征值给录进来了，录进来了之后又是这样的做了一个job的工作。



![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_27.png)

然后呢又把贝塔的值给拿到了啊，因为它有值的话。

![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_29.png)

那么把target的leg，就是15分钟的TK的leg拿到，其实也是为了算这个最后的target，然后呢还添加了这种open to clothes。

high to close这样的一些比例的这样的一些特征，那么这个里面的还有warning to count以及close to v up。



![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_31.png)

这样的话做了一些比值叫return，它的整个的这样的特征值给撸出来，撸出来之后呢，后面的这个函数就呃，是机器学习里面比较重要的，他做了一个呃交叉验证是等于五个，也就是说把整个的数据先切成五块了，然后呢。

这个里面呢就设定了它的这个chain跟spit，以及预留了一些这个这个这个叫什么，我们说的CV的这个值，那么我们来看看它整个的话啊，首先把这个汤姆斯店铺就是驱虫了一下，驱虫了之后呢。

我们来看看它把all劝times斯店铺去呃，做了除以除以，就是取模，就是被五整除吧，这样取模了之后呃，然后呢text split，然后呢它是怎么样去做的呢。

那么就是等于所有的这个所有的这个这个chance，对不是II，你看见没有，I的CV就是0~4对吧，可以取到0~5，这就其实是0~4啊，那么I乘以这个这个lion split。

到这个这个这个什么I加一到length spirit，那其实其实其实就是什么呢，就是对它进行的切割，而且分成了这个这个五个的列表啊，其实呢就是其实呢就是进行了这样的一个，切割的一个工作啊。

那么这个这个这样的里面呢，你可以看到它会有会有什么，其实呢分成好五段吧，这个五段呢比如说这个I是等于零的，那么其实就是对它的一个这样的数据来讲，其实的话就是零乘以什么什么，什么0+1乘以什么什么。

其实呢就是其实呢就是说的再直白一点，那么其实就是比如说这一段数据对吧，然后呢把这个这个剩余的除不尽的拿掉，其实就是分了五块一二，比如说一零他是零开始，01234，其实就是这这几段数据而已啊。

就是他把这个这个叫做什么叫啪啪嗒的，Ham stamp，也就是把他的这个索引给拿出来之后，以后方便进行这个取数据啊。



![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_33.png)

用索引去取数据嘛对吧，其实就是这样的，分了几个这样的list去拿出来而已。

![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_35.png)

那么这个里面的REM对吧，就是剩下的是什么呢。

![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_37.png)

就是所有的这个东西减掉的这个l split，乘以这个CVO，那么就是剩下的这个这个这个这个东西，那么如果剩下的大一点，它把它就更加test spirit是最后一个一个东西，等于什么样的一个一个数据，好。

我们来看看这个整个的这个这个这个这个，来看看它后面就是如何去划分训练集的啊。

![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_39.png)

那训练集也就是说呃一样的，就是其他的这种他有界限的啊，就是有有有这个这个叫什么，就是从哪里到哪里对吧，其实就是这样的MP这个MMAX，什么在MP点M啊，那么去取他的这样的东西。

那么还有一个not in bugage，那么这个里面呢还要什么什么，还要考虑到3750这样的一个数据。



![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_41.png)

其实呢这个里面呢搞来搞去写这么多啊。

![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_43.png)

其实就是一句话，怎么样去把它画成五份，然后呢还把这个in bug，还有这样的这个train呃，还有这个text这样的东西也给分出来而已，其实他讲了这么多，他其实就是做了这样的一个函数而已。



![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_45.png)

所以说你既可以看看这个东西，然后呢，后面呢就进行了这个这个呃训练的这样的东西，然后呢这里是一个专门存模型的层层picker，那么当然你也可以成成其他的这样的格式啊。



![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_47.png)

然后后来就low的这样的模型对吧。

![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_49.png)

后面呢就进行了真正的这个把数据传进来，get mode and valid这样的进行的每个资产呃，每一个资产进行训练啊，那么你可以看看当时我们说的这个rig b m。

进行单独的每个资产进行清理也是一样的，怎么样去把它东西先拿到，对每个资产先拿到他的copy copy之后呢，把他这个这个这个这个里面的Y拿到，然后呢把他的这个这个future重新拿到之后。



![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_51.png)

那么这个这个里面呢，这是给了这个model的一些参数啊。

![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_53.png)

那个这个还有包括的学习力啊，深度啊等等，拿完了这个之后，那么进行调用了，你看这个调用它，它首先要拿到这个这个chain text，就是把chain和text都放在一个zip文件里面啊。

就这放在一个zip，zip的话，大家都知道它可以对两边这样的一个一个什么，有两个两个两个这个这个历史的进行缝合对吧，它们就是个拉链一样，两个数据两两配对起来或者干嘛的。



![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_55.png)

可以进行一个这样的一个操作，那么这个里面呢就进行了这样的训练。

![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_57.png)

训练之后呢，而且的话还要进行的这个这个这个跟你讲的。

![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_59.png)

进行的模型的一些这种这种存储啊，包括什么啊，你看有没有这个模型就是跟你讲的在在训练啊，开始在训练。

![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_61.png)

拿到模型进行fit fit之后进行模型的存储对吧，然后呢还可以进行这个重要的模型，去进行他的future importance进行啊，你愿意画图的话就可以画图对吧，或者是给它打印什样的一个一个东西出来。

看看哪些特征是呃比较有用的啊，那么最后的话他取了这样的一些值，可能要去进进行这种呃预测呃，包括这个这个里面的这个这个，包括它的相关系数的这样的一些东西啊。



![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_63.png)

OK那么这个这个里面呢，大概大概其实就是这么多DESPIRIT。

![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_65.png)

可以看到后面的话一样的拿好了几把model，好像是这样的，model是不是重新这个这个看到看见没有。

![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_67.png)

他首先是不是有这个model的名字或者干嘛，其实呢我是觉得他现在呢在做一个什么。

![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_69.png)

就是重新的对这种呃。

![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_71.png)

他有一个很重要的一个一个工作，好像就是说对于这几种的这个呃模型的，这个这个这个就是呃就是就是这个块的话。



![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_73.png)

就是模型的权重啊，就是这一块它的进行的一个组合的东西啊。

![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_75.png)

你可以看到他是怎么样去做组合的。

![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_77.png)

就是是否就会更加的去减少，这个这种就是误差的这一块的东西，那么他可能有零有了0。80。9，0。80。9这样的进进行的模型的融合。



![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_79.png)

其实就是这样的意思啊，就是用了他的这个这个预测出来的。

![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_81.png)

这种这个predict means，加上这种对吧。

![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_83.png)

这样的一个一个一个一个这样的一个东西，看看哪一个东西会更好嗯。

![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_85.png)

最后的话把它DISPLIT1T下来。

![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_87.png)

拿了这类进行呢非常多的这种尝试。

![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_89.png)

进行了分拆之后对吧，每个品种会训练一下。

![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_91.png)

最后的话会得到的，最后的话他就是做了一个什么。

![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_93.png)

可以看到这个里面呢，就是其实是做了递交的这样的一个动作啊。

![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_95.png)

就是predict and submit，大概这个东西就是这样的。

![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_97.png)

其实这个感觉嗯怎么讲呢。

![](img/cc2cb0937b98321ec5bdcb04f1ffbee0_99.png)