# 第34节课 策略模板的编写 - P1 - 古辰诗提 - BV1LF4m1F72w

欢迎大家来到从零开始量化系列课程，Python基础课的第34课，这节课呢咱们讲策略模板的编写，为什么讲这个，因为策略模板，基本上咱们现在通过学过的内容呃，已经能够写了，可能一开始写不出来。

你可以看维纳那个平台它的策略模板，策略模板它的作用是什么呢，它会被就说你写成就说各种各样的策略，然后这些策略都是继承这个策略模板的，另外呢你写成的这个策略也会被多个实例化。



![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_1.png)

因为你这个策略不单单是被一个，就是合约去实例化，你可能会被多个合约给实例化，所以这个模板呢它就有这么三个，就是说咱们需要理解的这个内容，第一个就是这个模板本身，它是一个肯定是一个测，就是类嘛。

然后你在这个模板继承他之后又写了一个策略，这个就就是模板就是父类，然后你写的这个策略它也是一个类，它就是子类，然后你在实例化之后，这个是实例化之后的，你就是会有很多嘛。

这个就是实例化的它的这么一个呃实例是吧，它有很多这样的实例，所以说这个里边的变量也好，参数也好，当然就是你肯定是有参数和变量的，参数是什么，就是你30日均线，那个30就是参数均线值，它会根据行情的发展。

那个就是变量就是它会有很多不一，就是各种各样的。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_3.png)

当然每一个实例的时候参数也不一样对吧，所以说这个它就会有一部分公用功能，公用的功能，比如说委托的发送，比如说日志的输出，比如说参数的设定，等等是吧，你得把这些功能给实现了，这是就是一部分公用的功能。

另外还有一部分是一部分是实例化，或者说你这个被继承的策略需要单独实现的，因为你的逻辑不一样，所以说你必须得单独实现一个就是他的，就是说策略，根据你策略的需求去单独实现一些东西，比如说tick。

当有tick过来的时候，你在tick里面做的事，就需要根据你的这个具体的策略去实现，比如说B就是当即可合成了这个一分钟的K线，你再把这个一分钟的K线去合成，30分钟还是15分钟。

也需要根据你的策略去完善它对吧，还有个trade啊，就是这个你如果有成交了，你这个止盈止损怎么设，也需要根据你的策略等等等等啊，去这个是一部分是需要你单独去实现的，所以说你像这一部分单独实现的。



![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_5.png)

你是不是需要用咱们之前的这个ABC，就是那个abstract s t r AC t obstruct method。



![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_7.png)

去装饰它，然后你不用在里边去实现它，但是一部分的公用功能，你是不是得需要去在这个咱们的策略模板里面。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_9.png)

去把它给实现了，对吧好，那咱们就开始写class ccta template。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_11.png)

他继承的，既然里边有一部分功能，是需要继承它的这个子类去实现的话，它必须得显示的继承咱们的那个B呃，那个AABC就是abstract method，里边的这个大写的ABC是吧。

所以说我们需要导入一下from a b c，Import a b c，然后呃abstract method是吧，显示的去继承它，ABC一定要显示的去继承它，不然的话你这个装饰器是不起作用的。

这个装饰器就是如果说继承它的子类没有实现，用这个装饰器装饰的那些方法的话。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_13.png)

在运行的时候会报错的，会报错的，首先。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_15.png)

in it这个里面需要写传入哪些参数，你这个模板类你必须要可以进行实盘对吧，也可以进行回测，也可以进行模拟，所以说你这个里边当然你不解决这些问题，但是你需要让他们不管是实盘也好啊，回撤也好，模拟也好。

让他们就有一些接口得共同去实现的是吧，你得让公用啊，你不能就是说我这个模板，我既要写一个实盘的模板，我还要写一个回测的模板，我还要写一个模拟的模板，那样就很麻烦了对吧。

所以说你这边引擎ccta engine我先传入一个any，是传入的，可以是实盘的引擎，也可以是回测的引擎，也可以是这个模拟的引擎。



![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_17.png)

所以说咱们在这再新建一个。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_19.png)

engine点PY，然后咱们从这个里边去去把这个引擎。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_21.png)

它的基础的需要实现那些功能，或者说是必须实现的一个功能，把它放在这里边，然后你其他的实盘引擎也好，回测引擎也好，还是模拟引擎也好，都继承这个，我这个就是引擎的这个鸡肋，这样的话它有一些统一的接口。

它必须得去实现出来，是不是这样，就其实也是Python的多态嘛，咱们之前讲过就是不一样的呃，类就是同一个接口，然后实现不同的功能，同样的咱们从这也from a b c。



![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_23.png)

Import abc a b s t ject method。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_25.png)

咱们先定义一个e s base engine，集成ABC好。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_27.png)

DF杠杠INIT。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_29.png)

好咱们先把它就是说写着，如果说有一些功能需要，就是说通过别的地方来实现的，咱们就先把它写到这个里边，然后等你模板写完了，你如果说想尝试再写别的，比如说它的引擎，你可以直接去继承它。

他就会告诉你哪些东西是必须得实现的，这样的话才会被你的这个模板能够使用对吧，这个里边你必须得写两大块，第一个就是必须得有的参数，P等于我给它定义一下啊，list参数咱们放到一个list里边。

然后变量我也把它放到一个list里面去，你继承你的这个就是说city template的这个类，这个子类它肯定里边得写上参数和变量的，而且这个参数和变量会有很多的用处。

比如说你想用这个GUI界面给显示出来，或者或者用一个web页面，把你的现在的这个参数和变量都给显示出来，你必须你像这样的功能就是公用功能，你必须在里边儿去实现的对吧，然后你这个参数会根据不一样的实例。

或者会根据不一样的策略，里面定义的内容不一样，然后又会根据不一样的实力，给他付的这个实力值它也不一样对吧，如果说你是螺纹焦炭嗯，你这两个不可能是一样的，当然他们都是黑色，如果说你是橡胶的话，橡胶挺腰的。

你可能参数就得设大一些啊，好那咱们先在里边设定。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_31.png)

就是说几个呃。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_33.png)

我先把它变量给传过来啊，sity engine等于city engine，好，你后边还需要穿什么东西，你名字是得肯定有的吧，因为这个它会唯一标识，你的这个实例化的策略是吧。

T r a t g y string name。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_35.png)

STR这个你是必须得有的吧。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_37.png)

然后另外你名字有了你的这个which it simple，你用的这个合约你得有吧，还有一个就是说你的这个参数的设定。



![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_39.png)

你你也得有吧。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_41.png)

咱们就默认用个DICTOR啊，就是说让他传进来是吧。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_43.png)

这样的话咱们好设置好cf点卷。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_45.png)

GTRATEATEGY转几年cf关于。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_47.png)

等于v t simple。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_49.png)

四点setting s e t t i n g等于city s e t t好，都给它附上这个值，那在这个构造函数里边，你还要去做什么呢，首先咱们先定义几个变量小点pose等于零，它是INIT是吧。

等于零，然后cf点in it。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_51.png)

期待布尔等于四点trading。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_53.png)

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_54.png)

这三个是做什么用的，pose就不用说了，是记录咱们这个实例化策略，因为它是实例化的这个属性吗，是记录你的策略，它的仓位是多少的，因为你可能是多个策略一起挂的，所以说你的仓位和你的实际仓位。

不一定能对得上，第二个是因为你这个策略是需要初始化的。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_56.png)

就比如说你这个参考吧。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_58.png)

你得去把参考霸调回来，调回来，你猜就是然后把你的这个变量都附上，这个时候你就属于初始化成功了，或者说你还前面还有一些工作需要做，比如说把前一日的这个变量，比如说呃有没有就是它的止盈，止损价格呀什么的。

读取出来，这样的话你才能就是说初始化干的内容，然后初始化完成之后。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_60.png)

把这个self training变成这个true啊，这个我们先把它看成false啊。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_62.png)

写错了，把这个self training改成true，就true就意味着他可以去接受实时行情了，或者去接受回测的数据了，然后他也可以去发送委托了，对吧啊，就是这样的一个逻辑，那他们既然进来了。

我是不是得把它放到咱们的这个变量里边去去，放到咱们变量里面去，因为如果说你给GUI界面去看的话，你也得告诉他，我这个我这个策略他是不是准备好了，是不是可以进行交易了，它的状态是个什么情况。

所以说你需要把它放到变量里面去，这个变量怎么去放呢。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_64.png)

cf点啊，where are点insert。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_66.png)

就是这个是咱们之前学过的嘛，就是插入是吧，先插入咱们插入这个圈顶吧，零就是用insert插插到最前面的那个位置去啊，零一边插入这个cf点training，然后SP点VA2点insert。

这个一放到第一个位置，索引为一的这个地方好，Self init。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_68.png)

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_69.png)

然后放到第二个位置，就是C点pose。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_71.png)

你最终因为实际这个实盘过程中，你到时候你的这个pose是需要保存在本地的，下一次再开启的时候，因为柜台是有中断的嘛，下一次再开启的时候，你需要读取这个pose对吧，你得告诉我现在这个策略他实盘中。



![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_73.png)

他现在持仓情况，然后前面这两个是需要你不需要记录它，因为每次的开启和关闭，就是你开启的时候肯定是要让他先初始化，然后再把这个self training变成child，所以说你在就是它就是记录完之后。

关闭之前，你需要就是记录啊，不是需你在他需要记录的时候，你需要把这个两个变量给删掉，因为它没啥用，在这有一点需要咱们去注意一下。



![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_75.png)

这边你必须把cf点VA2S等于copy复制一份啊。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_77.png)

它会自己导入啊，之前也讲过这个复制一份cf点VA2S。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_79.png)

这个是什么意思啊，因为我vars它是一个类变量是吧，你从这如果说没有这行代码的话，你从下面插入都是往我的类变量里面去插入的，当它被继承了，然后又被多个实例化了，它会反复的被插入，从这个它的子类里边。

也是可以去修改它父类的里边的变量的，这个时候你多次的插入的话，它里边就是会反复的出现这个self training，self self dipose会出现很多个，所以说你一定要copy1份这个copy。

当它没有赋值的时候，你先不看这个前面当他copy的时候。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_81.png)

他copy的是这个，因为CVS还没有定义呢，它是在父类里边去找的。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_83.png)

所以说它就是类的这个变量，它找到了这个copy赋值给我这个cf点vs这个CVS，它其实是实例变量，能理解这个意思吧，这个是类的基础知识是吧，你没有定义的时候，你单独一个copy VR就是CVS。

它在实例变量里边找不着，他就会去呃这个它的这个类里边那个变量里边。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_85.png)

去找那里的变量里边去找A1找，找着了，找着了之后，我copy了一份给了我这个self vs就是实例变量，其实这俩是不一样的，SAVAS和SAVAS这俩完全是不一样的啊，你一定要知道这个是类变量。

这个是实例变量好吧。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_87.png)

一定要复要复制一份啊，复制完了之后，咱们做的第一件事，咱们是不是应该叫update这个sitting。



![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_89.png)

把他的这个设置参数给它重新去复制一下。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_91.png)

不一样的实力，是需要就是说重新赋予不一样的这个参数的，咱们单独定义一个update sitting，self这个逻辑怎么去处理它，就是你去赋值嘛是吧，而且是给我的自己的实力去赋值，就是你应该是什么。

for这个name in self sitting点，Kiss，咱们这咱们说过，他是用这个字典来存储的，字典存储它肯定前面是变量名。



![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_93.png)

就是名字是变量，是这个变量名，然后后边是它的这个值对吧，比如说我ma30。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_95.png)

你应该是这样的，对不对，然后这个时候你就变成他的这个名字，然后if name in小点。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_97.png)

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_98.png)

这个pa2S，就是如果说我的这个名字，在我的这个PS这个变量里边，注意看啊，这个时候cf p s没有被这个复制，他这个其实是类变量对吧，就是这个里面存放着的啊，它其实是类变量，然后我给他挨个去赋值。



![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_100.png)

然后用sat a t t r就是变量赋值嘛，然后object是self。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_102.png)

然后name就是这个name。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_104.png)

然后他的这个value就是你self sitting里边的。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_106.png)

你取出它的那个value来对吧，把name给放进去。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_108.png)

这的赋值一定要清楚了，他跟这个copy其实挺类似的，它是把这个sitting，因为sitting对吧，因为这个PRSP2S它是类变量，然后去类变量里边找这个名字，如果有的话，我就给实例self嘛。

给实力付这个变量，然后用这个我给传进来的这个setting里边，这个变量值是吧，这个时候其实是在你的实力里边，你增添了很多，只要是这个PS就是参数类参类里边，这个PS里边有的这个名字会给它附上值是吧。

这个也一定要理解啊。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_110.png)

咱们可以把在初始化的时候就让他自己去复制。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_112.png)

Up the setting，然后括号啊，Desitting，括号好。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_114.png)

Updsitting，做完之后，咱们后边应该去实现什么功能。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_116.png)

咱们看看上面一部分的公用功能，委托发送，你是不是得有委托发送。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_118.png)

那我就定义一个sorder self，那你应该去传什么参数呢，你发送委托，你是不是得有价格price，它是它是float类型的，你是不是得有手术，volume它是int类型的，因为这个期货里边。

它是没有说3。5首这么一说的啊，你是不是得有方向，Direction，Direction，咱们现在没有给它定义这个它属于哪个类呢，咱们可以你因为你方向只有多和空嘛。

你完全可以从这我给它定义一个就是from。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_120.png)

然后serious direction。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_122.png)

然后它继承词。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_124.png)

这个咱们之前也讲过枚举类吗，它只有有限个数的话，就一个是多，一个是空多，咱们用long来表示，long来表示，写上多，然后空用SHT来表示，然后写上空，有限个数的罗列啊，有点类似于常量。



![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_126.png)

这个时候咱们可以在前面把它给导入进来，From engine import direction。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_128.png)

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_129.png)

你就可以标示它为direction了啊，direction要么是多，要么是空，这样就省去，比如说你用字符串来传输，这很麻烦，万一你写错了呢，对不对，好方向，有了开屏的右吧。



![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_131.png)

offset好，这个一样的，咱们再听一个。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_133.png)

开咱们用open。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_135.png)

平咱们用close。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_137.png)

同样的导入它是吧。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_139.png)

直接写他就能自己去导入啊，好方向，有了开屏，有了后边还有什么呀，他是不是他用什么样的委托，对不对，咱们委纳平台里边只有两个委托，一个是限价委托，一个是停止，答案就是stop委托。

咱们在这就写上一个stop。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_141.png)

它是一个布尔值，我是不是用stop委托，默认是等于true是吧。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_143.png)

这个stop委托和这个限价的委托是完全是反着的，在这我就不多讲了啊，你实现这个功能，你实现这个功能大概参数就是这么多啊。



![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_145.png)

你实现这个功能，你下面怎么写呢是吧。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_147.png)

你就需要点把它扔给CTA引擎啊，因为你模板不是来实现这个去发送委托。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_149.png)

不是负责跟就是说咱们服务器交互的，它只是一个策略模板对吧，这个类实现的功能，它不可能去直接去把代码一直写到，去发送委托的，因为这个里边逻呃它有很多的逻辑嘛。

所以说你直接c c t engine s order，然后把它里边这就是这些变量全部给它传进去，但是你一定要把cf给传进去，就是把这个实例给他传进去，因为你这个CTA引擎回回测引擎好，是实盘引擎也好。

它不可能单独处理，尤其是实盘引擎，它不可能单独处理，只有一个类，只有你一个实例化，尤其是实盘的时候，它可能多个实例化并存，所以说他在委托回调的时候，他得知道这个委托是从哪个里边来的啊。

你一定要把self给它传进去。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_151.png)

然后后边的price。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_153.png)

然后这个WOL。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_155.png)

Direction，Offset，对吧，他有返回值吗，一般会给你一个委托的，这个就是他那个委托号是吧，所以说你直接去蹭一个这个，因为你return了，因为它本身你在CCTA引擎里边去写。



![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_157.png)

他肯定也必须得有返回值的，所以说这咱们就可以首先写上第一个。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_159.png)

它要实现的，当然得需要ada struct method的装饰一下。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_161.png)

它不用具体去实现对吧。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_163.png)

然后这个里边你需要去传入的。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_165.png)

我就把这一堆给它粘过来。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_167.png)

Ctrl c。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_169.png)

啊这个里边你首先得接一个strange，这个是哪个实例，当然你也可以标注它是city template。



![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_171.png)

但是由于咱们下来会从这一导入这个best engine，包括现在已经导入了direction和offset，你如果再从这儿来导入这个c t engine的话，不就是说它会相互导入，这样是有问题的啊。



![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_173.png)

这你就不要再写了，等导包的时候，咱们会具体说好。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_175.png)

这边写完之后，然后就写个pass就可以了，这个时候你如果再写个，你给他重写一下啊。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_177.png)

不用重写，因为我还没导入呢，好SORDER实现完了之后，其实你按照逻辑来说，他如果说想用的方便的话，是不是你得把by short sell cover，就是开多仓，平多仓，开空仓平多仓啊。

平空仓给它单独去实现出来，这样的话你在你的策略里边调，会显得就是很好读，这个代码很易读，因为by就代表着就是呃开多单，然后shot就代表着开空仓是吧，然后cover是代表着平空仓，cl是代表着屏多仓啊。

你给它单独实现出来，其实这个实现出来很简单，首先self你传入的by，其实它是direction和这个offset已经被指定了。



![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_179.png)

direction就是就是多么offset，就是开码开多嘛。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_181.png)

所以说这些就不用了，你只需要输入price float。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_183.png)

然后volume，int还有个它是不是这个stop单是吧。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_185.png)

Stop，然后布尔。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_187.png)

给它默认一个true，这个你就完全可以self sorder。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_189.png)

给这个咱们已经定义好的这个SORDER，然后给他传这个price。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_191.png)

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_192.png)

然后direction直接写direction点long是吧，然后offset直接写offset点open。



![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_194.png)

然后stop就等于stop。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_196.png)

啊这样就可以了，同样的，咱们把其他的几个给把其他的几个给实现出来。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_198.png)

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_199.png)

四个应该是这个应该是shut，啊这个应该是sell。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_201.png)

看吧期货里边只有这四种操作嘛对吧，然后SHTSHT里边咱们把这个改成short，offset还是open是吧，然后这个sell sell它的方向其实是你平多单，其实就是卖出去嘛。

其实就是shirt嘛啊他的这个开屏是close平仓嘛。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_203.png)

然后最后一个你cover cover就是凭空单，其实就是买入也是就是多嘛，然后你写上offset点close好。



![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_205.png)

这个几个就实现完了是吧，你在这个实例化之后，你直接可以调用by shirt。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_207.png)

省得你SORDER，然后那个代码看起来也不明白，你还得去看里边direction和适合这个offset，方向和这个开屏。



![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_209.png)

你这样给它实现出来，就省得你去再过一遍脑子对吧好。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_211.png)

这个实现完了之后，咱们再看一看日志的输出参数的设定。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_213.png)

写完了委托的发送啊，还有日志的输出，咱们直接可以df right log。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_215.png)

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_216.png)

这个你是肯定得写的，因为你开仓了，你肯定得输出日志嘛是吧，日志输出是message，然后STR这个咱们直接可以sc t engine right log。



![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_218.png)

把这个直接把message给它传进去吧。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_220.png)

或者你把strange t r a t EG y s，strange给它传进去，就是self吗，传进去之后，然后把message给他传过去，你得让他知道是哪个实例化的策略。



![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_222.png)

哪个策略他发的这个日志是吧，从这你就给他再at object method，然后DF呃，Right log，cf你接一个strange，T r a t e g y strange。



![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_224.png)

然后你再接message。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_226.png)

你从这儿呃，直接我先pass吧。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_228.png)

啊直接pass嗯。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_230.png)

这个因为你到时候继承它的时候，你单独去写，为什么你不直接print啊，因为你真正的运行起来的时候，你这个日志是需要保存的呀，你不仅仅是说是就是print，你到你你的那个CMD或者power shell。

或者这个窗口里边呃，你不保存的话，如果说中间出问题，你最起码知道哪出了问题，日志输出了什么东西，所以说你日志得用单独的日引擎，去给它进行输出对吧。



![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_232.png)

所以这一点一定要注意，VLOG要实现出来，然后参数的设定还有一些。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_234.png)

比如说像参数的获取，再写一个就是get这个参数的获取，就是当你比如说我想看现在这个实例化的这个，我跑的这个策略，它里边这个参数设定为什么，比如说我在对比它，比如说开了仓了，他应不应该开仓。

我想看它这个参数，你得有个方法，然后能获取到他的这个参数设定吧，而且是获取到这个实例化的这个参数设定是吧，PS以这个dict的方式，就是字典的方式给他返回出来，这个逻辑怎么去写呃。



![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_236.png)

你返回的这个参数，跟你的这个在这个PS里面定义的，就是说里边输入的，当然这里面肯定是字符串啊。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_238.png)

就是你肯定是以这个为基准嘛，既然你写到这个里边，他就是可以就是需要往外展示的对吧，或者需要保存的，你都在，你都是放在这个里边儿好。



![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_240.png)

那我就以这个这个PRPRS里边这个为基准，怎么去给他以这个字典呢，首先咱们以先定义一个字典，就是呃这个应该是strange t a t EG y，Strange p s，它是一个dict。

A full name in sp，A s s。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_242.png)

然后GATTR啊，这是获取吗。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_244.png)

kate AD t r object是从我self，就是因为它是获取的我实力的参数嘛。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_246.png)

self object name就是这个name，然后把它存储在哪个里边呢，就是应该是strange s t r a t EG y，strange pr等于它得有个key key值。



![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_248.png)

就用name来表示。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_250.png)

然后最终你把这个return这个strange，TRATEGY把这个字典给返回出去，这个代码应该能理解吧，我去这个self点PS，我实力的这个参数这个列表里边去找，这个列表能找到吗。



![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_252.png)

在我实例化的时候，我并没有copy，我是找不到的。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_254.png)

他会去我的这个父类里面去找父类，不是这个类，是他被继承的那个类，那个类里边肯定就是你的策略类吗。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_256.png)

策略类里边肯定是写了你的参数的，它就能找到了啊。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_258.png)

然后在再去你的实力里边去找get AD t r，这个是self，是实例里面去找跟他名字一样的，然后再赋值给这个strange p s，这个字典里边以这个name为key。

然后以这个找到了这个值为value存进去，然后再返回出来是吧，这个能理解吧，啊好咱们再实现一个就是GCLS类的PS，这个里边你去获取类的这个参数，为什么要获取类的参数，就是我需要就是我看一看我这个类。

它的基础的设定这个参数是个什么情况，就是我实例化。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_260.png)

我有一套参数，但是我写策略的时候，我这个类一开始设定的。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_262.png)

它这个参数是什么，我想获取一下，那这个怎么写。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_264.png)

就是你需要用at class method。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_266.png)

就是我去找我累的啊，这个里边的这个参数对吧，cs里边好一样的。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_268.png)

我定义一个叫cl s啊。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_270.png)

这个缩进的多了吗。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_272.png)

缩进的多了，我去定一个CLS，这个PARS等于。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_274.png)

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_275.png)

好我一样的。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_277.png)

full name in4点P。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_279.png)

不是cf点撇S了，是cl s p s。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_281.png)

然后CLSPARS，这个name就等于同样的GDTR。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_283.png)

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_284.png)

去哪个对象里面来找呢，就去CLS里面去找找这个name啊。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_286.png)

然后找到它的值，然后return strange t r a t e stratt r a t啊。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_288.png)

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_289.png)

不是专辑，class c o s p l s把它返回出来，咱们捋一下这个代码啊，看似写的简单，它是一个类方法，这个类方法，然后创建了一个字典，For name in cl s p s。



![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_291.png)

你实际上在你这个模板类实现了这个方法是吧，就是get这个CLS这个方法，然后继承了模板的这个子类子类里边，去寻找CLSD点PRS，它能在子子类里面找到这个PARS吗，他找不着的。

他找不着就去他的父类里面去找，就去他的父类里面去找CP点，PS就去他的父类里面去找，父类里面去找呢，然后cl就这个P点name等于get AD t r，不是找不着啊，因为你必须得在这个子类里边。

你的策略里边必须得定义这个就是说PS的，你在这个子类里边肯定是能找着的，他首先去子类里边来找，你肯定是定义了，因为父类里边它只有个空列表嘛，你找到也没意思呃，也没意义对吧，所以说子类里边肯定是能找到的。

找到了之后，然后呢就说你会在用这个去类，去这个子类里边去找它对应的这个name，然后再把这个值给取出来，它并不会在实例化那个那个对象里边去找，他会去这个类里边去找，对吧啊，这个你一定要分清楚了。



![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_293.png)

刚才我都有点扰乱了啊，啊虽然看似代码简单。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_295.png)

但是你得知道它这个里边如何去获取值的。

![](img/cf36ec3f724de3c94bb2f027cb8bdb8d_297.png)