# （三）Python多因子量化选择与机器学习 （IC／IR／因子收益率） - P1 - 代码解析与论文精读 - BV1WD421E7xn

哈喽各位小伙伴们大家好，今天我们来到多因子量化，选股与机器学习的第三讲，这一讲呢仍然是停留在最前面的那个，因子有效性分析的一部分，名字叫做ICR与因子收益率的计算，嗯小伙伴们不要慌。

就是为什么还讲最开始的这些呃，因子的有效性检验呀，因子的预处理呀，因为这些东西是基础知识，想要进入啊，想要写毕业论文，或者是想要进入炼化行业的这些概念，必须要了解的，什么叫IC值，什么叫IR值。

什么叫因子收益率嗯，做量化的必须要去懂的基础概念嗯，我们不能一口吃个大胖子，要一步一步来，所以今天就是讲第三讲啊，这个系列会非常漫长，那个后面也会定期的啊，为了防止大家比较烦躁。

后面也会定期更新一些其他的内容，嗯然后还是继续我们上次的内容，我们对这个因子的这个收益率，不是因因子的这个因子值，对它进行了一个预处理啊，因此中心化行业，中心化和市值中心化进行了一些预处理。



![](img/83fdf62721d53898ba9414a08d6db8d9_1.png)

预处理完之后，我们又进行了单一份检验。

![](img/83fdf62721d53898ba9414a08d6db8d9_3.png)

那今天第三讲，我们来讲三个概念，第一个是IC值，IC值其实就是嗯，当前因子值和未来时刻收益率的相关系数，其实很简单，这个定义也很简单，但是如果不知道的就真不知道，就是其实就是当前因子值与未来时刻。



![](img/83fdf62721d53898ba9414a08d6db8d9_5.png)

收益率的啊那个相关系数，什么叫RR值，R值呢，就是这个因子的均值与因子的标准差的比值，就是IR值，其实IR值其实就是由IC值计算得到的，那还有一个值就比较具有迷惑性了。



![](img/83fdf62721d53898ba9414a08d6db8d9_7.png)

什么叫做因此收益率嗯，因子收益率这边有有定义，因子收益率其实是权重系数，就是因子收益率在固定周期下，因因子的暴露值和下期收益率之间，构建横截面回归方程，得到了权重系数，即为因子收益率值。

所以他其实构建了一个回归方程。

![](img/83fdf62721d53898ba9414a08d6db8d9_9.png)

回归方程里面的系数就是这个因子收益率值好。

![](img/83fdf62721d53898ba9414a08d6db8d9_11.png)

那话不多说，还是我们要看一下代码对吧，呃首先第一步呢就是把这个数据进行导入。

![](img/83fdf62721d53898ba9414a08d6db8d9_13.png)

导入这些因子啊。

![](img/83fdf62721d53898ba9414a08d6db8d9_15.png)

为什么选这么少呢，就是选这些因子啊，大家可以自己在各自的数据集上面进行计算啊。

![](img/83fdf62721d53898ba9414a08d6db8d9_17.png)

只是以这些因子值为例，以这些因子值为例呢。

![](img/83fdf62721d53898ba9414a08d6db8d9_19.png)

我们第一步要计算这个IC值，C值其实就是横截面回归慢。

![](img/83fdf62721d53898ba9414a08d6db8d9_21.png)

我们要计算因子值，当前就是把每一个，因为每一个日期就会有一组因子值，和一组收益率值，所以我们对这个日期进行group by，我们每一个日期都计算当前因子值，X和收益率的一个回归系数。

Correlation，其实核心就是这个代码，Goodbye，点data a play，然后X点CORATION，和下未来时刻的收益率的相关系数就是IC值。



![](img/83fdf62721d53898ba9414a08d6db8d9_23.png)

我们得到这个IC值之后，我们先运行一下。

![](img/83fdf62721d53898ba9414a08d6db8d9_25.png)

看看是个什么结果，这个IC纸我们打印一下哈。

![](img/83fdf62721d53898ba9414a08d6db8d9_27.png)

![](img/83fdf62721d53898ba9414a08d6db8d9_28.png)

![](img/83fdf62721d53898ba9414a08d6db8d9_29.png)

我们打一下这个AC值，看到没有。

![](img/83fdf62721d53898ba9414a08d6db8d9_31.png)

这个C值，大家可以看一下哈，是每一个时刻，我们这个只选择的是2018年到，2017年到2018年，你看每一个时刻都有一组IC值，看这个这个因子的这个时刻的C值，这个因子的这个时刻的C值。

所以我们把每一个时刻的IC值算出来了。

![](img/83fdf62721d53898ba9414a08d6db8d9_33.png)

那么所有时刻的C值的均值，就是这一列的均值除以这一列的标准差。

![](img/83fdf62721d53898ba9414a08d6db8d9_35.png)

就是这个IR值，呃那接下来我们就开始这个IC值算了之后。

![](img/83fdf62721d53898ba9414a08d6db8d9_37.png)

那接下来我们就开始计算计算一个概率。

![](img/83fdf62721d53898ba9414a08d6db8d9_39.png)

看看我们要判断这个因子有没有效，看看看看在这么多日时期内。

![](img/83fdf62721d53898ba9414a08d6db8d9_41.png)

它这个因子的值大于0。03的这个概率。

![](img/83fdf62721d53898ba9414a08d6db8d9_43.png)

就是在这么多日期嗯。

![](img/83fdf62721d53898ba9414a08d6db8d9_45.png)

我们以0。03为一个阈值，如果大于0。03，就证明它有效，就是其实就是计算因子有效率的一个方式。

![](img/83fdf62721d53898ba9414a08d6db8d9_47.png)

我们来做一个回归判断，他大概是不是大于0。03，如果大于0。03就好end一下，然后除以这个除以这个总数。



![](img/83fdf62721d53898ba9414a08d6db8d9_49.png)

嗯然后看看这些因子。

![](img/83fdf62721d53898ba9414a08d6db8d9_51.png)

就是最后我们判断一下这个因子的有效概率，0。10。75，0。16，大于零的概率非常低，有效性很差。

![](img/83fdf62721d53898ba9414a08d6db8d9_53.png)

嗯那接下来我们就要计算这个因子收益率值，那因子收益率值，其实就是把因子值和未来的这个收益率值Y，进行一个回归，建立一个回归之后，我们取这个correlation，我们取这个呃系数。

就是这个回归系数作为当前的这个呃，因此收益率值。

![](img/83fdf62721d53898ba9414a08d6db8d9_55.png)

那每一个时刻都会有一个因子的系数。

![](img/83fdf62721d53898ba9414a08d6db8d9_57.png)

我们把这些系数相加就可以得到总额。

![](img/83fdf62721d53898ba9414a08d6db8d9_59.png)

总所有时刻的，因此收益率的一个均值还要再除以一个N。

![](img/83fdf62721d53898ba9414a08d6db8d9_61.png)

还要再除以一个N嗯，就是就是因子收益率的均值。

![](img/83fdf62721d53898ba9414a08d6db8d9_63.png)

哎这里哦这里处不处处温都一样，因为因为大家的时刻都一样，就是时间段都一样，所以这里就没有纯，其实应该除以一个N就是因子收益率的均值。



![](img/83fdf62721d53898ba9414a08d6db8d9_65.png)

然后这个除以100呢，就是把这个因子收益率呢呃缩小。

![](img/83fdf62721d53898ba9414a08d6db8d9_67.png)

这个为什么这么做，可能大家可能不出一把也没事，所以我们最后得到了几组值哈。

![](img/83fdf62721d53898ba9414a08d6db8d9_69.png)

第一个是IC的均值，就这么多时刻取平，就是每一列取平均，然后还有IC的标准差，然后IC的min除以IC的标准差，就是IRR值，然后我们还要计算这个因子的有效的概率，它在这么多时间内。

它的有效率有多少是0。91，这个就比有效有效率就比较高，这个0。16有效率就比较低，这个0。83就有效率比较高，然后0。41有效率就比较低，所以我们可以根据这个因子的有效率，来进行因子的筛选。

还有这个因子收益率的均值嗯。

![](img/83fdf62721d53898ba9414a08d6db8d9_71.png)

是是这么多，然后正的就是正的，就是当前因子值与未来收益率值的，相关系数是正的，那么如果是负的，就证明当前因子值越来收益率的值，信那个那个回归系数是负的，就是负相关，正值正相关啊，负值负相关。

所以很明显这个净资产收益率正相关，这个也是正相关，这是正相关，这是正相关，然后这个呃资产负债率就是负相关，它负债越多，它的未来收益率就越低。



![](img/83fdf62721d53898ba9414a08d6db8d9_73.png)

所以大概就是这个意思，那我们接下来就开始筛选，我们我们筛选出C的均值大于0。03的。

![](img/83fdf62721d53898ba9414a08d6db8d9_75.png)

这个因子，有这么多因子。

![](img/83fdf62721d53898ba9414a08d6db8d9_77.png)

然后并且进行了一个排序，进行一个排序。

![](img/83fdf62721d53898ba9414a08d6db8d9_79.png)

那接下来就是绘图了，绘图完之后啊，因此收益率的这个啊均值是什么样的。

![](img/83fdf62721d53898ba9414a08d6db8d9_81.png)

然后因子的这个IR值是什么样的。

![](img/83fdf62721d53898ba9414a08d6db8d9_83.png)

还有因子的这个呃大于0。03，它的呃排序就是因子收益率均值的排序。

![](img/83fdf62721d53898ba9414a08d6db8d9_85.png)

因此按R的排序因子啊，这个有效有效性的这个直方图。

![](img/83fdf62721d53898ba9414a08d6db8d9_87.png)

那我们也可以绘制一下它的走势。

![](img/83fdf62721d53898ba9414a08d6db8d9_89.png)

就是类似于这种。

![](img/83fdf62721d53898ba9414a08d6db8d9_91.png)

我们也可以绘制一下走势，它每一个因子值的啊，这个呃直方图它的一个直方图的分布，我们可以选一个0。03和负的0。03。



![](img/83fdf62721d53898ba9414a08d6db8d9_93.png)

反正我们可以设置一条阈值，然后根据这个阈值我们来筛选这个因子值啊。

![](img/83fdf62721d53898ba9414a08d6db8d9_95.png)

我们这一阈值是0。03，根据这个0。03。

![](img/83fdf62721d53898ba9414a08d6db8d9_97.png)

我们把因子值呃有效性的因子筛选出来。

![](img/83fdf62721d53898ba9414a08d6db8d9_99.png)

牵引出来之后，我们对他的这个因子收益率均值，因此2R值和这个有呃有比率。

![](img/83fdf62721d53898ba9414a08d6db8d9_101.png)

就是大于0。3的比率，就画了一个直方图。

![](img/83fdf62721d53898ba9414a08d6db8d9_103.png)

好今天就主要讲了三个概念。

![](img/83fdf62721d53898ba9414a08d6db8d9_105.png)

一个是什么IC值，什么叫IR值，什么叫因子收益率值呃，如果如果说的话，IC值是某一个时刻，它的因子值和未来收益率值的一个相关系数，而IR值是整体进行衡量，就是在总过去一段时间内。

IC的均值除以X的标准差，它是衡量整体一段时间的一个，因子的有效性的情况，而因子收益率呢是呃，到底就是它的相关性相关系数是正的还是负的，嗯那么呃它的绝对值越大，就证明它的那个相关性就越高。

其实是建立了一个回归方程。

![](img/83fdf62721d53898ba9414a08d6db8d9_107.png)

用回归方程来代表这个因子的有效性，的一种评判方式。

![](img/83fdf62721d53898ba9414a08d6db8d9_109.png)

好今天我们就讲到这里。

![](img/83fdf62721d53898ba9414a08d6db8d9_111.png)

嗯那个呃其实还是概念普及哈，嗯嗯后面还会继续在下下节课再讲好，祝大家生活愉快。

![](img/83fdf62721d53898ba9414a08d6db8d9_113.png)