# 在qlib和mlrun基础上的数据的特征处理 - P1 - 弯曲的时间 - BV1Ny411B7cC

![](img/16e2f81d8fb5950e25b75a349609e37e_0.png)

哈喽大家好，书，接上回，我们上一回呢把数据导入进来，然后生成了一些有趣的东西，我们也看到了相应的一些数据的内容，那么我们今天呢继续在这个基础上，继续往下推进，去看一下，往下再推进。

去进行机器学习训练的时候会遇到哪些问题哈，顺便呢我们重新复一新一下q lib的使用方法，有很多同学对一些使用方法，就觉得有一些困难啊，OK啊，然后我们看一下这个输出，对不对。

看下的输出状态呢叫complete，输出呢，其实就是呃输出了一个附件对吧，核心关键的呢它用的是，用的是什么呢，用的是auto trainer啊，他用了这么一个机器学习的，自动化训练的一个工具。

然后嘞他用的数据叫DATASET，如输出是DATASET啊，然后用的是堆积森林分布，对吧啊，0。2，然后标签它这个叫label，它这个叫label，我们看一下模型的名字叫cancel，Under。

叫chin，OK我们看一下哈，我们看一下上面的数据来源哈，维基森林分分类，随机森林分类，它首先得有一个分类的标记，它的标记是什么呢，咱们看一下他的他这里面特别说明了一下。

他这个叫breast consoliball，这个叫库洛姆，是叫label，他的这个你看啊，咱把它导进来了，导进来了之后呢，呃非常name，还有他的这个data塔，然后统一叫做cancel date。

Cancel dataset，这一个breast cancel label，额是他的目标变量，Target and label，然后他把这个数据呢comcontact at把它contact一下。

那样的话我们就会发现呢，就会有一个breast cancel dataset，这里边有个label，我们看下数据啊，看到数据比较直观一点，他的数据在哪里呢，在这里呃，是这个吧。

然后ARTIFENCE和数据对吧，然后它应该有个label，哎对吧，他有是有个叫label的东西，但是有一个叫label的东西嗯，但是在我们传统的量化交易里边，我们的label是什么呢。

我们的label是收盘价呀，对不对。

![](img/16e2f81d8fb5950e25b75a349609e37e_2.png)

所以在呃咱们的这一个里面，我们就会看到我们看到什么呢，我们看到有开盘价，最高价，最低价。

![](img/16e2f81d8fb5950e25b75a349609e37e_4.png)

收盘价，还有factor，还有隐因因子对吧，那我们看一下我们的数据啊。

![](img/16e2f81d8fb5950e25b75a349609e37e_6.png)

我们的数据是我们再打开一个页面啊。

![](img/16e2f81d8fb5950e25b75a349609e37e_8.png)

按一下可以按一下它的ARTIFX对吧，啊有data u good time，开盘价最高价，收盘价最低价，还有一个叫factor对吧，呃我们看一眼啊，然后这个叫pop out是啥，是他的大概是这个样子。

那我们的收盘价如果作为目标变量的话，我们如何去看一下这个问题。

![](img/16e2f81d8fb5950e25b75a349609e37e_10.png)

咱们先跳出来m wrong这一套体系，我们先看QDB这套体系，别把自己绕晕了啊，亲爱的，有一个他的一个好像内核源没装上，看下啊，重新加载一下啊，重新调整一下吧，OK然后咱们继续哈，呃我们看一下他的细节。

它的细节是什么样子的呢，我们这是他的画图，然后，这个是什么，这个是打印吧，我记得好像是对吧，看能不能选这个，还选个这，然后我们往下走啊，往下走的话，他是这个就他只是做了画图啊，画图也没什么意义。

然后这个也没啥往下走啊，额这个还是继续继续呃，这个是他的特征啊，他加了一个特征，同学们朋友们，他加了一个特征呃。



![](img/16e2f81d8fb5950e25b75a349609e37e_12.png)

我们把这个特征也放进来，因为我们在做机器学习的时候，我们也是需要特征的对吧，我们再把这个特征放到哪里去呢，放到放到这里，放到这里来啊，那这个叫B啊，他这个叫易菲特对吧。



![](img/16e2f81d8fb5950e25b75a349609e37e_14.png)

然后他还加了一堆这个呃，不是这加了一个特长，是但是就只加了一个特点，加了一个特征。

![](img/16e2f81d8fb5950e25b75a349609e37e_16.png)

咱们也加一个特征可以吗，那也加一个车。

![](img/16e2f81d8fb5950e25b75a349609e37e_18.png)

Ok，加完这个特征之后呢，然后是，那这里面是确定了一个叫A，他定义了一个叫什么的名字呢，这是一个曲线嘛对吧，然后他是data loader，data loader之后呢，他这里面是收盘价除以呃。

收盘前期前十天的收盘价，然后作为收益率较额对，然后把它load进来，然后data handle呢就是load一下UDL，我们先看下QDL是怎么定义的，然后就这一个开始先结束时间对吧，对这些就无所谓了。

然后他这个里面呢做了一套什么东西呢，而是在数据层面做处理啊，然后呃做了一个什么呢，做了一个机扣中文化，对不对，然后fetch一下，ok finch完了之后呢。

这里面做到了dataset segments，咱这样啊，咱不着急啊。

![](img/16e2f81d8fb5950e25b75a349609e37e_20.png)

咱先把这个先跑一遍，看一下，抖抖，再抖，这里还有个报错，看一下，呃不匹配要求，为什么叫我哎，怎么这里有一个R呢，看一下sorry，要怎么报这个图啊，你，对，2。2啊，哦这不成功两次了，看最新的这一个。

看下最新的哎，看到了没，我们新多了一个这个这个这个变量，对不对，呃新多了一个变量，我们看一下这个set，这个就是这个或者一个特征变量，行咱们继续啊。



![](img/16e2f81d8fb5950e25b75a349609e37e_22.png)

我们继续往下看，继续往下看哦，我们都看到他说到这里其实都是在处理数据，然后是train对吧，然后时间这个ds prepare是train，然后ds prepare是valid，然后嘞呃然后到这里。

这里这里看一下HDHD做了实例化，前面这一些应该都是在处理数据，我就把这个处理数据的过程呢，然后咱们把，啊，对到这个程度的数据对吧，搞掉搞掉之后呢就变成HD了，HD之后下面就是拿到了HD。

然后fetch在这之后应该拿的是DF是个数据，数据之后就没啥了，然后下一步就是机器学习了嘛，这是数据数据是hd set，这个地方多了个segments，下面才是训练嘛对吧，所以我们按照这个这个结构啊。

我们按照这个结构我们重新生成一个数据集。

![](img/16e2f81d8fb5950e25b75a349609e37e_24.png)

前面的数据集呢只是我们的这个数据集，这是我们的一个非常简单的一个，关于股票价格的数据集，我们下一步要怎么做呢，要把股票的价格特征化，然后把它训它，把它拆成趁，然后评估还还有测试三个级别。

然后我们把这个数据先做做出来，为了为了更清晰的看到，我们把这个地方呢我们拆一个啊，重新拆一个重另一个我们叫做releaf cn data，V2，然然后呢咱们，我see一下，没问题吧。

这一个呢咱们改一个名儿啊，叫什么发生器了，咱们咱们这个就叫贝塔，远一点吧，with the fat缓冲器，那我就不变啊，这个干掉。



![](img/16e2f81d8fb5950e25b75a349609e37e_26.png)

然后把它改一下，改成什么呢，改成呃看着维HDHD嗯嗯，这个应该是实例化了吧，应该是实例化实例化取了它，它的话是有一个HD对吧，HDHD是在哪里来的呢，HD是在这里来的，哎不对呀，这个。

HD这怎么跟158就连上了，帮我看一下啊，DSDS是train bh呃，按一下咱们先走这一步，看一看EFDHDH是它嘛，H是它，啊BQDLQDL是这里，CODL为什么是这样的。



![](img/16e2f81d8fb5950e25b75a349609e37e_28.png)

U g l。

![](img/16e2f81d8fb5950e25b75a349609e37e_30.png)

![](img/16e2f81d8fb5950e25b75a349609e37e_31.png)

啊那先QDL实例化，对不对，UDL实例化。

![](img/16e2f81d8fb5950e25b75a349609e37e_33.png)

然后六点l load，不管，注点2load load进来就是DF，这一个呢它是UDL，这是个DH，这两个做了一些数据的处理对吧。



![](img/16e2f81d8fb5950e25b75a349609e37e_35.png)

数据的处理一般把它先放在下面。

![](img/16e2f81d8fb5950e25b75a349609e37e_37.png)

然后把这个定义式放出来。

![](img/16e2f81d8fb5950e25b75a349609e37e_39.png)

![](img/16e2f81d8fb5950e25b75a349609e37e_40.png)

这样的话data data loader应该我理解它就是实例化，我看下变成DH了吗，dh fetch一下就是DF对吧。



![](img/16e2f81d8fb5950e25b75a349609e37e_42.png)

咱先这么抖一下，看有没有报错哈，然后这一个换成这个，读一遍，这个改一下吧，太多了，这地方，Q粒子不倒V2这样QLI补D，这换QLI补，It there are ok，然后，就改一下嘛对吧。

lip data杠V2，这个name呢我们也改成叫q lib data，然后这个发生器呢叫DATASET发生器，题吧，执行完了执行这个，诶这个地方有一个报错，我看到了grib data无效。

这个里边怎么还，我也不知道，然后这个也叫curly bator那一点啊，data toloader没有定义，看一下都data loader没有定义，那录点有定义啊，哦错了错了，E h，诶跑完了啊。

看一下我们的小结果，这一个对吧，啊最新的latest对吧，他是有个叫tag，每一个数据时都会给你留下的，这是PPL的格式。



![](img/16e2f81d8fb5950e25b75a349609e37e_44.png)

哎呀嗯看到了没啊。

![](img/16e2f81d8fb5950e25b75a349609e37e_46.png)

他是个PKL，所以呃他并没有实例化。

![](img/16e2f81d8fb5950e25b75a349609e37e_48.png)

我们得看一下啊，所以他并没有实例化，加了个fetch才是实例化，oh so diy加以防这个。

![](img/16e2f81d8fb5950e25b75a349609e37e_50.png)

加一行，这个就可以实例化，Hello，Ok，继续刷新一下，还是PKL，有点怪了，我已经finch了，我已经fetch了，为什么没有实例化呢，快点啊。



![](img/16e2f81d8fb5950e25b75a349609e37e_52.png)

![](img/16e2f81d8fb5950e25b75a349609e37e_53.png)

DF完全就是被16化了呀，再看一眼，咱们这样，咱们这样，为什么是，看一下，等下，有了FUQUA，OK那这个有两个字段，一个是他，一个是他吗，那没问题啊，我看一下。



![](img/16e2f81d8fb5950e25b75a349609e37e_55.png)

所以这就实例化了，实例化了之后呢，咱们继续哈，他这里面是DS了一下，vs了一下呢，然后我们简单的看一下，它这个DH对吧，找off for the self deceit，对了，它定了一个参数，开始时间。

结束时间，训练时间，剩下开始时间，训练结束时间，我这里有个market market，应该在上面有啊，我们先不找啊，然后这个应该是实例化HDHD，然后import的它，然后fish的它我们看一下。

用它试一下啊，这个看起来就比较完整哈，然后看一眼啊，就走到他这儿呗，对吧，走到这儿它其实就是一个参数。



![](img/16e2f81d8fb5950e25b75a349609e37e_57.png)

参数的话看一眼，唉还是改这个地方，改这个地方的话，我们。

![](img/16e2f81d8fb5950e25b75a349609e37e_59.png)

![](img/16e2f81d8fb5950e25b75a349609e37e_60.png)

我们把它放进来嘛，把它放进来，这些先把它删掉些，没有用，继续实验啊，继续实验OA，然后导入它，真好。

![](img/16e2f81d8fb5950e25b75a349609e37e_62.png)

![](img/16e2f81d8fb5950e25b75a349609e37e_63.png)

然后是HD。

![](img/16e2f81d8fb5950e25b75a349609e37e_65.png)

HD之后呢，他又引入了一个158158。

![](img/16e2f81d8fb5950e25b75a349609e37e_67.png)

这个稍后看一下，看一下代码，他引入的是个啥，稍后看一下，那理论上应该是不需要呀对吧，不有hand der函数了吗，哦也也放在这里面了，理论上不需要这个market可能得重新定义，你改一下market。

可以直接叫他，然后嘞这个我觉得可能不需要。

![](img/16e2f81d8fb5950e25b75a349609e37e_69.png)

我们先先先留着吧，然后这里面有个fetch20。

![](img/16e2f81d8fb5950e25b75a349609e37e_71.png)

就是实例化嘛对吧，OK咱们再来一遍，对不对，先留着它，然后再run一下，set一下，哎呀HB无效无效，这个地方应该是无线网，我觉得这，哎呃30行的HD，实际这个地方有啥问题，加上行号啊。

哦我加一个行号啊，30号，没问题啊，都有啊，那看没问题呀，这个就报了个什么错呢，报了一个嗯，看一下，夜潮，为什么会有一只呢，来一遍我写一下啊，理论上不应该有异常，project都没有定义啊。

下面再定义一下，诶这个我看一眼啊，Hd，那没有啥问题，咱把它注释掉看一下，哦我知道它可能各个格式这个地方有点问题，哦看到了，Sorry，sorry呀，小问题大错误啊，run一下，完了进来，诶看一下啊。

这就是158个因子咯，应该有个label，看一下这个，那这样咱这个数据就准备好了是吧好。

![](img/16e2f81d8fb5950e25b75a349609e37e_73.png)

今天先这样。